/* DAS PR0GRAMM MAG JAVASCRIPT UND...

jquery
	http://jquery.com/

jquery-cookie
	https://github.com/carhartl/jquery-cookie

jquery-tagsinput
	https://github.com/xoxco/jQuery-Tags-Input

John Resig's Simple JavaScript Inheritance
	http://ejohn.org/blog/simple-javascript-inheritance/
	
Fontawesome by Fonticons, Inc.
	https://fontawesome.com
*/

/* Amalgamation 2021-03-27 14:10:53 */
"use strict";window.p={NAVIGATE:{DEFAULT:0,SILENT:1,FORCE:2},LOAD:{OBJECT:0,PLAINTEXT:1,LAZY:2},path:'frontend/',currentView:null,$container:null,dispatchFromHistory:false,mobile:(/mobile|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),_routes:[],_loaded:{'lib/pproject.js':true},_current:[],_loadedCache:{},_navigationStack:[],_hasPushState:(window.history&&window.history.pushState),location:'--p-invalid',debug:false,log:function(){if(this.debug){console.log.apply(console,arguments);}},token:function(){return Math.random().toString(36).substr(2);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof p.Class||object===null){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=p.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=p.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof p.Class||ext===null){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
p.merge(original[key],ext);}}
return original;},load:function(file,flags){if(flags===p.LOAD.LAZY){return{lazy:true,file:file};}
var request=new XMLHttpRequest();request.open('GET','/'+file,false);request.send();return(flags===p.LOAD.PLAINTEXT)?request.responseText:{src:request.responseText,path:file};},require:function(file){if(this._loaded[file]){return;}
if([].indexOf&&this._current.indexOf(file)!==-1){console.log('Circular dependency: '+this._current.join(' -> ')+' -> '+file);return;}
this._current.push(file);var code=this.load(this.path+file,p.LOAD.PLAINTEXT)+"\n //# sourceURL="+this.path+file;try{eval.call(window,code);}
catch(error){console.error(error,error.message,error.lineNumber,this.path+file);}
this._current.pop();this._loaded[file]=true;},_cachedRegexp:{escapeQuotes:/'/g,escapeBackslashes:/\\/g,unescapeQuotes:/\\'/g,removeWhitspace:/[\r\t\n]+/g,printEscaped:/\{\{([\w\.\,\(\)\[\]\"]+?)\}\}/mg,print:/\{([\w\.\,\(\)\[\]\"]+?)\}/g,js:/<\?js(.*?)\?>/mg},compileTemplate:function(t){if(t.lazy){return p.compileTemplate(p.load(t.file));}
var path=t.path||'unknown';t=t.src||t;try{var re=this._cachedRegexp;var compiled=new Function("data","try {"+"data = data || {};"+"var _parts = [];"+"var print = function(a){ _parts.push(a); };"+"with(data){ _parts.push('"+
t.replace(re.escapeBackslashes,"\\\\").replace(re.escapeQuotes,"\\'").replace(re.removeWhitspace," ").replace(re.printEscaped,function(m,js){return"',"+js.replace(re.unescapeQuotes,"'")+".escape(),'";}).replace(re.print,function(m,js){return"',"+js.replace(re.unescapeQuotes,"'")+",'";}).replace(re.js,function(m,js){return"');"+js.replace(re.unescapeQuotes,"'")+";_parts.push('";})
+"');} "+"} catch( error ) { console.error(error.message + ' in "+path+"'); }"+"return _parts.join('');");}
catch(error){console.error(error.message,path);}
return compiled;},link:function(link){return'#'+link;},getURL:function(){var f='';if(document.location.pathname!='/'){f=document.location.pathname.substr(1);}
else{var match=window.location.href.match(/#(.*)$/);f=match?match[1]:'';}
return f;},getLocation:function(){return this.getURL().split(':')[0];},getFragment:function(){return this.getURL().split(':')[1]||'';},getQuery:function(name){var results=new RegExp("[?&]"+
name.replace(/[\[\]]/g,"\\$&")+"(=([^&#]*)|&|#|$)").exec(window.location.href);if(!results){return null};if(!results[2]){return''};return decodeURIComponent(results[2].replace(/\+/g," "));},navigateTo:function(location,mode){this._navigateSilent=(mode==p.NAVIGATE.SILENT);if(this._hasPushState){var url='/'+location;window.history.pushState({},document.title,url);this._dispatch(null,mode==p.NAVIGATE.FORCE);}
else{var url=document.location.href.replace(/#.*$/,'')+'#'+location;document.location.assign(url);}
if(CONFIG.ANALYTICS.ENABLED&&window._paq){_paq.push(['setCustomUrl','/'+location]);_paq.push(['setDocumentTitle',document.title]);_paq.push(['trackPageView']);}},replaceState:function(location){if(this._hasPushState){var url='/'+location;window.history.replaceState({},document.title,url);this.location=this.getLocation();}},navigateToPopStack:function(){if(!this._navigationStack.length){this.navigateTo('');}
else{this.navigateTo(this._navigationStack.pop());}},navigateToPushStack:function(location){this._navigationStack.push(this.getLocation());this.navigateTo(location);},addRoute:function(viewClass,rule){if(!viewClass){throw('Invalid viewClass '+viewClass+' for rule '+rule);}
var compiledRegexp=/(.*)/,names=[];if(rule!=='*'){names=rule.match(/<([^>]+)>/g)||[];for(var i=0;names&&i<names.length;i++){names[i]=names[i].replace(/<|:.*>|>/g,'');}
var regexp=rule.replace(/\//g,'\\/').replace(/<\w+:d>/g,'(\\d+)').replace(/<\w+:(.*?)>/g,'($1)').replace(/<\w+>/g,'([^\\/]+)');compiledRegexp=new RegExp('^'+regexp+'$');}
this._routes.push({rule:compiledRegexp,paramNames:names,viewClass:viewClass});},setView:function(viewClass,params){if(!this.currentView||this.currentView.classId!==viewClass.classId){if(this.currentView){this.currentView.hide();}
var newView=new(viewClass)(this.$container);if(newView.aborted){return;}
this.currentView=newView;}
if(this.onsetview){this.onsetview(this.currentView);}
this.currentView.show(params);},reload:function(){window.location.reload(true);},_dispatch:function(event,force){var prevLocation=this.location;this.location=this.getLocation();var prevFragment=this.fragment;this.fragment=this.getFragment();if(this._navigateSilent||(prevLocation==this.location&&force!==true)){this._navigateSilent=false;if(prevFragment!=this.fragment&&this.currentView&&this.currentView.fragmentChange){this.currentView.fragmentChange(this.fragment);}
return;}
var matches=null;for(var r=0;r<this._routes.length;r++){var route=this._routes[r];if((matches=this.location.match(route.rule))){var params={};for(var i=0;i<route.paramNames.length;i++){params[route.paramNames[i]]=decodeURIComponent(matches[i+1]);}
this.dispatchFromHistory=!!event;this.setView(this._routes[r].viewClass,params);this.dispatchFromHistory=false;return;}}},_started:false,start:function(container){if(this._started){return;}
var hashMatch=window.location.href.match(/#(.+)$/);if(this._hasPushState&&hashMatch){window.history.replaceState({},document.title,'/'+hashMatch[1]);}
else if(!this._hasPushState&&document.location.pathname!='/'){document.location.href='/#'+this.getLocation();return;}
this._started=true;this.$container=$(container||'body');var ev=this._hasPushState?'popstate':'hashchange';$(window).bind(ev,this._dispatch.bind(this));this._dispatch();}};"use strict";(function(window){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.p.Class=function(){};window.p.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var prop in this){if(typeof(this[prop])=='object'){this[prop]=p.copy(this[prop]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.p.Class.extend;Class.classId=prototype.classId=++window.p.Class._lastId;return Class;};window.p.Class._lastId=0;})(window);!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k="".trim,l={},m=a.document,n="2.1.0",o=function(a,b){return new o.fn.init(a,b)},p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};o.fn=o.prototype={jquery:n,constructor:o,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=o.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return o.each(this,a,b)},map:function(a){return this.pushStack(o.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},o.extend=o.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||o.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(o.isPlainObject(d)||(e=o.isArray(d)))?(e?(e=!1,f=c&&o.isArray(c)?c:[]):f=c&&o.isPlainObject(c)?c:{},g[b]=o.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},o.extend({expando:"jQuery"+(n+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===o.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isPlainObject:function(a){if("object"!==o.type(a)||a.nodeType||o.isWindow(a))return!1;try{if(a.constructor&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=o.trim(a),a&&(1===a.indexOf("use strict")?(b=m.createElement("script"),b.text=a,m.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":k.call(a)},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?o.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:g.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(c=a[b],b=a,a=c),o.isFunction(a)?(e=d.call(arguments,2),f=function(){return a.apply(b||this,e.concat(d.call(arguments)))},f.guid=a.guid=a.guid||o.guid++,f):void 0},now:Date.now,support:l}),o.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=o.type(a);return"function"===c||o.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,u=0,v=0,w=eb(),x=eb(),y=eb(),z=function(a,b){return a===b&&(j=!0),0},A="undefined",B=1<<31,C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=D.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",M=L.replace("w","w#"),N="\\["+K+"*("+L+")"+K+"*(?:([*^$|!~]?=)"+K+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+K+"*\\]",O=":("+L+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+N.replace(3,8)+")*)|.*)\\)|)",P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(O),U=new RegExp("^"+M+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L.replace("w","w*")+")"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=/'|\\/g,ab=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),bb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{G.apply(D=H.call(t.childNodes),t.childNodes),D[t.childNodes.length].nodeType}catch(cb){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function db(a,b,d,e){var f,g,h,i,j,m,p,q,u,v;if((b?b.ownerDocument||b:t)!==l&&k(b),b=b||l,d=d||[],!a||"string"!=typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(n&&!e){if(f=Z.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return d;if(g.id===h)return d.push(g),d}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&r(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return G.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(h)),d}if(c.qsa&&(!o||!o.test(a))){if(q=p=s,u=b,v=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){m=ob(a),(p=b.getAttribute("id"))?q=p.replace(_,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=m.length;while(j--)m[j]=q+pb(m[j]);u=$.test(a)&&mb(b.parentNode)||b,v=m.join(",")}if(v)try{return G.apply(d,u.querySelectorAll(v)),d}catch(w){}finally{p||b.removeAttribute("id")}}}return xb(a.replace(P,"$1"),b,d,e)}function eb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function fb(a){return a[s]=!0,a}function gb(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function hb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function ib(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||B)-(~a.sourceIndex||B);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function jb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function kb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function lb(a){return fb(function(b){return b=+b,fb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function mb(a){return a&&typeof a.getElementsByTagName!==A&&a}c=db.support={},f=db.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},k=db.setDocument=function(a){var b,e=a?a.ownerDocument||a:t,g=e.defaultView;return e!==l&&9===e.nodeType&&e.documentElement?(l=e,m=e.documentElement,n=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){k()},!1):g.attachEvent&&g.attachEvent("onunload",function(){k()})),c.attributes=gb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=gb(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(e.getElementsByClassName)&&gb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=gb(function(a){return m.appendChild(a).id=s,!e.getElementsByName||!e.getElementsByName(s).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==A&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){var c=typeof a.getAttributeNode!==A&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==A?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==A&&n?b.getElementsByClassName(a):void 0},p=[],o=[],(c.qsa=Y.test(e.querySelectorAll))&&(gb(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&o.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||o.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll(":checked").length||o.push(":checked")}),gb(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&o.push("name"+K+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||o.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),o.push(",.*:")})),(c.matchesSelector=Y.test(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&gb(function(a){c.disconnectedMatch=q.call(a,"div"),q.call(a,"[s!='']:x"),p.push("!=",O)}),o=o.length&&new RegExp(o.join("|")),p=p.length&&new RegExp(p.join("|")),b=Y.test(m.compareDocumentPosition),r=b||Y.test(m.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},z=b?function(a,b){if(a===b)return j=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===t&&r(t,a)?-1:b===e||b.ownerDocument===t&&r(t,b)?1:i?I.call(i,a)-I.call(i,b):0:4&d?-1:1)}:function(a,b){if(a===b)return j=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],k=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:i?I.call(i,a)-I.call(i,b):0;if(f===g)return ib(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)k.unshift(c);while(h[d]===k[d])d++;return d?ib(h[d],k[d]):h[d]===t?-1:k[d]===t?1:0},e):l},db.matches=function(a,b){return db(a,null,null,b)},db.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l&&k(a),b=b.replace(S,"='$1']"),!(!c.matchesSelector||!n||p&&p.test(b)||o&&o.test(b)))try{var d=q.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return db(b,l,null,[a]).length>0},db.contains=function(a,b){return(a.ownerDocument||a)!==l&&k(a),r(a,b)},db.attr=function(a,b){(a.ownerDocument||a)!==l&&k(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!n):void 0;return void 0!==f?f:c.attributes||!n?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},db.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},db.uniqueSort=function(a){var b,d=[],e=0,f=0;if(j=!c.detectDuplicates,i=!c.sortStable&&a.slice(0),a.sort(z),j){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return i=null,a},e=db.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=db.selectors={cacheLength:50,createPseudo:fb,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ab,bb),a[3]=(a[4]||a[5]||"").replace(ab,bb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||db.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&db.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return V.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&T.test(c)&&(b=ob(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ab,bb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=w[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&w(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==A&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=db.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&t){k=q[s]||(q[s]={}),j=k[a]||[],n=j[0]===u&&j[1],m=j[0]===u&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[u,n,m];break}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===u)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(t&&((l[s]||(l[s]={}))[a]=[u,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||db.error("unsupported pseudo: "+a);return e[s]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?fb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:fb(function(a){var b=[],c=[],d=g(a.replace(P,"$1"));return d[s]?fb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:fb(function(a){return function(b){return db(a,b).length>0}}),contains:fb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:fb(function(a){return U.test(a||"")||db.error("unsupported lang: "+a),a=a.replace(ab,bb).toLowerCase(),function(b){var c;do if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:lb(function(){return[0]}),last:lb(function(a,b){return[b-1]}),eq:lb(function(a,b,c){return[0>c?c+b:c]}),even:lb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:lb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:lb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:lb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=jb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=kb(b);function nb(){}nb.prototype=d.filters=d.pseudos,d.setFilters=new nb;function ob(a,b){var c,e,f,g,h,i,j,k=x[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=Q.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?db.error(a):x(a,i).slice(0)}function pb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function qb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=v++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[u,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[s]||(b[s]={}),(h=i[d])&&h[0]===u&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function rb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function sb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function tb(a,b,c,d,e,f){return d&&!d[s]&&(d=tb(d)),e&&!e[s]&&(e=tb(e,f)),fb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||wb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:sb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=sb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=sb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ub(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],i=g||d.relative[" "],j=g?1:0,k=qb(function(a){return a===b},i,!0),l=qb(function(a){return I.call(b,a)>-1},i,!0),m=[function(a,c,d){return!g&&(d||c!==h)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>j;j++)if(c=d.relative[a[j].type])m=[qb(rb(m),c)];else{if(c=d.filter[a[j].type].apply(null,a[j].matches),c[s]){for(e=++j;f>e;e++)if(d.relative[a[e].type])break;return tb(j>1&&rb(m),j>1&&pb(a.slice(0,j-1).concat({value:" "===a[j-2].type?"*":""})).replace(P,"$1"),c,e>j&&ub(a.slice(j,e)),f>e&&ub(a=a.slice(e)),f>e&&pb(a))}m.push(c)}return rb(m)}function vb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,i,j,k){var m,n,o,p=0,q="0",r=f&&[],s=[],t=h,v=f||e&&d.find.TAG("*",k),w=u+=null==t?1:Math.random()||.1,x=v.length;for(k&&(h=g!==l&&g);q!==x&&null!=(m=v[q]);q++){if(e&&m){n=0;while(o=a[n++])if(o(m,g,i)){j.push(m);break}k&&(u=w)}c&&((m=!o&&m)&&p--,f&&r.push(m))}if(p+=q,c&&q!==p){n=0;while(o=b[n++])o(r,s,g,i);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=E.call(j));s=sb(s)}G.apply(j,s),k&&!f&&s.length>0&&p+b.length>1&&db.uniqueSort(j)}return k&&(u=w,h=t),r};return c?fb(f):f}g=db.compile=function(a,b){var c,d=[],e=[],f=y[a+" "];if(!f){b||(b=ob(a)),c=b.length;while(c--)f=ub(b[c]),f[s]?d.push(f):e.push(f);f=y(a,vb(e,d))}return f};function wb(a,b,c){for(var d=0,e=b.length;e>d;d++)db(a,b[d],c);return c}function xb(a,b,e,f){var h,i,j,k,l,m=ob(a);if(!f&&1===m.length){if(i=m[0]=m[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&c.getById&&9===b.nodeType&&n&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(ab,bb),b)||[])[0],!b)return e;a=a.slice(i.shift().value.length)}h=V.needsContext.test(a)?0:i.length;while(h--){if(j=i[h],d.relative[k=j.type])break;if((l=d.find[k])&&(f=l(j.matches[0].replace(ab,bb),$.test(i[0].type)&&mb(b.parentNode)||b))){if(i.splice(h,1),a=f.length&&pb(i),!a)return G.apply(e,f),e;break}}}return g(a,m)(f,b,!n,e,$.test(a)&&mb(b.parentNode)||b),e}return c.sortStable=s.split("").sort(z).join("")===s,c.detectDuplicates=!!j,k(),c.sortDetached=gb(function(a){return 1&a.compareDocumentPosition(l.createElement("div"))}),gb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||hb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&gb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||hb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),gb(function(a){return null==a.getAttribute("disabled")})||hb(J,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),db}(a);o.find=t,o.expr=t.selectors,o.expr[":"]=o.expr.pseudos,o.unique=t.uniqueSort,o.text=t.getText,o.isXMLDoc=t.isXML,o.contains=t.contains;var u=o.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(o.isFunction(b))return o.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return o.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return o.filter(b,a,c);b=o.filter(b,a)}return o.grep(a,function(a){return g.call(b,a)>=0!==c})}o.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?o.find.matchesSelector(d,a)?[d]:[]:o.find.matches(a,o.grep(b,function(a){return 1===a.nodeType}))},o.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(o(a).filter(function(){for(b=0;c>b;b++)if(o.contains(e[b],this))return!0}));for(b=0;c>b;b++)o.find(a,e[b],d);return d=this.pushStack(c>1?o.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?o(a):a||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=o.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof o?b[0]:b,o.merge(this,o.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:m,!0)),v.test(c[1])&&o.isPlainObject(b))for(c in b)o.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=m.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=m,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):o.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(o):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),o.makeArray(a,this))};A.prototype=o.fn,y=o(m);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};o.extend({dir:function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&o(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),o.fn.extend({has:function(a){var b=o(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(o.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?o(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&o.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?o.unique(f):f)},index:function(a){return a?"string"==typeof a?g.call(o(a),this[0]):g.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(o.unique(o.merge(this.get(),o(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){while((a=a[b])&&1!==a.nodeType);return a}o.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return o.dir(a,"parentNode")},parentsUntil:function(a,b,c){return o.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return o.dir(a,"nextSibling")},prevAll:function(a){return o.dir(a,"previousSibling")},nextUntil:function(a,b,c){return o.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return o.dir(a,"previousSibling",c)},siblings:function(a){return o.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return o.sibling(a.firstChild)},contents:function(a){return a.contentDocument||o.merge([],a.childNodes)}},function(a,b){o.fn[a]=function(c,d){var e=o.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=o.filter(d,e)),this.length>1&&(C[a]||o.unique(e),B.test(a)&&e.reverse()),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return o.each(a.match(E)||[],function(a,c){b[c]=!0}),b}o.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):o.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(b=a.memory&&l,c=!0,g=e||0,e=0,f=h.length,d=!0;h&&f>g;g++)if(h[g].apply(l[0],l[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&j(i.shift()):b?h=[]:k.disable())},k={add:function(){if(h){var c=h.length;!function g(b){o.each(b,function(b,c){var d=o.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&g(c)})}(arguments),d?f=h.length:b&&(e=c,j(b))}return this},remove:function(){return h&&o.each(arguments,function(a,b){var c;while((c=o.inArray(b,h,c))>-1)h.splice(c,1),d&&(f>=c&&f--,g>=c&&g--)}),this},has:function(a){return a?o.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],f=0,this},disable:function(){return h=i=b=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,b||k.disable(),this},locked:function(){return!i},fireWith:function(a,b){return!h||c&&!i||(b=b||[],b=[a,b.slice?b.slice():b],d?i.push(b):j(b)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!c}};return k},o.extend({Deferred:function(a){var b=[["resolve","done",o.Callbacks("once memory"),"resolved"],["reject","fail",o.Callbacks("once memory"),"rejected"],["notify","progress",o.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return o.Deferred(function(c){o.each(b,function(b,f){var g=o.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&o.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?o.extend(a,d):d}},e={};return d.pipe=d.then,o.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&o.isFunction(a.promise)?e:0,g=1===f?a:o.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&o.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;o.fn.ready=function(a){return o.ready.promise().done(a),this},o.extend({isReady:!1,readyWait:1,holdReady:function(a){a?o.readyWait++:o.ready(!0)},ready:function(a){(a===!0?--o.readyWait:o.isReady)||(o.isReady=!0,a!==!0&&--o.readyWait>0||(H.resolveWith(m,[o]),o.fn.trigger&&o(m).trigger("ready").off("ready")))}});function I(){m.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),o.ready()}o.ready.promise=function(b){return H||(H=o.Deferred(),"complete"===m.readyState?setTimeout(o.ready):(m.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(b)},o.ready.promise();var J=o.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===o.type(c)){e=!0;for(h in c)o.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,o.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(o(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};o.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=o.expando+Math.random()}K.uid=1,K.accepts=o.acceptData,K.prototype={key:function(a){if(!K.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=K.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,o.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(o.isEmptyObject(f))o.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,o.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{o.isArray(b)?d=b.concat(b.map(o.camelCase)):(e=o.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(E)||[])),c=d.length;while(c--)delete g[d[c]]}},hasData:function(a){return!o.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(O,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?o.parseJSON(c):c}catch(e){}M.set(a,b,c)}else c=void 0;return c}o.extend({hasData:function(a){return M.hasData(a)||L.hasData(a)},data:function(a,b,c){return M.access(a,b,c)},removeData:function(a,b){M.remove(a,b)},_data:function(a,b,c){return L.access(a,b,c)},_removeData:function(a,b){L.remove(a,b)}}),o.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=M.get(f),1===f.nodeType&&!L.get(f,"hasDataAttrs"))){c=g.length;while(c--)d=g[c].name,0===d.indexOf("data-")&&(d=o.camelCase(d.slice(5)),P(f,d,e[d]));L.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){M.set(this,a)}):J(this,function(b){var c,d=o.camelCase(a);if(f&&void 0===b){if(c=M.get(f,a),void 0!==c)return c;if(c=M.get(f,d),void 0!==c)return c;if(c=P(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=M.get(this,d);M.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&M.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){M.remove(this,a)})}}),o.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=L.get(a,b),c&&(!d||o.isArray(c)?d=L.access(a,b,o.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=o.queue(a,b),d=c.length,e=c.shift(),f=o._queueHooks(a,b),g=function(){o.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return L.get(a,c)||L.access(a,c,{empty:o.Callbacks("once memory").add(function(){L.remove(a,[b+"queue",c])})})}}),o.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?o.queue(this[0],a):void 0===b?this:this.each(function(){var c=o.queue(this,a,b);o._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&o.dequeue(this,a)})},dequeue:function(a){return this.each(function(){o.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=o.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=L.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(a,b){return a=b||a,"none"===o.css(a,"display")||!o.contains(a.ownerDocument,a)},T=/^(?:checkbox|radio)$/i;!function(){var a=m.createDocumentFragment(),b=a.appendChild(m.createElement("div"));b.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var U="undefined";l.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function Z(){return!0}function $(){return!1}function _(){try{return m.activeElement}catch(a){}}o.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,r=L.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=o.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return typeof o!==U&&o.event.triggered!==b.type?o.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(E)||[""],j=b.length;while(j--)h=Y.exec(b[j])||[],n=q=h[1],p=(h[2]||"").split(".").sort(),n&&(l=o.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=o.event.special[n]||{},k=o.extend({type:n,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&o.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),o.event.global[n]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,r=L.hasData(a)&&L.get(a);if(r&&(i=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=Y.exec(b[j])||[],n=q=h[1],p=(h[2]||"").split(".").sort(),n){l=o.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||o.removeEvent(a,n,r.handle),delete i[n])}else for(n in i)o.event.remove(a,n+b[j],c,d,!0);o.isEmptyObject(i)&&(delete r.handle,L.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,p=[d||m],q=j.call(b,"type")?b.type:b,r=j.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||m,3!==d.nodeType&&8!==d.nodeType&&!X.test(q+o.event.triggered)&&(q.indexOf(".")>=0&&(r=q.split("."),q=r.shift(),r.sort()),k=q.indexOf(":")<0&&"on"+q,b=b[o.expando]?b:new o.Event(q,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=r.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:o.makeArray(c,[b]),n=o.event.special[q]||{},e||!n.trigger||n.trigger.apply(d,c)!==!1)){if(!e&&!n.noBubble&&!o.isWindow(d)){for(i=n.delegateType||q,X.test(i+q)||(g=g.parentNode);g;g=g.parentNode)p.push(g),h=g;h===(d.ownerDocument||m)&&p.push(h.defaultView||h.parentWindow||a)}f=0;while((g=p[f++])&&!b.isPropagationStopped())b.type=f>1?i:n.bindType||q,l=(L.get(g,"events")||{})[b.type]&&L.get(g,"handle"),l&&l.apply(g,c),l=k&&g[k],l&&l.apply&&o.acceptData(g)&&(b.result=l.apply(g,c),b.result===!1&&b.preventDefault());return b.type=q,e||b.isDefaultPrevented()||n._default&&n._default.apply(p.pop(),c)!==!1||!o.acceptData(d)||k&&o.isFunction(d[q])&&!o.isWindow(d)&&(h=d[k],h&&(d[k]=null),o.event.triggered=q,d[q](),o.event.triggered=void 0,h&&(d[k]=h)),b.result}},dispatch:function(a){a=o.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(L.get(this,"events")||{})[a.type]||[],k=o.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=o.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((o.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==e&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?o(e,this).index(i)>=0:o.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||m,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[o.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=W.test(e)?this.mouseHooks:V.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new o.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=m),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&o.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return o.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=o.extend(new o.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?o.event.trigger(e,null,b):o.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},o.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},o.Event=function(a,b){return this instanceof o.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.getPreventDefault&&a.getPreventDefault()?Z:$):this.type=a,b&&o.extend(this,b),this.timeStamp=a&&a.timeStamp||o.now(),void(this[o.expando]=!0)):new o.Event(a,b)},o.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=Z,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=Z,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z,this.stopPropagation()}},o.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){o.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!o.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.focusinBubbles||o.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){o.event.simulate(b,a.target,o.event.fix(a),!0)};o.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=L.access(d,b);e||d.addEventListener(a,c,!0),L.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=L.access(d,b)-1;e?L.access(d,b,e):(d.removeEventListener(a,c,!0),L.remove(d,b))}}}),o.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=$;else if(!d)return this;return 1===e&&(f=d,d=function(a){return o().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=o.guid++)),this.each(function(){o.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,o(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=$),this.each(function(){o.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){o.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?o.event.trigger(a,b,c,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td;function jb(a,b){return o.nodeName(a,"table")&&o.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function kb(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function lb(a){var b=gb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function mb(a,b){for(var c=0,d=a.length;d>c;c++)L.set(a[c],"globalEval",!b||L.get(b[c],"globalEval"))}function nb(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(L.hasData(a)&&(f=L.access(a),g=L.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)o.event.add(b,e,j[e][c])}M.hasData(a)&&(h=M.access(a),i=o.extend({},h),M.set(b,i))}}function ob(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&o.nodeName(a,b)?o.merge([a],c):c}function pb(a,b){var c=b.nodeName.toLowerCase();"input"===c&&T.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}o.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=o.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||o.isXMLDoc(a)))for(g=ob(h),f=ob(a),d=0,e=f.length;e>d;d++)pb(f[d],g[d]);if(b)if(c)for(f=f||ob(a),g=g||ob(h),d=0,e=f.length;e>d;d++)nb(f[d],g[d]);else nb(a,h);return g=ob(h,"script"),g.length>0&&mb(g,!i&&ob(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===o.type(e))o.merge(l,e.nodeType?[e]:e);else if(cb.test(e)){f=f||k.appendChild(b.createElement("div")),g=(bb.exec(e)||["",""])[1].toLowerCase(),h=ib[g]||ib._default,f.innerHTML=h[1]+e.replace(ab,"<$1></$2>")+h[2],j=h[0];while(j--)f=f.lastChild;o.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));k.textContent="",m=0;while(e=l[m++])if((!d||-1===o.inArray(e,d))&&(i=o.contains(e.ownerDocument,e),f=ob(k.appendChild(e),"script"),i&&mb(f),c)){j=0;while(e=f[j++])fb.test(e.type||"")&&c.push(e)}return k},cleanData:function(a){for(var b,c,d,e,f,g,h=o.event.special,i=0;void 0!==(c=a[i]);i++){if(o.acceptData(c)&&(f=c[L.expando],f&&(b=L.cache[f]))){if(d=Object.keys(b.events||{}),d.length)for(g=0;void 0!==(e=d[g]);g++)h[e]?o.event.remove(c,e):o.removeEvent(c,e,b.handle);L.cache[f]&&delete L.cache[f]}delete M.cache[c[M.expando]]}}}),o.fn.extend({text:function(a){return J(this,function(a){return void 0===a?o.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=jb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?o.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||o.cleanData(ob(c)),c.parentNode&&(b&&o.contains(c.ownerDocument,c)&&mb(ob(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(o.cleanData(ob(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return o.clone(this,a,b)})},html:function(a){return J(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!db.test(a)&&!ib[(bb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(ab,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(o.cleanData(ob(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,o.cleanData(ob(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,k=this.length,m=this,n=k-1,p=a[0],q=o.isFunction(p);if(q||k>1&&"string"==typeof p&&!l.checkClone&&eb.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(k&&(c=o.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(f=o.map(ob(c,"script"),kb),g=f.length;k>j;j++)h=c,j!==n&&(h=o.clone(h,!0,!0),g&&o.merge(f,ob(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,o.map(f,lb),j=0;g>j;j++)h=f[j],fb.test(h.type||"")&&!L.access(h,"globalEval")&&o.contains(i,h)&&(h.src?o._evalUrl&&o._evalUrl(h.src):o.globalEval(h.textContent.replace(hb,"")))}return this}}),o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){o.fn[a]=function(a){for(var c,d=[],e=o(a),g=e.length-1,h=0;g>=h;h++)c=h===g?this:this.clone(!0),o(e[h])[b](c),f.apply(d,c.get());return this.pushStack(d)}});var qb,rb={};function sb(b,c){var d=o(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:o.css(d[0],"display");return d.detach(),e}function tb(a){var b=m,c=rb[a];return c||(c=sb(a,b),"none"!==c&&c||(qb=(qb||o("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=qb[0].contentDocument,b.write(),b.close(),c=sb(a,b),qb.detach()),rb[a]=c),c}var ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};function xb(a,b,c){var d,e,f,g,h=a.style;return c=c||wb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||o.contains(a.ownerDocument,a)||(g=o.style(a,b)),vb.test(g)&&ub.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function yb(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",e=m.documentElement,f=m.createElement("div"),g=m.createElement("div");g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",f.appendChild(g);function h(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",e.appendChild(f);var d=a.getComputedStyle(g,null);b="1%"!==d.top,c="4px"===d.width,e.removeChild(f)}a.getComputedStyle&&o.extend(l,{pixelPosition:function(){return h(),b},boxSizingReliable:function(){return null==c&&h(),c},reliableMarginRight:function(){var b,c=g.appendChild(m.createElement("div"));return c.style.cssText=g.style.cssText=d,c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.innerHTML="",b}})}(),o.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:0,fontWeight:400},Eb=["Webkit","O","Moz","ms"];function Fb(a,b){if(b in a)return b;var c=b[0].toUpperCase()+b.slice(1),d=b,e=Eb.length;while(e--)if(b=Eb[e]+c,b in a)return b;return d}function Gb(a,b,c){var d=Ab.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Hb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=o.css(a,c+R[f],!0,e)),d?("content"===c&&(g-=o.css(a,"padding"+R[f],!0,e)),"margin"!==c&&(g-=o.css(a,"border"+R[f]+"Width",!0,e))):(g+=o.css(a,"padding"+R[f],!0,e),"padding"!==c&&(g+=o.css(a,"border"+R[f]+"Width",!0,e)));return g}function Ib(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=wb(a),g="border-box"===o.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=xb(a,b,f),(0>e||null==e)&&(e=a.style[b]),vb.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Hb(a,b,c||(g?"border":"content"),d,f)+"px"}function Jb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=L.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&S(d)&&(f[g]=L.access(d,"olddisplay",tb(d.nodeName)))):f[g]||(e=S(d),(c&&"none"!==c||!e)&&L.set(d,"olddisplay",e?c:o.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}o.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=xb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=o.camelCase(b),i=a.style;return b=o.cssProps[h]||(o.cssProps[h]=Fb(i,h)),g=o.cssHooks[b]||o.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Bb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(o.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||o.cssNumber[h]||(c+="px"),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]="",i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=o.camelCase(b);return b=o.cssProps[h]||(o.cssProps[h]=Fb(a.style,h)),g=o.cssHooks[b]||o.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=xb(a,b,d)),"normal"===e&&b in Db&&(e=Db[b]),""===c||c?(f=parseFloat(e),c===!0||o.isNumeric(f)?f||0:e):e}}),o.each(["height","width"],function(a,b){o.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&zb.test(o.css(a,"display"))?o.swap(a,Cb,function(){return Ib(a,b,d)}):Ib(a,b,d):void 0},set:function(a,c,d){var e=d&&wb(a);return Gb(a,c,d?Hb(a,b,d,"border-box"===o.css(a,"boxSizing",!1,e),e):0)}}}),o.cssHooks.marginRight=yb(l.reliableMarginRight,function(a,b){return b?o.swap(a,{display:"inline-block"},xb,[a,"marginRight"]):void 0}),o.each({margin:"",padding:"",border:"Width"},function(a,b){o.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+R[d]+b]=f[d]||f[d-2]||f[0];return e}},ub.test(a)||(o.cssHooks[a+b].set=Gb)}),o.fn.extend({css:function(a,b){return J(this,function(a,b,c){var d,e,f={},g=0;if(o.isArray(b)){for(d=wb(a),e=b.length;e>g;g++)f[b[g]]=o.css(a,b[g],!1,d);return f}return void 0!==c?o.style(a,b,c):o.css(a,b)},a,b,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){S(this)?o(this).show():o(this).hide()})}});function Kb(a,b,c,d,e){return new Kb.prototype.init(a,b,c,d,e)}o.Tween=Kb,Kb.prototype={constructor:Kb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(o.cssNumber[c]?"":"px")},cur:function(){var a=Kb.propHooks[this.prop];return a&&a.get?a.get(this):Kb.propHooks._default.get(this)},run:function(a){var b,c=Kb.propHooks[this.prop];return this.pos=b=this.options.duration?o.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=o.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){o.fx.step[a.prop]?o.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[o.cssProps[a.prop]]||o.cssHooks[a.prop])?o.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},o.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},o.fx=Kb.prototype.init,o.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Ob.exec(b),f=e&&e[3]||(o.cssNumber[a]?"":"px"),g=(o.cssNumber[a]||"px"!==f&&+d)&&Ob.exec(o.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,o.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function Sb(){return setTimeout(function(){Lb=void 0}),Lb=o.now()}function Tb(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=R[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ub(a,b,c){for(var d,e=(Rb[b]||[]).concat(Rb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Vb(a,b,c){var d,e,f,g,h,i,j,k=this,l={},m=a.style,n=a.nodeType&&S(a),p=L.get(a,"fxshow");c.queue||(h=o._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,k.always(function(){k.always(function(){h.unqueued--,o.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],j=o.css(a,"display"),"none"===j&&(j=tb(a.nodeName)),"inline"===j&&"none"===o.css(a,"float")&&(m.display="inline-block")),c.overflow&&(m.overflow="hidden",k.always(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Nb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(n?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;n=!0}l[d]=p&&p[d]||o.style(a,d)}if(!o.isEmptyObject(l)){p?"hidden"in p&&(n=p.hidden):p=L.access(a,"fxshow",{}),f&&(p.hidden=!n),n?o(a).show():k.done(function(){o(a).hide()}),k.done(function(){var b;L.remove(a,"fxshow");for(b in l)o.style(a,b,l[b])});for(d in l)g=Ub(n?p[d]:0,d,k),d in p||(p[d]=g.start,n&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function Wb(a,b){var c,d,e,f,g;for(c in a)if(d=o.camelCase(c),e=b[d],f=a[c],o.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=o.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Xb(a,b,c){var d,e,f=0,g=Qb.length,h=o.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Lb||Sb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:o.extend({},b),opts:o.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Lb||Sb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=o.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Wb(k,j.opts.specialEasing);g>f;f++)if(d=Qb[f].call(j,a,k,j.opts))return d;return o.map(k,Ub,j),o.isFunction(j.opts.start)&&j.opts.start.call(a,j),o.fx.timer(o.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}o.Animation=o.extend(Xb,{tweener:function(a,b){o.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Rb[c]=Rb[c]||[],Rb[c].unshift(b)},prefilter:function(a,b){b?Qb.unshift(a):Qb.push(a)}}),o.speed=function(a,b,c){var d=a&&"object"==typeof a?o.extend({},a):{complete:c||!c&&b||o.isFunction(a)&&a,duration:a,easing:c&&b||b&&!o.isFunction(b)&&b};return d.duration=o.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in o.fx.speeds?o.fx.speeds[d.duration]:o.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){o.isFunction(d.old)&&d.old.call(this),d.queue&&o.dequeue(this,d.queue)},d},o.fn.extend({fadeTo:function(a,b,c,d){return this.filter(S).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=o.isEmptyObject(a),f=o.speed(b,c,d),g=function(){var b=Xb(this,o.extend({},a),f);(e||L.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=o.timers,g=L.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Pb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&o.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=L.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=o.timers,g=d?d.length:0;for(c.finish=!0,o.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),o.each(["toggle","show","hide"],function(a,b){var c=o.fn[b];o.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Tb(b,!0),a,d,e)}}),o.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){o.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),o.timers=[],o.fx.tick=function(){var a,b=0,c=o.timers;for(Lb=o.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||o.fx.stop(),Lb=void 0},o.fx.timer=function(a){o.timers.push(a),a()?o.fx.start():o.timers.pop()},o.fx.interval=13,o.fx.start=function(){Mb||(Mb=setInterval(o.fx.tick,o.fx.interval))},o.fx.stop=function(){clearInterval(Mb),Mb=null},o.fx.speeds={slow:600,fast:200,_default:400},o.fn.delay=function(a,b){return a=o.fx?o.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=m.createElement("input"),b=m.createElement("select"),c=b.appendChild(m.createElement("option"));a.type="checkbox",l.checkOn=""!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,a=m.createElement("input"),a.value="t",a.type="radio",l.radioValue="t"===a.value}();var Yb,Zb,$b=o.expr.attrHandle;o.fn.extend({attr:function(a,b){return J(this,o.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){o.removeAttr(this,a)})}}),o.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===U?o.prop(a,b,c):(1===f&&o.isXMLDoc(a)||(b=b.toLowerCase(),d=o.attrHooks[b]||(o.expr.match.bool.test(b)?Zb:Yb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=o.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void o.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=o.propFix[c]||c,o.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&o.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),Zb={set:function(a,b,c){return b===!1?o.removeAttr(a,c):a.setAttribute(c,c),c}},o.each(o.expr.match.bool.source.match(/\w+/g),function(a,b){var c=$b[b]||o.find.attr;$b[b]=function(a,b,d){var e,f;return d||(f=$b[b],$b[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,$b[b]=f),e}});var _b=/^(?:input|select|textarea|button)$/i;o.fn.extend({prop:function(a,b){return J(this,o.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[o.propFix[a]||a]})}}),o.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!o.isXMLDoc(a),f&&(b=o.propFix[b]||b,e=o.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||_b.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),l.optSelected||(o.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),o.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){o.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;o.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(o.isFunction(a))return this.each(function(b){o(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=o.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(o.isFunction(a))return this.each(function(b){o(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(E)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ac," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?o.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(o.isFunction(a)?function(c){o(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=o(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===U||"boolean"===c)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||a===!1?"":L.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ac," ").indexOf(b)>=0)return!0;return!1}});var bc=/\r/g;o.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=o.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,o(this).val()):a,null==e?e="":"number"==typeof e?e+="":o.isArray(e)&&(e=o.map(e,function(a){return null==a?"":a+""})),b=o.valHooks[this.type]||o.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=o.valHooks[e.type]||o.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(bc,""):null==c?"":c)}}}),o.extend({valHooks:{select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(l.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&o.nodeName(c.parentNode,"optgroup"))){if(b=o(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=o.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=o.inArray(o(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),o.each(["radio","checkbox"],function(){o.valHooks[this]={set:function(a,b){return o.isArray(b)?a.checked=o.inArray(o(a).val(),b)>=0:void 0}},l.checkOn||(o.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),o.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){o.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),o.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var cc=o.now(),dc=/\?/;o.parseJSON=function(a){return JSON.parse(a+"")},o.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&o.error("Invalid XML: "+a),b};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=m.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[];function rc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(o.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function sc(a,b,c,d){var e={},f=a===oc;function g(h){var i;return e[h]=!0,o.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function tc(a,b){var c,d,e=o.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&o.extend(!0,a,d),a}function uc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function vc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}o.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":o.parseJSON,"text xml":o.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?tc(tc(a,o.ajaxSettings),b):tc(o.ajaxSettings,a)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=o.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?o(l):o.event,n=o.Deferred(),p=o.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!f){f={};while(b=ic.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?e:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return c&&c.abort(b),x(0,b),this}};if(n.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=o.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(h=mc.exec(k.url.toLowerCase()),k.crossDomain=!(!h||h[1]===ec[1]&&h[2]===ec[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=o.param(k.data,k.traditional)),sc(nc,k,b,v),2===t)return v;i=k.global,i&&0===o.active++&&o.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!kc.test(k.type),d=k.url,k.hasContent||(k.data&&(d=k.url+=(dc.test(d)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=hc.test(d)?d.replace(hc,"$1_="+cc++):d+(dc.test(d)?"&":"?")+"_="+cc++)),k.ifModified&&(o.lastModified[d]&&v.setRequestHeader("If-Modified-Since",o.lastModified[d]),o.etag[d]&&v.setRequestHeader("If-None-Match",o.etag[d])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+pc+"; q=0.01":""):k.accepts["*"]);for(j in k.headers)v.setRequestHeader(j,k.headers[j]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(j in{success:1,error:1,complete:1})v[j](k[j]);if(c=sc(oc,k,b,v)){v.readyState=1,i&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,c.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,f,h){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),c=void 0,e=h||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,f&&(u=uc(k,v,f)),u=vc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(o.lastModified[d]=w),w=v.getResponseHeader("etag"),w&&(o.etag[d]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?n.resolveWith(l,[r,x,v]):n.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,i&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),i&&(m.trigger("ajaxComplete",[v,k]),--o.active||o.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return o.get(a,b,c,"json")},getScript:function(a,b){return o.get(a,void 0,b,"script")}}),o.each(["get","post"],function(a,b){o[b]=function(a,c,d,e){return o.isFunction(c)&&(e=e||d,d=c,c=void 0),o.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),o.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){o.fn[b]=function(a){return this.on(b,a)}}),o._evalUrl=function(a){return o.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},o.fn.extend({wrapAll:function(a){var b;return o.isFunction(a)?this.each(function(b){o(this).wrapAll(a.call(this,b))}):(this[0]&&(b=o(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(o.isFunction(a)?function(b){o(this).wrapInner(a.call(this,b))}:function(){var b=o(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=o.isFunction(a);return this.each(function(c){o(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){o.nodeName(this,"body")||o(this).replaceWith(this.childNodes)}).end()}}),o.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},o.expr.filters.visible=function(a){return!o.expr.filters.hidden(a)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;function Bc(a,b,c,d){var e;if(o.isArray(b))o.each(b,function(b,e){c||xc.test(a)?d(a,e):Bc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==o.type(b))d(a,b);else for(e in b)Bc(a+"["+e+"]",b[e],c,d)}o.param=function(a,b){var c,d=[],e=function(a,b){b=o.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=o.ajaxSettings&&o.ajaxSettings.traditional),o.isArray(a)||a.jquery&&!o.isPlainObject(a))o.each(a,function(){e(this.name,this.value)});else for(c in a)Bc(c,a[c],b,e);return d.join("&").replace(wc,"+")},o.fn.extend({serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=o.prop(this,"elements");return a?o.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!o(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(a)&&(this.checked||!T.test(a))}).map(function(a,b){var c=o(this).val();return null==c?null:o.isArray(c)?o.map(c,function(a){return{name:b.name,value:a.replace(yc,"\r\n")}}):{name:b.name,value:c.replace(yc,"\r\n")}}).get()}}),o.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=o.ajaxSettings.xhr();a.ActiveXObject&&o(a).on("unload",function(){for(var a in Dc)Dc[a]()}),l.cors=!!Fc&&"withCredentials"in Fc,l.ajax=Fc=!!Fc,o.ajaxTransport(function(a){var b;return l.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort"),f.send(a.hasContent&&a.data||null)},abort:function(){b&&b()}}:void 0}),o.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return o.globalEval(a),a}}}),o.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),o.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=o("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),m.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;o.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||o.expando+"_"+cc++;return this[a]=!0,a}}),o.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=o.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(dc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||o.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&o.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),o.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||m;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=o.buildFragment([a],b,e),e&&e.length&&o(e).remove(),o.merge([],d.childNodes))};var Ic=o.fn.load;o.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h),a=a.slice(0,h)),o.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&o.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?o("<div>").append(o.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},o.expr.filters.animated=function(a){return o.grep(o.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;function Kc(a){return o.isWindow(a)?a:9===a.nodeType&&a.defaultView}o.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=o.css(a,"position"),l=o(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=o.css(a,"top"),i=o.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),o.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},o.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){o.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,o.contains(b,d)?(typeof d.getBoundingClientRect!==U&&(e=d.getBoundingClientRect()),c=Kc(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===o.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),o.nodeName(a[0],"html")||(d=a.offset()),d.top+=o.css(a[0],"borderTopWidth",!0),d.left+=o.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-o.css(c,"marginTop",!0),left:b.left-d.left-o.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||Jc;while(a&&!o.nodeName(a,"html")&&"static"===o.css(a,"position"))a=a.offsetParent;return a||Jc})}}),o.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;o.fn[b]=function(e){return J(this,function(b,e,f){var g=Kc(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),o.each(["top","left"],function(a,b){o.cssHooks[b]=yb(l.pixelPosition,function(a,c){return c?(c=xb(a,b),vb.test(c)?o(a).position()[b]+"px":c):void 0})}),o.each({Height:"height",Width:"width"},function(a,b){o.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){o.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return J(this,function(b,c,d){var e;return o.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?o.css(b,c,g):o.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),o.fn.size=function(){return this.length},o.fn.andSelf=o.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return o});var Lc=a.jQuery,Mc=a.$;return o.noConflict=function(b){return a.$===o&&(a.$=Mc),b&&a.jQuery===o&&(a.jQuery=Lc),o},typeof b===U&&(a.jQuery=a.$=o),o});"use strict";String.prototype.shorten=function(maxLength){return this.length>maxLength?(this.substr(0,maxLength-2)+'\u2026'):this.valueOf();};String.prototype.shortenMid=function(maxLength){return this.length>maxLength?(this.substr(0,maxLength*0.33)+'\u2026'+this.substr(-maxLength*0.66)):this.valueOf();};String.prototype.escape=function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');};String.prototype.removeTags=function(){return this.replace(/<[^>]*>+/ig,"");}
String.prototype.possessive=function(){return this.match(/s$/i)?this.valueOf()+"'":this.valueOf()+"'s";};String.prototype.inflect=function(count,p,s){var name=this;if(count!=1&&count!=-1){return count+' '+name+(p||'e');}
return count+' '+name+(s||'');};String.prototype.inflectNoCount=function(count,p){var name=this;if(count!=1&&count!=-1){return name+(p||'e');}
return name;};String.prototype.hostName=function(){var m=this.match(/\/\/(www\.)?(.*?)\//);return m&&m[2]?m[2]:'unknown';};String.prototype.newlineToHTML=function(){return this.replace(/\n\s+\n/g,'<br/><br/>').replace(/\n/g,'<br/>');};String.prototype.urlsToHTML=function(maxLength){return this.replace(/\b(https?:\/\/(?:www\.)?|www\.)([^<>\s]+\([^<>\s]+[^<>!,.:\s]|[^(<>\s]+[^<>)!,.:\s])/g,function(url,httpwww,hostandpath){if(httpwww==='www.'){url='http://'+url;}
let path=null;if(path=hostandpath.match(new RegExp('^'+CONFIG.HOST+'(/.*?)$'))){let like=path[1].match('^\\/user\\/[a-zA-Z0-9]{2,32}\\/likes\\/([0-9]+)');let url=like?`/new/${like[1]}`:path[1];return'<a href="'+url+'">'+url+'</a>';}
else{return'<a href="'+url+'" target="_blank" rel="noopener">'+hostandpath.shortenMid(maxLength)+'</a>';}});};String.prototype.setQueryParameter=function(key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i");var separator=this.indexOf('?')!==-1?"&":"?";if(this.match(re)){return this.replace(re,'$1'+key+"="+value+'$2');}
else{return this+separator+key+"="+value;}};String.prototype.userAtToHTML=function(){return this.replace(/(^|\s|<br\/>)(@([a-zA-Z0-9]{2,}))/g,'$1<a href="/user/$3">$2</a>');};String.prototype.format=function(){return this.escape().newlineToHTML().urlsToHTML(80).userAtToHTML();};String.prototype.replaceAll=function(search,replacement){return this.replace(new RegExp(search.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),'g'),replacement);};"use strict";Date.RELATIVE_TIME_PERIODS={Jahr:31536000,Monat:2628000,Woche:604800,Tag:86400,Stunde:3600,Minute:60,Moment:-1};Date.now=Date.now||function(){return(new Date()).getTime();};Date.secondsToString=function(rawSeconds){var days=Math.floor(rawSeconds/(60*60*24));var hours=Math.floor((rawSeconds%(60*60*24))/(60*60));var minutes=Math.floor((rawSeconds%(60*60))/60);var seconds=rawSeconds%60;return days+" Tag(e), "+hours+" Stunde(n), "+minutes+" Minute(n), "+seconds+" Sekunde(n)";};Date.prototype.unix=function(){return Math.floor(this.getTime()/1000);};Date.prototype.relativeTime=function(forcePast,noprefix){var diff=(new Date()).getTime()/1000-this.getTime()/1000;if(forcePast&&diff<0){diff=0;}
var prefix=noprefix?'':(diff>=0)?"vor ":"in ";diff=Math.abs(diff);for(var period in Date.RELATIVE_TIME_PERIODS){var length=Date.RELATIVE_TIME_PERIODS[period];if(diff>length){if(length>0){diff=Math.round(diff/length);var plural=diff>1?(period.substr(-1)=='e'?'n':'en'):'';return prefix+diff+" "+period+plural;}
else{return prefix+"einem Moment";}}}
return false;};Date.MONTH_NAMES=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];Date.prototype.readableTime=function(){var h=this.getHours();var m=this.getMinutes();return this.getDate()+". "+
Date.MONTH_NAMES[this.getMonth()]+" "+
this.getFullYear()+" - "+
(h>9?h:'0'+h)+":"+(m>9?m:'0'+m);};Date.prototype.readableDate=function(){return this.getDate()+". "+
Date.MONTH_NAMES[this.getMonth()]+" "+
this.getFullYear();};"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.zeroes='000000000000';Number.prototype.zeroFill=function(d){var s=this.toString();return Number.zeroes.substr(0,d-s.length)+s;};Number.prototype.toSiUnit=function(){if(this>10000000){return((this/1000000)|0)+'m';}
else if(this>10000){return((this/1000)|0)+'k';}
return this;};Number.prototype.toPrice=function(){if(this%1===0)
return this;return this.toFixed(2).replace('.',',');};"use strict";Object.defineProperty(Array.prototype,'erase',{value:function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;}});Object.defineProperty(Array.prototype,'random',{value:function(){return this[Math.floor(Math.random()*this.length)];}});Object.defineProperty(Array.prototype,'shuffle',{value:function(){for(var j,x,i=this.length;i;j=Math.floor(Math.random()*i),x=this[--i],this[i]=this[j],this[j]=x);return this;}});Object.defineProperty(Array.prototype,'first',{value:function(){return this.length?this[0]:null;}});Object.defineProperty(Array.prototype,'last',{value:function(){return this.length?this[this.length-1]:null;}});"use strict";Function.prototype.bind=Function.prototype.bind||function(bind){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};"use strict";p.isNormalClick=function(ev){return(ev.type!='click'||!(ev.which!=1||ev.shiftKey||ev.altKey||ev.metaKey||ev.ctrlKey));};p.KEY={'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'0':48,'1':49,'2':50,'3':51,'4':52,'5':53,'6':54,'7':55,'8':56,'9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){$.ui=$.ui||{};var version=$.ui.version="1.12.1";var widgetUuid=0;var widgetSlice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove");}}catch(e){}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype;var proxiedPrototype={};var namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
if($.isArray(prototype)){prototype=$.extend.apply(null,[{}].concat(prototype));}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){function _super(){return base.prototype[prop].apply(this,arguments);}
function _superApply(args){return base.prototype[prop].apply(this,args);}
return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string";var args=widgetSlice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==="instance"){returnValue=undefined;}else{this.each(function(){var methodValue;var instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;}
if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled);}
this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:function(){return{};},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key);});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace);},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key;var parts;var curOption;var i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){if(key==="classes"){this._setOptionClasses(value);}
this.options[key]=value;if(key==="disabled"){this._setOptionDisabled(value);}
return this;},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue;}
elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}));}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus");}},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_classes:function(options){var full=[];var that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add){current=$($.unique(current.get().concat(options.element.get())));}else{current=$(current.not(options.element).get());}
that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]]);}}}
this._on(options.element,{"remove":"_untrackClassesElement"});if(options.keys){processClassString(options.keys.match(/\S+/g)||[],true);}
if(options.extra){processClassString(options.extra.match(/\S+/g)||[]);}
return full.join(" ");},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1){that.classesElementLookup[key]=$(value.not(event.target).get());}});},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false);},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true);},_toggleClass:function(element,keys,extra,add){add=(typeof add==="boolean")?add:extra;var shift=(typeof element==="string"||element===null),options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.toggleClass(this._classes(options),add);return this;},_on:function(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy);}else{element.on(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+
this.eventNamespace;element.off(eventName).off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover");},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus");},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig;var callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions;var effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;(function(){var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div "+"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>"+"<div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9,hasOffset=!isWindow&&!isDocument;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+
scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+
scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-
withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-
withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-
outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+
atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-
outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+
offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};})();var position=$.ui.position;var keycode=$.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};var uniqueId=$.fn.extend({uniqueId:(function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});};})(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr("id");}});}});var safeActiveElement=$.ui.safeActiveElement=function(document){var activeElement;try{activeElement=document.activeElement;}catch(error){activeElement=document.body;}
if(!activeElement){activeElement=document.body;}
if(!activeElement.nodeName){activeElement=document.body;}
return activeElement;};var widgetsMenu=$.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=false;this.element.uniqueId().attr({role:this.options.role,tabIndex:0});this._addClass("ui-menu","ui-widget ui-widget-content");this._on({"mousedown .ui-menu-item":function(event){event.preventDefault();},"click .ui-menu-item":function(event){var target=$(event.target);var active=$($.ui.safeActiveElement(this.document[0]));if(!this.mouseHandled&&target.not(".ui-state-disabled").length){this.select(event);if(!event.isPropagationStopped()){this.mouseHandled=true;}
if(target.has(".ui-menu").length){this.expand(event);}else if(!this.element.is(":focus")&&active.closest(".ui-menu").length){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1){clearTimeout(this.timer);}}}},"mouseenter .ui-menu-item":function(event){if(this.previousFilter){return;}
var actualTarget=$(event.target).closest(".ui-menu-item"),target=$(event.currentTarget);if(actualTarget[0]!==target[0]){return;}
this._removeClass(target.siblings().children(".ui-state-active"),null,"ui-state-active");this.focus(event,target);},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.find(this.options.items).eq(0);if(!keepActiveItem){this.focus(event,item);}},blur:function(event){this._delay(function(){var notContained=!$.contains(this.element[0],$.ui.safeActiveElement(this.document[0]));if(notContained){this.collapseAll(event);}});},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(event){if(this._closeOnDocumentClick(event)){this.collapseAll(event);}
this.mouseHandled=false;}});},_destroy:function(){var items=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),submenus=items.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled "+"tabIndex").removeUniqueId().show();submenus.children().each(function(){var elem=$(this);if(elem.data("ui-menu-submenu-caret")){elem.remove();}});},_keydown:function(event){var match,prev,character,skip,preventDefault=true;switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled")){this.expand(event);}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=false;prev=this.previousFilter||"";skip=false;character=event.keyCode>=96&&event.keyCode<=105?(event.keyCode-96).toString():String.fromCharCode(event.keyCode);clearTimeout(this.filterTimer);if(character===prev){skip=true;}else{character=prev+character;}
match=this._filterMenuItems(character);match=skip&&match.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);match=this._filterMenuItems(character);}
if(match.length){this.focus(event,match);this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}
if(preventDefault){event.preventDefault();}},_activate:function(event){if(this.active&&!this.active.is(".ui-state-disabled")){if(this.active.children("[aria-haspopup='true']").length){this.expand(event);}else{this.select(event);}}},refresh:function(){var menus,items,newSubmenus,newItems,newWrappers,that=this,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length);newSubmenus=submenus.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var menu=$(this),item=menu.prev(),submenuCaret=$("<span>").data("ui-menu-submenu-caret",true);that._addClass(submenuCaret,"ui-menu-icon","ui-icon "+icon);item.attr("aria-haspopup","true").prepend(submenuCaret);menu.attr("aria-labelledby",item.attr("id"));});this._addClass(newSubmenus,"ui-menu","ui-widget ui-widget-content ui-front");menus=submenus.add(this.element);items=menus.find(this.options.items);items.not(".ui-menu-item").each(function(){var item=$(this);if(that._isDivider(item)){that._addClass(item,"ui-menu-divider","ui-widget-content");}});newItems=items.not(".ui-menu-item, .ui-menu-divider");newWrappers=newItems.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(newItems,"ui-menu-item")._addClass(newWrappers,"ui-menu-item-wrapper");items.filter(".ui-state-disabled").attr("aria-disabled","true");if(this.active&&!$.contains(this.element[0],this.active[0])){this.blur();}},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},_setOption:function(key,value){if(key==="icons"){var icons=this.element.find(".ui-menu-icon");this._removeClass(icons,null,this.options.icons.submenu)._addClass(icons,null,value.submenu);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this.element.attr("aria-disabled",String(value));this._toggleClass(null,"ui-state-disabled",!!value);},focus:function(event,item){var nested,focused,activeParent;this.blur(event,event&&event.type==="focus");this._scrollIntoView(item);this.active=item.first();focused=this.active.children(".ui-menu-item-wrapper");this._addClass(focused,null,"ui-state-active");if(this.options.role){this.element.attr("aria-activedescendant",focused.attr("id"));}
activeParent=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper");this._addClass(activeParent,null,"ui-state-active");if(event&&event.type==="keydown"){this._close();}else{this.timer=this._delay(function(){this._close();},this.delay);}
nested=item.children(".ui-menu");if(nested.length&&event&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger("focus",event,{item:item});},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0;paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.outerHeight();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){return;}
this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active");this._trigger("blur",event,{item:this.active});this.active=null;},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr("aria-hidden")!=="true"){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true");submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position);},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this._removeClass(currentMenu.find(".ui-state-active"),null,"ui-state-active");this.activeMenu=currentMenu;},this.delay);},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false");},_closeOnDocumentClick:function(event){return!$(event.target).closest(".ui-menu").length;},_isDivider:function(item){return!/[^\-\u2014\u2013\s]/.test(item.text());},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem);}},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);});}},next:function(event){this._move("next","first",event);},previous:function(event){this._move("prev","last",event);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(direction,filter,event){var next;if(this.active){if(direction==="first"||direction==="last"){next=this.active
[direction==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);}else{next=this.active
[direction+"All"](".ui-menu-item").eq(0);}}
if(!next||!next.length||!this.active){next=this.activeMenu.find(this.options.items)[filter]();}
this.focus(event,next);},nextPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isLastItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base-height<0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.find(this.options.items)
[!this.active?"first":"last"]());}},previousPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isFirstItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base+height>0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.find(this.options.items).first());}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};if(!this.active.has(".ui-menu").length){this.collapseAll(event,true);}
this._trigger("select",event,ui);},_filterMenuItems:function(character){var escapedCharacter=character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),regex=new RegExp("^"+escapedCharacter,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return regex.test($.trim($(this).children(".ui-menu-item-wrapper").text()));});}});$.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput,nodeName=this.element[0].nodeName.toLowerCase(),isTextarea=nodeName==="textarea",isInput=nodeName==="input";this.isMultiLine=isTextarea||!isInput&&this._isContentEditable(this.element);this.valueMethod=this.element[isTextarea||isInput?"val":"text"];this.isNewMenu=true;this._addClass("ui-autocomplete-input");this.element.attr("autocomplete","off");this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly")){suppressKeyPress=true;suppressInput=true;suppressKeyPressRepeat=true;return;}
suppressKeyPress=false;suppressInput=false;suppressKeyPressRepeat=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=true;this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=true;this._keyEvent("next",event);break;case keyCode.ENTER:if(this.menu.active){suppressKeyPress=true;event.preventDefault();this.menu.select(event);}
break;case keyCode.TAB:if(this.menu.active){this.menu.select(event);}
break;case keyCode.ESCAPE:if(this.menu.element.is(":visible")){if(!this.isMultiLine){this._value(this.term);}
this.close(event);event.preventDefault();}
break;default:suppressKeyPressRepeat=true;this._searchTimeout(event);break;}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=false;if(!this.isMultiLine||this.menu.element.is(":visible")){event.preventDefault();}
return;}
if(suppressKeyPressRepeat){return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event);break;}},input:function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
this._searchTimeout(event);},focus:function(){this.selectedItem=null;this.previous=this._value();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
clearTimeout(this.searching);this.close(event);this._change(event);}});this._initSource();this.menu=$("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance");this._addClass(this.menu.element,"ui-autocomplete","ui-front");this._on(this.menu.element,{mousedown:function(event){event.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;if(this.element[0]!==$.ui.safeActiveElement(this.document[0])){this.element.trigger("focus");}});},menufocus:function(event,ui){var label,item;if(this.isNewMenu){this.isNewMenu=false;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent);});return;}}
item=ui.item.data("ui-autocomplete-item");if(false!==this._trigger("focus",event,{item:item})){if(event.originalEvent&&/^key/.test(event.originalEvent.type)){this._value(item.value);}}
label=ui.item.attr("aria-label")||item.value;if(label&&$.trim(label).length){this.liveRegion.children().hide();$("<div>").text(label).appendTo(this.liveRegion);}},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item"),previous=this.previous;if(this.element[0]!==$.ui.safeActiveElement(this.document[0])){this.element.trigger("focus");this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item;});}
if(false!==this._trigger("select",event,{item:item})){this._value(item.value);}
this.term=this._value();this.close(event);this.selectedItem=item;}});this.liveRegion=$("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible");this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_destroy:function(){clearTimeout(this.searching);this.element.removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove();},_setOption:function(key,value){this._super(key,value);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo(this._appendTo());}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_isEventTargetInWidget:function(event){var menuElement=this.menu.element[0];return event.target===this.element[0]||event.target===menuElement||$.contains(menuElement,event.target);},_closeOnClickOutside:function(event){if(!this._isEventTargetInWidget(event)){this.close();}},_appendTo:function(){var element=this.options.appendTo;if(element){element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0);}
if(!element||!element[0]){element=this.element.closest(".ui-front, dialog");}
if(!element.length){element=this.document[0].body;}
return element;},_initSource:function(){var array,url,that=this;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(that.xhr){that.xhr.abort();}
that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data);},error:function(){response([]);}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){var equalValues=this.term===this._value(),menuVisible=this.menu.element.is(":visible"),modifierKey=event.altKey||event.ctrlKey||event.metaKey||event.shiftKey;if(!equalValues||(equalValues&&!menuVisible&&!modifierKey)){this.selectedItem=null;this.search(null,event);}},this.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this._addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:value},this._response());},_response:function(){var index=++this.requestIndex;return $.proxy(function(content){if(index===this.requestIndex){this.__response(content);}
this.pending--;if(!this.pending){this._removeClass("ui-autocomplete-loading");}},this);},__response:function(content){if(content){content=this._normalize(content);}
this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger("open");}else{this._close();}},close:function(event){this.cancelSearch=true;this._close(event);},_close:function(event){this._off(this.document,"mousedown");if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",event);}},_change:function(event){if(this.previous!==this._value()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({},item,{label:item.label||item.value,value:item.value||item.label});});},_suggest:function(items){var ul=this.menu.element.empty();this._renderMenu(ul,items);this.isNewMenu=true;this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next();}
this._on(this.document,{mousedown:"_closeOnClickOutside"});},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item);},_renderItem:function(ul,item){return $("<li>").append($("<div>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){if(!this.isMultiLine){this._value(this.term);}
this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(keyEvent,event);event.preventDefault();}},_isContentEditable:function(element){if(!element.length){return false;}
var editable=element.prop("contentEditable");if(editable==="inherit"){return this._isContentEditable(element.parent());}
return editable==="true";}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";}}},__response:function(content){var message;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;}
if(content&&content.length){message=this.options.messages.results(content.length);}else{message=this.options.messages.noResults;}
this.liveRegion.children().hide();$("<div>").text(message).appendTo(this.liveRegion);}});var widgetsAutocomplete=$.ui.autocomplete;}));(function(window){var host=document.location.host;var useSubdomains=true;window.CONFIG={READ_ONLY:false,HOST:host,ABSOLUTE_PATH:'/',HEADER_HEIGHT:52,COOKIE:{NAME:'me',EXPIRE:3650,SECURE:true},PATH:{IMAGES:(useSubdomains?'//img.'+host+'/':'/data/images/'),VIDS:(useSubdomains?'//vid.'+host+'/':'/data/images/'),FULLSIZE:(useSubdomains?'//full.'+host+'/':'/data/fullsize/'),THUMBS:(useSubdomains?'//thumb.'+host+'/':'/data/thumbs/')},ANIMATION_TIME:100,LAYOUT:{THUMBS_PER_ROW:{MIN:3,MAX:8},THUMB:{WIDTH:128,HEIGHT:128,PADDING:4},WIDTH_CLASS:{TWO_SIDEBARS:{MAX_WIDTH:Infinity,SIDEBARS_WIDTH:400,MARGIN:24,CLASS_NAME:'two-sidebars'},ONE_SIDEBAR:{MAX_WIDTH:1440,SIDEBARS_WIDTH:200,MARGIN:20,CLASS_NAME:'one-sidebar'},NO_SIDEBAR:{MAX_WIDTH:780,SIDEBARS_WIDTH:0,MARGIN:0,CLASS_NAME:'no-sidebar'}},WIDTH_CLASS_FORCE_NO_SIDEBAR:{MAX_WIDTH:Infinity,SIDEBARS_WIDTH:0,MARGIN:24,CLASS_NAME:'wide-no-sidebar'}},THEMES:[{id:0,name:'bewährtes Orange'},{id:1,name:'angenehmes Grün'},{id:2,name:'Olivgrün des Friedens'},{id:3,name:'episches Blau'},{id:4,name:'altes Pink'}],ANALYTICS:{ENABLED:true,ACCOUNT:'UA-66268030-1'},COMMENTS_MAX_LEVELS:18,SHOW_SCORE_MIN_AGE:3600,AUTO_SYNC:{ENABLED:true,INTERVAL:60},SFW_FLAG:{SFW:{flag:1,name:'sfw'},NSFW:{flag:2,name:'nsfw'},NSFL:{flag:4,name:'nsfl'},NSFP:{flag:8,name:'nsfp'}},COLLECTIONS_MAX:12,TAGS_MIN_CONFIDENCE:0.2,TAGS_MAX_DISPLAY:4,ITEM_CACHE_BUST_MAX_AGE:60,LAST_LINEAR_COMMENTS_ITEM:128926,API:{ENDPOINT:'/api/',ALLOWED_UPLOAD_TYPES:['image/png','image/jpeg','image/gif','video/webm','video/mp4']},TAGS_INPUT_SETTINGS:{'defaultText':'Tags hinzufügen, mit Komma trennen','removeWithBackspace':true,'minChars':2,'maxChars':32},BOOKMARKLET:"javascript:"+"void((function(){"+"var%20e=document.createElement('script');"+"e.src='https://"+host+"/media/bookmarklet.min.js';"+"document.body.appendChild(e);"+"})());",ADS:{AMAZON_REF:false,HUBTRAFFIC:{ENABLED:true,SEARCH_REGEXP:/(pornhub|redtube|tube8|youporn|xtube|spankwire)\.com/,QUERY_PARAMS:{utm_source:'paid',utm_medium:'hubtraffic',utm_campaign:'hubtraffic_pr0gramm'}},ACCOUNT:'61585078',REFRESH_INTERVAL:(300*1000)}};})(window);p.ads={UNIT:{},_escLoaded:false,_refreshInterval:0,requireEscobar:function(){if(p.ads._escLoaded){return;}
(function(opts){window.esc={fill:function(){this.q.push(arguments);},q:[],opts:opts};esc.refresh=esc.fill;var s=document.createElement('script');s.async=true;s.src=(opts.path||'')+'escobar.js?'+(new Date().getTime()/(1000*60)|0);document.getElementsByTagName('head')[0].appendChild(s);})({path:CONFIG.PATH.IMAGES+'pr0paganda/',debug:false,autoFill:false});p.ads._refreshInterval=setInterval(p.ads.refresh.bind(p.ads),CONFIG.ADS.REFRESH_INTERVAL);p.ads._escLoaded=true;},refresh:function(){if(!p.ads._escLoaded){return;}
esc.refresh();},fill:function(elements){if(!elements.length){return;}
p.ads.requireEscobar();esc.fill(elements);},category:function(){if(p.user.flags===1||p.user.flags===9||p.user.flags===8)return'sfw';else return'nsfw';}};(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}}(function($){var pluses=/\+/g;function raw(s){return s;}
function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}
function converted(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}
try{return config.json?JSON.parse(s):s;}catch(er){}}
var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}
value=config.json?JSON.stringify(value):String(value);return(document.cookie=[config.raw?key:encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=decode(parts.join('='));if(key&&key===name){result=converted(cookie);break;}
if(!key){result[name]=converted(cookie);}}
return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,'',$.extend(options,{expires:-1}));return true;}
return false;};}));p.LocalStore=p.Class.extend({storeName:'keyvalues',prefix:'default_',status:0,_db:null,_queue:[],init:function(name,version){this.prefix=name?(name+'_'):this.prefix;var that=this;var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!indexedDB){that.status=p.LocalStore.STATUS.FAILED;console.warn('LocalStore not supported');that._execQueue();return;}
version=version||1;try{var request=indexedDB.open('LocalStore',version||1);request.onupgradeneeded=function(){try{request.result.deleteObjectStore(that.storeName);}catch(err){console.warn('LocalStore deleteObjectStore:',err);}
try{request.result.createObjectStore(that.storeName);}catch(err){console.warn('LocalStore createObjectStore:',err);}};request.onsuccess=function(){that.status=p.LocalStore.STATUS.OPEN;that._db=request.result;that._execQueue();};request.onerror=function(err){console.warn('LocalStore open onerror:',err);that.status=p.LocalStore.STATUS.FAILED;that._execQueue();};}catch(err){that.status=p.LocalStore.STATUS.FAILED;console.warn('LocalStore open:',err);that._execQueue();}},_execQueue:function(){var queue=this._queue;this._queue=[];for(var i=0;i<queue.length;i++){var q=queue[i];this._execRequest(q.mode,q.action,q.callback,q.params);}},_execRequest:function(mode,action,callback,params){if(this.status===p.LocalStore.STATUS.OPEN){try{var store=this._db.transaction(this.storeName,mode).objectStore(this.storeName);var req=store[action].apply(store,params);if(callback){req.onsuccess=function(){callback(null,req.result);};req.onerror=function(err){console.warn('LocalStore transaction onerror:',err);callback(req.error,null);};}}catch(err){console.warn('LocalStore transaction:',err);if(err.name==='NotFoundError'){this._db.close();console.warn('LocalStore in broken state. Deleting.');p.LocalStore.deleteDatabase('LocalStore');}}}
else if(this.status===p.LocalStore.STATUS.NOT_OPEN){this._queue.push({mode:mode,action:action,callback:callback,params:params});}
else if(this.status===p.LocalStore.STATUS.FAILED&&callback){callback(this.status);}},getItem:function(key,callback){this._execRequest('readonly','get',callback,[this.prefix+key]);},setItem:function(key,value,callback){this._execRequest('readwrite','put',callback,[value,this.prefix+key]);},removeItem:function(key,callback){this._execRequest('readwrite','delete',callback,[this.prefix+key]);},clear:function(callback){this._execRequest('readwrite','clear',callback,[]);}});p.LocalStore.deleteDatabase=function(name){name=name||'LocalStore';var indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(indexedDB){try{indexedDB.deleteDatabase(name);}catch(err){console.warn('LocalStore deleteDatabase:',err);}}};p.LocalStore.STATUS={NOT_OPEN:0,FAILED:1,OPEN:2};p.VoteCache=p.Class.extend({votes:{items:{},tags:{},comments:{},users:{},commentFavs:{},collections:{}},localStore:null,_storageRequestsRunning:0,_updateFromLogWaiting:null,_cachedLastOffset:-1,setDatabaseName:function(name){name=(typeof name==='string')?name.replace(/[^\w]/,''):'default';this.localStore=new p.LocalStore(name,4);this.localStore.getItem('sync_log_version',function(error,version){if(!error&&version!==p.VoteCache.SYNC_LOG_VERSION){this.localStore.clear(function(){this.localStore.setItem('sync_log_version',p.VoteCache.SYNC_LOG_VERSION);}.bind(this));}}.bind(this));},clear:function(callback){this.votes.items={};this.votes.tags={};this.votes.comments={};this.localStore.clear(callback);},getLastSyncData:function(callback){if(!this.localStore){return;}
var that=this;this.localStore.getItem('last_offset',function(error,offset){if(error){return;}
var lastOffset=(parseInt(offset)||0);that.localStore.getItem('sync_token',function(error,token){if(that._cachedLastOffset!==-1&&that._cachedLastOffset!=lastOffset){that.loadFromLocal(function(){callback(lastOffset,token);});}
else{callback(lastOffset,token);}
that._cachedLastOffset=lastOffset;});});},createNewSyncToken:function(){var token=Math.random().toString(36).substr(2);this.localStore.setItem('sync_token',token);return token;},loadFromLocal:function(callback){if(!this.localStore){return;}
this._storageRequestsRunning++;this.localStore.getItem('votes',function(error,buffer){if(buffer&&buffer instanceof ArrayBuffer){this.createVotesFromBuffer(buffer);}
this._storageRequestsRunning--;if(this._updateFromLogWaiting){var r=this._updateFromLogWaiting;this._updateFromLogInternal(r.base64,r.offset,r.callback);this._updateFromLogWaiting=null;}
callback();}.bind(this));},storeToLocal:function(){var voteCount=0;for(var thing in this.votes){if(thing==='collections'){var votes=this.votes[thing];for(var thingId in votes){voteCount+=Object.keys(votes[thingId]).length*2;}}
else{voteCount+=Object.keys(this.votes[thing]).length;}}
var buffer=new ArrayBuffer(voteCount*5);var view=new DataView(buffer);var offset=0;for(var thing in this.votes){var votes=this.votes[thing];if(thing==='collections'){for(var thingId in votes){for(var collectionId in votes[thingId]){view.setUint32(offset,thingId,true);view.setInt8(offset+4,p.VoteCache.COLLECT);offset+=5;view.setUint32(offset,collectionId,true);view.setInt8(offset+4,p.VoteCache.COLLECTION_ID);offset+=5;}}}
else{var VA=p.VoteCache.VOTE_TO_ACTION[thing];for(var thingId in votes){var action=VA[votes[thingId]+1];view.setUint32(offset,thingId,true);view.setInt8(offset+4,action);offset+=5;}}}
this.localStore.setItem('votes',buffer);},updateFromLog:function(base64,offset,callback){if(!this.localStore||(!base64&&offset===this._cachedLastOffset)){return;}
this._cachedLastOffset=offset;if(this._storageRequestsRunning!=0){this._updateFromLogWaiting={base64:base64,offset:offset,callback:callback};}
else{this._updateFromLogInternal(base64,offset,callback);}},_updateFromLogInternal:function(base64,offset,callback){this.localStore.setItem('last_offset',offset);var buffer=this.base64ToArrayBuffer(base64||"");this.createVotesFromBuffer(buffer);this.storeToLocal();callback();},createVotesFromBuffer:function(buffer){var view=new DataView(buffer);var AV=p.VoteCache.ACTION_TO_VOTE;var collectionAction=0;var collectionItemId=0
for(var i=0;i<view.byteLength;i+=5){var thingId=view.getUint32(i,true);var action=AV[view.getInt8(i+4)];if(action&&action.vote===0){delete this.votes[action.thing][thingId];}
else if(action.thing==='collections'){if(action.vote===2&&collectionAction){if(collectionAction===-1){if(this.votes.collections[collectionItemId]&&this.votes.collections[collectionItemId][thingId]){delete this.votes.collections[collectionItemId][thingId];}}
else if(collectionAction===1){if(!this.votes.collections[collectionItemId]){this.votes.collections[collectionItemId]={};}
this.votes.collections[collectionItemId][thingId]=1;}
collectionAction=0;}
else{collectionAction=action.vote;collectionItemId=thingId;}}
else if(action){this.votes[action.thing][thingId]=action.vote;}}},base64ToArrayBuffer:function(base64){var bin=window.atob(base64);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++){bytes[i]=bin.charCodeAt(i);}
return bytes.buffer;}});p.VoteCache.ACTION_TO_VOTE=[null,{thing:'items',vote:-1},{thing:'items',vote:0},{thing:'items',vote:+1},{thing:'comments',vote:-1},{thing:'comments',vote:0},{thing:'comments',vote:+1},{thing:'tags',vote:-1},{thing:'tags',vote:0},{thing:'tags',vote:+1},{thing:'items',vote:+2},{thing:'comments',vote:+2},{thing:'users',vote:1},{thing:'users',vote:0},{thing:'users',vote:2},{thing:'users',vote:1},{thing:'commentFavs',vote:1},{thing:'commentFavs',vote:0},{thing:'collections',vote:-1},{thing:'collections',vote:1},{thing:'collections',vote:2},];p.VoteCache.UNCOLLECT=18;p.VoteCache.COLLECT=19;p.VoteCache.COLLECTION_ID=20;p.VoteCache.VOTE_TO_ACTION={items:[1,2,3,10],comments:[4,5,6,11],tags:[7,8,9],users:[0,13,12,14],commentFavs:[0,17,16],collections:[0,19,18],};p.VoteCache.SYNC_LOG_VERSION=6;p.User=p.Class.extend({id:null,paid:false,cookie:{},flags:1,flagsName:'sfw',name:'',admin:false,syncTimeout:null,showAds:true,favUpvote:true,verified:true,inboxCount:0,inbox:{comments:0,mentions:0,messages:0,notifications:0,follows:0},syncToken:null,video:{volume:1,muted:true},init:function(){this.voteCache=new p.VoteCache();this.loadCookie();if(this.id){this.voteCache.setDatabaseName(this.name);this.voteCache.loadFromLocal(this.syncVotesOnCurrentView.bind(this));this.sync();}
this.setLastVisit();},login:function(data,callback){this.externalCallback=callback;p.api.post('user.login',data,this.loginCallback.bind(this));},logout:function(){p.api.post('user.logout',{id:this.id});this.voteCache.clear();this.softLogout();},softLogout:function(){this.flags=CONFIG.SFW_FLAG.SFW.flag;this.cookie={};this.saveCookie();this.id=null;this.paid=0;if(this.syncTimeout){clearTimeout(this.syncTimeout);}},setFlags:function(flags){if(flags<1||!this.verified){flags=CONFIG.SFW_FLAG.SFW.flag;}
this.flags=flags;this.cookie.fl=flags;this.saveCookie();this.reloadFlagsName();return true;},setShowAds:function(forceOn){if(this.paid&&forceOn){this.set('ads',1);this.showAds=true;}
else{this.unset('ads');if(this.paid){this.showAds=false;}}},setFavUpvote:function(disable){if(disable){this.unset('fav');this.favUpvote=false;}else{this.set('fav',1);this.favUpvote=true;}},loginCallback:function(response){if(response.success){this.loadCookie();this.voteCache.setDatabaseName(this.name);this.voteCache.loadFromLocal(this.syncVotesOnCurrentView.bind(this));this.sync();}
if(this.externalCallback){this.externalCallback(response);}},get:function(key){return this.cookie[key]||null;},set:function(key,value){this.cookie[key]=value;this.saveCookie();},unset:function(key){delete this.cookie[key];this.saveCookie();},getTheme:function(){return parseInt(this.get('t'))||0;},setTheme:function(themeId){this.set('t',themeId);},loadCookie:function(){var restored=JSON.parse($.cookie(CONFIG.COOKIE.NAME)||'{}');if(restored){this.cookie=p.merge(this.cookie,restored);this.id=this.cookie.id;this.flags=parseInt(this.cookie.fl)||1;if(this.flags<1){this.flags=CONFIG.SFW_FLAG.SFW.flag;}
if(this.id){this.name=this.cookie.n;this.admin=!!this.cookie.a;this.paid=!!this.cookie.paid;if(this.flags&CONFIG.SFW_FLAG.SFW.flag){this.flags=this.flags|CONFIG.SFW_FLAG.NSFP.flag;}}
this.video.volume=this.cookie.vv!==undefined?(this.cookie.vv/100):1;this.video.muted=this.cookie.vm!==false;if(this.cookie.lv+3600<Date.now()/1000){this.video.muted=true;this.saveAudioSettings();}}
else{this.id=null;}
if(!this.id){this.flags=CONFIG.SFW_FLAG.SFW.flag;this.admin=false;this.paid=false;}
if(!this.paid&&this.cookie.t!==0){this.setTheme(0);}
this.showAds=!!(!this.paid||this.cookie.ads);this.favUpvote=!!this.cookie.fav;this.verified=(this.cookie.verified===undefined||!!this.cookie.verified);this.reloadFlagsName();},reloadFlagsName:function(){if(this.flags==(CONFIG.SFW_FLAG.SFW.flag|CONFIG.SFW_FLAG.NSFW.flag|CONFIG.SFW_FLAG.NSFL.flag|CONFIG.SFW_FLAG.NSFP.flag)){this.flagsName='alle';}
else{var names=[];for(var f in CONFIG.SFW_FLAG){if(this.flags&CONFIG.SFW_FLAG[f].flag&&CONFIG.SFW_FLAG[f].flag!=CONFIG.SFW_FLAG.NSFP.flag){names.push(CONFIG.SFW_FLAG[f].name);}}
this.flagsName=names.length?names.join('+'):CONFIG.SFW_FLAG.SFW.name;}},saveAudioSettings:function(){this.set('vv',(this.video.volume*100)|0);this.set('vm',this.video.muted);},setLastVisit:function(){this.set('lv',(Date.now()/1000)|0);setTimeout(this.setLastVisit.bind(this),60*1000);},saveCookie:function(){var cs=JSON.stringify(this.cookie);$.cookie(CONFIG.COOKIE.NAME,cs,{expires:CONFIG.COOKIE.EXPIRE,path:'/',secure:CONFIG.COOKIE.SECURE});},sync:function(){this.voteCache.getLastSyncData((function(lastOffset,globalSyncToken){if(!globalSyncToken||!this.syncToken||this.syncToken===globalSyncToken){this.syncToken=this.voteCache.createNewSyncToken();p.api.get('user.sync',{offset:lastOffset},this.syncCallback.bind(this),p.ServerAPI.SILENT);}
else{this.syncToken=globalSyncToken;this.voteCache.localStore.getItem('inbox',(function(error,inbox){this.setInboxLink(inbox||{comments:0,mentions:0,messages:0,notifications:0,follows:0});this.scheduleSync();}).bind(this));}}).bind(this));},syncCallback:function(response){this.voteCache.localStore.setItem('inbox',response.inbox);this.setInboxLink(response.inbox);this.loadCookie();this.voteCache.updateFromLog(response.log,response.logLength,this.syncVotesOnCurrentView.bind(this));this.scheduleSync();},scheduleSync:function(){if(this.id&&CONFIG.AUTO_SYNC.ENABLED){clearTimeout(this.syncTimeout);this.syncTimeout=setTimeout(this.sync.bind(this),CONFIG.AUTO_SYNC.INTERVAL*1000);}},restoreVotes:function(callback){clearTimeout(this.syncTimeout);this.voteCache.clear();p.api.get('user.sync',{offset:0},function(response){if(callback){callback(response);}
this.syncCallback(response);}.bind(this),p.ServerAPI.SILENT);},setInboxLink:function(inbox){this.inboxCount=inbox.comments+
inbox.mentions+
inbox.messages+
inbox.notifications+
inbox.follows;this.inbox=inbox;let empty=(this.inboxCount===0);let inboxLink=$('#inbox-link');p.mainView.setNotificationCount(this.inboxCount);inboxLink.toggleClass('empty',empty);if(inbox.messages||(!inbox.comments&&!inbox.mentions&&!inbox.notifications&&!inbox.follows)){inboxLink.attr('href','/inbox/messages');}
else if(inbox.notifications){inboxLink.attr('href','/inbox/notifications');}
else if(inbox.follows){inboxLink.attr('href','/inbox/follows');}
else{inboxLink.attr('href','/inbox/comments');}
$('#inbox-count').text(this.inboxCount);},syncVotesOnCurrentView:function(){if(p.currentView&&p.currentView.syncVotes){p.currentView.syncVotes(this.voteCache.votes);}}});p.User.MARK={'0':'Schwuchtel','1':'Neuschwuchtel','2':'Altschwuchtel','3':'Admin','4':'Gesperrt','5':'Moderator','6':'Fliesentischbesitzer','7':'Lebende Legende','8':'Wichtler','9':'Edler Spender','10':'Mittelaltschwuchtel','11':'Alt-Moderator','12':'Community-Helfer','13':'Nutzer-Bot','14':'System-Bot','15':'Alt-Helfer',};p.User.COLLECTIONS_CACHE=null;p.ServerAPI=p.Class.extend({path:'/',init:function(path){this.path=path||'/';},post:function(endpoint,data,callback,errback){if(CONFIG.READ_ONLY){if(errback){errback();}
return;}
this._ajax('POST',endpoint,data,callback,errback);},get:function(endpoint,data,callback,errback,defaulterror){this._ajax('GET',endpoint,data,callback,errback,defaulterror);},_ajax:function(method,endpoint,data,callback,errback,defaulterror=true){if(data instanceof HTMLFormElement||((data instanceof $)&&data.is('form'))){data=$(data).serialize();if(data.length>0&&p.user.id&&method=='POST'){data=data+'&_nonce='+p.user.id.substr(0,16);}}
else if(method=='POST'&&p.user&&p.user.id){if(typeof(data)=='object'){data._nonce=p.user.id.substr(0,16);}
else if(typeof(data)=='string'){data=data+'&_nonce='+p.user.id.substr(0,16);}}
var url=this.path+endpoint.replace(/\./g,'/');if(this.onerror&&errback!==p.ServerAPI.SILENT){if(errback&&defaulterror){var onerror=this.onerror;var paramErrback=errback;errback=function(response){onerror(response);paramErrback(response);}}
else if(!errback){errback=this.onerror;}}
$.ajax({type:method,url:url,success:callback,error:errback,dataType:'json',data:data});}});p.ServerAPI.SILENT=function(){};p.View={};p.View.Base=p.Class.extend({title:null,visible:false,needsRendering:false,aborted:false,compiledTemplate:null,template:null,children:[],data:{},dataReady:true,parentView:null,requiresLogin:false,loginUrl:'overlay',resetViewport:true,$container:null,init:function(container,parent){if(this.requiresLogin&&!p.user.id){this.aborted=true;if(this.loginUrl=='overlay'){p.mainView.showLogin();}
else{p.navigateToPushStack(this.loginUrl);}
return;}
this.$container=container?$(container):null;if(parent){this.parentView=parent;this.parentView.children.push(this);}
this.compiledTemplate=p._compiledTemplates[this.classId];if(!this.compiledTemplate&&this.template){this.compiledTemplate=p.compileTemplate(this.template);p._compiledTemplates[this.classId]=this.compiledTemplate;}},remove:function(){this.visible=false;if(!this.parentView){return;}
this.parentView.children.erase(this);},resize:function(){for(var i=0;i<this.children.length;i++){this.children[i].resize();}},load:function(){return true;},showLoader:function(){if(!$('#loader').length){$('#head-content').append(p.View.Base.LoadingAnimHTML);}},hideLoader:function(){$('#loader').remove();},render:function(){if(!this.visible){return;}
if(!this.parentView&&this.resetViewport!==false){$(document).scrollTop(0);}
this.hideLoader();if(!this.$container){this.$container=$(this.compiledTemplate(this.data));}
else{this.$container.html(this.compiledTemplate(this.data));}
var anchors=this.$container.find('a[href^="#"]');if(p._hasPushState){anchors.each(function(){this.href='/'+$(this).attr('href').substr(1);});}
anchors.click(this.handleHashLink.bind(this));this.needsRendering=false;if(this.title!==null){p.mainView.setTitle(this.title);}},handleHashLink:function(ev){if(!p.isNormalClick(ev)){return true;}
var target=$(ev.currentTarget);if(target.hasClass('action')){return false;}
var mode=target.hasClass('silent')?p.NAVIGATE.SILENT:p.NAVIGATE.DEFAULT;p.navigateTo(target.attr('href').substr(1),mode);return false;},show:function(params){if(this.aborted){return;}
this.needsRendering=true;this.data.params=params||{};this.visible=true;var loaded=this.load();if(this.needsRendering){if(loaded){this.hideLoader();this.render();}
else{this.showLoader();}}
for(var i=0;i<this.children.length;i++){this.children[i].show(params);}},hide:function(){this.visible=false;for(var i=0;i<this.children.length;i++){this.children[i].hide();}},focus:function(selector){var f=this.$container.find(selector);setTimeout(function(){f.focus();},1);}});p.View.Base.LoadingAnimHTML=$('<div id="loader"><div></div></div>');p._compiledTemplates={};p.View.Overlay=p.View.Overlay||{};p.View.Overlay.BatchDeleteItem=p.View.Base.extend({name:'overlay-batch-delete-item',resetViewport:false,template:'<div class="overlay-content"> <h2>Hochlads löschen</h2> </div> <div class="overlay-content"> <form id="batch-image-delete-form"> <div class="form-row"> <label class="checkbox-label"> <input name="reason" type="radio" value="custom" checked id="custom"/> </label> <input type="text" class="text-line" name="customReason" placeholder="Grund"/> <?js for (let reason of reasons) { ?> <label> <input name="reason" type="radio" value="{reason.banReason}"/> {reason.banReason} </label> <?js } ?> </div> <div class="form-row"> <input type="checkbox" name="banUser" id="delete-ban-user"/> <label class="checkbox-label" for="delete-ban-user">Benutzer Sperren für</label> <input type="text" name="days" class="number" value="1"/> Tage (0 = für immer) </div> <div class="form-row"> <input type="submit" value="Alle Löschen" id="image-delete"/> </div> </form> </div> ',elements:[],init:function(container,parent){this.elements=document.querySelectorAll('a.thumb.remove');this.parent(container,parent);},load:function(){p.mainView.showLoader();p.api.get('faq.reasons',{type:9},this.loaded.bind(this));},loaded:function(response){this.data.reasons=response.rules;p.mainView.hideLoader();this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));var customRadionButton=this.$container.find('input[name=reason][value=custom]');this.$container.find('input[name=customReason]').bind('focus onchange',function(){customRadionButton.prop('checked',true);});this.focus('input[name=customReason]');},submit:function(ev){ev.preventDefault();const items=[];this.elements.forEach(el=>{items.push(el.id.replace('item-',''));});let data=new URLSearchParams();data.append('items',items);data.append('reason',$('input[name=reason]:checked').val());data.append('customReason',$('input[name=customReason]').val());data.append('banUser',$('input[name=banUser]:checked').length);data.append('days',$('input[name=days]').val());data.append('_nonce',p.user.id.substr(0,16));fetch(CONFIG.API.ENDPOINT+'items/batchDelete',{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8",},body:data.toString()}).then(res=>res.json()).then(response=>this.posted(response));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){document.body.removeChild(document.getElementById('batch-delete-counter'));this.elements.forEach(e=>e.className=e.className.replaceAll('remove',''));this.hideLoader();p.mainView.closeOverlay();}});p.Hotkeys=p.Class.extend({$indicator:null,init:function(element){$(element).keydown(this.keydown.bind(this));},keydown:function(ev){if((ev.target.type==='text'||ev.target.type==='textarea')&&ev.ctrlKey&&ev.keyCode===p.KEY.ENTER){ev.target.form.querySelector("input[type='submit']").click()}
if(ev.altKey){switch(ev.keyCode){case p.KEY.W:if(p.user.admin){ev.preventDefault();const elm=document.getElementById(`item-${$('.tag-form input[name=itemId]').val()}`);elm.className+=" remove";if(document.getElementById('batch-delete-counter')){const counter=document.getElementById('batch-delete-counter');counter.innerHTML=document.querySelectorAll('a.thumb.remove').length;}else{const t=document.createElement('div');t.id='batch-delete-counter';t.innerHTML=document.querySelectorAll('a.thumb.remove').length;document.body.append(t);}
this.showKeyIndicator('O',true);}
return true;case p.KEY.S:if(p.user.admin){ev.preventDefault();const elm=document.getElementById(`item-${$('.tag-form input[name=itemId]').val()}`);elm.className=elm.className.replaceAll(' remove','');if(document.getElementById('batch-delete-counter')){const counter=document.getElementById('batch-delete-counter');counter.innerHTML=document.querySelectorAll('a.thumb.remove').length;}}
return true;case p.KEY.X:{if(p.user.admin){ev.preventDefault();p.mainView.showOverlay(p.View.Overlay.BatchDeleteItem);}
return true;}}}
if(ev.altKey||ev.ctrlKey||ev.metaKey){return;}
if(ev.target.type=='text'||ev.target.type=='textarea'||ev.target.type=='email'||ev.target.type=='password'||ev.target.type=='date'||ev.target.type==='time'||ev.target.className=='button'){if(ev.keyCode==p.KEY.ESC){ev.target.blur();}
return;}
if(this.handleKey(ev.keyCode)){ev.preventDefault();return false;}
return true;},handleKey:function(code){let video=$('video')[0];switch(code){case p.KEY.LEFT_ARROW:case p.KEY.A:$('.stream-prev:visible').click();return true;case p.KEY.RIGHT_ARROW:case p.KEY.D:$('.stream-next:visible').click();return true;case p.KEY.ESC:if(p.mainView.overlayView){p.mainView.closeOverlay();}
else{$('.item-image:visible').click();}
return true;case p.KEY.K:$('#search-form-inline:visible input.q').focus();return true;case p.KEY.C:$('.comment:visible').focus();return true;case p.KEY.X:$('#item-delete').click();return true;case p.KEY.E:$('#item-edit-tags').click();return true;case p.KEY.T:$('.add-tags-link:visible').click();$('.tagsinput-writebox').focus();return true;case p.KEY.F:case p.KEY.MULTIPLY:if($('.vote-fav').click().length){this.showKeyIndicator($('.vote-fav.faved').length?'*':'+',true);}
return true;case p.KEY.W:case p.KEY.PLUS:case p.KEY.ADD:case p.KEY.G:if(!$('.item-vote').hasClass('voted-up')&&$('.item-vote .vote-up:visible').click().length){this.showKeyIndicator('+',true);}
return true;case p.KEY.S:case p.KEY.MINUS:case p.KEY.SUBTRACT:case p.KEY.B:if(!$('.item-vote').hasClass('voted-down')&&$('.item-vote .vote-down:visible').click().length){this.showKeyIndicator('-',true);}
return true;case p.KEY.Q:$('svg.audio-state').trigger('mousedown');return true;case p.KEY.P:$('svg.video-state').trigger('mousedown');return true;case p.KEY.N:if(p.user.admin){var itemId=$('.tag-form input[name=itemId]').val();if(itemId){this.showKeyIndicator('nsfw',false);p.api.post('tags.add',{tags:'nsfw',itemId:itemId});}}
return true;case p.KEY.M:if(p.user.admin){var itemId=$('.tag-form input[name=itemId]').val();if(itemId){this.showKeyIndicator('nsfl',false);p.api.post('tags.add',{tags:'nsfl',itemId:itemId});}}
return true;case p.KEY.PERIOD:if(!video)return false;video.volume=(video.volume+0.1<=1)?video.volume+0.1:video.volume;return true;case p.KEY.COMMA:if(!video)return false;if(video.volume-0.1>0){video.volume=video.volume-0.1;}else{video.volume=0;}
return true;case p.KEY.L:if(!video)return false;video.currentTime=video.currentTime+5;this.showKeyIndicator('+5',false);return true;case p.KEY.J:if(!video)return false;video.currentTime=video.currentTime-5;this.showKeyIndicator('-5',false);return true;case p.KEY["0"]:case p.KEY["1"]:case p.KEY["2"]:case p.KEY["3"]:case p.KEY["4"]:case p.KEY["5"]:case p.KEY["6"]:case p.KEY["7"]:case p.KEY["8"]:case p.KEY["9"]:if(!video)return false;let percentage=parseFloat("0."+String.fromCharCode(code));video.currentTime=percentage*video.duration;this.showKeyIndicator(String.fromCharCode(code)+"0%",false);return true;}
return false;},showKeyIndicator:function(text,isPict){if(!this.$indicator){this.$indicator=$('<div/>').attr('id','key-indicator');$('body').append(this.$indicator);}
this.$indicator.stop().css('opacity',1).toggleClass('pict',isPict).text(text).show().delay(500).fadeOut(CONFIG.ANIMATION_TIME);}});"use strict";p.voteClass=function(vote){return vote?(vote==1?' voted-up':' voted-down'):'';};p.adjustVote=function(thing,vote,cached){if(!thing){return;}
if(thing.vote<0){thing.down--;}
else if(thing.vote>0){thing.up--;}
if(vote>0){thing.up++;}
else if(vote<0){thing.down++;}
thing.vote=vote;if(cached&&thing.id){cached[thing.id]=vote;}};p.shouldShowScore=function(thing){return(p.user.admin||thing.name===p.user.name||thing.user===p.user.name||(thing.created+CONFIG.SHOW_SCORE_MIN_AGE<Date.now()/1000));};p.olderThanMinAge=function(thing){return(thing.created+CONFIG.SHOW_SCORE_MIN_AGE<Date.now()/1000)};p.View.Error404=p.View.Base.extend({title:"Fehler: 404",template:'<h2 class="main-message">ZOMFG, 404 &#175;\\_(&#12484;)_/&#175;</h2>',init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Login=p.View.Base.extend({name:'overlay-login',resetViewport:false,template:'<div class="overlay-content divide-2-1"> <h2>Anmelden</h2> <?js if(loginFailed) {?> <?js if(ban && ban.banned) { ?> <p class="warn"> Dein Account ist gesperrt. <?js if(ban.till) {?> Die Sperrung wird am {ban.till.readableTime()} ({ban.till.relativeTime()}) aufgehoben. <?js } else { ?> Die Sperrung ist dauerhaft. <?js } ?> <?js if(ban.reason) {?> <strong>Grund:</strong> {{ban.reason}} <?js } ?> </p> <?js } else { ?> <?js if (error == \'invalidCaptcha\') {?> <p class="warn">Das Captcha stimmt nicht überein</p> <?js } else if (error == \'invalidLogin\') {?> <p class="warn">Falscher Benutzername oder Passwort</p> <?js } else if (error == \'wrongFormat\') {?> <p class="warn">Bitte gebe einen gültigen <strong>Benutzernamen</strong> ein. Mit der E-Mailadresse kann man sich nicht anmelden.</p> <?js } ?> <?js } ?> <?js } ?> <form> <div class="form-row"> <p></p> <label>Benutzername:</label> <input type="text" name="name" placeholder="Name" pattern="{namePattern}" title="Der Benutzername darf keine Sonderzeichen beinhalten. E-Mailadressen werden ebenfalls nicht akzeptiert." tabindex="201" value="{{name}}" autocomplete="nickname" required /> </div> <div class="form-row"> <label>Passwort:</label> <input type="password" name="password" placeholder="Passwort" autocomplete="current-password" tabindex="202" required /> </div> <div class="form-row"> </div> <?js if (token) {?> <div class="form-row"> <label>Captcha:</label> <div> <img src="{captcha}" alt="captcha" style="width:180px; height:45px"/> </div> <input type="text" name="captcha" placeholder="Captcha" tabindex="203" autocomplete="off" required/> <input type="hidden" name="token" value="{token}"/> </div> <?js } ?> <div class="form-row"> <input type="submit" value="Anmelden" id="login-button" tabindex="204"/> </div> <p> <span class="link" id="reset-password-link">Passwort vergessen?</span> </p> </form> </div> <div class="overlay-content divide-2-2"> <h2>Neu Registrieren</h2> <p> Wenn du noch keinen Account hast, kannst du dir jetzt einen pr0mium Account erstellen. </p> <div class="call-to-action"> <a href="#pr0mium" class="confirm-button">Jetzt pr0mium User werden</a> </div> </div> ',data:{ban:null,name:'',loginFailed:false,namePattern:'[A-Za-z0-9]{0,32}'},load:function(){p.api.get('user.captcha',{bust:Math.random()},this.loaded.bind(this));return false;},loaded:function(response){this.data.token=response.token;this.data.captcha=response.captcha;this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));if(!p.mobile){this.focus('input[name=name]');}
$('#reset-password-link').click(p.mainView.showResetPassword.bind(p.mainView));},submit:function(ev){this.data.name=$(ev.target).find('input[name=name]').val();if(this.data.name.match(/^[A-Za-z0-9]{0,32}$/)===null){this.data.loginFailed=true;this.data.error='wrongFormat';this.load();return false;}
p.user.login(ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(response.success){p.reload();}
else{this.data.loginFailed=true;this.data.error=response.error;if(!!response.info&&!response.info.valid){p.navigateTo("user/"+response.info.name+"/validate");}
this.data.ban=response.ban;if(this.data.ban&&this.data.ban.till){this.data.ban.till=new Date(this.data.ban.till*1000);}
this.load();}}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.ResetPassword=p.View.Base.extend({name:'overlay-reset-password',resetViewport:false,template:'<div class="overlay-content"> <h2>Passwort zurücksetzen</h2> </div> <div class="overlay-content"> <?js if(resetSuccess) { ?> <div class="notice"> Die E-Mail mit dem Link zum Zurücksetzen wurde versendet. </div> <?js } else { ?> <form method="post"> <div class="form-row"> <input type="email" name="email" placeholder="E-Mail Adresse" value=""/> </div> <?js if(resetFailed) {?> <p class="warn">E-Mail Adresse nicht bekannt, oder der Account ist gesperrt</p> <?js } ?> <div class="form-row"> <input type="submit" value="Abschicken"/> </div> </form> <?js } ?> </div> ',data:{resetFailed:false,resetSuccess:false},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));this.focus('input[name=email]');if(p.location==='resetpassword'){$('#head').hide();}},submit:function(ev){p.api.post('user.sendpasswordresetmail',ev.currentTarget,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){this.data.resetFailed=!response.success;this.data.resetSuccess=response.success;this.render();}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Error=p.View.Base.extend({name:'overlay-error',resetViewport:false,template:'<div class="overlay-content"> <h2>ZOMG, Fehler!</h2> </div> <div class="overlay-content"> <?js if(error) {?> <h2 class="warn">{error.code} &ndash; {{error.msg}}</h2> <?js if(error.error == \'limitReached\' ) { ?> <p>Was immer du getan hast, es war zu viel. Probier\'s später nochmal.</p> <?js } else if (error.desc) { ?> <p>{{error.desc}}</p> <?js } else if (error.html) { ?> <p>{error.html}</p> <?js } ?> <?js } else {?> <h2 class="warn">Irgendwas Doofes ist passiert. Probier\'s später nochmal :/</h2> <?js } ?> </div> ',data:{error:null},init:function(container,parent,error){this.data.error=error;this.parent(container,parent);},show:function(params){if(params){this.data.error=params;}
this.parent();}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Report=p.View.Base.extend({name:'overlay-report',resetViewport:false,template:'<div class="overlay-content"> <h2>Beitrag melden</h2> </div> <div class="overlay-content"> <form id="image-delete-form" method="post"> <div class="form-row"> <p> Bitte stelle sicher, dass der Beitrag tatsächlich gegen unsere Regeln verstößt. Missbrauch der <em>Melden</em>-Funktion wird nicht geduldet. </p> <label class="checkbox-label"> <input name="reason" type="radio" value="custom" checked id="custom"/> </label> <input type="text" class="text-line" name="customReason" placeholder="Grund"/> <?js for (let reason of reasons) { ?> <label> <input name="reason" type="radio" value="{reason.banReason}"/> {reason.banReason} </label> <?js } ?> <?js if (allowSelfReport) { ?> <label> <input name="reason" type="radio" value="Ich habe diesen Beitrag selbst erstellt und möchte ihn gelöscht haben"/> Ich habe diesen Beitrag selbst erstellt und möchte ihn gelöscht haben </label> <?js } ?> </div> <div class="form-row"> </div> <div class="form-row"> <input type="hidden" name="itemId" value="{itemId}"/> <input type="hidden" name="commentId" value="{commentId}"/> <input type="hidden" name="userId" value="{userId}"> <input type="submit" value="Melden" id="report"/> </div> </form> </div> ',data:{itemId:0,commentId:0,userId:0,reasons:{},allowSelfReport:true},init:function(container,parent,params){this.data.itemId=params.itemId||0;this.data.commentId=params.commentId||0;this.data.userId=params.userId||0;this.parent(container,parent);},load:function(){let type=(this.data.commentId!==0)?2:1;if(this.data.userId!==0){this.data.allowSelfReport=false;type=4}
if(p.user.admin){type+=8}
p.mainView.showLoader();p.api.get('faq.reasons',{type:type},this.loaded.bind(this));},loaded:function(response){this.data.reasons=response.rules;p.mainView.hideLoader();this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));var customRadionButton=this.$container.find('input[name=reason][value=custom]');this.$container.find('input[name=customReason]').bind('focus onchange',function(){customRadionButton.prop('checked',true);});this.focus('input[name=customReason]');},submit:function(ev){ev.preventDefault();let endpoint=(this.data.commentId!==0)?'contact.reportComment':'contact.reportItem';endpoint=(this.data.userId!==0)?'contact.reportUser':endpoint;p.api.post(endpoint,ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){this.$container.find('.overlay-content').text('Danke!');setTimeout(function(){p.mainView.closeOverlay();},1000);}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.BookmarkAdd=p.View.Base.extend({name:'overlay-bookmark-add',resetViewport:false,template:'<div class="overlay-content"> <h2>Lesezeichen hinzufügen</h2> </div> <div class="overlay-content"> <form id="image-delete-form"> <div class="form-row"> <label>Bezeichnung:</label> <input class="wide" type="text" name="name" maxlength="90" placeholder="Bezeichnung" value="{{name}}"/> <?js if(error === \'invalidName\') {?> <p class="warn">Ungültiger Name.</p> <?js } ?> </div> <div class="form-row"> <label>Ziel:</label> <input class="wide" type="text" name="link" maxlength="255" placeholder="Ziel" value="{{link}}"/> <?js if(error === \'invalidLink\') {?> <p class="warn">Ungültige Ziel URL.</p> <?js } ?> </div> <div class="form-row"> </div> <div class="form-row"> <input type="submit" value="Lesezeichen Hinzufügen" id="bookmark-add"/> </div> </form> </div> ',data:{error:null,name:"",link:""},init:function(container,parent,params){this.data.name=(params)?params.name:p.mainView.title||'';this.data.link=(params)?params.link:"/"+p.getLocation();this.parent(container,parent);},show:function(params){if(!p.mainView.requireLogin()){return false;}
if(!p.user.paid){p.mainView.closeOverlay();p.mainView.showOverlay(p.View.Overlay.Error,{code:402,msg:"Payment Required",html:"Diese Funktion steht Dir nur mit einem <a href='/pr0mium'>pr0mium</a> Account zur Verfügung!"});return false;}
this.parent(params);},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));if(!p.mobile){this.focus('input[name=name]');}},submit:function(ev){p.api.post('bookmarks.add',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(!response.error){p.mainView.closeOverlay();if(p.mainView.bookmarksSubView){p.mainView.bookmarksSubView.loaded(response);setTimeout(function(){p.mainView.bookmarksSubView.preventHide=false;},300);}}
else{this.data.name=this.$container.find('input[name=name]').val();this.data.link=this.$container.find('input[name=link]').val();this.data.error=response.error;this.render();}},remove:function(){this.parent();if(p.mainView.bookmarksSubView){p.mainView.bookmarksSubView.preventHide=false;}}});p.View.CancerDonations=p.View.Base.extend({template:'<h1 class="pane-head not-in-dropdown">Aktuelle Spendenergebnisse</h1> <a href="/top/4467685" class="cancer-donations-total" id="cancer-donations-total-value"> {donations.sums.total.confirmed.toLocaleString()}&euro; </a> <span class="not-in-dropdown spacing">(Gesamt)</span> <div class="details-wrap" style="margin-bottom: 50px;"> <div class="details"> <h2 class="only-in-dropdown">Aktuelle Spendenergebnisse</h2> <div id="cancer-donations-detailed-stats"> <?js for (var l in donations.sums.orgasCountOnly) { var orgac = donations.sums.orgasCountOnly[l]; ?> <p> {{orgac.name}}:<br/> <span class="sub-total">{orgac.postCount} gute Taten</span> </p> <?js } ?> <?js for (var k in donations.sums.orgas) { var orga = donations.sums.orgas[k]; ?> <p> {{orga.name}}:<br/> <span class="sub-total">{orga.confirmed.toLocaleString()}&euro;</span> <span class="donations-count">({orga.postCount} Spenden)</span> </p> <?js } ?> </div> </div> </div>',data:{donations:[]},preventHide:false,load:function(){p.api.get('cancerdonations.get',{},this.loaded.bind(this));setTimeout(this.load.bind(this),1000*120);if(this.data.params.iap){$('#head').hide();}
return false;},loaded:function(response){this.data.donations=response.donations;this.render();}});p.View.Bookmarks=p.View.Base.extend({template:'<?js if (collections.length) {?> <div class="bookmarks-head"> <span class="bookmarks-head-type">Sammlungen</span> <span class="bookmarks-head-divider"></span> </div> <?js for (var i = 0; i < collections.length; i++) { var c = collections[i]; ?> <div class="bookmark-row"> <a href="#user/{p.user.name}/{c.keyword}"> <span class="pict bookmark-collection">*</span> {{c.name}} </a> </div> <?js } ?> <?js } ?> <?js if (trending && trending.length) {?> <div class="bookmarks-head"> <span class="bookmarks-head-type">Frequentiert</span> <span class="bookmarks-head-divider"></span> </div> <?js for (var i = 0; i < trending.length; i++) { var bm = trending[i]; ?> <div class="bookmark-row"> <a href="#new/! {{bm.search}}"> <svg viewBox="96 0 400 400" class="icon trending-icon"> <path fill="currentColor" d="M464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"> </path> </svg> {{bm.name.shorten(30)}} </a> </div> <?js } ?> <?js } ?> <div class="bookmarks-head"> <span class="bookmarks-head-type">Lesezeichen</span> <span class="bookmarks-head-divider"></span> <span class="bookmark-add">+ hinzufügen</span> </div> <?js for (var i = 0; i < bookmarks.length; i++) { var bm = bookmarks[i]; ?> <div class="bookmark-row"> <a href="#{{bm.link}}"> <svg viewBox="0 0 384 512" class="icon bookmark-icon"> <path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"/> </svg> {{bm.name.shorten(30)}} </a> <span class="bookmark-delete" title="Lesezeichen löschen" data-index="{i}">×</span> </div> <?js } ?> <?js if (deleted) { ?> <div class="bookmark-row undo-delete-row"> “{{deleted.name}}” wurde gelöscht. <span class="action bookmark-undo-delete" data-link="{{deleted.link}}" data-name="{{deleted.name}}">Rückgängig</span> </div> <?js } ?>',data:{bookmarks:[],deleted:null},preventHide:false,load:function(){var opts={};if(!p.user.id){opts.default=true;}
p.api.get('bookmarks.get',opts,this.loaded.bind(this));return false;},loaded:function(response){this.data.collections=response.collections;this.data.bookmarks=response.bookmarks;this.data.trending=response.trending||[];for(var i=0;i<this.data.trending.length;i++){this.data.trending[i].search=encodeURIComponent(this.data.trending[i].search);}
this.render();},render:function(){this.parent();this.$container.find('.bookmark-delete').click(this.delete.bind(this));this.$container.find('.bookmark-add').click(this.add.bind(this));this.$container.find('.bookmark-undo-delete').click(this.undoDelete.bind(this));this.$container.find('.undo-delete-row').delay(10000).fadeOut('fast');},add:function(){if(!p.user.paid){return p.navigateTo('pr0mium');}
p.mainView.showOverlay(p.View.Overlay.BookmarkAdd);this.preventHide=true;return false;},delete:function(ev){if(!p.user.paid){return p.navigateTo('pr0mium');}
var index=$(ev.target).data('index');var bm=this.data.bookmarks[index];this.data.deleted=bm;this.data.bookmarks.splice(index,1);p.api.post('bookmarks.delete',{name:bm.name});this.render();return false;},undoDelete:function(ev){p.api.post('bookmarks.add',{name:this.data.deleted.name,link:'/'+this.data.deleted.link});this.data.bookmarks.unshift(this.data.deleted);this.data.deleted=null;this.render();return false;}});p.View.Layout=p.View.Base.extend({template:'<?js if(p.user.showAds) {?> <div class="side-wide-skyscraper gpt fixed-sidebar-left" id="gpt-skyscraper-left" data-escobar="skyscraper-left-{p.ads.category()}"> </div> <div class="side-wide-skyscraper gpt fixed-sidebar-right" id="gpt-skyscraper-right" data-escobar="skyscraper-right-{p.ads.category()}"> </div> <?js } ?> <div id="page"> <div id="head"> <div id="head-content"> <a id="casino-badge" title="CASIN0 PR0YALE" href="/casino"></a> <div id="cancer-donations"></div> <div class="user-info guest-only"> <span class="head-link" id="login-link">anmelden</span> </div> <div class="user-info user-only"> <a href="#user/{user.name}" id="user-profile-name" class="head-link">{user.name}</a> <a href="#user/{user.name}" id="user-profile-icon" class="head-link pict">~</a> <a href="#inbox/messages" id="inbox-link" class="empty head-link" title="Nachrichten"> <span class="pict">m</span> <span id="inbox-count">0</span> </a> <a href="#settings/site" class="head-link pict" id="settings-link" title="Einstellungen">#</a> </div> <a href="#" id="pr0gramm-logo-link"><?js print(logo.src || logo); ?></a> <div id="head-menu"> <a id="tab-new" class="head-tab" href="#new">neu</a> <a id="tab-top" class="head-tab" href="#top">beliebt</a> <?js if(user.admin) {?> <a id="tab-admin" class="head-tab" href="/admin/">admin</a> <?js } ?> <span id="bookmarks-link" class="head-tab head-link"> <svg viewBox="0 0 512 512" class="icon elipsis-icon"> <path fill="currentColor" d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"></path> </svg> </span> <?js if(!!p.user.verified) {?> <span id="filter-link" class="user-only head-link"> <span id="filter-link-flag" class="pict">f</span> <span id="filter-link-name">{currentFilterName}</span> </span> <?js } ?> <span class="guest-only" id="search-form-spacer"></span> <form action="" id="search-form-inline" class="search-form"> <input type="text" name="q" class="q" value="" title="Suche [k]" autocomplete="off" placeholder="Suchen"/> <input type="submit" id="search-submit-inline" class="pict" title="Suche [k]" value="q"/> <span id="bookmark-button" class="pict" title="Lesezeichen anlegen">h</span> </form> <span id="search-button" class="head-link pict">q</span> <a href="#upload" class="head-link pict user-only" id="upload-link" title="Bilder hochladen">u</a> </div> <div id="search-menu" class="tip-menu"> <div class="tip-menu-inner"> <form action="" class="search-form"> <div id="search-input-in-menu" class="search-row"> <div class="search-row-head">Suchbegriffe:</div> <input type="text" name="q" class="q" value="" title="Suche [k]" autocomplete="off" placeholder="Suchen"/> </div> <div class="search-row search-exclude"> <div class="search-row-head"> Suchen in: <a href="/search" class="search-help"> <span class="search-help-inner">Erweiterte Suche&nbsp<span class="pict">p</span></span> </a> </div> <input type="radio" class="box-from-label" name="searchCategory" value="top" id="search-category-top"> <label for="search-category-top">beliebt</label> <input type="radio" class="box-from-label" name="searchCategory" value="new" id="search-category-new"> <label for="search-category-new">neu</label> </div> <div class="search-row search-exclude"> <div class="search-row-head"> Minimaler Benis: <span id="search-score-indicator">schnurz</span> </div> <input type="range" class="search-opts" name="searchScore" value="0" min="0" max="100" step="1" id="search-score"> </div> <div class="search-row search-exclude"> <div class="search-row-head">Ausschließen:</div> <input type="checkbox" class="box-from-label search-opts" name="searchExclude[]" value="sound" id="search-exclude-sound"> <label for="search-exclude-sound">sound</label> <input type="checkbox" class="box-from-label search-opts" name="searchExclude[]" value="video" id="search-exclude-video"> <label for="search-exclude-video">video</label> <input type="checkbox" class="box-from-label search-opts" name="searchExclude[]" value="repost" id="search-exclude-repost"> <label for="search-exclude-repost">repost</label> <input type="checkbox" class="box-from-label search-opts" name="searchExclude[]" value="ftb" id="search-exclude-ftb"> <label for="search-exclude-ftb">ftb</label> </div> <div class="search-row search-exclude"> <div class="search-row-head">Weitere Tags ausschließen:</div> <input type="text" class="exclude search-opts" autocomplete="off" id="search-exclude-tags" placeholder="süßvieh kadse"> </div> <div class="search-submit-wrap"> <input type="submit" class="search-submit" value="Suchen"/> </div> </form> </div> </div> <div id="filter-menu" class="tip-menu"> <div class="tip-menu-inner"> <span class="filter-setting" data-flag="{CONFIG.SFW_FLAG.SFW.flag}"> <div class="filter-name"> <span class="filter-check"></span> sfw </div> <div class="filter-desc"> <em>Safe for work</em> </div> </span> <span class="filter-setting" data-flag="{CONFIG.SFW_FLAG.NSFW.flag}"> <div class="filter-name"> <span class="filter-check"></span> nsfw </div> <div class="filter-desc"> Beinhaltet nackte Haut, Pornos und leicht offensiven Kram. </div> </span> <span class="filter-setting" data-flag="{CONFIG.SFW_FLAG.NSFL.flag}"> <div class="filter-name"> <span class="filter-check"></span> nsfl </div> <div class="filter-desc"> Alles. Gewalt, ekliger Scheiß. </div> </span> <span id="filter-save">Speichern</span> </div> </div> <div id="bookmarks-menu" class="tip-menu"> <div class="tip-menu-inner"> <div class="bookmark-row"> <a href="#<?js if (user.id) {?>user/{user.name}/uploads<?js } else { ?>pr0mium<?js } ?>"> <span class="pict">u</span> meine Hochlads </a> </div> <div class="bookmark-row"> <a href="#<?js if (user.paid) {?>stalk<?js } else { ?>pr0mium<?js } ?>"> <span class="pict">@</span> Stelzungen </a> <span class="side-link">(<a href="#<?js if (user.paid) {?>stalk/list/stalk-date<?js } else { ?>pr0mium<?js } ?>">gestelzte Benutzer</a>)</span> </div> <div id="bookmarks-view"><span class="spinner"></span></div> </div> </div> </div> <?js if (CONFIG.READ_ONLY) {?> <div class="terminal"> <span class="terminal-location"> root@pr0gramm:~# </span> <span class="terminal-command"> chmod a-w </span> <span class="terminal-comment"> # read only </span> </div> <?js } ?> </div> <div id="main-view"></div> </div> <div id="overlay"> <div id="overlay-box"></div> </div> <div id="footer-links" class="fixed-sidebar-left"> <div> <a href="#faq">FAQ</a> <a href="#contact">Kontakt</a> <a href="https://pr0paganda.com" target="_blank" title="Werbung/Advertising">Ads</a> <a href="#datasafety">Datenschutz</a> <a href="#changelog">Changelog</a> <a href="https://app.pr0gramm.com">Mobile&nbsp;App</a> <a href="https://pr0mart.com" target="_blank" title="pr0mart">Shop</a> <a href="https://twitter.com/pr0gramm" target="_blank">Status</a> </div> </div> ',notificationCount:0,widthClass:null,pagePadding:0,currentAdPosision:52,preFillSearchOptions:true,thumbsPerRow:-1,data:{currentFilterName:'sfw',logo:'<?xml version="1.0" encoding="UTF-8" standalone="no"?> <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"> <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="136px" height="26px" viewBox="0 0 136 26" enable-background="new 0 0 136 26" xml:space="preserve"> <image id="image0" width="136" height="26" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAAAaCAYAAABsFBQaAAAEBWlDQ1BpY2MAADiNjVVdaBxVFD67 c2cjJM5TbDSFdKg/DSUNk1Y0obS6f93dNm6WSTbaIuhk9u7OmMnOODO7/aFPRVB8MeqbFMS/t4Ag KPUP2z60L5UKJdrUICg+tPiDUOiLpuuZOzOZabqx3mXufPOd75577rln7wXouapYlpEUARaari0X MuJzh4+IPSuQhIegFwahV1EdK12pTAI2Twt3tVvfQ8J7X9nV3f6frbdGHRUgcR9is+aoC4iPAfCn Vct2AXr6kR8/6loe9mLotzFAxC96uOFj18NzPn6NaWbkLOLTiAVVU2qIlxCPzMX4Rgz7MbDWX6BN auuq6OWiYpt13aCxcO9h/p9twWiF823Dp8+Znz6E72Fc+ys1JefhUcRLqpKfRvwI4mttfbYc4NuW m5ERPwaQ3N6ar6YR70RcrNsHqr6fpK21iiF+54Q28yziLYjPN+fKU8HYq6qTxZzBdsS3NVry8jsE wIm6W5rxx3L7bVOe8ufl6jWay3t5RPz6vHlI9n1ynznt6Xzo84SWLQf8pZeUgxXEg4h/oUZB9ufi /rHcShADGWoa5Ul/LpKjDlsv411tpujPSwwXN9QfSxbr+oFSoP9Es4tygK9ZBqtRjI1P2i256uv5 UcXOF3yffIU2q4F/vg2zCQUomDCHvQpNWAMRZChABt8W2Gipgw4GMhStFBmKX6FmFxvnwDzyOrSZ zcG+wpT+yMhfg/m4zrQqZIc+ghayGvyOrBbTZfGrhVxjEz9+LDcCPyYZIBLZg89eMkn2kXEyASJ5 ijxN9pMcshNk7/rYSmxFXjw31v28jDNSpptF3Tm0u6Bg/zMqTFxT16wsDraGI8sp+wVdvfzGX7Fc 6Sw3UbbiGZ26V875X/nr/DL2K/xqpOB/5Ffxt3LHWsy7skzD7GxYc3dVGm0G4xbw0ZnFicUd83Hx 5FcPRn6WyZnnr/RdPFlvLg5GrJcF+mr5VhlOjUSs9IP0h7QsvSd9KP3Gvc19yn3Nfc59wV0CkTvL neO+4S5wH3NfxvZq8xpa33sWeRi3Z+mWa6xKISNsFR4WcsI24VFhMvInDAhjQlHYgZat6/sWny+e PR0OYx/mp/tcvi5WAYn7sQL0Tf5VVVTpcJQpHVZvTTi+QROMJENkjJQ2VPe4V/OhIpVP5VJpEFM7 UxOpsdRBD4ezpnagbQL7/B3VqW6yUurSY959AlnTOm7rDc0Vd0vSk2IarzYqlprq6IioGIbITI5o U4fabVobBe/e9I/0mzK7DxNbLkec+wzAvj/x7Psu4o60AJYcgIHHI24Yz8oH3gU484TastvBHZFI fAvg1Pfs9r/6Mnh+/dTp3MRzrOctgLU3O52/3+901j5A/6sAZ41/AaCffFXthGDhAAAAIGNIUk0A AHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAJ cEhZcwAACxMAAAsTAQCanBgAAATQelRYdFJhdyBwcm9maWxlIHR5cGUgaWNjAABIiZVXWbLjKgz9 ZxW9BAZJwHJswFVv/xvoIwYnTux3+5Jy4QjpoAkhm/9KMX8wvLXJWB2xJnHRRivFet9JUqVFip49 RQKNE2fevPJmLOPF6bxj3nQ24iTEEC05tmyp2DlO4H8YB3ZVjdwi1ODrbwDeh/kl/y4kHIOE/s/Z NMhyGCElSx0LcSxwLjDYRh+p/49uzDakGOE5u+jLFY4M3NndOBbErgWJ7/QpqPQLf0rvQITIDFVj Xr5p0BKRlLnzNum+yAO/wc73QO++OIcjisLSsOYlS0BazPQwDE/IIQJyEb738LP4S9o8i/9u/Bh+ 5FqJ/GXiMV8KzN850D6B/PC+SwTfwBLaJ70N+oZ0AJ15AvoRBFe3CLNYqJnrwtE0RwgnbNJHPnjv odXOTPMU+G2KJZHoERe+auThuoQwJuYrPW9xk4T4xmna3KB4hMBTo2MBzQVUARxhCjPhVinwR0NW MeUzk4fJiJ9kWJCZrhqF0DScCO5xMTkgwNAfvluaDsCQNtnloJ29uagadkFJEURhCZyaqmkUqF35 S5ENQdh4hd8NU0LzSLxC8XT2mMNRNAioV8dlA3INPirwUbmaBt31YLyF+RSIpM6mdDGZkGM0TusC GjtTtpruSKZ83WDXaCLYp6aTjjxCEdTKuoCG81gTIDL7M/xDkH1D5fTEFC+agk3PIMOCa/hZCxIL fInE0zMo8In4+Q5zBc4+aq/9VrVTYPL6H0C6SfRTCEACs7RmK1MHaGOOC7DcAFXz2jHqjvsUyKNc LsG+xmr7G+jbpl2jq4pYeNOkpRewmkbBtU2BePJivRXlNePPt80qNNbiMi/+UqN337R81Qh+JFx8 1JULc96Rfwg/hYon4ckdiAKYSeemCTqZcxf40pzPQJlPFYcJqsmnRtFNM/kFiFTpgMWZGRXS2368 Nzd9coxo3fnvO2U6UMahxTm9dXpCrvOhd0c50nHYh/xSoJU/30n2P8n6lfHmKeUfQbgRnmS58nhH v8RVD+0NCNddF+eT36Nz1Uz/D3nznNUv+88cegT88Yh8gtGMbH8WX9XZTKYldBfu+qRJibHsxaVb jeBC2hOXGmxnRMVsudf0b1+ulBBO0VA7RO+G5P1dnbHBVqjZgFtRyDeHB4em7TbkgFuH8VQ8yKOw b3qtdJBQ9HGgHZjFhg3z/nDGrlXAPFS8z7r0XQVejo/L2XUKTKF/zvBRPRt4mkNb0zxMRrlo6Hma Z7zfa9hQh1pwWE/gi1NmX2fPvEL/ZOJjVmvGr/fPPPqVaW+AFM1tFjtbR0WQ/Kt61K/MAabRiS/Q XmJWdJr2zz8AfeyKpkFvHtTs/EM9T6/i/wki6F4ETKJ5opuiXxQACYCFtpP+dWULQtkFlbm/81M5 Hcl4H1nzEFqO2iml9TGj1siBZiv33j+iyQFGQAriF9UXZnzmCbagjO4r+IZWFQ4GDfNLLIb+T79P 8CGB7hrNtXbh6xP10vkfoTdS64vSAe04v2XfBvrY/n0XapvdbcVHzQ0jb7E3WluJvQV02g3e8Pk0 ek/HefTZe0L/G2JX2V6Hs6703aOyhOAva4XGf67NHDrC7Nhi7gtHza7T9833uW5hmtBbxAKvmr+W vFzGdPwAYAAAC5hJREFUaN7tmWl0leURx3/z3tyQSxZEQIWoVcSWuqAoraJVEFSEcOq+nvbYqlVP W3cpx61WbdWqH7D1WK0V97oDWgUVXEDABSigVoRAFFAQQhISkpDkLtMPMy95c70hgbbHfrhzTk7e e995lpn5PzP/eS7kJS95yUte8vI/EQkf5g4acEdBgV6rKgXa/nW3JQBiom0qTGvM8NtRy9ct/7aN y8t/LkH4IIFeGyMoAAhkx/8QiElQGFcZGYejv23D8vLfkYL2RylIZ5RUMoXEYkgs2OHJ0oAooul0 zsGq2hcoDhfMet0EbBGRFteNA7v5HiXHUg0iUt/JOgVAKVACtAH14bw5dMV1y4FdsENTD6wHNotI 2vXKIu+zpdXXaN6ef1S1j6/VCmwM587S6Q308o+1ItLQyVylQG+gEKgF6txP5b7HNmCDiGQ6sbkv 0NO/WiciyVzrtANEIChKUDywP82rVpLeupVYURHIjpUb04519vqnwDG+bo+sdzXAx6r6ooisAPoD N7khRVmBSQJVqvo4sEREUhHjS4AzsSy2B9AIfKqqrwOLsnQLgdHAeGCo6wdANfAJMF9Vp4hIDXA8 cAYGukI6grYRWK6q04H3o2tkBeUGYBCwAfgrsCCHj84ETnQfLVTV23MFGTjN910MPAc8D2SA3wNl bsOfgY9zjN0H+DUw0D9fAazJFbBtANF0htLDhtL/ol9R/epL1L4xg7aN1Ug8DhKgyVY0k0EkICjs ATuRYYCjgFOBzcAKOiJpGHAuMFRVJ2LoPsUBsgzLMAKoA+ZYYAhwi6rOEZG0qiaAy4EJQAJYiZ3G s4BRwG3Amx6wXhhgrwAGuO4aLDv1Bk4HTvK15wIHePAyQCUQZiQB9gUqfI1bVXWGiGiW7YcAl2AH IwZsVtVFOYI/zNfGbXwaWBVV8ENwLjDGv6oEprpvTnfQqIMkF0AqgIsxsAPc3CVAQIiV9aL4wCH0 Gn4sDRUns/6Jv1EzcyZKml7DfkDxgUNo/ryKxkULySTbINhhkDRj6XUqcFUWQEYAN3oQ5gDzsFRf 5IGsigCkB3A2MAm4yB30pY+9Htji388HdgeuAX4CbFLVuSLSCvwCuBU7zZcAs7BMoO64MKOEZLsF y1xLgZ+580OA9AYuw8B5DbDI543KBJ97qgd2HPAi8H6W3lasPAQ+71XYaQ/BIb63gyNj2nxu3Gc9 MaBXqOoLIrI4Mv572CEtiYzPlaE6AkRiwuZ581h16w2Un38hZUeNpHDPveg5+CDIZOgz9mRQJdVQ x4Znn2LT6zPQdJqdEAVas/mDl4BRwGFYClwa0W8Qkbos/Q+wrFIO7OoAqcAyx+PAVD+d670UHQ3s B5Sq6u5YdkgAdwHPO2hCaQJeU9VYhCeEJSWF8Y3aiH6Nqr4H/BIrjWVRgKjqnsAPfexkX/cErGxl AySMy3sOhDGq2ldENvm7IuwwCbAa+I4/iwdasIO4GMtGY/05lGN83mXY4dl1e8GKpAAh3VBPzasv UznxatZOuhMUyi++nPJLr0TTbVT94XfUvv0mpQcPoSDRE1TZScmVegpozygpB0YYlFxEqJ87azOW rgXY03XnZqXuZcASoA+Wfg8BBmO8Z14WONo9koNE5hJVjWHZJoaRxez5zvBgLATeAl7AeMzRqjqo E/9UAm+7nWdE3u2P8aalwId4bxDxl2AAfxPLJsep6j6+z3IMlIXAGxiItxvEgugHCQI0maa5cgWN A/agz7jxBIkE6eYm4v36029cBUFpCY2LF5BqadlhAhuRuBPEuG8w7U4Y658/88CDlZOrVXUj7UDp i50ExcrIBtoBA7Aua71G4Gss9fb08aVY3d0aCbT4HNHS1yYibf6cwYjd9aoaZsAYxkGOx8rQfKwD ioJnnK/7qIi0quoCD/ARWNZc2QlIHgJGAmep6oMerxHAkcAtGHfKddgU43hTsdI6BngQ+BFwHDAb A9dxsP1Lrw4A0XSGoDBOnxPHsNeVEykasBfVU55h/ZOTKRkylN6jx5CqraF29mx0a3M7B5HAL0O6 JYUYVxgd2VwRVm8BZriTg4j+ef6c8O9THtg/AU+506OdRXbLlvExgdscts5tdKy/5T7neJ9DMJ5y JwbiDJYpzvd3xZG5a3zvj2W1jBVYtqoHPlLVAb7uWxi/GOGkdm3WnmPAB1inMxg7PAswIDZipWkc HbNsJvK8EXgFuBAYqapTgMOxLPoq7dxqu9IBIPRM0Pek8exz5W+I7dqXjdOe46v7J9FUuYqGxUv4 +rmnCQpikMkQFCdAQRHjIul0dzOK4vcAkfUVS6mfAPeLyApVPcDftWLo34JljdFYjZ0kIrdE5t3i gQqdG5W4BzPp8zVgp303DIChJLGOYYk7cl86tuMBsBZ4yoNxGtbdVGLkeHok24TZ48fYSW90OzJu 726udhQw3OfNljasHX4SOMf3OgorPavcrtB/0ZIcfrcUI98jfa9HAh8B70aA1D2AaCZDUf8BlF9w MQV9+1E97VnW3HsXLWvWEisuIZNqpeywYfQefjRBIkFYutJtbdS/N4/a2e9AUaI7AElh9fE6LCOE siFCxMLNh6f8PhFZrar7u8NGAP1VtUfIH0SkXlWbfOwgrBMKpQ9GfLdg4PocK0sHue4y19sE3I5l kdOAP9IxhQcYMbxbRDar6hzgEZ9/7xwOPxA41L9fj5HXUFqArzDeNExVn8/RGiuWaVY7MAb6XLOw Lioe0c3OIIKV2uk+9lKMQE/Gys/gHQIIIqTr6qh+eQpFe+/NV488RMsXqwlKylBNo8kUPQfuR+8T xhIrLYOM7SW9tYnkhvXUzJqJdA8gCtSISFV3lF1KHASVqnoD8AB2ol7H6mwoH2NZ5hRVfVpEtjqv OBxj7p9hBO4T4J8OkMtUdQWw0klpHVCnqpto7wqyfVaGcaRZ2MXU3cBEoFpVn4kE+kSMVH6KHYiw 81EMbMdgmWeo27glh+31WMa6ESuBC7B7maCLAIuIZFR1odt9KJZ15nhJ7la6b29zAyFZW8OXD9xP rGcRqeatxEpKHYsxgkSC6umvUPvuO0gQ29bBqCqZLQ3EiktQEWT7nU34MkbXouRg2CIyX1V/jp30 e1V1OPAolgUmYe1sBfCYqi7GUnkFRhJnYC1qRlVvd/vPA6YBc1S1CuM2JVgpS9BegjTrPyKiqvow BrrbfP1DVPUerKSNcTDdJyKvfMNA1ZUeuJMwwjorh82twGNYpgmw7mMxRrJzOTvbbx9hmfBUnz9s q4UuOpgOAEFBYjEgQ7qpmSAe76AoQUCqro5kdTUaKXcCSEGB3bh2LbtghLRXN3TD32JKyO62RBap 6iQse0zA6neliFSp6k0YeM70v1D+AjwRtr8islxVb8bS8DnYzSIYGQ0B/C+MMOOBTmD3BgWRvSRV 9VkMgHdgmWQmxk1GYuT1w05srMMuBM8GTveSVRJZL3AQrnI7A+z3KnV+E/qx2EMRYN2c4MAWkWZV nYp1LvUiEpbhuOt2xEHnAFEQQYKg0xtSice7BIJu83FOuRd4iayr405kLXbDWUjua+A5GEMfiF0q hYu+5kE5Art7aMLayPki8mUHe0RWquptwD+wS7QBGAjqMeCswk4gWJb5woO6MWueNlX9O9ZKfx/j DJuxur+O3G1sOG4axieq3X0Puz2fY8QWL1mbsoY3YaT3HQzI4Q+FF/j/pZF1Wvhm61+F3fyWdeJf Gxs+zP9u/2Q8CAqSO333BUUigG7conrdiOXrJme/97ongOYgZOTQD9zATCfvYxjIk9k6/otuHANO sqv1fK3wsi4FpKJjurP3yBzbLvo623suv3jp67aPcul25bPO1u1MZ1sGCZB7khmdkEZj0j3+0kEC gSQkVTJzYsi8XDpuRLch2JWRTirTnbxL0d72dnettu2873LvOebolq3RuXfER7l0uwOMHbEpL3nJ S17ykpe85CUvefm/k38DwJKR/cJO6g4AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDMtMjhUMDI6 NTU6MzMtMDc6MDDEiOR5AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAzLTI4VDAyOjU1OjMzLTA3 OjAwtdVcxQAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBh bGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJH QiBQcm9maWxlGqc4jgAAACR0RVh0aWNjOm1hbnVmYWN0dXJlcgBHZW5lcmljIFJHQiBQcm9maWxl HD1oPgAAAB10RVh0aWNjOm1vZGVsAEdlbmVyaWMgUkdCIFByb2ZpbGXqb66rAAAAAElFTkSuQmCC" /> </svg> '},init:function(container,parent){this.parent(container,parent);this.data.user=p.user;p.onsetview=this.onSetView.bind(this);p.api.onerror=this.onError.bind(this);if(p.mobile){$.fx.off=true;}
this.resize();$(window).resize(this.resize.bind(this)).scroll(this.scroll.bind(this));},resize:function(){var L=CONFIG.LAYOUT;var windowWidth=$(window).width();var forceSetCSS=false;var resizedWidthClass=this.widthClass;for(var NAME in L.WIDTH_CLASS){var C=L.WIDTH_CLASS[NAME];if(windowWidth<C.MAX_WIDTH){resizedWidthClass=C;}}
if(!p.user.showAds&&resizedWidthClass!=L.WIDTH_CLASS.NO_SIDEBAR){resizedWidthClass=L.WIDTH_CLASS_FORCE_NO_SIDEBAR;}
if(!p.user.showAds){this.$container.find('.gpt').remove();}
var availableWidth=windowWidth-resizedWidthClass.SIDEBARS_WIDTH-resizedWidthClass.MARGIN;var resizedThumbsPerRow=((availableWidth+L.THUMB.PADDING)/(L.THUMB.WIDTH+L.THUMB.PADDING)|0).limit(L.THUMBS_PER_ROW.MIN,L.THUMBS_PER_ROW.MAX);if(this.thumbsPerRow===resizedThumbsPerRow&&this.widthClass===resizedWidthClass){return;}
this.widthClass=resizedWidthClass;this.setPageCSS(resizedThumbsPerRow);if(p.currentView){p.currentView.resize();}
p.ads.fill(this.$container.find('.gpt:visible'));this.scroll();this.hideFilterMenu();this.hideSearchMenu();this.hideBookmarksMenu();},scroll:function(){var L=CONFIG.LAYOUT;if(this.widthClass===L.WIDTH_CLASS.NO_SIDEBAR||this.widthClass===L.WIDTH_CLASS_FORCE_NO_SIDEBAR){return;}
var scroll=$(document).scrollTop();var windowHeight=Math.max(window.innerHeight,800);var thumbHeight=L.THUMB.HEIGHT+L.THUMB.PADDING;var np=Math.ceil((Math.floor((scroll+windowHeight)/(windowHeight*2))*windowHeight*2)/thumbHeight)*thumbHeight+52;if(np!==this.currentAdPosision){this.currentAdPosision=np;$('.side-wide-skyscraper').css('top',this.currentAdPosision);}},setPageCSS:function(thumbsPerRow){var L=CONFIG.LAYOUT;this.thumbsPerRow=thumbsPerRow;var pageWidth=this.thumbsPerRow*(L.THUMB.WIDTH+L.THUMB.PADDING)-L.THUMB.PADDING+this.widthClass.SIDEBARS_WIDTH;$('body').removeClass().addClass(this.widthClass.CLASS_NAME);this.setThemeCSS();$('#head').css('width',pageWidth);$('#page').css('width',pageWidth).toggleClass('desktop',!p.mobile).toggleClass('lt8',thumbsPerRow<8).toggleClass('lt7',thumbsPerRow<7).toggleClass('lt6',thumbsPerRow<6).toggleClass('lt5',thumbsPerRow<5).toggleClass('lt4',thumbsPerRow<4).toggleClass('noAds',!p.user.showAds);$('meta[name=viewport]').attr('content','minimal-ui, width='+pageWidth);var sidebarOffset=(this.widthClass===L.WIDTH_CLASS.NO_SIDEBAR||this.widthClass===L.WIDTH_CLASS_FORCE_NO_SIDEBAR)?0:-(pageWidth-160);$('.fixed-sidebar-left').css('left',sidebarOffset);$('.fixed-sidebar-right').css('right',sidebarOffset);$('#search-form-bar').hide();},setThemeCSS:function(){$('body').removeClass(function(index,css){return(css.match(/(^|\s)theme-\S+/g)||[]).join(' ');}).addClass('theme-'+p.user.getTheme());},onSetView:function(){this.closeOverlay();this.hideBookmarksMenu();this.hideFilterMenu();this.hideSearchMenu();$('input.q').blur();this.preFillSearchOptions=true;},onError:function(response){if(response.responseJSON&&response.responseJSON.code==404){return p.setView(p.View.Error404);}
else{if(response.responseJSON&&response.responseJSON.code==403&&response.responseJSON.error=='forbidden'){p.user.softLogout();this.setUserStatus(false);return false;}
return this.showOverlay(p.View.Overlay.Error,response.responseJSON);}},setUserStatus:function(isUser){$('#page').toggleClass('status-user',isUser).toggleClass('status-guest',!isUser);},search:function(q){if(!q||q.length===0||q==="")return;let m=null;if(m=q.match(/^(\w+):([\w\-]+)( (.+))?/)){const tags=m[4]?('/'+encodeURIComponent(m[4])):'';p.navigateTo('user/'+m[1]+'/'+m[2]+tags);}
else{const tab=$('#search-category-top').prop('checked')?'top':'new';let path=q?('/'+encodeURIComponent(q)):'';path=path.match(/^\/\d+$/)?path.replace('/','/+'):path;p.navigateTo(tab+path);}
$('#search-form-bar').hide();},show:function(params){this.data.currentFilterName=p.user.flagsName;this.parent(params);this.setPageCSS(this.thumbsPerRow);this.setUserStatus(!!p.user.id);$('#login-link').click(this.showLogin.bind(this));this.overlay=$('#overlay');this.overlay.click(this.hideOverlay.bind(this));$('#filter-link').click(this.toggleFilterMenu.bind(this));this.hideFilterMenuBound=this.hideFilterMenu.bind(this);$('.filter-setting').click(function(ev){$(ev.currentTarget).toggleClass('active').blur();return false;});$('#filter-save').click(function(){var flags=0;$('.filter-setting.active').each(function(){flags+=parseInt($(this).data('flag'));});p.user.setFlags(flags);p.reload();$('#filter-menu').fadeOut(100);return false;});$('#bookmarks-link').click(this.toggleBookmarksMenu.bind(this));this.hideBookmarksMenuBound=this.hideBookmarksMenu.bind(this);$('#search-button').click(this.toggleSearchMenu.bind(this));$('#bookmark-button').click(()=>{this.showOverlay(p.View.Overlay.BookmarkAdd);});$('#search-form-inline input').on('focus',this.showSearchMenu.bind(this));$('#search-form-inline input[type=submit]').on('click',()=>{$('#search-form-inline input[type=text]').focus();});$('#search-menu, #search-form-inline input.q').on('mousedown',function(){this.preventSearchMenuHide=true;}.bind(this));this.hideSearchMenuBound=this.hideSearchMenu.bind(this);this.rebuildSearchQueryBound=this.rebuildSearchQuery.bind(this);var that=this;$('form.search-form').submit(function(ev){that.search($('input.q:visible').val());ev.preventDefault();return false;});if(p.getQuery('iap')!==null){jQuery("body").addClass("in-app");}
p.ads.fill(this.$container.find('.gpt:visible'));this.donationsSubView=new p.View.CancerDonations(this.$container.find('#cancer-donations'),this);this.donationsSubView.show();},toggleFilterMenu:function(){if($('#filter-menu').is(':visible')){this.hideFilterMenu();}
else{this.showFilterMenu();}},showFilterMenu:function(){if($('#filter-menu:visible').length){return false;}
var menuLink=$('#filter-link')[0];var menuWidth=270;var x=menuLink.offsetLeft+menuLink.offsetWidth/2-menuWidth/2-3;$('.filter-setting').each(function(){var el=$(this);el.toggleClass('active',!!(p.user.flags&parseInt(el.data('flag'))));});$('#filter-menu').css('left',x).fadeIn(100);$('body').on('mouseup',this.hideFilterMenuBound);return false;},hideFilterMenu:function(ev){if(ev&&$(ev.target).parents('#filter-menu, #filter-link').length){return true;}
$('body').unbind('mouseup',this.hideFilterMenuBound);$('#filter-menu').fadeOut(100);return false;},toggleSearchMenu:function(){var q=$('#search-form-bar').find('input.q');if($('#search-menu').is(':visible')){q.blur();this.hideSearchMenu();}
else{this.showSearchMenu();q.focus();}},showSearchMenu:function(){if($('#search-menu:visible').length){return false;}
if(this.preFillSearchOptions){this.fillSearchOptions();this.preFillSearchOptions=false;}
$('.search-opts').on('change input',this.rebuildSearchQueryBound);var menuElement=$('#search-form-inline').is(':visible')?$('#search-form-inline input')[0]:$('#search-button')[0];var menuWidth=270;var x=menuElement.offsetLeft+menuElement.offsetWidth/2-menuWidth/2;$('#search-menu').css('left',x).fadeIn(100);$('body').on('mouseup',this.hideSearchMenuBound);return false;},hideSearchMenu:function(ev){if(this.preventSearchMenuHide){this.preventSearchMenuHide=false;return true;}
if(ev&&$(ev.target).parents('#search-menu, #search-form-inline').length){return true;}
$('.search-opts').unbind('change input',this.rebuildSearchQueryBound);$('body').unbind('mouseup',this.hideSearchMenuBound);$('#search-menu').fadeOut(100);return false;},toggleBookmarksMenu:function(){if($('#bookmarks-menu').is(':visible')){this.hideBookmarksMenu();}
else{this.showBookmarksMenu();}},showBookmarksMenu:function(){if($('#bookmarks-menu:visible').length){return false;}
var menuLink=$('#bookmarks-link')[0];var menuWidth=270;var x=menuLink.offsetLeft+menuLink.offsetWidth/2-menuWidth/2-3;$('#bookmarks-menu').css('left',x).fadeIn(100);$('body').on('mouseup',this.hideBookmarksMenuBound);if(!this.bookmarksSubView){this.bookmarksSubView=new p.View.Bookmarks(this.$container.find('#bookmarks-view'),this);this.bookmarksSubView.show();}
return false;},hideBookmarksMenu:function(ev){if(ev&&$(ev.target).parents('#bookmarks-menu, #bookmarks-link').length){return true;}
if(this.bookmarksSubView&&this.bookmarksSubView.preventHide){return;}
$('body').unbind('mouseup',this.hideBookmarksMenuBound);$('#bookmarks-menu').fadeOut(100);return false;},rangeToScore:function(range){var score=(Math.pow(range/100.0,2)*9000)|0;return((0.5+score/100)|0)*100;},scoreToRange:function(score){return Math.sqrt((score/9000),2)*100;},fillSearchOptions:function(){var tab=$('#tab-top').hasClass('active')?'top':'new';var query=$('input.q').val();$('#search-category-'+tab).prop('checked',true);var scoreMatch=query.match(/s:(\d+)/);if(scoreMatch){var range=this.scoreToRange(scoreMatch[1]);$('#search-score').val(range);$('#search-score-indicator').text(scoreMatch[1]);}
else{$('#search-score').val(0);$('#search-score-indicator').text('schnurz');}
$('#search-exclude-sound').prop('checked',query.match(/-"sound"/));$('#search-exclude-video').prop('checked',query.match(/-"video"/));$('#search-exclude-repost').prop('checked',query.match(/-"repost"/));$('#search-exclude-ftb').prop('checked',query.match(/-m:ftb/));var excludes=[];query.replace(/-([^\s]+)/g,function(m,tag){if(!tag.match(/"(sound|video|repost)"|m:ftb/)){excludes.push(tag);}});$('#search-exclude-tags').val(excludes.join(' '));},rebuildSearchQuery:function(){var query=$('input.q:visible').val();var includeTags=[];var parts=query.replace(/^!/,'').split(/\s+/);for(var i=0;i<parts.length;i++){if(!parts[i].match(/(^-)|:|^.{0,2}$/)){includeTags.push(parts[i]);}}
var advancedOpts=[];var range=parseInt($('#search-score').val());if(range){var score=this.rangeToScore(range);advancedOpts.push('s:'+score);$('#search-score-indicator').text(score);}
else{$('#search-score-indicator').text('schnurz');}
if($('#search-exclude-sound').prop('checked')){advancedOpts.push('-"sound"');}
if($('#search-exclude-video').prop('checked')){advancedOpts.push('-"video"');}
if($('#search-exclude-repost').prop('checked')){advancedOpts.push('-"repost"');}
if($('#search-exclude-ftb').prop('checked')){advancedOpts.push('-m:ftb');}
var exclude=$('#search-exclude-tags').val();if(exclude.match(/[^\s]+/)){var excludeTags=$.trim(exclude).split(/\s+/);for(var i=0;i<excludeTags.length;i++){advancedOpts.push('-'+excludeTags[i]);}}
var opts=includeTags.concat(advancedOpts);var query=(advancedOpts.length?'! ':'')+opts.join(' ');$('input.q').val(query);},setTab:function(tab){if(tab=='new'){$('#tab-new').addClass('active');$('#tab-top').removeClass('active');}else if(tab=='top'){$('#tab-top').addClass('active');$('#tab-new').removeClass('active');}
else{$('#tab-new, #tab-top').removeClass('active');}
$('.head-tab').removeClass('active');$('#tab-'+tab).addClass('active');},requireLogin:function(){if(CONFIG.READ_ONLY){this.showOverlay(p.View.Overlay.Error,{code:'READ ONLY MODE',msg:'Wartungsarbeiten'});return false;}
if(!p.user.id){this.showOverlay(p.View.Overlay.Login);return false;}
return true;},showResetPassword:function(){return this.showOverlay(p.View.Overlay.ResetPassword);},showLogin:function(){return this.showOverlay(p.View.Overlay.Login);},showOverlay:function(overlayClass,param){if(this.overlayView){this.overlayView.remove();this.overlayView=null;}
var overlayBox=$('#overlay-box');overlayBox.attr('class',overlayClass.prototype.name||'overlay-generic');this.overlayView=new(overlayClass)(overlayBox,this,param);this.overlayView.show();if(p.mobile){overlayBox.css('top',$(document).scrollTop()+CONFIG.HEADER_HEIGHT);this.overlay.addClass('mobile');}
this.overlay.fadeIn(CONFIG.ANIMATION_TIME);return false;},hideOverlay:function(ev){if(ev&&ev.target!=this.overlay[0]){return;}
return this.closeOverlay();},closeOverlay:function(){if(!this.overlayView){return false;}
this.overlay.fadeOut(CONFIG.ANIMATION_TIME);this.overlayView.remove();this.overlayView=null;this.hideLoader();return false;},updateDocumentTitle:function(){document.title=(this.notificationCount?'['+this.notificationCount+'] ':'')
+(this.title?this.title+' – ':'')+'pr0gramm.com – Schabernack, Unterhaltung, Gemeinschaft';},setTitle:function(title){this.title=title;this.updateDocumentTitle();},setNotificationCount:function(count){this.notificationCount=count;this.updateDocumentTitle();}});"use strict";function LruCache(maxSize){var cache=[];this.set=function(key,value,onDisplaced){cache.push({key:key,value:value,onDisplaced:onDisplaced});if(cache.length>maxSize){var removed=cache.shift();if(removed.onDisplaced){removed.onDisplaced();}}};this.get=function(key){for(var idx=0;idx<cache.length;idx++){var cached=cache[idx];if(cached.key===key){cache.splice(idx,1);cache.push(cached);return cached.value;}}
return null;};}
window.EXIF=new(function EXIF(){var cache=new LruCache(64);function findThumbnail(byteArray){var start=0,end=0;while(true){start=byteArray.indexOf(0xd8,start+2);if(start===-1){return null;}
if(byteArray[start-1]===0xff&&byteArray[start+1]===0xff&&byteArray[start+2]>=0xc0){end=start+2;while(true){end=byteArray.indexOf(0xd9,end+1);if(end===-1||end===byteArray.length-1){return null;}
if(byteArray[end-1]===0xff){var slice=byteArray.subarray(start-1,end+1);var blob=new Blob([slice],{'type':'image/jpeg'});return URL.createObjectURL(blob);}}}}}
this.extractThumbnail=function(thumbUri,onSuccess){if(!window.fetch||!window.URL||!window.Uint8Array||!window.Promise){return;}
onSuccess=onSuccess||function(){};var cached=cache.get(thumbUri);if(cached!=null){onSuccess(cached);return;}
fetch(thumbUri).then(function(response){return response.arrayBuffer();}).then(function(arrayBuffer){var exifUri=findThumbnail(new Uint8Array(arrayBuffer));if(exifUri!=null){cache.set(thumbUri,exifUri,function(){URL.revokeObjectURL(exifUri);});onSuccess(exifUri);}});};})();"use strict";p.Stream=p.Class.extend({reached:{start:false,end:false},_oldestId:Number.POSITIVE_INFINITY,_newestId:0,items:{},options:{},init:function(options){this.options=options||{};},loadInfo:function(id,callback,cacheBust){var item=this.items[id];if(!item){return;}
if(item.infoTime){if(callback){callback(item);}
return;}
if(item.loadQueue){if(callback){item.loadQueue.push(callback);}
return;}
item.loadQueue=callback?[callback]:[];var that=this;p.api.get('items.info',{itemId:id,bust:cacheBust},function(response){that._processInfo(item,response);});},getLoadedItems:function(){var itemsArray=[];for(var id in this.items){itemsArray.push(this.items[id]);}
if(this.options.promoted){itemsArray.sort(p.Stream.sortByPromoted);}
else{itemsArray.sort(p.Stream.sortById);}
return itemsArray;},_processInfo:function(item,response){if(!item.infoTime||item.infoTime<response.ts){item.comments=response.comments;item.tags=response.tags;item.infoTime=response.ts;}
for(var i=0;i<item.loadQueue.length;i++){item.loadQueue[i](item);}
item.loadQueue=null;},loadNewest:function(callback){this._load({},callback);},loadAround:function(id,callback){this._load({id:id},callback);},loadNewer:function(callback){var id=this._newestId;if(id>=this._newestId&&this.reached.start){callback(null,p.Stream.POSITION.NONE);return;}
this._load({newer:id},callback);},loadOlder:function(callback){var id=this._oldestId;if(id<=this._oldestId&&this.reached.end){callback(null,p.Stream.POSITION.NONE);return;}
this._load({older:id},callback);},syncVotes:function(votes){var itemVotes=votes.items;for(var id in this.items){if(itemVotes[id]){this.items[id].vote=itemVotes[id];}}
var itemFavs=votes.collections;for(var id in this.items){if(itemFavs[id]){this.items[id].fav=Object.keys(itemFavs[id]).length;}}},_load:function(options,callback){var stream=this;options.flags=p.user.flags;p.api.get('items.get',p.merge(options,this.options),function(data){var position=stream._processResponse(data);callback(data.items,position,data.error);});},_processResponse:function(data){if(!data.items||!data.items.length){return null;}
this.reached.start=data.atStart||this.reached.start;this.reached.end=data.atEnd||this.reached.end;var oldestId,newestId;if(this.options.promoted){data.items.sort(p.Stream.sortByPromoted);oldestId=data.items[data.items.length-1].promoted;newestId=data.items[0].promoted;}
else{data.items.sort(p.Stream.sortById);oldestId=data.items[data.items.length-1].id;newestId=data.items[0].id;}
var position=(oldestId<this._oldestId)?p.Stream.POSITION.APPEND:p.Stream.POSITION.PREPEND;this._oldestId=Math.min(this._oldestId,oldestId);this._newestId=Math.max(this._newestId,newestId);var prev=null;var itemVotes=p.user.voteCache.votes.items;var itemFavs=p.user.voteCache.votes.collections;for(var i=0;i<data.items.length;i++){var item=data.items[i];item.thumb=CONFIG.PATH.THUMBS+item.thumb;item.image=(item.image.match(/\.mp4$/)?CONFIG.PATH.VIDS:CONFIG.PATH.IMAGES)+item.image;item.fullsize=item.fullsize?CONFIG.PATH.FULLSIZE+item.fullsize:null;item.vote=itemVotes[item.id]||0;item.fav=itemFavs[item.id]?Object.keys(itemFavs[item.id]).length:0;this.items[item.id]=item;}
return position;}});p.Stream.POSITION={NONE:0,APPEND:1,PREPEND:2};p.Stream.FLAG_NAME={1:'SFW',2:'NSFW',4:'NSFL',8:'NSFP'};p.Stream.sortById=function(a,b){return(b.id-a.id);};p.Stream.sortByPromoted=function(a,b){return(b.promoted-a.promoted);};(function($){var rgba=function(r,g,b,a){return'rgba('+r+','+g+','+b+','+a+')';};$.fn.highlight=function(r,g,b,a,wait,cb){var that=this;if(that.data('_highlightTimeout')){return;}
r=r||255;g=g||255;b=b||255;a=a||1;that.css('background-color',rgba(r,g,b,a));var step=function(){a-=0.05;if(a<=0){that.data('_highlightTimeout',null);that.css('background-color','transparent');if(cb){cb(that);}}
else{that.css('background-color',rgba(r,g,b,a));that.data('_highlightTimeout',setTimeout(step,50));}}
that.data('_highlightTimeout',setTimeout(step,wait||200));};})(jQuery);p.View.Overlay=p.View.Overlay||{};p.View.Overlay.DeleteComment=p.View.Base.extend({name:'overlay-delete-comment',resetViewport:false,template:'<div class="overlay-content"> <h2>Kommentar löschen</h2> </div> <div class="overlay-content"> <form id="comment-delete-form"> <div class="form-row"> <label class="checkbox-label"> <input name="reason" type="radio" value="custom" checked id="custom"/> </label> <input type="text" class="text-line" name="customReason" placeholder="Grund"/> <?js for (let reason of reasons) { ?> <label> <input name="reason" type="radio" value="{reason.banReason}"/> {reason.banReason} </label> <?js } ?> </div> <div class="form-row"> <input type="checkbox" name="banUser" id="delete-ban-user"/> <label class="checkbox-label" for="delete-ban-user">Benutzer Sperren für</label> <input type="text" name="days" class="number" value="1"/> Tage (0 = für immer) </div> <div class="form-row"> </div> <div class="form-row"> <input type="hidden" name="id" value="{commentId}"/> <input type="submit" value="Durch [gelöscht] ersetzen" id="comment-delete-soft"/> <input type="submit" value="Hart Löschen (inkl. aller antworten)" id="comment-delete-hard"/> </div> </form> </div>',data:{commentId:0},submitSource:null,init:function(container,parent,$div){var $comment=$div.parent();this.data.commentId=$comment.find('.permalink').attr('href').split(':comment')[1];this.parent(container,parent);},load:function(){let type=2;type+=8
p.mainView.showLoader();p.api.get('faq.reasons',{type:type},this.loaded.bind(this));},loaded:function(response){this.data.reasons=response.rules;p.mainView.hideLoader();this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));this.$container.find('input[type=submit]').click(function(ev){this.submitSource=$(ev.currentTarget).attr('id');}.bind(this));this.focus('input[name=reason]');},submit:function(ev){var $button=this.$container.find('input[type=submit]:focus');var action=(this.submitSource||$button.attr('id'))==='comment-delete-hard'?'comments.delete':'comments.softDelete';p.api.post(action,ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){p.mainView.closeOverlay();}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.SELFDELETECONTENT=p.View.Base.extend({name:'overlay-self-delete-content',resetViewport:false,template:'<div class="overlay-content"> <h2 class="warn" id="overlay-title">Möchtest Du Deinen Beitrag wirklich löschen?</h2> <div id="yesno-buttons" style="text-align: center; margin-top: 10px"> <input type="button" class="yes" style="background-color: #ff0000;" value="Ja, ich bin mir sicher!" style="margin-right: 15px"> <input type="button" class="no" value="Nein, abbrechen!" style="margin-left: 15px"> </div> </div> ',data:{itemId:null,commentId:null},init:function(container,parent,params){this.data.itemId=params.itemId;this.data.commentId=params.commentId;this.parent(container,parent);},show:function(){this.parent();let that=this;this.$container.find('.yes').click(async()=>{p.api.post('contact.report',{"reason":"custom","customReason":"Ich habe diesen Beitrag selbst erstellt und möchte ihn gelöscht haben","commentId":this.data.commentId,"itemId":this.data.itemId});document.getElementById('overlay-title').innerText="Dein Beitrag wird innerhalb von 5 Minuten gelöscht!";that.$container.find('input[type=button]').attr('disabled','disabled');p.mainView.showLoader();setTimeout(()=>{p.mainView.hideLoader();p.mainView.closeOverlay()},3000);});this.$container.find('.no').click(()=>{p.mainView.closeOverlay();});}});p.View.Stream=p.View.Stream||{};p.View.Stream.Comments=p.View.Base.extend({template:' <div class="comments-head"> <?js if (deleted) {?> <span class="pict">c</span> Kommentare deaktiviert, Hochlad wurde vom Nutzer gelöscht <?js } else if (unlawful) {?> <span class="pict">c</span> Kommentare deaktiviert, Hochlad wurde gelöscht <?js } else { ?> <span class="pict">c</span> {"Kommentar".inflect(commentCount)} <?js } ?> </div> <?js if(p.user.showAds) {?> <div class="comments-large-rectangle gpt" id="gpt-rectangle-comments" data-escobar="comments-rectangle-{p.ads.category()}"> </div> <?js } ?> <?js if (!deleted && !unlawful) {?> <form class="comment-form" method="post"> <textarea minlength="3" class="comment" name="comment" required placeholder="Kommentar schreiben…" title="Kommentar schreiben [c]" <?js if (!p.user.id) {?>disabled<?js } ?>></textarea> <input type="hidden" name="parentId" value="0"/> <input type="hidden" name="itemId" value="{params.id}"/> <div> <input type="submit" value="Abschicken" <?js if (!p.user.id) {?>disabled<?js } ?>/> <input type="button" value="Abbrechen" class="cancel"/> </div> </form> <form class="comment-edit-form" method="post"> <textarea class="comment" required name="comment"></textarea> <input type="hidden" name="commentId" value="0"/> <div> <input type="submit" value="Abschicken"/> <input type="button" value="Abbrechen" class="cancel"/> </div> </form> <div class="comments"> <?js if (!p.user.id) { ?> <div class="comment-login-wrapper"> <div class="comment-login"> <h2>Anmeldung erforderlich</h2> <h4>Für Kommentare bitte <span id="login-link-comments" class="action">anmelden</span>.</h4> </div> </div> <?js } ?> <?js var recurseComments = function( comments, level ) { ?> <div class="comment-box"> <?js for( var i = 0; i < comments.length; i++ ) { var c = comments[i]; ?> <div class="comment-box-inner"> <div class="comment{p.voteClass(c.vote)}" id="comment{c.id}"> <div class="comment-vote"> <span class="pict vote-up">+</span> <span class="pict vote-down">-</span> </div> <div class="comment-content"> {c.content.format()} </div> <div class="comment-foot"> <?js if(c.name == itemUser){?> <span class="user-comment-op">OP</span><?js}?> <a href="#user/{c.name}" class="user um{c.mark}">{c.name}</a> <?js if( p.shouldShowScore(c) ) {?> <span class="score" title="{c.up} up, {c.down} down">{"Punkt".inflect(c.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#{tab}/{itemId}:comment{c.id}" class="time permalink" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</a> <?js if( level < CONFIG.COMMENTS_MAX_LEVELS ) {?> <a href="#{tab}/{itemId}:comment{c.id}" class="comment-reply-link action"><span class="pict">r</span> antworten</a> <?js } ?> <?js if (c.children.length > 0) {?> <span class="fold fold-in action" title="Kommentare einklappen">[–]</span> <span class="fold fold-out action" title="Kommentare ausklappen">[+]</span> <span class="folded-comments-message"> (<span class="folded-comments-count"></span> eingeklappt) </span> <?js } ?> <?js if( p.user.admin ) {?> [ <span class="comment-delete action">del</span> / <a href="#{tab}/{itemId}:comment{c.id}" class="comment-edit-link action">edit</a> ] <?js } ?> <?js if ( !p.user.admin && p.user.name == c.name) { ?> [<span class="comment-self-delete action" data-item="{itemId}" data-comment="{c.id}">löschen</span>] <?js } ?> <?js if (p.user.id && p.user.name != c.name) { ?> [<span class="comment-report action" data-item="{itemId}" data-comment="{c.id}">melden</span>] <?js } ?> <span class="pict vote-cfav<?js if (c.fav){ ?> faved<?js } ?>">*</span> </div> </div> <?js if( c.children.length ) { recurseComments(c.children, level+1); } ?> </div> <?js } ?> </div> <?js }; ?> <?js recurseComments(comments, 1); ?> </div> <?js } ?> ',init:function(container,parent){this.stream=parent.stream;this.parent(container,parent);},load:function(){this.stream.loadInfo(this.data.params.id,this.loaded.bind(this),this.data.params.cacheBust);return false;},syncVotes:function(votes){if(!this.data.comments){return;}
var commentVotes=votes.comments;var commentFavs=votes.commentFavs;for(var id in this.commentMap){var newVote=commentVotes[id];var prevVote=this.commentMap[id].vote;if(newVote!=prevVote){var node=$('#comment'+id);this.commentMap[id].vote=newVote||0;node.removeClass('voted-up voted-down');if(newVote){node.addClass(newVote===1?'voted-up':'voted-down');}}
var newFav=commentFavs[id]||0;var prevFav=this.commentMap[id].fav;if(newFav!=prevFav){var favIcon=$('#comment'+id+' .vote-cfav');favIcon.toggleClass('faved',newFav);}}},loaded:function(item){item.id=(item.id||this.data.itemId);this.data.linearComments=(item.id<=CONFIG.LAST_LINEAR_COMMENTS_ITEM);if(item.commentId){p.user.voteCache.votes.comments[item.commentId]=1;this.data.params.comment='comment'+item.commentId;}
this.data.comments=this.prepareComments(item.comments);this.stream.items[this.data.params.id].comments=item.comments;this.data.commentCount=item.comments.length;this.data.tab=this.parentView.parentView.tab||'new';this.data.itemId=item.id;this.data.itemUser=this.data.itemUser||item.user;this.data.deleted=this.parentView.data.item.deleted;this.data.unlawful=this.parentView.data.item.unlawful;this.render();},prepareComments:function(comments){if(this.data.linearComments){comments.sort(p.View.Stream.Comments.SortTime);}
else{comments.sort(p.View.Stream.Comments.SortConfidenceTime);}
var commentMap={'0':{children:[]}};var commentVotes=p.user.voteCache.votes.comments;var commentFavs=p.user.voteCache.votes.commentFavs;for(var i=0;i<comments.length;i++){var comment=comments[i];comment.date=new Date(comment.created*1000);comment.children=[];comment.vote=commentVotes[comment.id]||0;comment.fav=commentFavs[comment.id]||0;comment.score=comment.up-comment.down;commentMap[comment.id]=comment;}
for(var i=0;i<comments.length;i++){var comment=comments[i];var parent=commentMap[comment.parent];if(parent){parent.children.push(comment);}}
this.commentMap=commentMap;return commentMap['0'].children;},render:function(){this.parent();this.$commentForm=this.$container.find('.comment-form');this.$commentForm.submit(this.submitComment.bind(this));this.$commentForm.find('input.cancel').hide().click(this.cancelReply.bind(this));this.$commentEditForm=this.$container.find('.comment-edit-form');this.$commentEditForm.submit(this.submitCommentEdit.bind(this));this.$commentEditForm.find('input.cancel').click(this.cancelEdit.bind(this));this.$container.find('.comment-reply-link').click(this.showReplyForm.bind(this));this.$container.find('.comment-edit-link').click(this.showEditForm.bind(this));var that=this;this.$container.find('.vote-up').click(function(ev){return that.vote(ev,1);});this.$container.find('.vote-down').click(function(ev){return that.vote(ev,-1);});this.$commentFav=this.$container.find('.vote-cfav')
this.$commentFav.click(function(ev){return that.fav(ev);});this.$container.find('.comment-delete').click(function(){p.mainView.showOverlay(p.View.Overlay.DeleteComment,$(this));});this.$container.find('.comment-self-delete').click((ev)=>{p.mainView.showOverlay(p.View.Overlay.SELFDELETECONTENT,{itemId:ev.currentTarget.dataset.item,commentId:ev.currentTarget.dataset.comment});});this.$container.find('.comment-report').click(function(){var c=$(this);p.mainView.showOverlay(p.View.Overlay.Report,{itemId:c.data('item'),commentId:c.data('comment')});});this.$container.find(".fold").click(function(ev){var box=$(ev.target).closest('.comment-box-inner').toggleClass('folded-in').children('.comment-box').slideToggle(CONFIG.ANIMATION_TIME);var count=box.find('.comment').length;$(ev.target).siblings('.folded-comments-message').fadeToggle(CONFIG.ANIMATION_TIME).children('.folded-comments-count').text(count);});if(this.data.params.comment){this.focusComment(that.data.params.comment);this.data.params.comment=null;}
p.ads.fill(this.$container.find('.gpt:visible'));if(CONFIG.ADS.AMAZON_REF){this.insertAmazonRefId(CONFIG.ADS.AMAZON_REF,this.$container.find('a'));}
if(CONFIG.ADS.HUBTRAFFIC.ENABLED){this.insertRefParameters(CONFIG.ADS.HUBTRAFFIC.SEARCH_REGEXP,CONFIG.ADS.HUBTRAFFIC.QUERY_PARAMS,this.$container.find('a'));}
if(!p.user.id){this.$container.find('#login-link-comments').click(this.showLogin.bind(this));const comments=document.getElementsByClassName('comment-box')[0];comments.style.filter="blur(3px)";comments.style.pointerEvents="none";comments.style.cursor="default";comments.style.userSelect="none";comments.style.textDecoration="none";}},showLogin:function(ev){if(!p.mainView.requireLogin()){return false;}},insertRefParameters:function(search,params,links){for(var i=0;i<links.length;i++){var href=links[i].href;if(href.match(search)){for(name in params){href=href.setQueryParameter(name,params[name]);}
links[i].href=href;}}},insertAmazonRefId:function(refId,links){for(var i=0;i<links.length;i++){var link=links[i];if(link.href.match(/https?:\/\/[^\/]+amazon.(de|com)\/[^ !.]+/)){link.href=link.href.replace(/\/tag=[\w\-_]+/,'/').setQueryParameter('tag',refId);}}},focusComment:function(comment){var target=this.$container.find('#'+comment);if(target.length){var jumpPos=target.offset().top-CONFIG.HEADER_HEIGHT-80;target.highlight(180,180,180,1);$(document).scrollTop(jumpPos);}},fav:function(ev){if(!p.mainView.requireLogin()){return false;}
var $comment=$(ev.currentTarget).parent().parent();var commentId=$comment.find('.permalink').attr('href').split(':comment')[1];var addFav=!$(ev.currentTarget).hasClass('faved');var absoluteVote=addFav?1:0;if($(ev.currentTarget).hasClass('faved')){$(ev.currentTarget).removeClass('faved');this.commentMap[commentId].fav=0;p.api.post('comments.unfav',{id:commentId});}
else{$(ev.currentTarget).addClass('faved');this.commentMap[commentId].fav=1;p.api.post('comments.fav',{id:commentId});}
var c=this.commentMap[commentId];p.adjustVote(c,absoluteVote,p.user.voteCache.votes.commentFavs);return false;},vote:function(ev,vote){if(!p.mainView.requireLogin()){return false;}
var $comment=$(ev.currentTarget).parent().parent();var commentId=$comment.find('.permalink').attr('href').split(':comment')[1];var absoluteVote=vote;if(($comment.hasClass('voted-up')&&vote===1)||($comment.hasClass('voted-down')&&vote===-1)){absoluteVote=0;$comment.removeClass('voted-up voted-down');}
else{$comment.removeClass('voted-up voted-down');$comment.addClass(vote===1?'voted-up':'voted-down');}
var c=this.commentMap[commentId];p.adjustVote(c,absoluteVote,p.user.voteCache.votes.comments);p.api.post('comments.vote',{id:commentId,vote:absoluteVote});c.score=(c.up-c.down);var score=$comment.find('.score');score.text("Punkt".inflect(c.score));return false;},showReplyForm:function(ev){if(!p.mainView.requireLogin()){return false;}
var $foot=$(ev.currentTarget.parentNode);if($foot.has('.comment-form').length){return;}
var parentId=ev.currentTarget.href.split(':comment')[1];var $form=this.$commentForm.clone(true);$form.find('input.cancel').show();$form.find('input[name=parentId]').val(parentId);$foot.append($form);$form.find('textarea').val('').addClass('reply').focus();return false;},cancelReply:function(ev){$(ev.currentTarget).parents('form').remove();},submitComment:function(ev){if(!p.mainView.requireLogin()){return false;}
var $form=$(ev.currentTarget);var data=$form.serialize();$form.find('input,textarea,button,select').attr('disabled','disabled');p.api.post('comments.post',data,this.loaded.bind(this),function(){$form.find('input,textarea,button,select').removeAttr('disabled');});this.showLoader();return false;},showEditForm:function(ev){var id=ev.currentTarget.href.split(':comment')[1];var $comment=$('#comment'+id);var $content=$('#comment'+id+' .comment-content');if($comment.has('.comment-edit-form').length){return;}
var $form=this.$commentEditForm.clone(true);$form.find('textarea').val(this.commentMap[id].content);$form.find('input[name=commentId]').val(id);$form.show();$content.after($form);$content.hide();$form.find('textarea').focus();return false;},cancelEdit:function(ev){var id=$(ev.currentTarget).parents('form').find('input[name=commentId]').val();var $comment=$('#comment'+id);$comment.find('.comment-edit-form').remove();$comment.find('.comment-content').show();},submitCommentEdit:function(ev){var $form=$(ev.currentTarget);var data=$form.serialize();$form.find('input,textarea,button,select').attr('disabled','disabled');p.api.post('comments.edit',data,this.loaded.bind(this),function(){$form.find('input,textarea,button,select').removeAttr('disabled');});this.showLoader();return false;}});p.View.Stream.Comments.SortConfidenceTime=function(a,b){return(b.confidence===a.confidence?a.created-b.created:b.confidence-a.confidence);};p.View.Stream.Comments.SortTime=function(a,b){return(a.created-b.created);};p.View.Overlay=p.View.Overlay||{};p.View.Overlay.EditTags=p.View.Base.extend({name:'overlay-edit-tags',resetViewport:false,template:'<div class="overlay-content"> <h2>Tags Bearbeiten</h2> </div> <div class="overlay-content"> <form id="edit-tag-form"> <?js for( var i = 0; i < tags.length; i++ ) { var t = tags[i]; ?> <div class="form-row"> <label> <input class="tag-select" type="checkbox" name="tags[]" value="{t.id}"/> {{t.tag}} ~ <a href="/user/{t.user}">{t.user}</a>, score [<?js print(t.up-t.down);?>]: <?js for( var j = 0; j < t.votes.length; j++ ) { var v = t.votes[j]; ?> <?js print(v.vote > 0 ? \'+\' : \'-\'); ?><a href="/user/{v.user}">{v.user}</a>&nbsp; <?js } ?> </label> </div> <?js } ?> <p> <span class="action" id="edit-tags-invert">Auswahl invertieren</span> </p> <div class="form-row"> <input type="hidden" name="itemId" value="{itemId}"/> <input type="checkbox" name="banUsers" id="delete-ban-user"/> <label class="checkbox-label" for="delete-ban-user">Benutzer Sperren für</label> <input type="text" name="days" class="number" value="1"/> Tage <input type="hidden" name="mode" value="2"> <span class="field-details">(Permaban (0) hier nicht erlaubt; bestehende Bans werden nicht überschrieben)</span> </div> <div class="form-row"> <input type="submit" value="Ausgewählte Tags Löschen"/> </div> </form> </div> ',data:{itemId:0},init:function(container,parent,$el){this.data.itemId=$el.data('id');this.parent(container,parent);},load:function(){p.api.get('tags.details',{itemId:this.data.itemId},this.loaded.bind(this));return false;},loaded:function(response){response.tags.sort(p.View.Stream.Tags.SortConfidence);this.data.tags=response.tags;this.render();},render:function(){this.parent();this.$container.find('#edit-tags-invert').click(this.invertSelection.bind(this));this.$container.find('#edit-tag-form').submit(this.submit.bind(this));},invertSelection:function(){this.$container.find('input.tag-select').each(function(){this.checked=!this.checked;});},submit:function(ev){p.api.post('tags.delete',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){p.mainView.closeOverlay();}});p.View.Overlay.EditTags.SortConfidence=function(a,b){return b.confidence-a.confidence;};p.View.Stream=p.View.Stream||{};p.View.Stream.Tags=p.View.Base.extend({template:'<?js if (!deleted && !unlawful) {?> <div class="tags"> <?js for( var i = 0; i < tags.length; i++ ) { var t = tags[i]; ?> <span id="tag-{t.id}" class="tag{p.voteClass(t.vote)} {t.qualityClass}"> <a href="#{tab}/{{t.link}}" class="tag-link">{{t.tag}}</a> <span href="" class="vote-up">+</span> <span href="" class="vote-down">&#8722;</span> </span> <?js } ?> <?js if( p.user.admin ) { ?> [<span class="action" id="item-edit-tags" data-id="{params.id}">edit</span>] <?js } ?> <?js if( badTagsCount > 0 ) {?> <span class="action tags-expand">{"weiter".inflect(badTagsCount,"e","en")} anzeigen…</span> <?js } ?> <span class="action tags-collapse">einklappen...</span> <a href="" class="add-tags-link action" title="Tags hinzufügen [t]">Tags&nbsp;hinzufügen…</a> </div> <form class="tag-form" method="post"> <span class="warn" id="warn_taglimit" style="display: none"> Du kannst maximal 10 Tags hinzufügen! </span> <input type="text" class="item-tagsinput" name="tags"/> <input type="hidden" name="itemId" value="{params.id}"/> <input type="submit" value="Tags speichern"/> <input type="button" value="Abbrechen" class="cancel"/> </form> <?js } ?>',addedTagInput:false,init:function(container,parent){this.stream=parent.stream;this.parent(container,parent);this.data.tab=(this.parentView.parentView.tab=='top')?'top':'new';},syncVotes:function(votes){if(!this.data.tags){return;}
var tagVotes=votes.tags;for(var i=0;i<this.data.tags.length;i++){var tag=this.data.tags[i];var newVote=tagVotes[tag.id];var oldVote=tag.vote;if(newVote!=oldVote){tag.vote=newVote||0;var node=$('#tag-'+tag.id);node.removeClass('voted-up voted-down');if(newVote){node.addClass(newVote===1?'voted-up':'voted-down');}}}},load:function(){this.stream.loadInfo(this.data.params.id,this.loaded.bind(this),this.data.params.cacheBust);return false;},loaded:function(item){this.data.goodTagsCount=0;this.data.badTagsCount=0;if(item.tagIds&&item.tagIds.length){for(var i=0;i<item.tagIds.length;i++){p.user.voteCache.votes.tags[item.tagIds[i]]=1;}}
if(item.error==='userIsNotAllowedToTag'){p.mainView.showOverlay(p.View.Overlay.Error,{code:403,msg:'Forbidden',desc:'Dir wurde das Taggen verboten. Du kannst nur noch '+'Tags auf deine eigenen Upload setzen.'});}
item.tags.sort(p.View.Stream.Tags.SortConfidence);var tagVotes=p.user.voteCache.votes.tags;var goodTagsCount=0,badTagsCount=0;for(var i=0;i<item.tags.length;i++){var tag=item.tags[i];var linkPrefix=tag.tag.match(/^\d+$/)?'+':'';tag.link=linkPrefix+encodeURIComponent(tag.tag);tag.vote=tagVotes[tag.id]||0;if(tag.confidence>CONFIG.TAGS_MIN_CONFIDENCE&&(goodTagsCount<CONFIG.TAGS_MAX_DISPLAY||tag.tag==='nsfw'||tag.tag==='nsfl'||tag.tag==='nsfp')){tag.qualityClass='tag-good';goodTagsCount++;}
else{tag.qualityClass='tag-bad';badTagsCount++;}}
this.data.goodTagsCount=goodTagsCount;this.data.badTagsCount=badTagsCount;this.stream.items[this.data.params.id].tags=item.tags;this.data.tags=item.tags;this.data.deleted=this.parentView.data.item.deleted;this.data.unlawful=this.parentView.data.item.unlawful;this.render();p.mainView.setTitle(item.tags.length?'"'+item.tags[0].tag+'"':'Hochlad '+this.data.params.id);},render:function(){this.parent();this.addedTagInput=false;this.$container.find('.tag-form').submit(this.saveTags.bind(this));this.$container.find('.add-tags-link').click(this.showTagForm.bind(this));this.$container.find('.tag-form .cancel').click(this.hideTagForm.bind(this));var that=this;this.$container.find('span.vote-up').click(function(ev){return that.vote(ev,1);});this.$container.find('span.vote-down').click(function(ev){return that.vote(ev,-1);});this.$container.find('.tags-expand').click(function(ev){$(ev.currentTarget).hide();$('.tags-collapse').show();$('.tag-bad').css('display','inline-block');});this.$container.find('.tags-collapse').click(function(ev){$('.tags-expand').show();$('.tags-collapse').hide();$('.tag-bad').css('display','none');});this.$container.find('#item-edit-tags').click(function(){p.mainView.showOverlay(p.View.Overlay.EditTags,$(this));});},saveTags:function(ev){if(!p.mainView.requireLogin()){return false;}
const $form=$(ev.currentTarget);const data=$form.serialize();$form.find('input,textarea,button,select').attr('disabled','disabled');p.api.post('tags.add',data,(res)=>{if(!res.tags){$form.find('input,textarea,button,select').removeAttr('disabled');this.hideTagForm();}else{this.loaded(res);}},function(){$form.find('input,textarea,button,select').removeAttr('disabled');});return false;},showTagForm:function(ev){if(!p.mainView.requireLogin()){return false;}
this.$container.find('.add-tags-link').hide();this.$container.find('.tag-form').show();var input=this.$container.find('input.item-tagsinput');if(!this.addedTagInput){let options=CONFIG.TAGS_INPUT_SETTINGS;let taglimit=$('#warn_taglimit');options.onAddTag=function(elem){if($('.tagsinput > .tag').length>10){$(this).removeTag(elem);taglimit.show();}else{taglimit.hide();}};this.tagInput=input.tagsInput(options);this.addedTagInput=true;this.focus('.tagsinput input');let that=this;if(p.View.Stream.Tags.TOP_TAGS_CACHE){this.autocompleteTagsLoaded(p.View.Stream.Tags.TOP_TAGS_CACHE);}
else{p.api.get('tags.top',{},function(response){p.View.Stream.Tags.TOP_TAGS_CACHE=response.tags;this.autocompleteTagsLoaded(response.tags);}.bind(this));}}
return false;},autocompleteTagsLoaded:function(tags){this.$container.find('.tagsinput input').autocomplete({minLength:3,delay:200,source:tags,select:(function(event,ui){this.tagInput.addTag(ui.item.value);ui.item.value=null;this.$container.find('.ui-autocomplete-input').focus();}.bind(this))});},hideTagForm:function(ev){this.$container.find('.add-tags-link').show();this.$container.find('.tag-form').hide();return false;},vote:function(ev,vote){if(!p.mainView.requireLogin()){return false;}
var $tag=$(ev.currentTarget).parent();var tagId=$tag.attr('id').split('-')[1];var absoluteVote=vote;if(($tag.hasClass('voted-up')&&vote===1)||($tag.hasClass('voted-down')&&vote===-1)){absoluteVote=0;$tag.removeClass('voted-up voted-down');}
else{$tag.removeClass('voted-up voted-down');$tag.addClass(vote===1?'voted-up':'voted-down');}
for(var i=0;i<this.data.tags.length;i++){if(this.data.tags[i].id==tagId){p.adjustVote(this.data.tags[i],absoluteVote,p.user.voteCache.votes.tags);break;}}
p.api.post('tags.vote',{id:tagId,vote:absoluteVote});return false;}});p.View.Stream.Tags.SortConfidence=function(a,b){return b.confidence-a.confidence;};p.View.Stream.Tags.TOP_TAGS_CACHE=null;p.View.Overlay=p.View.Overlay||{};p.View.Overlay.DeleteItem=p.View.Base.extend({name:'overlay-delete-item',resetViewport:false,template:'<div class="overlay-content"> <h2>Bild löschen</h2> </div> <div class="overlay-content"> <form id="image-delete-form"> <div class="form-row"> <label class="checkbox-label"> <input name="reason" type="radio" value="custom" checked id="custom"/> </label> <input type="text" class="text-line" name="customReason" placeholder="Grund"/> <?js for (let reason of reasons) { ?> <label> <input name="reason" type="radio" value="{reason.banReason}"/> {reason.banReason} </label> <?js } ?> </div> <div class="form-row"> <input type="checkbox" name="banUser" id="delete-ban-user"/> <label class="checkbox-label" for="delete-ban-user">Benutzer Sperren für</label> <input type="text" name="days" class="number" value="1"/> Tage (0 = für immer) </div> <div class="form-row"> </div> <div class="form-row"> <input type="hidden" name="id" value="{itemId}"/> <input type="submit" value="Löschen" id="image-delete"/> </div> </form> </div> ',data:{itemId:0},init:function(container,parent,$el){this.data.itemId=$el.data('id');this.parent(container,parent);},load:function(){let type=1;type+=8;p.mainView.showLoader();p.api.get('faq.reasons',{type:type},this.loaded.bind(this));},loaded:function(response){this.data.reasons=response.rules;p.mainView.hideLoader();this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));var customRadionButton=this.$container.find('input[name=reason][value=custom]');this.$container.find('input[name=customReason]').bind('focus onchange',function(){customRadionButton.prop('checked',true);});this.focus('input[name=customReason]');},submit:function(ev){p.api.post('items.delete',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){p.mainView.closeOverlay();}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Collect=p.View.Base.extend({name:'overlay-collect',resetViewport:false,template:'<div class="overlay-content"> <h2>Sammlungen</h2> </div> <div class="overlay-content"> <?js for (var i = 0; i < collections.length; i++) { var c = collections[i]; ?> <div class="collection-box-container<?js if (!p.user.paid && !c.isDefault && !c.collected){?> collection-disabled<?js } ?>"> <?js if (c.collected) {?> <div class="{allowHoverClass}drop-target collection-box collection-remove" data-id="{c.id}"> <img class="collection-preview" src="{item.thumb}"/> <div class="collection-remove-indicator">×</div> </div> <div class="collection-name"> <span class="collection-collected-indicator">✓</span> {{c.name}} </div> <?js } else { ?> <div class="{allowHoverClass}drop-target collection-box collection-add" data-id="{c.id}"> <?js for (var j = c.items.length-1; j >= 0; j--) { var ci = c.items[j]; ?> <?js if (!(ci.flags & p.user.flags)) {?> <div class="collection-preview"> <img class="collection-preview-blurred" src="{ci.thumb}"/> </div> <?js } else { ?> <img class="collection-preview" src="{ci.thumb}"/> <?js } ?> <?js } ?> </div> <div class="collection-name"> {{c.name}} </div> <?js } ?> </div> <?js } ?> <?js if (canCreateCollection) { ?> <div class="collection-box-container<?js if (!p.user.paid){?> collection-disabled<?js } ?>"> <div class="{allowHoverClass}drop-target collection-box collection-create"></div> <div class="collection-name"> <span id="collection-create-placeholder">+ Neue Sammlung</span> <form id="collection-create-form"> <input id="collection-create-name" type="text" name="name" maxlength="20" autocomplete="off" placeholder="Bezeichnung" value="Bezeichnung"> </form> </div> </div> <?js } ?> </div> <?js if (showDragDropHint) {?> <div class="collection-usage-hint"> Statt auf den kleinen Pfeil zu drücken, kannst Du Bilder &amp; Videos auch einfach per Drag+Drop hier hereinschieben. Muss man wissen! </div> <?js } ?>',preventClose:false,init:function(container,parent,params){this.data.showDragDropHint=params.showDragDropHint;this.data.item=params.item;this.data.allowHoverClass=params.allowHover?'allow-hover ':'';this.itemView=params.itemView;this.parent(container,parent);},remove:function(){this.visible=false;if(this.createFormNeedsSaving){this.$container.find('#collection-create-form').submit();}
this.parent();},load:function(){if(p.User.COLLECTIONS_CACHE){this.data.collections=p.User.COLLECTIONS_CACHE;return true;}
p.api.get('collections.get',{},this.loaded.bind(this));return false;},loaded:function(response){this.data.collections=this.prepareCollections(response.collections);this.render();},render:function(){var collected=p.user.voteCache.votes.collections;for(var i=0;i<this.data.collections.length;i++){this.data.collections[i].collected=(collected[this.data.item.id]&&collected[this.data.item.id][this.data.collections[i].id]);}
this.data.canCreateCollection=(p.user.paid&&this.data.collections.length<CONFIG.COLLECTIONS_MAX)||this.data.collections.length===0;this.parent();this.$container.find('.drop-target').bind('drop',this.dropOrClick.bind(this)).bind('dragover',this.dragOver.bind(this)).bind('dragenter',this.dragEnter.bind(this)).bind('dragleave',this.dragLeave.bind(this)).click(this.dropOrClick.bind(this));this.$container.find('#collection-create-form').submit(this.create.bind(this));if(p.mobile){this.$container.find('.collection-remove-indicator').show();}},dragOver:function(ev){ev.preventDefault();},dropOrClick:function(ev){ev.preventDefault();var target=$(ev.currentTarget);if(target.hasClass('collection-create')){this.initCreate();}
else if(target.hasClass('collection-add')){var collectionId=target.data('id');this.addItem(collectionId);p.mainView.closeOverlay();}
else if(target.hasClass('collection-remove')){var collectionId=target.data('id');this.removeItem(collectionId);p.mainView.closeOverlay();}},dragEnter:function(ev){if(this.currentDragTarget===ev.currentTarget){this.ignoreDragLeave=true;return;}
this.currentDragTarget=ev.currentTarget;var target=$(ev.currentTarget);target.addClass('active');},dragLeave:function(ev){if(this.ignoreDragLeave){this.ignoreDragLeave=false;return;}
var target=$(ev.currentTarget);target.removeClass('active');if(this.currentDragTarget===ev.currentTarget){this.currentDragTarget=null;}},closeOnClick:function(ev){if(ev.target.type==='text'){return;}
if(this.visible){p.mainView.closeOverlay();}},addItem:function(collectionId){var c=p.View.Overlay.Collect.CollectionFromCache(collectionId);if(!p.user.paid&&c&&!c.isDefault){p.navigateTo('pr0mium');return;}
p.api.post('collections.add',{collectionId:collectionId,itemId:this.data.item.id});this.data.item.fav=p.View.Overlay.Collect.AddCache(collectionId,this.data.item);this.itemView.syncVotes(p.user.voteCache.votes);if(p.user.favUpvote&&!this.itemView.$itemVote.hasClass('voted-up')&&!this.itemView.$itemVote.hasClass('voted-down')){this.itemView.vote(null,1);}},removeItem:function(collectionId){p.api.post('collections.remove',{itemId:this.data.item.id,collectionId:collectionId});this.data.item.fav=p.View.Overlay.Collect.RemoveCache(collectionId,this.data.item);this.itemView.syncVotes(p.user.voteCache.votes);},initCreate:function(){if(this.data.collections.length>0&&!p.user.paid){p.navigateTo('pr0mium');return;}
this.createFormNeedsSaving=true;this.preventClose=true;$('#collection-create-placeholder').hide();$('#collection-create-form').show();$('#collection-create-name').select();var img=new Image();img.src=this.data.item.thumb;$('.collection-create').append(img);setTimeout(function(){this.$container.click(this.closeOnClick.bind(this));}.bind(this),16);},create:function(ev){this.createFormNeedsSaving=false;if(this.visible){p.mainView.closeOverlay();}
p.api.post('collections.create',ev.currentTarget,this.created.bind(this));return false;},created:function(response){this.data.collections=this.prepareCollections(response.collections);this.addItem(response.collectionId);},prepareCollections:function(collections){for(var i=0;i<collections.length;i++){for(var j=0;j<collections[i].items.length;j++){var item=collections[i].items[j];item.thumb=CONFIG.PATH.THUMBS+item.thumb;}}
p.User.COLLECTIONS_CACHE=collections;return collections;}});p.View.Overlay.Collect.CollectionFromCache=function(collectionId){if(!p.User.COLLECTIONS_CACHE){return null;}
for(var i=0;i<p.User.COLLECTIONS_CACHE.length;i++){var c=p.User.COLLECTIONS_CACHE[i];if(c.id==collectionId){return c;}}
return null;}
p.View.Overlay.Collect.AddCache=function(collectionId,item){var c=p.View.Overlay.Collect.CollectionFromCache(collectionId);if(c){c.items.unshift({id:item.id,thumb:item.thumb,flags:item.flags});c.items.length=Math.min(c.items.length,3);}
var collections=p.user.voteCache.votes.collections;if(!collections[item.id]){collections[item.id]={};}
collections[item.id][collectionId]=1;return Object.keys(collections[item.id]).length;};p.View.Overlay.Collect.RemoveCache=function(collectionId,item){var c=p.View.Overlay.Collect.CollectionFromCache(collectionId);if(c){c.items=c.items.filter(function(ci){return ci.id!==item.id;});}
var favcount=0;var collections=p.user.voteCache.votes.collections;if(collections[item.id]){delete collections[item.id][collectionId];favcount=Object.keys(collections[item.id]).length;}
else{favcount=0;}
return favcount;}
p.View.Stream=p.View.Stream||{};p.View.Stream.Item=p.View.Base.extend({template:'<div class="item-container-content"> <?js if( p.user.admin ) {?> <svg class="flags flags-{item.flags}" viewBox="0 0 10 10"> <polygon points="0,0 10,0 0,10"></polygon> </svg> <?js } ?> <div class="item-image-wrapper"> <?js if( item.video ) { ?> <div class="item-image"> <div class="item-image-thumb" style="background-image: url({item.thumb})"></div> <?js if(supportsAutoplay) {?> <video class="item-image-actual" draggable="true" src="{item.image}" type="video/mp4" loop autoplay preload="auto"></video> <?js } else { ?> <video class="item-image-actual" draggable="true" webkit-playsinline playsinline poster="{item.thumb}" src="{item.image}" type="video/mp4" loop preload="metadata"></video> <svg class="video-play-button" viewBox="0 0 200 200"> <circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"></circle> <polygon points="70, 55 70, 145 145, 100" fill="#fff"></polygon> </svg> <?js } ?> </div> <div class="video-controls<?js if(item.audio){?> has-audio<?js}?>"> <div class="video-position-bar-background"> <div class="video-position"></div> </div> <?js if(supportsAutoplay) {?> <div class="video-pause-controls" title="Pausieren [p]"> <svg class="video-state video-state-playing" viewBox="20 20 160 160"> <g class="video-state-play-button"> <polygon points="70,50 70,150 150,100" fill="#fff"></polygon> </g> <g class="video-state-pause-button"> <polygon points="70,50 70,150 90,150 90,50" fill="#fff"></polygon> <polygon points="110,50 110,150 130,150 130,50" fill="#fff"></polygon> </g> </svg> </div> <?js } ?> <?js if(item.audio) {?> <div class="audio-controls" title="Stumm [q]"> <svg class="audio-state" viewBox="0 0 75 75"> <polygon class="audio-speaker" points="39.389,13.769 22.235,28.606 6,28.606 6,47.699 21.989,47.699 39.389,62.75 39.389,13.769"/> <g class="audio-x"> <path d="M 49,50 69,26"/> <path d="M 69,50 49,26"/> </g> <g class="audio-wave"> <path class="audio-wave-1" d="M 48,49 C 50,46 51,42 51,38 C 51,34 50,31 48,28"/> <path class="audio-wave-2" d="M 55,21 C 59,26 61,32 61,38 C 61,45 59,51 55,56"/> <path class="audio-wave-3" d="M 62,63 C 67,56 70,48 70,38 C 70,29 67,21 62,14"/> </g> </svg> <div class="audio-volume-controls"> <div class="audio-volume-bar"></div> <div class="audio-volume-slider"></div> </div> </div> <?js } ?> </div> <?js } else { ?> <div class="item-image"> <div class="item-image-thumb" style="background-image: url({item.thumb})"></div> <img class="item-image-actual" draggable="true" src="{item.image}"/> </div> <?js if(item.fullsize) { ?> <a href="{item.fullsize}" target="_blank" class="item-fullsize-link">+</a> <?js } ?> <?js } ?> <div class="stream-prev arrow pict" title="Neuer [&#171;, a]">&lt;</div> <div class="stream-next arrow pict" title="Älter [&#187;, d]">&gt;</div> </div> <div class="item-info"> <?js if(!item.deleted && !item.unlawful) {?> <div class="item-vote{p.voteClass(item.vote)}"> <span class="pict vote-up" title="Hochvoten [w, +]">+</span> <span class="pict vote-down" title="Runtervoten [s, -]">-</span> <?js if( p.shouldShowScore(item) ) {?> <span class="score<?js if(!p.olderThanMinAge(item)){?> score-young<?js}?>" title="{item.up} up, {item.down} down"><?js print((item.up - item.down).toSiUnit()) ?></span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> </div> <span class="pict vote-fav<?js if (item.fav){ ?> faved<?js } ?>" title="Favorisieren [f]">*</span> <span class="collect" title="In Sammlung einsortieren">▼</span> <?js } ?> <div class="item-details"> <a class="time" title="{item.date.readableTime()}" href="/new/{item.id}">{item.date.relativeTime(true)}</a> <span class="time">von</span> <a href="#user/{item.user}" class="user um{item.mark}">{item.user}</a> <?js if( item.source ) {?> <span class="item-source"> <span class="pict">s</span>&nbsp;<a href="{{item.source}}" target="_blank" rel="noopener noreferrer">{{item.source.hostName()}}</a> </span> <?js } ?> <?js if (item.user !== p.user.name) { ?> <span class="item-stalk" style="display: none;"> <span class="action item-follow pict" title="Benutzer stelzen">@</span> <span class="action item-unfollow pict" title="Benutzer unstelzen">A</span> <span class="action item-subscribe pict" title="Benachrichtigung aktivieren">d</span> <span class="action item-unsubscribe pict" title="Benachrichtigung deaktivieren">e</span> </span> <?js } ?> <?js if(!item.deleted && !item.unlawful) {?> <?js if( !item.video ) {?> <span class="item-google-search"> <?js let image = item.image.replace(\'//\', \'\'); ?> <span class="pict">g</span>&nbsp;<a title="Bild mit ImgOps suchen" href="https://imgops.com/{image}" target="_blank" rel="noopener noreferrer"> ImgOps </a> </span> <?js } ?> <span> <span class="pict">t</span> <span class="action copy-link" data-url="https://{CONFIG.HOST}/new/{item.id}" title="Link zum Teilen in die Zwischenablage kopieren"> Teilen</span> </span> <?js if (!!p.mobile) { ?> <span style="margin-right: 12px;"> | <a href="{item.image}">Datei öffnen</a> </span> <?js } ?> <?js if( p.user.admin ) { ?> [<span class="action" id="item-delete" data-id="{item.id}">del</span>] [<a href="/new/phash.{item.id}.12">phash</a>] <?js } ?> <?js if ( !p.user.admin && p.user.name == item.user) { ?> [<span class="item-self-delete action" data-item="{item.id}">löschen</span>] <?js } ?> <?js if ( p.user.id ) { ?> [<span class="item-report action" data-item="{item.id}">melden</span>] <?js } ?> <?js } ?> </div> <div class="item-tags"></div> </div> <?js if(p.user.showAds) {?> <div class="divider-widget gpt gpt-no-refresh" id="gpt-divider-widget" data-escobar="thumbs-widget-{p.ads.category()}"> </div> <?js } ?> <p class="follow-non-paid warn"> Gespeichert. Um die Posts von Benutzern zu sehen die Du stelzt, benötigst Du einen <a href="#pr0mium">pr0mium-Account</a> </p> <div class="item-comments"></div> </div> ',swipeDistance:96,navTop:-1,mouseIsDown:false,init:function(container,parent){this.stream=parent.stream;this.parent(container,parent);},show:function(rowIndex,itemData,defaultHeight,jumpToComment,cacheBust){if(this.removed){return;}
this.data.supportsAutoplay=!p.mobile;this.data.item=itemData;this.data.item.video=!!this.data.item.image.match(/\.mp4$/);this.data.item.date=new Date(itemData.created*1000);this.parent();this.$image=this.$container.find('.item-image');this.$media=this.$image.find(".item-image-actual");var that=this;if(this.data.item.width&&this.data.item.height){var imageWidth=p.mobile?this.parentView.$container.width():Math.min(this.data.item.width,this.parentView.$container.width());var imageHeight=(this.data.item.height/this.data.item.width)*imageWidth;if(this.data.item.video&&imageHeight>window.innerHeight-CONFIG.HEADER_HEIGHT){imageHeight=window.innerHeight-CONFIG.HEADER_HEIGHT;imageWidth=(this.data.item.width/this.data.item.height)*imageHeight;}
this.$media.css('width',imageWidth|0);this.$media.css('height',imageHeight|0);this.$image.css('width',imageWidth|0);this.$image.css('height',imageHeight|0);this.loadPreview(this.data.item.thumb);}
this.$container.find('.item-follow').click(this.follow.bind(this));this.$container.find('.item-unfollow').click(this.unfollow.bind(this));this.$container.find('.item-subscribe').click(this.subscribe.bind(this));this.$container.find('.item-unsubscribe').click(this.unsubscribe.bind(this));this.$itemStalk=this.$container.find('.item-stalk');this.syncFollow(p.user.voteCache.votes);this.$itemVote=this.$container.find('.item-vote');this.$itemVote.find('.vote-up').click(function(ev){return that.vote(ev,1);});this.$itemVote.find('.vote-down').click(function(ev){return that.vote(ev,-1);});this.$itemFav=this.$container.find('.vote-fav');this.$itemFav.click(this.fav.bind(this));this.$container.find('.collect').click(this.collect.bind(this));this.$container.find('#item-delete').click(function(){p.mainView.showOverlay(p.View.Overlay.DeleteItem,$(this));});this.$container.find('.item-self-delete').click((ev)=>{p.mainView.showOverlay(p.View.Overlay.SELFDELETECONTENT,{itemId:ev.currentTarget.dataset.item});});this.$container.find('.item-report').click(function(){var c=$(this);p.mainView.showOverlay(p.View.Overlay.Report,{itemId:c.data('item'),commentId:0});});this.$container.find('.copy-link').click(async(ev)=>{const element=ev.currentTarget;if(!!navigator.canShare){await navigator.share({url:element.dataset.url,title:'PR0GRAMM HOCHLAD #'+this.data.item.id,text:'HOCHLAD #'+this.data.item.id+' VON '+this.data.item.user});}else{await navigator.clipboard.writeText(element.dataset.url);element.style.color="#fc8833";element.innerHTML="Link kopiert..."
setTimeout(()=>{element.style.color=null;element.innerHTML="Teilen";},2500);}});this.tagView=new p.View.Stream.Tags(this.$container.find('.item-tags'),this);this.tagView.show({id:itemData.id,cacheBust:cacheBust});this.commentView=new p.View.Stream.Comments(this.$container.find('.item-comments'),this);this.commentView.show({id:itemData.id,comment:jumpToComment,cacheBust:cacheBust});if(this.data.item.video){this.videoSetup(imageWidth);}
else{this.$image.click(this.parentView.hideItem.bind(this.parentView));}
if(!p.mobile&&p.user.id){this.$media.on('dragstart',this.dragStart.bind(this));}
this.$media.one("load loadeddata",this.hidePreview.bind(this)).each(function(){if(this.complete){$(this).load();}});if(p.mobile){this.setupSwipe();}
else{this.$streamPrev=this.$container.find('.stream-prev');this.$streamNext=this.$container.find('.stream-next');this.$streamPrev.show().click(this.parentView.prev.bind(this.parentView));this.$streamNext.show().click(this.parentView.next.bind(this.parentView));this.onScrollBound=this.onScroll.bind(this);$(window).bind('scroll',this.onScrollBound);this.onScroll();}
p.ads.fill(this.$container.find('.gpt:visible'));p.ads.fill(this.$container.find('.gpt.divider-widget'));},loadPreview:function(thumbUrl){if(this.removed||this.$media[0].complete){return;}
EXIF.extractThumbnail(thumbUrl,this.setPreview.bind(this,thumbUrl));},setPreview:function(thumbUrl,microThumbUrl){if(this.removed||this.$media[0].complete){return;}
this.$image.css({backgroundImage:"url("+microThumbUrl+")"});},hidePreview:function(){if(this.removed){return;}
this.$image.css({backgroundImage:"none"});this.$image.find('.item-image-thumb').css('display','none');},onScroll:function(){var ih=this.$image.height();var h=ih/2-32;var p=($(window).scrollTop()-this.$container.offset().top).limit(32,ih-32-96)+96;if(p==this.navTop){return;}
this.navTop=p;this.$streamPrev.css('padding-top',p);this.$streamNext.css('padding-top',p);},remove:function(){if(this.video){this.video.pause();this.video.removeAttribute('src');this.video.load();clearInterval(this.video.tsInterval);}
if(this.commentView){this.commentView.remove();}
if(this.tagView){this.tagView.remove();}
this.parent();this.removed=true;if(this.updateVideoPositionInterval){clearInterval(this.updateVideoPositionInterval);}
if(this.onScrollBound){$(window).unbind('scroll',this.onScrollBound);}
if(this.mouseUpBound){$(window).unbind('mouseup',this.mouseUpBound);}},syncVotes:function(votes){if(!this.data.item){return;}
var vote=votes.items[this.data.item.id];var fav=votes.collections[this.data.item.id];if(vote&&this.$itemVote){this.$itemVote.removeClass('voted-up voted-down');this.$itemVote.addClass(vote>0?'voted-up':'voted-down');}
if(fav!==undefined&&this.$itemVote){if(Object.keys(fav).length){this.$itemFav.addClass('faved');}
else{this.$itemFav.removeClass('faved');}}
if(this.commentView){this.commentView.syncVotes(votes);}
if(this.tagView){this.tagView.syncVotes(votes);}
this.syncFollow(votes);},syncFollow:function(votes){var follows=votes.users[this.data.item.userId];if(follows===1||follows===2){this.$itemStalk.addClass('followed').removeClass('unfollowed');}
else{this.$itemStalk.addClass('unfollowed').removeClass('followed');}
if(follows===2){this.$itemStalk.addClass('subscribed').removeClass('unsubscribed');}
else{this.$itemStalk.addClass('unsubscribed').removeClass('subscribed');}
if(!p.mobile){this.$itemStalk.show();}},fav:function(ev){if(!p.mainView.requireLogin()){return false;}
if(p.user.voteCache.votes.collections[this.data.item.id]&&Object.keys(p.user.voteCache.votes.collections[this.data.item.id]).length){this.collect(ev);return;}
p.api.post('collections.add',{itemId:this.data.item.id},function(response){if(!response.collectionId){return;}
p.View.Overlay.Collect.AddCache(response.collectionId,this.data.item);}.bind(this));this.data.item.fav=1;this.$container.find('.vote-fav').addClass('faved');if(p.user.favUpvote&&!this.$itemVote.hasClass('voted-up')&&!this.$itemVote.hasClass('voted-down')){this.vote(ev,1);}
return false;},collect:function(ev){if(!p.mainView.requireLogin()){return false;}
var collected=p.user.voteCache.votes.collections[this.data.item.id]&&Object.keys(p.user.voteCache.votes.collections[this.data.item.id]).length;p.mainView.showOverlay(p.View.Overlay.Collect,{item:this.data.item,itemView:this,showDragDropHint:!collected&&!p.mobile,allowHover:true});return false;},vote:function(ev,vote){if(!p.mainView.requireLogin()){return false;}
var absoluteVote=vote;if((this.$itemVote.hasClass('voted-up')&&vote===1)||(this.$itemVote.hasClass('voted-down')&&vote===-1)){absoluteVote=0;this.$itemVote.removeClass('voted-up voted-down');}
else{this.$itemVote.removeClass('voted-up voted-down');this.$itemVote.addClass(vote===1?'voted-up':'voted-down');}
var cachedItem=this.stream.items[this.data.item.id];p.adjustVote(cachedItem,absoluteVote,p.user.voteCache.votes.items);var $score=this.$itemVote.find('.score');$score.text((cachedItem.up-cachedItem.down).toSiUnit());p.api.post('items.vote',{id:this.data.item.id,vote:absoluteVote});return false;},follow:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.follow',{name:this.data.item.user});this.$itemStalk.addClass('followed').removeClass('unfollowed');if(!p.user.paid){$('.follow-non-paid').show();}
p.user.voteCache.votes.users[this.data.item.userId]=1;},unfollow:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.unfollow',{name:this.data.item.user});this.$itemStalk.addClass('unfollowed unsubscribed').removeClass('followed subscribed');delete p.user.voteCache.votes.users[this.data.item.userId];},subscribe:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.subscribe',{name:this.data.item.user});this.$itemStalk.addClass('subscribed').removeClass('unsubscribed');if(!p.user.paid){$('.follow-non-paid').show();}
p.user.voteCache.votes.users[this.data.item.userId]=2;},unsubscribe:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.unsubscribe',{name:this.data.item.user});this.$itemStalk.addClass('unsubscribed').removeClass('subscribed');p.user.voteCache.votes.users[this.data.item.userId]=1;},mediaSessionCreate:function(){if('mediaSession'in navigator){navigator.mediaSession.metadata=new MediaMetadata({title:`${this.data.item.id}`,artist:this.data.item.user,artwork:[{src:this.data.item.thumb,sizes:'128x128',type:'image/png'},{src:this.data.item.thumb.replace('.png','-original.webp'),sizes:`${this.data.item.height}x${this.data.item.width}`,type:'image/webp'}]});navigator.mediaSession.setActionHandler('play',()=>{this.video.play();let svg=this.$container.find('.video-state')[0];if(!!svg){svg.setAttribute('class','video-state video-state-playing');}else{this.videoPausePlay(true);}});navigator.mediaSession.setActionHandler('pause',()=>{this.video.pause();let svg=this.$container.find('.video-state')[0];if(!!svg){svg.setAttribute('class','video-state video-state-paused');}else{this.videoPausePlay(false);}});}},setTimestampUrl:function(element){const time=Math.round(element.currentTime*100);const copyElement=document.querySelector('.item-details .copy-link');const url=new URL(copyElement.dataset.url);url.searchParams.set('timestamp',time.toString());copyElement.dataset.url=url.toString();},videoSetup:function(imageWidth){this.video=this.$media[0];if(!p.mobile){this.video.onvolumechange=(ev)=>{this.videoSetVolume(ev.target.volume);}}
this.video.onplay=(ev)=>{if('mediaSession'in navigator){navigator.mediaSession.playbackState="playing";}
this.mediaSessionCreate();this.video.tsInterval=setInterval(()=>{this.setTimestampUrl(ev.target);},1000);}
this.video.onpause=(ev)=>{if('mediaSession'in navigator){navigator.mediaSession.playbackState="paused";}
this.setTimestampUrl(ev.target);window.clearInterval(this.video.tsInterval);}
const queryString=window.location.search;const urlParams=new URLSearchParams(queryString);if(urlParams.has('timestamp')){this.video.currentTime=parseInt(urlParams.get('timestamp'))/100;this.video.pause();let svg=this.$container.find('.video-state')[0];if(!!svg){svg.setAttribute('class','video-state video-state-paused');}else{this.videoPausePlay(false);}}
this.$volumeControls=this.$container.find('.audio-volume-controls');this.$videoControls=this.$container.find('.video-controls');this.$videoControls.css({width:imageWidth}).show();this.$videoPosition=this.$container.find('.video-position');this.playVideoAfterScrub=false;this.videoThrough=0;this.updateVideoPositionInterval=setInterval(this.videoUpdatePosition.bind(this),16);if(p.mobile){this.$playButton=this.$container.find('.video-play-button');this.$image.click(this.videoPausePlay.bind(this));this.$container.find('svg.audio-state').click(this.videoToggleMute.bind(this));}
else{this.$image.click(this.parentView.hideItem.bind(this.parentView));this.$videoControls.on('mousedown',this.videoPositionBarMouseDown.bind(this));this.mouseUpBound=this.videoControlsMouseUp.bind(this);$(window).on('mouseup',this.mouseUpBound);this.$videoControls.on('mousemove',this.videoControlsMouseMove.bind(this));this.$volumeControls.on('mousedown',this.audioVolumeMouseDown.bind(this));this.$container.find('svg.audio-state').on('mousedown',this.videoToggleMute.bind(this));this.$container.find('svg.video-state').on('mousedown',this.videoTogglePause.bind(this));}
if(this.data.item.audio){this.videoSetVolume(p.user.video.muted?0:p.user.video.volume);}
if(!p.mobile&&!urlParams.has('timestamp')){this.videoTryAutoplay(0);}},videoTryAutoplay:function(failedAttempts){var promise=this.video.play();if(promise){promise.catch(function(error){failedAttempts++;if(error.name==='NotAllowedError'){if(this.removed||!this.video){return;}
if(failedAttempts<2){this.videoSetVolume(0);this.videoTryAutoplay(failedAttempts)}
else{this.videoTogglePause();}}}.bind(this));}},videoPausePlay:function(play){if((this.video.paused||play===true)&&play!==false){this.$container.find('.video-play-button').hide();this.video.play();}
else{this.$container.find('.video-play-button').show();this.video.pause();}},videoUpdatePosition:function(){if(!this.video||!this.video.duration){return;}
var through=(this.video.currentTime/this.video.duration);if(through<this.videoThrough){this.videoThrough=through;}
this.videoThrough=0.9*this.videoThrough+0.1*through;this.$videoPosition.css('width',(this.videoThrough*100).round(3)+'%')},videoPositionBarMouseDown:function(ev){this.mouseDownOn=p.View.Stream.Item.TARGET.SEEK_CONTROLS;this.videoControlsMouseMove(ev);this.playVideoAfterScrub=!this.video.paused;this.video.pause();ev.preventDefault();ev.stopPropagation();},audioVolumeMouseDown:function(ev){this.mouseDownOn=p.View.Stream.Item.TARGET.VOLUME_CONTROLS;this.videoControlsMouseMove(ev)
ev.preventDefault();ev.stopPropagation();},videoControlsMouseUp:function(ev){this.mouseDownOn=p.View.Stream.Item.TARGET.NOTHING;if(this.video&&!this.removed&&this.playVideoAfterScrub){this.video.play();}
this.playVideoAfterScrub=false;},videoControlsMouseMove:function(ev){if(!this.video||!this.video.duration){return;}
if(this.mouseDownOn===p.View.Stream.Item.TARGET.SEEK_CONTROLS){this.videoThrough=(ev.pageX-this.$videoControls.offset().left)/this.$videoControls.width();this.video.currentTime=this.video.duration*this.videoThrough;}
else if(this.mouseDownOn===p.View.Stream.Item.TARGET.VOLUME_CONTROLS){var volume=(ev.pageX-this.$volumeControls.offset().left)/this.$volumeControls.width();this.videoSetVolume(volume);}},videoSetVolume:function(volume){if(!this.video){return;}
volume=volume.limit(0,1);p.user.video.muted=volume===0;if(volume!==0){p.user.video.volume=volume;}
p.user.saveAudioSettings();this.video.volume=volume;this.video.muted=volume===0;this.$volumeControls.find('.audio-volume-slider').css('left',(volume*100)+'%');var svg=this.$container.find('.audio-state')[0];if(!svg){return;}
var volumeClass='audio-volume-'+['0','33','66','99'][Math.ceil(volume*3)];svg.setAttribute('class','audio-state '+volumeClass);},videoToggleMute:function(ev){ev.preventDefault();ev.stopPropagation();if(!this.video){return;}
var isMuted=this.video.volume===0||this.video.muted;this.videoSetVolume(isMuted?p.user.video.volume:0);},videoTogglePause:function(ev){ev.preventDefault();ev.stopPropagation();if(!this.video){return;}
if(this.video.paused){this.video.play();}
else{this.video.pause();}
var stateClass=this.video.paused?'video-state-paused':'video-state-playing';var svg=this.$container.find('.video-state')[0];svg.setAttribute('class','video-state '+stateClass);},dragStart:function(ev){var img=$('#item-'+this.data.item.id+' img')[0];img.width=128;img.height=128;ev.originalEvent.dataTransfer.setDragImage(img,64,64);setTimeout(function(){p.mainView.showOverlay(p.View.Overlay.Collect,{item:this.data.item,itemView:this,showDragDropHint:false,allowHover:false});}.bind(this),16);$(document).on('dragend',this.dragEnd.bind(this));return true;},dragEnd:function(ev){$(document).off('dragend');if(p.mainView.overlayView&&p.mainView.overlayView.preventClose){return;}
p.mainView.closeOverlay();},lastTouch:{x:0,y:0},avgTouchDelta:{x:0,y:0},touchOffset:{x:0,y:0},setupSwipe:function(){this.$image.bind('touchstart',this.initSwipeImage.bind(this)).bind('touchmove',this.swipeImage.bind(this)).bind('touchend',this.endSwipeImage.bind(this));this.$container.find('.video-play-button').bind('touchstart',this.initSwipeImage.bind(this)).bind('touchmove',this.swipeImage.bind(this)).bind('touchend',this.endSwipeImage.bind(this));},initSwipeImage:function(ev){var touch=ev.originalEvent.touches[0];this.lastTouch.x=touch.clientX;this.lastTouch.y=touch.clientY;this.avgTouchDelta.x=0;this.avgTouchDelta.y=0;this.touchOffset.x=0;this.touchOffset.y=0;},endSwipeImage:function(ev){if(this.touchOffset.x>this.swipeDistance){this.parentView.prev();}
else if(this.touchOffset.x<-this.swipeDistance){this.parentView.next();}
else{this.touchOffset.x=0;this.touchOffset.y=0;this.$image.css('margin-left',this.touchOffset.x);if(this.$playButton){this.$playButton.css('margin-left',this.touchOffset.x);}}},swipeImage:function(ev){if(ev.originalEvent.touches.length>1){return;}
var touch=ev.originalEvent.touches[0];var deltaX=this.lastTouch.x-touch.clientX;var deltaY=this.lastTouch.y-touch.clientY;this.lastTouch.x=touch.clientX;this.lastTouch.y=touch.clientY;this.avgTouchDelta.x=Math.abs(this.avgTouchDelta.x)*0.8+Math.abs(deltaX)*0.2;this.avgTouchDelta.y=Math.abs(this.avgTouchDelta.y)*0.8+Math.abs(deltaY)*0.2;if(Math.abs(this.avgTouchDelta.x)>Math.abs(this.avgTouchDelta.y)){ev.preventDefault();this.touchOffset.x-=deltaX;this.touchOffset.y-=deltaY;}
else{this.touchOffset.x=0;this.touchOffset.y=0;}
this.$image.css('margin-left',this.touchOffset.x);if(this.$playButton){this.$playButton.css('margin-left',this.touchOffset.x);}}});p.View.Stream.Item.TARGET={NOTHING:0,SEEK_CONTROLS:1,VOLUME_CONTROLS:2};p.View.Stream=p.View.Stream||{};p.View.Stream.Main=p.View.Base.extend({title:"",baseURL:'',template:' <div id="stream"></div> <div class="clear"></div> ',SCROLL:{NONE:1,THUMB:2,FULL:4},scrollPosition:0,loadInProgress:false,loadingTargetDistance:512,checkScrollPositionInterval:null,hasItems:false,prependNextSection:false,jumpToItem:null,jumpToComment:null,currentItemId:null,_scrolledToFullView:false,itemsPerRow:6,rowMargin:4,prefetched:[],init:function(container,parent){this.parent(container,parent);this.loadedBound=this.loaded.bind(this);this.scrollBound=this.onscroll.bind(this);$(window).scroll(this.scrollBound);this.checkScrollPositionInterval=setInterval(this.scrollBound,1000);this.$itemContainerTemplate=$('<div class="item-container"/>');},fragmentChange:function(fragment){if(this.currentItemSubview&&this.currentItemSubview.commentView&&fragment){this.currentItemSubview.commentView.focusComment(fragment);}},show:function(params){if(!params.userName){this.tab=params.tab||'top';}
else{this.tab=null;}
if(params.tab==='stalk'&&!p.user.paid){p.navigateTo('pr0mium');return;}
p.mainView.setTab(this.tab);var q=params.userName?params.userName+':'+params.userTab+(params.tags?' '+params.tags:''):params.tags||'';$('input.q').val(q.replace(/^\+(\d)/,'$1'));if(params.tab==='stalk'){this.title='Stelzungen';}
else if(params.userName){this.title=(params.userTab==='uploads'?'Hochlads':'Sammlung '+params.userTab)+' von '+params.userName;}
else if(params.tags){this.title='"'+params.tags+'" auf '+(this.tab==='top'?'Beliebt':'Neu');}
else{this.title=(this.tab==='top'?'Beliebt':'Neu');}
var newBaseURL=(p._hasPushState?'/':'#')+
(params.userName?('user/'+params.userName+'/'+params.userTab+'/'+(params.tags?encodeURIComponent(params.tags)+'/':'')):(this.tab+'/'+(params.tags?encodeURIComponent(params.tags)+'/':'')));if(newBaseURL==this.baseURL){this.data.params=params;if(this.data.params.itemId){var $target=$('#item-'+this.data.params.itemId);if($target.length){$(document).scrollTop($target.offset().top-CONFIG.HEADER_HEIGHT);this.showItem($target,this.SCROLL.THUMB);return;}}
else if(p.dispatchFromHistory){if(this.$currentItem){this.$itemContainer.remove();this.currentItemSubview.remove();this.$itemContainer=null;this.$currentItem=null;this.currentItemId=null;$(document).scrollTop(this.scrollPosition);}
return;}}
this.children=[];var options={};if(params.tab==='top'||(!params.tab&&!params.userName)){options.promoted=1;}
else if(params.tab==='stalk'){options.following=1;}
if(params.tags){options.tags=params.tags;}
if(params.userName&&params.userTab==='uploads'){options.user=params.userName;}
else if(params.userName&&params.userTab){options.user=params.userName;options.collection=params.userTab;if(params.userName===p.user.name){options.self=true;}}
this.stream=new p.Stream(options);this.baseURL=newBaseURL;this.hasItems=false;this.needsFirstRendering=true;this.parent(params);},resize:function(){this.jumpToItem=this.currentItemId;this.jumpToComment=p.getFragment();this.$streamContainer.html('');this.loaded(this.stream.getLoadedItems(),p.Stream.POSITION.APPEND);this.parent();},hide:function(){$(window).unbind('scroll',this.scrollBound);clearInterval(this.checkScrollPositionInterval);this.parent();},syncVotes:function(votes){if(this.stream){this.stream.syncVotes(votes);}
if(this.currentItemSubview){this.currentItemSubview.syncVotes(votes);}},load:function(){this.loadInProgress=true;if(this.data.params.itemId){this.jumpToItem=this.data.params.itemId;this.jumpToComment=p.getFragment();this.stream.loadAround(this.data.params.itemId,this.loadedBound);}
else{this.stream.loadNewest(this.loadedBound);}
this.showLoader();return false;},prepareThumbsForInsertion:function(html){var thumbs=$(html);thumbs.find('a').click(this.handleThumbLink.bind(this));thumbs.find('a').mouseover(this.handleThumbLinkMouseover.bind(this));return thumbs;},handleThumbLink:function(ev){if(!p.isNormalClick(ev)){return true;}
ev.preventDefault();this.showItem($(ev.currentTarget),this.SCROLL.NONE);if(!this._wasHidden){this.handleHashLink(ev);}
this._wasHidden=false;return false;},handleThumbLinkMouseover:function(ev){var thumbUri=$(ev.currentTarget).find("img").get(0).src;EXIF.extractThumbnail(thumbUri);return false;},loaded:function(items,position,error){if(this.needsFirstRendering){this.needsFirstRendering=false;this.render();this.$streamContainer=this.$container.find('#stream');this.$itemContainer=null;}
this.hideLoader();this.itemsPerRow=p.mainView.thumbsPerRow;if(!items||!items.length){var msg=null;var fm=null;if(!p.user.id||!p.user.verified){msg="NICHTS GEFUNDEN ¯\\_(ツ)_/¯"}
else if(error&&(fm=error.match(/^(nsfw|nsfl|nsfp|sfw)Required$/))){msg='Das Bild wurde als <em>'+fm[1].toUpperCase()+'</em> markiert.<br/>'+
(p.user.id?'Ändere deine Filter-Einstellung,':'Melde dich an,')+' wenn du es sehen willst.'}
else if(!this.hasItems){msg=this.tab==='stalk'?'Du stelzt noch keine anderen Accounts &#175;\\_(&#12484;)_/&#175;':'Nichts gefunden &#175;\\_(&#12484;)_/&#175;';}
if(msg){this.$container.html('<h2 class="main-message">'+msg+'</h2>');}
return;}
if(position==p.Stream.POSITION.PREPEND){var prevHeight=$('#main-view').height();var firstRow=this.$streamContainer.find('.stream-row:first');var placeholders=firstRow.find('.thumb-placeholder');var numPlaceholders=placeholders.length
if(numPlaceholders){var html='';for(var i=0;i<numPlaceholders;i++){html+=this.buildItem(items[items.length-numPlaceholders-1+i]);}
placeholders.remove();firstRow.prepend(this.prepareThumbsForInsertion(html));}
var html=this.buildItemRows(items,0,items.length-numPlaceholders,position);this.$streamContainer.prepend(this.prepareThumbsForInsertion(html));var newHeight=$('#main-view').height();$(document).scrollTop($(document).scrollTop()+(newHeight-prevHeight));}
else if(position==p.Stream.POSITION.APPEND){var lastRow=this.$streamContainer.find('.stream-row:last');var itemCount=lastRow.find('.thumb').length;var fill=0;if(itemCount%this.itemsPerRow!=0){var html='';fill=this.itemsPerRow-itemCount;for(var i=0;i<fill;i++){html+=this.buildItem(items[i]);}
lastRow.append(this.prepareThumbsForInsertion(html));}
var html=this.buildItemRows(items,fill,items.length,position);this.$streamContainer.append(this.prepareThumbsForInsertion(html));}
if(this.jumpToItem){var target=$('#item-'+this.jumpToItem);if(target.length){$(document).scrollTop(target.offset().top-CONFIG.HEADER_HEIGHT);this.showItem(target,this.SCROLL.THUMB);}
this.jumpToItem=null;}
this.loadInProgress=false;this.hasItems=true;},buildItemRows:function(items,start,end,position){var html='';if(position==p.Stream.POSITION.PREPEND&&(end-start)%this.itemsPerRow!=0){html+='<div class="stream-row">';var fillItems=(end-start)%this.itemsPerRow;var fillPlaceholders=this.itemsPerRow-fillItems;for(var i=0;i<fillPlaceholders;i++){html+='<div class="thumb-placeholder"></div>';}
for(var i=start;i<start+fillItems;i++){html+=this.buildItem(items[i]);}
start+=fillItems;html+='</div>'}
var fullRows=((end-start)/this.itemsPerRow)|0;var itemIndex=start;for(var r=0;r<fullRows;r++){html+='<div class="stream-row">';for(var i=0;i<this.itemsPerRow;i++,itemIndex++){html+=this.buildItem(items[itemIndex]);}
html+='</div>'}
if(position==p.Stream.POSITION.APPEND&&itemIndex!=end){html+='<div class="stream-row">';for(itemIndex;itemIndex<end;itemIndex++){html+=this.buildItem(items[itemIndex]);}
html+='</div>'}
return html;},buildItem:function(item){return('<a class="silent thumb" id="item-'+item.id+'" href="'+this.baseURL+item.id+'">'+'<img src="'+item.thumb+'"/>'+
(item.promoted>1000000000?'<div class="sticky-badge"></div>':'')+'</a>');},onscroll:function(ev){this.scrollPosition=$(document).scrollTop();if(this.loadInProgress||!this.hasItems){return;}
var loadingTargetNewer=this.loadingTargetDistance,loadingTargetOlder=$('#main-view').height()-this.loadingTargetDistance-window.innerHeight;if(this.scrollPosition>loadingTargetOlder&&!this.stream.reached.end){this.loadInProgress=true;this.stream.loadOlder(this.loadedBound);this.showLoader();}
else if(this.scrollPosition<loadingTargetNewer&&!this.stream.reached.start){this.loadInProgress=true;this.stream.loadNewer(this.loadedBound);this.showLoader();}},showItem:function($item,scrollTo){if(this.$currentItem&&$item.is(this.$currentItem)){this.hideItem();this._wasHidden=true;this.currentItemId=null;return;}
$('a.thumb.active').removeClass('active');$item.addClass('active');this.$currentItem=$item;var $row=$item.parent();var scrollTarget=0;if(scrollTo==this.SCROLL.FULL){scrollTarget=$row.offset().top-CONFIG.HEADER_HEIGHT+$item.height();}
else if(scrollTo==this.SCROLL.THUMB){scrollTarget=$row.offset().top-CONFIG.HEADER_HEIGHT-this.rowMargin;}
else{scrollTarget=$(document).scrollTop();}
var animate=!(scrollTo==this.SCROLL.FULL&&this._scrolledToFullView);this._scrolledToFullView=(scrollTo==this.SCROLL.FULL);if(this.$itemContainer){var previousItemHeight=this.$itemContainer.find('.item-image').height()||0;}
var itemContainerNeedsToShow=false;if(!$row.next().hasClass('item-container')){itemContainerNeedsToShow=true;if(this.$itemContainer){if(this.$itemContainer.offset().top<$item.offset().top){scrollTarget-=this.$itemContainer.innerHeight();}
if(animate){this.$itemContainer.find('.gpt').empty();this.$itemContainer.slideUp(CONFIG.ANIMATION_TIME,function(){$(this).remove();});}
else{this.$itemContainer.remove();}}
this.$itemContainer=this.$itemContainerTemplate.clone(true);this.$itemContainer.insertAfter($row);}
var id=$item[0].id.replace('item-','');var itemData=this.stream.items[id];var rowIndex=$item.prevAll().length;if(this.currentItemSubview){this.currentItemSubview.remove();}
var cacheBust=(p.getQuery('ts')||0)>Date.now()/1000-CONFIG.ITEM_CACHE_BUST_MAX_AGE?(p.getQuery('ts')|0):undefined;this.currentItemSubview=new p.View.Stream.Item(this.$itemContainer,this);this.currentItemSubview.show(rowIndex,itemData,previousItemHeight,this.jumpToComment,cacheBust);this.jumpToComment=null;if(itemContainerNeedsToShow){if(animate&&!this.jumpToItem){this.$itemContainer.slideDown(CONFIG.ANIMATION_TIME);}
else{this.$itemContainer.show();}}
this.stream.loadInfo(itemData.id,this.prefetch.bind(this,$item),cacheBust);if(!this.jumpToItem){if(animate){$('body, html').stop(true,true).animate({scrollTop:scrollTarget},CONFIG.ANIMATION_TIME);}
else{$('body, html').stop(true,true).scrollTop(scrollTarget);}}
this.currentItemId=id;},hideItem:function(ev){$('a.thumb.active').removeClass('active');var c=this.$itemContainer;c.slideUp(CONFIG.ANIMATION_TIME,function(){c.remove();});p.navigateTo(this.baseURL.substr(1,this.baseURL.length-2),p.NAVIGATE.SILENT);this.$itemContainer=null;this.$currentItem=null;this.currentItemSubview.remove();p.mainView.setTitle(this.title);},prefetch:function($centerItem){var $prev=this.getPrevItem($centerItem);var $next=this.getNextItem($centerItem);var queue=[];if($prev.length){queue.push($prev[0].id.replace('item-',''));}
if($next.length){queue.push($next[0].id.replace('item-',''));}
for(var i=0;i<this.prefetched.length;i++){this.prefetched[i].src="";}
this.prefetched=[];for(var i=0;i<queue.length;i++){this.stream.loadInfo(queue[i]);var source=this.stream.items[queue[i]].image;if(source.match(/\.mp4$/)){var vid=$('<video autobuffer/>')[0];vid.src=source;this.prefetched.push(vid);}
else{var img=new Image();img.src=source;this.prefetched.push(img);}}},getNextItem:function($item){var $next=$item.next();if(!$next.length){$next=$item.parent().nextAll('.stream-row:first').find('.thumb:first');}
return $next.hasClass('thumb')?$next:$();},getPrevItem:function($item){var $prev=$item.prev();if(!$prev.length){$prev=$item.parent().prevAll('.stream-row:first').find('.thumb:last');}
return $prev.hasClass('thumb')?$prev:$();},next:function(ev){var $next=this.getNextItem(this.$currentItem);if(!$next.length){return false;}
this.showItem($next,this.SCROLL.FULL);p.navigateTo($next.attr('href').substr(1),p.NAVIGATE.SILENT);return false;},prev:function(ev){var $prev=this.getPrevItem(this.$currentItem);if(!$prev.length){return false;}
this.showItem($prev,this.SCROLL.FULL);p.navigateTo($prev.attr('href').substr(1),p.NAVIGATE.SILENT);return false;}});p.View.FollowList=p.View.Base.extend({title:"Stelzliste",template:'<h1 class="pane-head user-head">Stelzliste</h1> <div class="tab-bar"> <a href="#stalk/list/stalk-date" <?js if(params.sort==\'stalk-date\') {?>class="active"<?js}?>>Nach Stelz-Datum</a> <a href="#stalk/list/post-date" <?js if(params.sort==\'post-date\') {?>class="active"<?js}?>>Nach letztem Post</a> </div> <div class="pane"> <?js for( var i = 0; i < list.length; i++ ) { var followed = list[i]; var subscribed = (followed.subscribed)? \'subscribed\' : \'unsubscribed\'; ?> <div class="followed-user"> <?js if( followed.itemId ) { ?> <a class="thumb" href="#user/{followed.name}/uploads/{followed.itemId}"><img src="{followed.thumb}"/></a> <?js } else { ?> <div class="thumb-placeholder"></div> <?js } ?> <div class="follow-details following {subscribed}"> <div> <a href="#user/{followed.name}" class="user um{followed.mark}">{followed.name}</a> </div> <div class="follow-times"> <div> Letzter Post <?js if( followed.lastPost ) {?> <span class="time" title="{followed.lastPost.readableTime()}"> {followed.lastPost.relativeTime()} </span> <?js } else { ?> <span class="time">–</span> <?js } ?> </div> <div> Gestelzt <span class="time" title="{followed.followCreated.readableTime()}"> {followed.followCreated.relativeTime()} </span> </div> </div> <span class="action user-unfollow" data-name="{followed.name}"> <span class="pict">A</span> unstelzen </span> <span class="action user-follow" data-name="{followed.name}"> <span class="pict">@</span> stelzen </span> <span class="action user-unsubscribe" data-name="{followed.name}" title="Benachrichtigungen deaktivieren"> <span class="pict">e</span> </span> <span class="action user-subscribe" data-name="{followed.name}" title="Benachrichtigungen aktivieren"> <span class="pict">d</span> </span> </div> </div> <?js } ?> </div>',load:function(){p.api.get('user.followlist',{flags:p.user.flags},this.loaded.bind(this));return false;},loaded:function(response){if(this.data.params.sort=='post-date'){response.list.sort(p.View.FollowList.SortFollowLastPost);}
else{response.list.sort(p.View.FollowList.SortFollowCreated);}
for(var i=0;i<response.list.length;i++){var l=response.list[i];l.followCreated=new Date(l.followCreated*1000);l.lastPost=l.itemId?new Date(l.lastPost*1000):null;l.thumb=CONFIG.PATH.THUMBS+l.thumb;}
this.data.list=response.list;this.render();},render:function(){this.parent();this.$container.find('.user-follow').click(this.follow.bind(this));this.$container.find('.user-unfollow').click(this.unfollow.bind(this));this.$container.find('.user-subscribe').click(this.subscribe.bind(this));this.$container.find('.user-unsubscribe').click(this.unsubscribe.bind(this));},follow:function(ev){var $button=$(ev.currentTarget);$button.closest('.follow-details').removeClass('not-following').addClass('following');p.api.post('profile.follow',{name:$button.data('name')});},unfollow:function(ev){var $button=$(ev.currentTarget);$button.closest('.follow-details').removeClass('following subscribed').addClass('not-following unsubscribed');p.api.post('profile.unfollow',{name:$button.data('name')});},subscribe:function(ev){var $bellicon=$(ev.currentTarget);$bellicon.closest('.follow-details').addClass('subscribed').removeClass('unsubscribed');p.api.post('profile.subscribe',{name:$bellicon.data('name')});},unsubscribe:function(ev){var $bellicon=$(ev.currentTarget);$bellicon.closest('.follow-details').addClass('unsubscribed').removeClass('subscribed');p.api.post('profile.unsubscribe',{name:$bellicon.data('name')});}});p.View.FollowList.SortFollowCreated=function(a,b){return(b.followCreated-a.followCreated);};p.View.FollowList.SortFollowLastPost=function(a,b){return(b.lastPost-a.lastPost);};p.View.User=p.View.Base.extend({title:"Profil",template:'<h1 class="pane-head user-head"> {user.name} <?js if(p.user.admin) {?> <a href="/admin/?view=users&amp;action=show&amp;id={user.id}" id="user-admin">admin</a> <?js } else if (p.user && p.user.name !== user.name) { ?> <span id="user-report" class="no-select">[<span class="action">melden</span>]</span> <?js } ?> <span class="break-on-mobile no-select"> <?js if( p.user.name !== user.name ) { ?> <?js if(following && !blocked) { ?> <span class="action user-unfollow"> <span class="pict">A</span> unstelzen </span> <?js if(subscribed && !blocked) { ?> <span class="action user-unsubscribe" title="Benachrichtigung deaktivieren"> <span class="pict">e</span> </span> <?js } else { ?> <span class="action user-subscribe" title="Benachrichtigung aktivieren"> <span class="pict">d</span> </span> <?js } ?> <?js } else if(!blocked) { ?> <span class="action user-follow"> <span class="pict">@</span> stelzen </span> <?js } ?> <?js if(blocked) { ?> <span class="action user-unblock" title="Blockierung aufheben"> <span class="pict">b</span> Blockierung aufheben </span> <?js } else { ?> <span class="action user-block" title="Benutzer blockieren"> <span class="pict">a</span> blockieren </span> <?js } ?> <?js } ?> <?js if( p.user.name !== user.name ) { ?> <a href="#inbox/messages/{user.name}" class="user-send-pm"> <span class="pict">m</span> private Nachricht senden </a> <?js } ?> </span> </h1> <p class="follow-non-paid warn"> Gespeichert. Um die Posts von Benutzern zu sehen die Du stelzt, benötigst Du einen <a href="#pr0mium">pr0mium-Account</a> </p> <p class="block-non-paid warn"> Gespeichert. Um keine Nachrichten von Benutzern zu erhalten die Du blockierst, benötigst Du einen <a href="#pr0mium">pr0mium-Account</a> </p> <div class="user-stats"> <div class="badges"> <?js for( var i = 0; i < dynamicBadges.length; i++ ) { var b = dynamicBadges[i]; ?> <a class="badge" href="{{b.link}}" title="{{b.description}}"> <?js if(b.type=="png") { ?> <img src="/media/badges/{b.image}" class="badge" alt=""/> <?js }else{ ?> <img src="/media/badges/{b.image}" class="badge" alt="" height="{b.height}"/> <?js } ?> <span class="badge-extra badge-{b.name}">{{b.extra}}</span> </a> <?js } ?> <?js for( var i = 0; i < badges.length; i++ ) { var b = badges[i]; ?> <a class="badge" href="{{b.link}}" title="{{b.description}} - {b.created.readableDate()}"> <img src="/media/badges/{b.image}" class="badge" alt=""/> </a> <?js } ?> </div> <div class="user-score-pane" title="{user.up} up, {user.down} down">BENIS <span class="user-score">{user.score}</span></div> <div> <?js if(user.score < 0 ) {?>Geschrumpft<?js } else {?>Gewachsen<?js } ?> seit {user.registered.readableDate()} ({user.registered.relativeTime(true,true)}) <?js if( user.name === p.user.name ) { ?> <a href="/userstats" class="stats">Statistik anzeigen</a> <?js } ?> <?js if(user.banned) { ?>, <?js if( user.bannedUntil ) { ?> <?js if( user.inactive == 1 ) { ?> auf Wunsch gesperrt bis {user.bannedUntil.relativeTime()} <?js } else { ?> gesperrt bis {user.bannedUntil.relativeTime()} <?js } ?> <?js } else { ?> <?js if( user.inactive == 1 ) { ?> inaktiv <?js } else { ?> dauerhaft gesperrt <?js } ?> <?js } ?> <?js } ?> </div> </div> <div class="tab-bar"> <span>Hochlads</span> <em>{uploadCount}</em> <span>Gesammelt</span> <em>{collectedCount}</em> <span>Kommentare</span> <em>{commentCount}</em> <span>Tags</span> <em>{tagCount}</em> <?js if( user.name === p.user.name && p.user.paid ) { ?> <span>Stelzend</span> <em class="follow-count">{followCount}</em> <a href="#stalk/list/stalk-date" class="follow-list">Stelzliste anzeigen…</a> <?js } ?> <em class="user-mark user um{user.mark}">{p.User.MARK[user.mark]}</em> </div> <div class="pane"> <h2 class="section"> Neueste Hochlads <?js if( uploads.length ) { ?> <a href="#user/{user.name}/uploads" class="user-show-all">Alle Hochlads…</a> <?js } ?> </h2> <?js if( !uploads.length) {?> <span class="disabled">Bisher keine Hochlads</span> <?js } ?> </div> <?js if( uploads.length) {?> <div class="stream-row in-pane"> <?js for( var i = 0; i < displayUploads; i++ ) { var u = uploads[i]; ?> <a class="thumb" href="#user/{user.name}/uploads/{u.id}"><img src="{u.thumb}"/></a> <?js } ?> <div class="clear"></div> </div> <?js } ?> <?js if (!collections.length) { ?> <div class="pane"> <h2 class="section">Sammlungen</h2> <span class="disabled"> <?js if( p.user.name === user.name ) { ?> Keine Sammlungen <?js } else { ?> Keine öffentlichen Sammlungen <?js } ?> </span> </div> <?js } ?> <?js for (var i = 0; i < collections.length; i++) { c = collections[i]; ?> <?js if (c.items.length === 0 && p.user.name !== user.name) { continue; } ?> <div class="pane"> <h2 class="section"> Sammlung: {{c.name}} <?js if( p.user.name === user.name ) { ?> <?js if (c.isPublic) {?> (öffentlich<?js if(c.isDefault){?>, standard<?js}?>) <?js } else { ?> (privat<?js if(c.isDefault){?>, standard<?js}?>) <?js } ?> <span class="action section-edit collection-toggle-edit" data-target="#collection-edit-form-{i}"> bearbeiten </span> <?js } ?> <a href="#user/{user.name}/{c.keyword}" class="user-show-all"> Alle Hochlads in dieser Sammlung… </a> </h2> </div> <?js if (p.user.name === user.name) { ?> <form class="collection-edit-form" id="collection-edit-form-{i}"> <input type="hidden" name="collectionId" value="{c.id}"/> <div class="form-section"> <h3>Bezeichnung</h3> <input type="text" name="name" value="{{c.name}}" placeholder="Bezeichnung" required maxlength="20"/> <h3>Sammlung ist sichtbar für</h3> <input type="radio" class="box-from-label" name="isPublic" value="1" id="collection-public-{i}" <?js if(c.isPublic) {?>checked="checked"<?js } ?> /><label class="radio" for="collection-public-{i}">Jeden</label> <input type="radio" class="box-from-label" name="isPublic" value="0" id="collection-private-{i}" <?js if(!c.isPublic) {?>checked="checked"<?js } ?> /><label class="radio" for="collection-private-{i}">Nur für mich</label> <input type="submit" value="Speichern" class="confirm collection-save"/> <?js if (collections.length > 1) { ?> <span class="action section-edit collection-toggle-move" data-target="#collection-move-form-{i}"> Inhalte verschieben </span> <?js } ?> <?js if (p.user.paid && !c.isDefault) {?> <span class="action section-edit collection-make-default" data-id="{c.id}"> als Standard festlegen </span> <?js } ?> <?js if (!c.isDefault) {?> <span class="action section-edit collection-toggle-delete" data-target="#collection-delete-form-{i}"> Sammlung löschen </span> <?js } ?> </div> </form> <form class="collection-delete-form" id="collection-delete-form-{i}"> <input type="hidden" name="collectionId" value="{c.id}"/> <div class="form-section"> <p class="warn">Diese Sammlung und die gesammelten Hochlads werden restlos gelöscht. Es gibt kein Untun!</p> <input type="submit" value="Sammlung löschen" class="confirm delete collection-save"/> <input type="button" class="cancel confirm collection-toggle-delete" data-target="#collection-delete-form-{i}" value="Abbrechen"/> </div> </form> <form class="collection-move-form" id="collection-move-form-{i}"> <input type="hidden" name="collectionId" value="{c.id}"/> <div class="form-section"> <div class="form-page"> <p> Mit den Tags legst Du fest, welche Hochlads aus dieser Sammlung verschoben oder kopiert werden. <br>Nur Hochlads die <span style="font-weight: bold">alle</span> angegeben Tags haben, werden berücksichtigt. </p> <div class="collection-tag" style="width: 80%"> <input type="text" class="collection-move-tagsinput" name="tags"/> </div> <span class="warn warn-taglimit" style="display: none"> Du kannst maximal 10 Tags gleichzeitig eingeben! </span> <label style="margin-top: 10px;">Zielsammlung</label> <select id="destinationCollection" name="destinationCollectionId"> <?js collections.forEach((a, b) => { ?> <?js if(b === i) return; ?> <option value="{a.id}">{{a.name}}</option> <?js }) ?> </select> </div> <p>Art der Übertragung:</p> <input type="radio" class="box-from-label" name="move" id="collection-move-{i}" value="1" checked="checked"> <label class="radio" for="collection-move-{i}">Verschieben</label> <input type="radio" class="box-from-label" name="move" id="collection-copy-{i}" value="0"> <label class="radio" for="collection-copy-{i}">Kopieren</label> <input type="hidden" value="{i}"> <input type="submit" value="Verschieben" class="confirm move collection-save"/> <input type="button" class="cancel confirm collection-toggle-move" data-target="#collection-move-form-{i}" value="Abbrechen"/> </div> </form> <?js } ?> <div class="stream-row in-pane"> <?js for (var j = 0; j < c.items.length; j++ ) { var ci = c.items[j]; ?> <a class="thumb" href="#user/{user.name}/{c.keyword}/{ci.id}"><img src="{ci.thumb}"/></a> <?js } ?> <div class="clear"></div> </div> <?js } ?> <?js if( p.user.id ) {?> <div class="pane"> <h2 class="section"> Neueste Kommentare <?js if( comments.length ) { ?> <a href="#user/{user.name}/comments/before/{newestCommentTime}" class="user-show-all"> Alle Kommentare… </a> <?js } ?> </h2> <?js for( var i = 0; i < comments.length; i++ ) { var c = comments[i]; ?> <div class="comment with-thumb"> <a href="#new/{c.itemId}:comment{c.id}"> <img src="{c.thumb}" class="comment-thumb"/> </a> <div class="comment-content with-thumb"> {c.content.format()} </div> <div class="comment-foot with-thumb"> <a href="#user/{user.name}" class="user um{user.mark}">{user.name}</a> <?js if(p.user.name === user.name || p.shouldShowScore(c)) {?> <span class="score" title="{c.up} up, {c.down} down">{"Punkt".inflect(c.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{c.itemId}:comment{c.id}" class="time permalink" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</a> </div> </div> <?js } ?> <?js if( !comments.length) {?> <span class="disabled">Bisher keine Kommentare</span> <?js } ?> </div> <?js } else { ?> <div class="pane"> <span class="disabled">Kommentare nur für registrierte Benutzer sichtbar</span> </div> <?js } ?> <?js if( p.user.id ) {?> <div class="pane"> <h2 class="section"> Neueste Kommentar-Favoriten <?js if( likesArePublic && comments_likes.length ) { ?> <a href="#user/{user.name}/comments/likes/before/{newestCommentLikesTime}" class="user-show-all"> Alle Kommentar-Favoriten… </a> <?js } ?> </h2> <?js if( likesArePublic && comments_likes.length ) { ?> <?js for( var i = 0; i < comments_likes.length; i++ ) { var c = comments_likes[i]; ?> <div class="comment with-thumb"> <a href="#new/{c.itemId}:comment{c.id}"> <img src="{c.thumb}" class="comment-thumb"/> </a> <div class="comment-content with-thumb"> {c.content.format()} </div> <div class="comment-foot with-thumb"> <a href="#user/{c.name}" class="user um{c.mark}">{c.name}</a> <?js if(p.shouldShowScore(c)) {?> <span class="score">{"Punkt".inflect(c.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{c.itemId}:comment{c.id}" class="time permalink" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</a> <?js if ( user.name === p.user.name ) { ?> [<a class="remove-like" data-comment="{c.id}" data-up="{c.up}" data-down="{c.down}">entfernen</a>] <?js } ?> </div> </div> <?js } ?> <?js } ?> <?js if(!likesArePublic) { ?> <span class="disabled">Nicht öffentlich</span> <?js } else if( !comments_likes.length) { ?> <span class="disabled">Bisher keine Favoriten</span> <?js } ?> </div> <?js } ?> ',data:{tagsInitialized:false},init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);},load:function(){var opts={name:this.data.params.name,flags:p.user.flags};p.api.get('profile.info',opts,this.loaded.bind(this));return false;},render:function(){var thumbsPerRow=p.mainView.thumbsPerRow;var rows=thumbsPerRow<5?3:2;var maxThumbs=(thumbsPerRow*rows).limit(9,16);this.data.displayUploads=Math.min(this.data.uploads.length,maxThumbs);this.parent();this.$container.find('#user-report').click(this.report.bind(this));this.$container.find('.user-follow').click(this.follow.bind(this));this.$container.find('.user-unfollow').click(this.unfollow.bind(this));this.$container.find('.user-subscribe').click(this.subscribe.bind(this));this.$container.find('.user-unsubscribe').click(this.unsubscribe.bind(this));this.$container.find('.user-block').click(this.block.bind(this));this.$container.find('.user-unblock').click(this.unblock.bind(this));this.$container.find('.user-send-pm').click(()=>p.mainView.requireLogin());this.$container.find('.collection-toggle-edit').click(this.collectionToggleEdit.bind(this));this.$container.find('.collection-edit-form').submit(this.collectionSubmitEdit.bind(this));this.$container.find('.collection-make-default').click(this.collectionMakeDefault.bind(this));this.$container.find('.collection-toggle-delete').click(this.collectionToggleDelete.bind(this));this.$container.find('.collection-delete-form').submit(this.collectionSubmitDelete.bind(this));this.$container.find('.collection-toggle-move').click(this.collectionToggleMove.bind(this));this.$container.find('.collection-move-form').submit(this.collectionSubmitMove.bind(this));this.$container.find('.remove-like').click(p.View.User.CommentLikes.remove.bind(this));},report:function(){let that=this;p.mainView.showOverlay(p.View.Overlay.Report,{userId:that.data.user.id});},collectionMakeDefault:function(ev){var id=$(ev.currentTarget).data('id');p.api.post('collections.default',{collectionId:id},function(){this.load();}.bind(this));},collectionToggleEdit:function(ev){var targetSelector=$(ev.currentTarget).data('target');var form=$(targetSelector);if(form.is(':visible')){form.slideUp(CONFIG.ANIMATION_TIME);}
else{this.$container.find('collection-edit-form:visible').slideUp(CONFIG.ANIMATION_TIME);form.slideDown(CONFIG.ANIMATION_TIME);form.find('input[name=name]').select();}},collectionSubmitEdit:function(ev){p.api.post('collections.edit',ev.currentTarget,this.collectionEditResponse.bind(this));$(ev.currentTarget).find('input[type=submit]').prop('disabled',true);this.showLoader();return false;},collectionToggleDelete:function(ev){this.$container.find('.collection-edit-form:visible').slideUp(CONFIG.ANIMATION_TIME);var targetSelector=$(ev.currentTarget).data('target');var form=$(targetSelector);if(form.is(':visible')){form.slideUp(CONFIG.ANIMATION_TIME);}
else{form.slideDown(CONFIG.ANIMATION_TIME);}},collectionSubmitDelete:function(ev){p.api.post('collections.delete',ev.currentTarget,this.collectionEditResponse.bind(this));$(ev.currentTarget).find('input[type=submit]').prop('disabled',true);this.showLoader();return false;},collectionToggleMove:function(ev){this.$container.find('.collection-edit-form:visible').slideUp(CONFIG.ANIMATION_TIME);this.initTagInputs();const targetSelector=$(ev.currentTarget).data('target');const form=$(targetSelector);if(form.is(':visible')){form.slideUp(CONFIG.ANIMATION_TIME);}
else{form.slideDown(CONFIG.ANIMATION_TIME);}
this.$container.find('input[name=move]').change((ev)=>{const move=ev.currentTarget.value==="1";let submit=form.find(':submit')[0];submit.value=(move)?"Verschieben":"Kopieren";});},collectionSubmitMove:function(ev){const formdata=$(ev.currentTarget).serializeArray();let move=formdata.find((c)=>c.name==="move").value==="1";const endpoint=`collections.${(move)?'move':'copy'}`;p.api.post(endpoint,ev.currentTarget,this.collectionEditResponse.bind(this));$(ev.currentTarget).find('input[type=submit]').prop('disabled',true);this.showLoader();return false;},collectionEditResponse:function(response){if(response.error){var errorMessage='Unbekannter Fehler';if(response.error==='nameInvalid'){errorMessage='Bezeichnung ungültig oder zu Lang';}
else if(response.error==='collectionNotFound'){errorMessage='Sammlung nicht gefunden';}
p.mainView.showOverlay(p.View.Overlay.Error,{code:'Fehler',msg:errorMessage});this.$container.find('input[type=submit]').prop('disabled',false);}
else{p.User.COLLECTIONS_CACHE=null;this.load();}},initTagInputs:function(){if(this.data.tagsInitialized)return;let tags=this.$container.find('.collection-move-tagsinput');let taglimit=this.$container.find('.warn-taglimit');let options=CONFIG.TAGS_INPUT_SETTINGS;options.onAddTag=function(elem){if($('.tag').length>10){$(this).removeTag(elem);taglimit.show();}else{taglimit.hide();}};let tagInput=tags.tagsInput(options);let that=this;p.api.get('tags.top',{},function(response){this.$container.find('.tagsinput input').autocomplete({minLength:3,delay:200,autoFocus:false,source:response.tags,select:function(event,ui){tagInput.addTag(ui.item.value);ui.item.value=null;that.$container.find('.ui-autocomplete-input').focus();}});that.data.tagsInitialized=true;}.bind(this));},resize:function(){if(this.data.user){this.render();}
this.parent()},follow:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.follow',{name:this.data.user.name});this.data.following=true;this.render();if(!p.user.paid){$('.follow-non-paid').show();}
p.user.voteCache.votes.users[this.data.user.id]=1;},unfollow:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.unfollow',{name:this.data.user.name});this.data.following=false;this.data.subscribed=false;this.render();delete p.user.voteCache.votes.users[this.data.user.id];},subscribe:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.subscribe',{name:this.data.user.name});this.data.subscribed=true;this.render();if(!p.user.paid){$('.follow-non-paid').show();}
p.user.voteCache.votes.users[this.data.user.id]=2;},unsubscribe:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.unsubscribe',{name:this.data.user.name});this.data.subscribed=false;this.render();p.user.voteCache.votes.users[this.data.user.id]=1;},block:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.block',{name:this.data.user.name});this.data.blocked=true;this.data.following=false;this.data.subscribed=false;this.render();if(!p.user.paid){$('.block-non-paid').show();}},unblock:function(){if(!p.mainView.requireLogin()){return false;}
p.api.post('profile.unblock',{name:this.data.user.name});this.data.blocked=false;this.render();},loaded:function(response){this.title="Profil von "+response.user.name;this.data.user=response.user;this.data.user.registered=new Date(this.data.user.registered*1000);if(this.data.user.bannedUntil){this.data.user.bannedUntil=new Date(this.data.user.bannedUntil*1000);}
this.data.comments=response.comments;for(var i=0;i<this.data.comments.length;i++){var c=this.data.comments[i];c.date=new Date(c.created*1000);c.thumb=CONFIG.PATH.THUMBS+c.thumb;c.score=c.up-c.down;}
this.data.newestCommentTime=this.data.comments.length?this.data.comments.first().created+1:0;this.data.comments_likes=response.comments_likes;for(var i=0;i<this.data.comments_likes.length;i++){var c=this.data.comments_likes[i];c.date=new Date(c.ccreated*1000);c.thumb=CONFIG.PATH.THUMBS+c.thumb;c.score=c.up-c.down;}
this.data.newestCommentLikesTime=this.data.comments_likes.length?this.data.comments_likes.first().created+1:0;this.data.uploads=response.uploads;for(var i=0;i<this.data.uploads.length;i++){this.data.uploads[i].thumb=CONFIG.PATH.THUMBS+this.data.uploads[i].thumb;}
this.data.collections=response.collections;for(var i=0;i<this.data.collections.length;i++){var collection=this.data.collections[i];for(var j=0;j<collection.items.length;j++){collection.items[j].thumb=CONFIG.PATH.THUMBS+collection.items[j].thumb;}}
this.data.badges=response.badges;for(var i=0;i<this.data.badges.length;i++){this.data.badges[i].created=new Date(this.data.badges[i].created*1000);}
this.data.followCount=response.followCount;this.data.dynamicBadges=[];if(this.data.user.commentDelete>0)
{var badge=p.copy(p.View.User.BADGE.COMMENTDELETE.TEMPLATE);badge.description=badge.description.replace(/%c/g,this.data.user.commentDelete);if(this.data.user.commentDelete==1)badge.description=badge.description.replace(/%k/g,'eigenen Kommentar');else badge.description=badge.description.replace(/%k/g,'eigene Kommentare');badge.extra='';this.data.dynamicBadges.push(badge);}
if(this.data.user.itemDelete>0)
{var badge=p.copy(p.View.User.BADGE.ITEMDELETE.TEMPLATE);badge.description=badge.description.replace(/%c/g,this.data.user.itemDelete);if(this.data.user.itemDelete==1)badge.description=badge.description.replace(/%k/g,'eigenen Hochlad');else badge.description=badge.description.replace(/%k/g,'eigene Hochlads');badge.extra='';this.data.dynamicBadges.push(badge);}
if(response.commentCount>=1000){let count=(response.commentCount<1000000)?`${response.commentCount/1000|0}k`:"1m";let badge=p.copy(p.View.User.BADGE.COMMENTS.TEMPLATE);badge.description=badge.description.replace(/%c/g,count);badge.extra=count;this.data.dynamicBadges.push(badge);}
if(response.tagCount>=1000){let count=(response.tagCount<1000000)?`${response.tagCount/1000|0}k`:"1m";let badge=p.copy(p.View.User.BADGE.TAGS.TEMPLATE);badge.description=badge.description.replace(/%c/g,count);badge.extra=count;this.data.dynamicBadges.push(badge);}
var years=Math.floor((Date.now()-this.data.user.registered.getTime())/(365*24*60*60*1000));if(years>0){var badge=p.copy(p.View.User.BADGE.YEARS.TEMPLATE);badge.description=badge.description.replace(/%y/g,'Jahr'.inflect(years));badge.link='#user/'+response.user.name;badge.extra=years.toString();this.data.dynamicBadges.push(badge);}
this.data.commentCount=response.commentCount;this.data.tagCount=response.tagCount;this.data.uploadCount=response.uploadCount;this.data.likesArePublic=response.likesArePublic;this.data.collectedCount=response.collectedCount;this.data.following=response.following;this.data.subscribed=response.subscribed;this.data.blocked=response.blocked;this.render();}});p.View.User.BADGE={COMMENTS:{TEMPLATE:{name:'comments',image:'comments.svg',link:'',description:'Hat mehr als %c Kommentare verfasst',extra:'0',type:'svg',height:27},},TAGS:{TEMPLATE:{name:'tags',image:'tags.svg',link:'',description:'Hat mehr als %c Tags gesetzt.',extra:'0',type:'svg',height:27},},YEARS:{TEMPLATE:{name:'years',image:'years.png',link:'',description:'Hat %y auf pr0gramm verschwendet',extra:'1',type:'png',height:null},},COMMENTDELETE:{TEMPLATE:{name:'commentDelete',image:'commentdelete.svg',link:'',description:'Hat %c %k löschen lassen',extra:'',type:'svg',height:30},},ITEMDELETE:{TEMPLATE:{name:'itemDelete',image:'itemdelete.svg',link:'',description:'Hat %c %k löschen lassen',extra:'',type:'svg',height:27},}};p.View.User.Comments=p.View.Base.extend({title:"Kommentare",template:'<h1 class="pane-head user-head"> Kommentare von <a href="#user/{user.name}">{user.name}</a> </h1> <?js if( p.user.id ) {?> <div class="pane"> <?js for( var i = 0; i < comments.length; i++ ) { var c = comments[i]; ?> <div class="comment with-thumb"> <a href="#new/{c.itemId}:comment{c.id}"> <img src="{c.thumb}" class="comment-thumb"/> </a> <div class="comment-content with-thumb"> {c.content.format()} </div> <div class="comment-foot with-thumb"> <a href="#user/{user.name}" class="user um{user.mark}">{user.name}</a> <?js if( p.shouldShowScore(c) ) {?> <span class="score" title="{c.up} up, {c.down} down">{"Punkt".inflect(c.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{c.itemId}:comment{c.id}" class="time permalink" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</a> </div> </div> <?js } ?> <div class="inbox-nav-bar"> <?js if( after ) { ?> <a href="#user/{user.name}/comments/after/{after}" class="inbox-nav newer">« Neuer</a> <?js } ?> <?js if( before ) { ?> <a href="#user/{user.name}/comments/before/{before}" class="inbox-nav older">Älter »</a> <?js } ?> </div> <?js if( !comments.length) {?> <span class="disabled">Keine Kommentare gefunden</span> <?js } ?> </div> <?js } else { ?> <div class="pane"> <span class="disabled">Kommentare nur für registrierte Benutzer sichtbar</span> </div> <?js } ?>',init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);},load:function(){var opts={name:this.data.params.name,flags:p.user.flags};opts[this.data.params.search]=this.data.params.timestamp;p.api.get('profile.comments',opts,this.loaded.bind(this));return false;},loaded:function(response){this.title="Kommentare von "+response.user.name;this.data.user=response.user;this.data.comments=response.comments;this.data.comments.sort(function(a,b){return(b.created-a.created);})
this.data.after=response.hasNewer?this.data.comments.first().created:null;this.data.before=response.hasOlder?this.data.comments.last().created:null;for(var i=0;i<this.data.comments.length;i++){var c=this.data.comments[i];c.date=new Date(c.created*1000);c.thumb=CONFIG.PATH.THUMBS+c.thumb;c.score=c.up-c.down;}
this.render();}});p.View.User.CommentLikes=p.View.Base.extend({title:"Kommentar-Favoriten",template:'<h1 class="pane-head user-head"> Kommentar-Favoriten von <a href="#user/{user.name}">{user.name}</a> </h1> <div class="pane"> <?js if( likesArePublic && comments.length ) { ?> <?js for( var i = 0; i < comments.length; i++ ) { var c = comments[i]; ?> <div class="comment with-thumb"> <a href="#new/{c.itemId}:comment{c.id}"> <img src="{c.thumb}" class="comment-thumb"/> </a> <div class="comment-content with-thumb"> {c.content.format()} </div> <div class="comment-foot with-thumb"> <a href="#user/{c.name}" class="user um{c.mark}">{c.name}</a> <?js if( p.shouldShowScore(c) ) {?> <span class="score" title="{c.up} up, {c.down} down">{"Punkt".inflect(c.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{c.itemId}:comment{c.id}" class="time permalink" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</a> <?js if ( user.name === p.user.name ) { ?> [<a class="remove-like" data-comment="{c.id}" data-up="{c.up}" data-down="{c.down}">entfernen</a>] <?js } ?> </div> </div> <?js } ?> <div class="inbox-nav-bar"> <?js if( after ) { ?> <a href="#user/{user.name}/comments/likes/after/{after}" class="inbox-nav newer">« Neuer</a> <?js } ?> <?js if( before ) { ?> <a href="#user/{user.name}/comments/likes/before/{before}" class="inbox-nav older">Älter »</a> <?js } ?> </div> <?js } ?> <?js if(!likesArePublic) { ?> <span class="disabled">Nicht öffentlich</span> <?js } else if( !comments.length) { ?> <span class="disabled">Bisher keine Favoriten</span> <?js } ?> </div>',init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);},load:function(){var opts={name:this.data.params.name,flags:p.user.flags};opts[this.data.params.search]=this.data.params.timestamp;p.api.get('profile.commentlikes',opts,this.loaded.bind(this));return false;},loaded:function(response){this.title="Kommentar-Favoriten von "+response.user.name;this.data.user=response.user;this.data.comments=response.comments;this.data.likesArePublic=response.likesArePublic;this.data.comments.sort(function(a,b){return(b.created-a.created);})
this.data.after=response.hasNewer?this.data.comments.first().created:null;this.data.before=response.hasOlder?this.data.comments.last().created:null;for(var i=0;i<this.data.comments.length;i++){var c=this.data.comments[i];c.date=new Date(c.ccreated*1000);c.thumb=CONFIG.PATH.THUMBS+c.thumb;c.score=c.up-c.down;}
this.render();},render:function(){this.parent();this.$container.find('.remove-like').click(p.View.User.CommentLikes.remove.bind(this));}});p.View.User.CommentLikes.remove=function(ev){let data=ev.target.dataset;var c={id:data.comment,vote:0,up:data.up,down:data.down};p.adjustVote(c,0,p.user.voteCache.votes.commentFavs);p.api.post('comments.unfav',{id:data.comment},()=>{ev.target.parentNode.parentNode.remove(ev.target.parentNode);});}
p.View.InboxTabs=p.View.Base.extend({template:'<h1 class="pane-head">Nachrichten</h1> <div class="tab-bar"> <a href="#inbox/all" <?js if(active===\'all\') { ?>class="active"<?js }?> > Alle </a> <a href="#inbox/comments" <?js if(active===\'comments\') { ?>class="active"<?js }?> > Kommentare <?js if (p.user.inbox.comments || p.user.inbox.mentions) { ?> <span class="unread-count"><?js print(p.user.inbox.comments + p.user.inbox.mentions)?></span> <?js } ?> </a> <a href="#inbox/notifications"<?js if(active===\'notifications\') { ?>class="active"<?js }?> > Systembenachrichtigungen <?js if (p.user.inbox.notifications) { ?> <span class="unread-count">{p.user.inbox.notifications}</span> <?js } ?> </a> <a href="#inbox/follows"<?js if(active===\'follows\') { ?>class="active"<?js }?> > Stelz-Abos <?js if (p.user.inbox.follows) { ?> <span class="unread-count">{p.user.inbox.follows}</span> <?js } ?> </a> <a href="#inbox/messages"<?js if(active===\'messages\') { ?>class="active"<?js }?> > Private Nachrichten <?js if (p.user.inbox.messages) { ?> <span class="unread-count">{p.user.inbox.messages}</span> <?js } ?> </a> <a href="#inbox/blocklist"<?js if(active===\'blocklist\') { ?>class="active"<?js }?> > Blockierungen </a> </div> ',requiresLogin:true,data:{active:null},init:function(container,parent,activeTab){this.parent(container,parent);this.data.active=activeTab;}});p.View.InboxGeneric=p.View.Base.extend({title:"Nachrichten",template:'<div id="inbox-tabs"></div> <div class="pane"> <form class="comment-form" method="post"> <textarea minlength="3" class="comment" name="comment"></textarea> <input type="hidden" name="parentId" value=""/> <input type="hidden" name="itemId" value=""/> <input type="hidden" name="recipientId" value=""/> <div> <input type="submit" value="Abschicken"/> <input type="button" value="Abbrechen" class="cancel"/> </div> </form> <?js if(messages.length === 0) { ?> <em>Keine {itemName} :(</em> <?js } else { ?> <div class="inbox-messages"></div> <?js } ?> </div>',requiresLogin:true,data:{messages:[],itemName:'Nachrichten',active:'none'},init:function(container,parent){this.parent(container,parent);this.scrollBound=this.onscroll.bind(this);$(window).scroll(this.scrollBound);p.mainView.setTab(null);},show:function(params){if(!p.user.id){p.navigateTo('');return false;}
this.endReached=false;this.loadInProgress=false;this.tab=params.tab;return this.parent(params);},hide:function(){$(window).unbind('scroll',this.scrollBound);this.parent();},onscroll:function(){if(this.loadInProgress||this.endReached){return;}
if($(document).scrollTop()>this.loadingTargetPosition){this.loadInProgress=true;this.showLoader();p.api.get('inbox.'+this.tab,{older:this.oldestTimestamp},function(response){var messages=this.processMessages(response.messages);if(messages.length){this.appendMessages(messages);}
this.hideLoader();}.bind(this));}},load:function(){p.api.get('inbox.'+this.tab,{},function(response){this.data.messages=this.processMessages(response.messages);if(this.tab==='comments'||this.tab==='all'){p.user.inbox.comments=0;p.user.inbox.mentions=0;this.data.itemName='Kommentare';}
if(this.tab==='notifications'||this.tab==='all'){p.user.inbox.notifications=0;this.data.itemName='Systembenachrichtigungen';}
if(this.tab==='follows'||this.tab==='all'){p.user.inbox.follows=0;this.data.itemName='Stelz-Abos';}
if(this.tab==='all'){p.user.inbox.messages=0;this.data.itemName='Nachrichten';}
p.user.setInboxLink(p.user.inbox);this.render();}.bind(this));return false;},render:function(){this.parent();var tabContainer=this.$container.find('#inbox-tabs');var view=new p.View.InboxTabs(tabContainer,this,this.tab);view.show();this.$commentForm=this.$container.find('.comment-form');this.$commentForm.hide();this.$commentForm.submit(this.submitComment.bind(this));this.$commentForm.find('input.cancel').hide().click(this.cancelComment.bind(this));if(this.data.messages.length){this.appendMessages(this.data.messages);}},processMessages:function(messages){messages.sort(p.View.InboxGeneric.sortByCreated);for(var i=0;i<messages.length;i++){var m=messages[i];m.date=new Date(m.created*1000);m.thumb=CONFIG.PATH.THUMBS+m.thumb;}
if(messages.length){this.oldestTimestamp=messages.last().created;this.endReached=(messages.length<CONFIG.INBOX_ENTRIES_PER_PAGE);}
else{this.endReached=true;}
return messages;},appendMessages:function(messages){var messagesContainer=$('<div/>');this.$container.find('.inbox-messages').append(messagesContainer);var view=new p.View.InboxGeneric.Comments(messagesContainer,this,messages);view.show();messagesContainer.find('.comment-reply-link').click(this.showCommentForm.bind(this));messagesContainer.find('.block').click((ev)=>{const name=ev.currentTarget.dataset.name;p.api.post('profile.block',{name:name},()=>{p.reload();},(err)=>p.mainView.showOverlay(p.View.Overlay.Error,err.responseJSON));});messagesContainer.find('.unblock').click((ev)=>{const name=ev.currentTarget.dataset.name;p.api.post('profile.unblock',{name:name},()=>{p.reload();},(err)=>p.mainView.showOverlay(p.View.Overlay.Error,err.responseJSON));});this.loadingTargetPosition=$('#main-view').height()-window.innerHeight-500;this.loadInProgress=false;},showCommentForm:function(ev){if(!p.mainView.requireLogin()){return false;}
var $foot=$(ev.currentTarget.parentNode);if($foot.has('.comment-form').length){return false;}
var $form=this.$commentForm.clone(true).show();var parentId=ev.currentTarget.href.split(':comment')[1];var itemId=$foot.data('itemid');$form.find('input[name=parentId]').val(parentId);$form.find('input[name=itemId]').val(itemId);$form.find('input.cancel').show();$foot.append($form);this.focus('textarea');return false;},cancelComment:function(ev){$(ev.currentTarget).parents('form').remove();},submitComment:function(ev){if(!p.mainView.requireLogin()){return false;}
var $form=$(ev.currentTarget);var data=$form.serialize();$form.find('input,textarea,button,select').attr('disabled','disabled');var onerror=function(response){$form.find('input,textarea,button,select').removeAttr('disabled');};p.api.post('comments.post',data,function(item){if(item.commentId){p.user.voteCache.votes.comments[item.commentId]=1;}
$form.html('<span>Gesendet!</span>')},onerror);return false;}});p.View.InboxGeneric.sortByCreated=function(a,b){return(b.created-a.created);};p.View.InboxGeneric.Comments=p.View.Base.extend({template:'<?js for( let i = 0; i < messages.length; i++ ) { let m = messages[i]; let flag = m.flags & p.user.flags; ?> <?js if (m.type === \'follows\') {?> <div class="comment with-thumb" id="comment{m.id}"> <a href="#new/{m.itemId}"> <?js if (flag === 0) { ?> <div class="flag-container"> <img src="{m.thumb}" class="comment-thumb"/> <div class="flag flag-{m.flags}"> <?js if (m.flags === 1) { ?>SFW<?js }?> <?js if (m.flags === 2) { ?>NSFW<?js }?> <?js if (m.flags === 4) { ?>NSFL<?js }?> <?js if (m.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <img src="{m.thumb}" class="comment-thumb"/> <?js } ?> </a> <div class="comment-content with-thumb"> Neuer Hochlad </div> <div class="comment-foot with-thumb" data-itemid="{m.itemId}"> Neuer Hochlad von <a href="#user/{m.name}" class="user um{m.mark}">{m.name}</a> <?js if( p.shouldShowScore(m) ) {?> <span class="score">{"Punkt".inflect(m.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{m.itemId}" class="time permalink" title="{m.date.readableTime()}"> {m.date.relativeTime(true)} </a> </div> </div> <?js } else if (m.type === \'message\' ) {?> <div class="comment with-thumb"> <div class="comment-content with-thumb"> {m.message.format()} </div> <div class="comment-foot with-thumb"> Private Nachricht von <a href="#user/{m.name}" class="user um{m.mark}">{m.name}</a> <span class="time permalink" title="{m.date.readableTime()}"> {m.date.relativeTime(true)} </span> <a href="#inbox/messages/{m.name}"> &nbsp;zur Unterhaltung » </a> </div> </div> <?js } else if (m.type === \'notification\' ) {?> <div class="comment with-thumb"> <div class="comment-content with-thumb"> {m.message.format()} </div> <div class="comment-foot with-thumb"> Systembenachrichtigung <span class="time permalink" title="{m.date.readableTime()}"> {m.date.relativeTime(true)} </span> </div> </div> <?js } else if (m.type === \'comment\' ) {?> <div class="comment with-thumb" id="comment{m.id}"> <a href="#new/{m.itemId}:comment{m.id}?ts={m.date.unix()}"> <?js if (flag === 0) { ?> <div class="flag-container"> <img src="{m.thumb}" class="comment-thumb"/> <div class="flag flag-{m.flags}"> <?js if (m.flags === 1) { ?>SFW<?js }?> <?js if (m.flags === 2) { ?>NSFW<?js }?> <?js if (m.flags === 4) { ?>NSFL<?js }?> <?js if (m.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <img src="{m.thumb}" class="comment-thumb"/> <?js } ?> </a> <div class="comment-content with-thumb"> <?js if (m.blocked) { ?> <div class="warn" style="background: #2a2e31;padding: 5px; margin-bottom: 5px;"> Aktive Blockierungen sind nur mit <a href="/pr0mium">pr0mium</a> wirksam. </div> <?js } ?> {m.message.format()} </div> <div class="comment-foot with-thumb" data-itemid="{m.itemId}"> Kommentar von <a href="#user/{m.name}" class="user um{m.mark}">{m.name}</a> <?js if( p.shouldShowScore(m) ) {?> <span class="score">{"Punkt".inflect(m.score)}</span> <?js } else { ?> <span class="score-hidden" title="Score noch unsichtbar">●●●</span> <?js } ?> <a href="#new/{m.itemId}:comment{m.id}?ts={m.date.unix()}" class="time permalink" title="{m.date.readableTime()}"> {m.date.relativeTime(true)} </a> <a href="#new/{m.itemId}:comment{m.id}?ts={m.date.unix()}" class="comment-reply-link action"> <span class="pict">r</span> antworten </a> <?js if (!m.blocked) { ?> <span id="action-block"> [<span class="action block" data-name="{m.name}">blockieren</span>] </span> <?js } else { ?> <span id="action-unblock"> [<span class="action unblock" data-name="{m.name}">Blockierung aufheben</span>] </span> <?js } ?> </div> </div> <?js } ?> <?js } ?>',data:{messages:[]},init:function(container,parent,messages){this.parent(container,parent);this.data.messages=messages;}});p.View.InboxMessages=p.View.Base.extend({title:"Private Nachrichten",template:'<div id="inbox-tabs"></div> <div class="pane"> <?js if (!hasConversations && !params.with) { ?> <em>Keine Nachrichten :(</em> <?js } else { ?> <div class="conversations-pane"></div> <div class="private-messages"> <div id="user-blocked-none-paid" class="warn" style="display: none; background: #2a2e31;padding: 5px; margin-bottom: 5px; margin-left: 25px;" > Aktive Blockierungen sind nur mit <a href="/pr0mium">pr0mium</a> wirksam. </div> <div id="user-blocked" style="display: none; text-align: center;"> <h3 class="warn">USER BLOCKIERT</h3> <span class="action unblock">Blockierung aufheben</span> </div> <form class="private-message-form" style="display: none;" method="post"> <p> Unterhaltung mit <a class="user" id="private-messages-current-user" href="/user/">…</a> <span style="float: right; display: none" id="action-block"> [<span class="action block" data-name="">blockieren</span>] </span> <span style="float: right; display: none" id="action-unblock"> [<span class="action unblock" data-name="">Blockierung aufheben</span>] </span> </p> <textarea class="private-message" name="comment" required placeholder="Nachricht schreiben…" title="Nachricht schreiben"></textarea> <input type="hidden" name="recipientName" value=""/> <div> <input type="submit" value="Abschicken"/> </div> </form> <div class="inbox-messages"></div> </div> <?js } ?> </div> ',requiresLogin:true,currentUserName:null,endReached:false,conversationsEndReached:false,allConversations:{},data:{messages:[]},init:function(container,parent){this.parent(container,parent);this.scrollBound=this.onscroll.bind(this);$(window).scroll(this.scrollBound);p.mainView.setTab(null);},show:function(params){if(!p.user.id){p.navigateTo('');return false;}
this.endReached=false;this.loadInProgress=false;this.currentUserName=null;this.allConversations={};return this.parent(params);},hide:function(){$(window).unbind('scroll',this.scrollBound);this.parent();},onscroll:function(){if(this.loadInProgress||this.endReached){return;}
if($(document).scrollTop()>this.loadingTargetPosition){this.loadInProgress=true;this.showLoader();p.api.get('inbox.messages',{older:this.oldestTimestamp,with:this.currentUserName},function(response){this.endReached=response.atEnd;var messages=this.processMessages(response.messages);if(messages.length){this.appendMessages(messages);}
this.hideLoader();}.bind(this));}},load:function(){p.api.get('inbox.conversations',{},function(response){this.data.conversationsEndReached=response.atEnd;this.data.hasConversations=response.conversations.length>0;this.render();var conversations=this.processConversations(response.conversations);if(conversations.length){this.appendConversations(conversations,this.data.params.with);}
if(this.data.params.with){this.loadMessages(this.data.params.with);}
else{var tab=this.$container.find('.conversation-tab .unread-count:visible').parent().first();if(!tab.length){tab=this.$container.find('.conversation-tab').first().click();}
if(tab.length){tab.addClass('active');var name=tab.data('name');p.replaceState('inbox/messages/'+name);this.loadMessages(name);}}}.bind(this));return false;},loadMessages:function(name){if(name===this.currentUserName){return;}
this.currentUserName=name;this.$container.find('input[name=recipientName]').val(name);this.$container.find('.inbox-messages').empty();this.$container.find('textarea').attr('placeholder','Nachricht an '+name+" schreiben").val('').focus();this.$container.find('input,textarea,button,select').attr('disabled','disabled');$(document).scrollTop(0);var conversationTab=this.$container.find('.conversation-tab.active');this.showLoader();p.api.get('inbox.messages',{with:this.currentUserName},function(response){this.$container.find('#private-messages-current-user').attr('href','/user/'+response.with.name).text(response.with.name).removeClass().addClass('user').addClass('um'+response.with.mark);this.$container.find('.private-message-form').toggle(!response.with.blocked);this.$container.find('#user-blocked-none-paid').toggle(!p.user.paid&&response.with.blocked);this.$container.find('#user-blocked').toggle(response.with.blocked);this.$container.find('#action-block').toggle(!response.with.blocked);this.$container.find('#action-unblock').toggle(response.with.blocked);this.$container.find('.unblock').click(()=>{p.api.post('profile.unblock',{name:this.currentUserName},()=>{p.reload();},(err)=>p.mainView.showOverlay(p.View.Overlay.Error,err.responseJSON));});this.$container.find('.block').click((ev)=>{p.api.post('profile.block',{name:this.currentUserName},()=>{p.reload();},(err)=>p.mainView.showOverlay(p.View.Overlay.Error,err.responseJSON));});this.$container.find('input,textarea,button,select').removeAttr('disabled');this.endReached=response.atEnd;const messages=this.processMessages(response.messages);if(messages.length){this.appendMessages(messages);}
else{this.insertNewConversation(this.currentUserName,response.with.mark)}
this.hideLoader();this.markAsRead(conversationTab);}.bind(this));},insertNewConversation:function(name,mark){if(this.allConversations[name]){return;}
this.allConversations[name]=true;var conversationsContainer=$('<div/>');this.$container.find('.conversations-pane').prepend(conversationsContainer);var conversations=[{name:name,mark:mark,date:null,unreadCount:0}];var view=new p.View.InboxMessages.Conversations(conversationsContainer,this,conversations);view.data.hideLoadMore=true;view.show({with:name});conversationsContainer.find('a.conversation-tab').click(this.handleConversationTabClick.bind(this));},markAsRead:function(tab){var unreadCount=tab.find('.unread-count:visible');if(unreadCount.length){var count=parseInt(unreadCount.text());p.user.inbox.messages=Math.max(0,p.user.inbox.messages-count);p.user.setInboxLink(p.user.inbox);setTimeout(function(){unreadCount.fadeOut(CONFIG.ANIMATION_TIME);},2000);}},render:function(){this.parent();var tabContainer=this.$container.find('#inbox-tabs');var view=new p.View.InboxTabs(tabContainer,this,'messages');view.show();this.$messageForm=this.$container.find('.private-message-form');this.$messageForm.submit(this.submitMessage.bind(this));},handleLoadOlderConversationsClick:function(ev){var el=this.$container.find('#load-older-conversations');var older=el.data('older');el.remove();this.showLoader();p.api.get('inbox.conversations',{older:older},function(response){this.hideLoader();this.data.conversationsEndReached=response.atEnd;var conversations=this.processConversations(response.conversations);if(conversations.length){this.appendConversations(conversations);}}.bind(this));},handleConversationTabClick:function(ev){if(!p.isNormalClick(ev)){return true;}
this.$container.find('.conversation-tab.active').removeClass('active');$(ev.currentTarget).addClass('active');ev.preventDefault();this.loadMessages($(ev.currentTarget).data('name'));this.handleHashLink(ev);return false;},processConversations:function(conversations){conversations=conversations.sort(p.View.InboxMessages.sortByLastMessage);conversations=conversations.filter(function(el){if(this.allConversations[el.name]){return false;}
else{this.allConversations[el.name]=true;return true;}}.bind(this));for(var i=0;i<conversations.length;i++){var c=conversations[i];c.date=new Date(c.lastMessage*1000);}
return conversations;},appendConversations:function(conversations,currentUserName){var conversationsContainer=$('<div/>');this.$container.find('.conversations-pane').append(conversationsContainer);var view=new p.View.InboxMessages.Conversations(conversationsContainer,this,conversations);view.show({with:currentUserName});var loadOlder=conversationsContainer.find('#load-older-conversations')
if(this.data.conversationsEndReached){loadOlder.remove();}
else{loadOlder.click(this.handleLoadOlderConversationsClick.bind(this));}
conversationsContainer.find('a.conversation-tab').click(this.handleConversationTabClick.bind(this));},processMessages:function(messages){messages.sort(p.View.InboxMessages.sortByCreated);for(var i=0;i<messages.length;i++){var m=messages[i];m.date=new Date(m.created*1000);}
if(messages.length){this.oldestTimestamp=messages.last().created;}
else{this.endReached=true;}
return messages;},appendMessages:function(messages){var messagesContainer=$('<div/>');this.$container.find('.inbox-messages').append(messagesContainer);var view=new p.View.InboxMessages.Messages(messagesContainer,this,messages);view.show();this.loadingTargetPosition=$('#main-view').height()-window.innerHeight-500;this.loadInProgress=false;},submitMessage:function(ev){if(!p.mainView.requireLogin()){return false;}
var $form=$(ev.currentTarget);var data=$form.serialize();$form.find('input,textarea,button,select').attr('disabled','disabled');var onerror=function(response){$form.find('input,textarea,button,select').removeAttr('disabled');};this.showLoader();var conversationTab=this.$container.find('.conversation-tab.active');p.api.post('inbox.post',data,function(response){this.hideLoader();if(response.success){conversationTab.find('.time').text('vor einem Moment');conversationTab.detach();this.$container.find('.conversations-pane div:first-child').prepend(conversationTab);this.$container.find('.inbox-messages').empty();this.$container.find('textarea').val('');this.$container.find('input,textarea,button,select').removeAttr('disabled');var messages=this.processMessages(response.messages);this.appendMessages(messages);}
else{onerror(response);}}.bind(this),onerror);return false;}});p.View.InboxMessages.sortByCreated=function(a,b){return(b.created-a.created);};p.View.InboxMessages.sortByLastMessage=function(a,b){return(b.lastMessage-a.lastMessage);};p.View.InboxMessages.Messages=p.View.Base.extend({template:'<?js for( var i = 0; i < messages.length; i++ ) { var m = messages[i]; ?> <div class="message-row <?js if (m.sent) {?>message-row-own<?js }?>"> <div class="message <?js if (m.sent) {?>message-own<?js }?>" id="message{m.id}"> <div class="comment-content"> {m.message.format()} </div> <div class="comment-foot message-foot"> <a href="#user/{m.name}" class="user um{m.mark}">{m.name}</a> <span class="time permalink" title="{m.date.readableTime()}">{m.date.relativeTime(true)}</span> </div> </div> </div> <?js } ?>',data:{messages:[]},init:function(container,parent,messages){this.parent(container,parent);this.data.messages=messages;}});p.View.InboxMessages.Conversations=p.View.Base.extend({template:'<?js for (var i = 0; i < conversations.length; i++) { var c = conversations[i]; ?> <a class="conversation-tab silent<?js if(params.with === c.name){?> active<?js }?>" href="/inbox/messages/{c.name}" data-name="{c.name}" > <span class="user um{c.mark}" title="{c.name}">{c.name.shorten(20)}</span> <?js if (c.unreadCount) {?> <span class="unread-count aside">{c.unreadCount}</span> <?js } ?> <br/> <?js if (c.date !== null) { ?> <div class="time unimportant" title="{c.date.readableTime()}">{c.date.relativeTime(true)}</div> <?js } else { ?> <div class="time unimportant">nie</div> <?js } ?> </a> <?js } ?> <?js if (!hideLoadMore) { ?> <span id="load-older-conversations" class="conversation-tab action" data-older="{conversations.last().lastMessage}" > Ältere laden… </span> <?js } ?>',data:{hideLoadMore:false,conversations:[]},init:function(container,parent,conversations){this.parent(container,parent);this.data.conversations=conversations;}});p.View.InboxBlockList=p.View.Base.extend({title:"Blockierungen",template:'<div id="inbox-tabs"></div> <?js if (blockedUsers.length === 0) { ?> <p>Du hast keine Benutzer blockiert.</p> <p>Blockiere einen Benutzer auf seiner Profilseite, um keine Benachrichtigungen mehr zu erhalten.</p> <?js } else if (p.user.paid) { ?> <p> Du bekommst von den hier aufgeführten Benutzern keine Benachrichtigungen mehr. </p> <?js } else { ?> <p> Mit einem <a href="/pr0mium">pr0mium-Account</a>, bekommst von den hier aufgeführten Benutzern keine Benachrichtigungen mehr. </p> <?js } ?> <div class="block-grid"> <?js for (let u of blockedUsers) { ?> <div> <a href="/user/{{u.name}}" class="user um{u.mark}" style="float: left">{{u.name}}</a> <span style="float: right" class="action unblock" data-name="{{u.name}}">Blockierung aufheben</span> </div> <?js } ?> </div> <style type="text/css"> .block-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr; grid-gap: 10px 10px; } .block-grid > div { background: #2a2e31; padding: 5px; } </style> ',requiresLogin:true,load:function(){p.api.get('user.blocklist',null,this.loaded.bind(this));},loaded:function(response){this.data=response;this.render();},render:function(){this.parent();const tabContainer=this.$container.find('#inbox-tabs');const view=new p.View.InboxTabs(tabContainer,this,'blocklist');view.show();this.$container.find('.unblock').click((ev)=>{let name=ev.currentTarget.dataset.name;p.api.post('profile.unblock',{name:name},()=>{this.data={};this.load();});});}});p.View.Validate=p.View.Base.extend({template:p.load('frontend/templates/validate.html',p.LOAD.LAZY),load:function(){p.api.post('user.validate',{token:this.data.params.token},this.loaded.bind(this));return false;},loaded:function(response){if(response.success){p.navigateTo('');p.reload();}
else{this.render();}}});p.View.ValidateInfo=p.View.Base.extend({template:'<div class="pane"> <h2>E-Mailvalidierung</h2> <p> Die Emailadresse ({email}) zu ihrem Account {name} wurde noch nicht bestätigt.<br> Siehe bitte auch im Spamordner nach der Bestätigugnsmail! </p> <p id="emailChange" style="display: none" class="warn"> Du hast eine andere E-Mailadresse angegeben, weshalb die Deines Accounts entsprechend geändert wird. </p> <p id="emailInvalid" style="display: none" class="warn"> Diese E-Mailadresse ist ungültig oder bereits vergeben! </p> <input class="text-line" type="email" name="mail" value="{email}" placeholder="E-Mailadresse"> <input id="resent" type="submit" value="Erneut senden"> oder <a href="/contact?category=account">Support kontaktieren</a> </div>',data:{email:"",name:""},load:function(){p.api.get('user.validateInfo',{name:this.data.params.name},this.loaded.bind(this));return false;},loaded:function(response){this.data.email=response.email;this.data.name=response.name;this.data.userId=response.userId;this.render();},render:function(){this.parent();document.querySelector('input[name=mail]').addEventListener('input',(ev)=>{this.data.email=ev.target.value;document.getElementById('emailChange').style.display=(ev.target.defaultValue!==ev.target.value)?"block":"none"});document.getElementById('resent').addEventListener('click',()=>{p.api.post('user.resendValidationMail',{userId:this.data.userId,email:this.data.email},this.submitted);});},submitted:function(response){let elem=document.querySelector('.pane');if(response.error){document.getElementById('emailInvalid').style.display="block";return false;}
elem.innerHTML="<h1>Danke!</h1><p>Wir haben Dir eine E-Mail an folgende Adresse geschickt: "+response.email+"</p><p>Bitte suche auch im Spam-Ordner nach der E-Mail!</p>"},});p.View.ResetPassword=p.View.Base.extend({title:"Passwort zurücksetzen",template:p.load('frontend/templates/reset-password.html',p.LOAD.LAZY),data:{submitted:false,error:null},render:function(){this.parent();this.$container.find('#reset-password').submit(this.setPassword.bind(this));},setPassword:function(ev){p.api.post('user.resetpassword',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){this.data.submitted=true;this.data.error=response.error;this.render();}});p.View.RegisterInvite=p.View.Base.extend({title:"Registrieren",template:p.load('frontend/templates/register-invite.html',p.LOAD.LAZY),data:{error:null,name:'',registered:false,inviter:null},load:function(){p.api.get('user.loadinvite',{token:this.data.params.token},this.loaded.bind(this));return false;},loaded:function(response){this.data.error=response.error;this.data.inviter=response.inviter;this.render();},render:function(){this.parent();this.$container.find('#register-form').submit(this.submit.bind(this));this.focus('input[name=name]');},submit:function(ev){if(!this.$container.find('input[name=tos]:checked').length){this.$container.find('#tos-row').highlight(252,136,52,1);return false;}
if(!this.$container.find('input[name=datasafety]:checked').length){this.$container.find('#datasafety-row').highlight(252,136,52,1);return false;}
this.data.name=this.$container.find('input[name=name]').val();this.data.error=null;p.api.post('user.joinwithinvite',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(response.error){this.data.error=response.error;this.render();return;}
p.user.loadCookie();window.location='/';}});p.View.RedeemCode=p.View.Base.extend({title:"pr0mium Code Einlösen",template:p.load('frontend/templates/redeem-code.html',p.LOAD.LAZY),data:{tokenError:null,error:null,name:'',email:'',inviter:null},load:function(){this.data.params.token=this.data.params.token||"";p.api.post('user.loadpaymenttoken',{token:this.data.params.token},this.loaded.bind(this));return false;},loaded:function(response){this.data.tokenError=response.tokenError;this.data.token=response.token;this.render();},render:function(){this.parent();this.$container.find('#redeem-form').submit(this.redeem.bind(this));this.$container.find('#redeem-form-manual').submit(this.settoken.bind(this));this.$container.find('#register-form').submit(this.register.bind(this));this.focus('input[name=name]');},settoken:function(ev){p.navigateTo('redeem/'+this.$container.find('input[name=token-manual]').val())
return false;},redeem:function(ev){this.data.error=null;if(!this.$container.find('input[name=datasafety]:checked').length){this.$container.find('#datasafety-row').highlight(252,136,52,1);return false;}
if(!this.$container.find('input[name=revocation]:checked').length){this.$container.find('#revocation-row').highlight(252,136,52,1);}
p.api.post('user.redeemtoken',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},register:function(ev){this.data.error=null;if(!this.$container.find('input[name=tos]:checked').length){this.$container.find('#tos-row').highlight(252,136,52,1);return false;}
if(!this.$container.find('input[name=datasafety]:checked').length){this.$container.find('#datasafety-row').highlight(252,136,52,1);return false;}
if(!this.$container.find('input[name=revocation]:checked').length){this.$container.find('#revocation-row').highlight(252,136,52,1);return false;}
if(this.$container.find('input[name=password]').val()!==this.$container.find('input[name=passwordRetype]').val()){this.data.error='passwordDontMatch';this.$container.find('input[name=passwordRetype]').highlight(252,136,52,1);}
this.data.name=this.$container.find('input[name=name]').val();this.data.email=this.$container.find('input[name=email]').val();if(!!this.data.error){this.render();}else{p.api.post('user.joinwithtoken',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();}
return false;},posted:function(response){if(response.error||response.tokenError){this.data.tokenError=response.tokenError;this.data.error=response.error;this.render();return;}
if(CONFIG.ANALYTICS.ENABLED&&window._paq){_paq.push(['trackGoal',1,18]);}
p.user.loadCookie();p.user.set('paid',true);window.location=(!!response.valid)?'/redeem/thanks':'/redeem/registered';}});p.View.RedeemThanks=p.View.Base.extend({title:"pr0mium Code Einlösen",template:p.load('frontend/templates/redeem-thanks.html',p.LOAD.LAZY)});p.View.RedeemRegistered=p.View.Base.extend({title:"pr0mium Code Einlösen",template:p.load('frontend/templates/redeem-registered.html',p.LOAD.LAZY)});p.View.Auth=p.View.Base.extend({title:"Auth",template:p.load('frontend/templates/auth.html',p.LOAD.LAZY),rulesView:null,filterView:null,data:{info:[],state:null},load:function(){if(!p.mainView.requireLogin()){return false;}
var $_GET={};document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g,function(){function decode(s){return decodeURIComponent(s.split("+").join(" "));}
$_GET[decode(arguments[1])]=decode(arguments[2]);});this.data.error=null;if(this.data.params.name){var opts={};$_GET["name"]=this.data.params.name;$_GET["state"]=this.data.params.state;opts.name=$_GET["name"];this.data.state=$_GET["state"];p.api.get('user.authclientinfo',opts,this.loaded.bind(this));this.data.get=$_GET;}
return false;},loaded:function(response){this.data.info=response.clientInfo;this.data.permissions=response.permissions;this.render();},render:function(){this.parent();this.$container.find('.auth-allow').click(this.allow.bind(this));this.$container.find('.auth-deny').click(this.deny.bind(this));this.$container.find('#logo').error(()=>{this.$container.find('.logo').hide();});},allow:function(){p.api.post('user.auth',{name:this.data.info.cleanName,state:this.data.state},this.allowed.bind(this));this.preventHide=true;return false;},deny:function(){window.location.replace(this.data.info.redirectUrl+'?error=denied');this.preventHide=true;return false;},allowed:function(response){if(response.error)
{this.data.error=response.error;this.render();}else{this.data.error=null;window.location.replace(this.data.info.redirectUrl+'?authCode='+response.authCode+'&userId='+response.userId+'&state='+response.state);}},});p.View.Changes=p.View.Base.extend({title:"Changelog",template:p.load('frontend/templates/changes.html',p.LOAD.LAZY),data:{changes:[]},load:function(){p.api.get('faq.changelog',null,this.loaded.bind(this));},loaded:function(response){this.data.changes=response.changes.map((val)=>({created:new Date(val.created*1000),text:val.text,title:val.title}));this.render();},render:function(){this.parent();},});p.View.Discord=p.View.Base.extend({title:"disc0rd",template:'<div class="pane"> <h1>disc0rd</h1> <?js if (!!revoke) { ?> <h3 class="warn">Dein Account wird getrennt!</h3> <?js } ?> <?js if (!!user) { ?> <div class="discordUser"> <?js if (!!user.avatar) { ?> <img src="https://cdn.discordapp.com/avatars/{user.id}/{user.avatar}.png"> <?js } else { ?> <img src="https://cdn.discordapp.com/embed/avatars/{user.avatarDiscriminator}.png"> <?js } ?> <p class="big">{{user.username}}#{{user.discriminator}}</p> <p> Dein Account ist verknüpft! <a class="action revoke">trennen</a> </p> </div> <?js } ?> <?js if (!!pending) { ?> <p class="warn">Bitte warte, bis der Serverbot deinen Beitritt verarbeitet hat!</p> <?js } else if (!user && !pending) { ?> <a class="action" rel="nofollow noreferrer" target="_self" id="discordOauth" href="https://discord.com/api/oauth2/authorize?client_id=487235276117245954&redirect_uri=https%3A%2F%2Fpr0gramm.com%2Fdiscord&state={:state:}&response_type=code&scope=identify%20guilds.join"> Mit Discord verknüpfen </a> <?js } ?> </div> <style> .discordUser { background: #2A2E31; min-height: 128px; } .discordUser p { padding: 5px; word-break: break-all; text-align: center; } .discordUser p.big { font-size: 2em; } .discordUser img { width: 129px; float: left; } </style> ',requiresLogin:true,data:{addGuildMember:null,state:'',user:null,pending:false,revoke:null},load:function(){const code=p.getQuery('code')||false;const state=p.getQuery('state')||false;if(code&&state){p.api.post('discord.auth',{code:code,state:state},this.loaded.bind(this));return;}
p.api.get('discord.user',{},this.loaded.bind(this));},loaded:function(res){this.data.state=res.state||'';this.data.addGuildMember=res.addGuildMember||null;this.data.user=res.user||null;this.data.pending=res.pending||null;this.data.revoke=res.revoke||null;if(!!this.data.user){this.data.user.avatarDiscriminator=this.data.user.discriminator%5;}
this.render();},render:function(){this.parent();this.$container.find('.revoke').click(()=>{p.api.get('discord.revoke',{},this.load.bind(this));});if(!this.data.user){document.getElementById('discordOauth').href=document.getElementById('discordOauth').href.replace('{:state:}',this.data.state);}}});p.View.Games=p.View.Games||{};p.View.Games.Casino=p.View.Base.extend({template:'<div class="pane casino" style="min-height: 100vh;"> <div class="grid-container"> <div class="info"> <div class="text"> <h1>CASIN0 PR0YALE</h1> <p> Willkommen im exklusiven CASIN0 PR0YALE!<br> Falls Du Dich bereits als wahrer Ehrenmann bei der diesjährigen Spendenaktion bewiesen hast, kannst Du Dein Können und Glück unter Beweis stellen. Ham du auch ma di glügg? </p> </div> <div class="budget"> <h3>Seriöse Wechselstube</h3> Aktuelles Guthaben: {user.credits} Credits <?js if (!!error && error === \'NOT_ENOUGH_SCORE\') { ?> <p class="warn">Dein Benis ist zu klein um ihn in Credits umzutauschen!</p> <?js } else { ?> <input type="range" name="searchScore" value="{value}" min="1" max="{user.score}" step="1" id="scoreRange"> <input type="number" name="searchScore" value="{value}" min="1" max="{user.score}" id="scoreInput"> <input type="submit" id="exchange" value="Benis Umtauschen"> <p class="fine-print"> 1 Benis ≙ 1.5 Credits (+ 5% Transaktionsgebühren) </p> <?js } ?> </div> </div> <div class="background"> <div class="roulette" id="game-roulette"> <img class="img" src="/media/games/14_roulette wheel.png"> Roulette </div> </div> <div class="background"> <div class="blackjack" id="game-blackjack"> <img class="img" src="/media/games/5_diamonds poker card.png"> Blackjack </div> </div> <div class="background"> <div class="slots" id="game-slots"> <img class="img" src="/media/games/24_slot machine.png"> Benitrator </div> </div> </div> <?js if (hooker) {?> <div class="game-hooker"> <img src="/media/games/stefi.gif" /> </div> <?js } ?> <div> <div class="pane game-big-wins-container" style="display:none"> <h2 class="section">Gewinnertypen</h2> <table id="game-big-wins"></table> </div> </div> </div> <style> .grid-container { display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1em 1em; grid-template-areas: "info info info" "slots roulette blackjack"; } .info { display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 0px 0px; grid-template-areas: "text budget budget" "text budget budget"; grid-area: info; } @media screen and (max-width: 600px) { .info { display: grid; grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; gap: 1em 0px; grid-template-areas: "text" "budget"; grid-area: info; } .grid-container { display: block; } .roulette, .blackjack, .slots { margin-top: 1em; } } .text { grid-area: text; } .change { grid-area: change; } .budget { grid-area: budget; text-align: center; } .roulette, .blackjack, .slots { cursor: pointer; background-color: #21212170; padding: 1em; min-height: 100%; font-size: xx-large; text-shadow: -2px 1px 0px rgb(77 101 76 / 98%); } .roulette { grid-area: roulette; } .blackjack { grid-area: blackjack; } .slots { grid-area: slots; } .budget { background: url(\'/media/games/13_gambling chip.png\'); background-position-y: center; background-size: 33%; background-position-x: 115%; background-repeat: no-repeat; position: relative; } .background { background: url(\'/media/games/RasterBluss.png\'); background-position-y: center; background-size: 130%; position: relative; } .background .img { position: absolute; width: 85px; right: 15px; bottom: 15px; } </style>',requiresLogin:true,data:{user:{score:0,credits:0},value:0,error:null},load:function(){p.api.get('casino.info',null,this.loaded.bind(this));},loaded:function(response){this.data.user.score=response.score;this.data.user.credits=Math.floor(response.credits);this.data.isUnlocked=response.activated;this.data.hooker=response.hooker;p.api.get('casino.winners',{},function(response){let rows=[];for(let w of response.winners){const time=new Date(w.created*1000);rows.push(`<tr class="game-win-row"><td><a href="/user/${w.name}"class="user um${w.mark}">${w.name}</a></td><td class="game-win">${Math.floor(w.amount)}&nbsp;Credits</td></tr>`)}
this.$container.find('.game-big-wins-container').show();this.$container.find('#game-big-wins').html(rows.join(''));}.bind(this));if(response.score<=0){this.data.error='NOT_ENOUGH_SCORE';}else{this.data.value=Math.round(response.score*0.4);}
this.render();},render:function(){this.parent();const scoreInput=document.getElementById('scoreInput');const scoreRange=document.getElementById('scoreRange');if(!!scoreRange){scoreRange.addEventListener('input',(ev)=>{scoreInput.value=ev.target.value;});}
if(!!scoreInput){scoreInput.addEventListener('input',(ev)=>{scoreRange.value=ev.target.value;});}
if(!!scoreInput&&!!scoreRange){document.getElementById('exchange').addEventListener('click',this.exchange.bind(this));}
document.getElementById('game-roulette').addEventListener('click',()=>p.navigateTo('casino/roulette',p.NAVIGATE.DEFAULT));document.getElementById('game-blackjack').addEventListener('click',()=>p.navigateTo('casino/blackjack',p.NAVIGATE.DEFAULT));document.getElementById('game-slots').addEventListener('click',()=>p.navigateTo('casino/slots',p.NAVIGATE.DEFAULT));},exchange:function(){p.api.post('casino.exchange',{amount:document.getElementById('scoreInput').value},()=>{window.location.reload(false);});},});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Hooker=p.View.Base.extend({name:'overlay-error',resetViewport:false,template:'<div class="overlay-content" style="min-height: 20vh; "> <h2>Angebot, jetzt zuschlagen!1!</h2> <img src="/media/games/1_bunny girl.png" style="position: absolute;bottom: 10px;right: 0;height: 190px;"/> <?js if (valid) { ?> <p style="width: 266px"> Ja, ich möchte "Stefi" im Casino für eine halbe Stunde an meiner Seite haben.<br> Dafür zahlen ich gerne den Crackfurter Straßenpreis für 1g Kokain in Höhe von 500 Credits. </p> <input id="getHooker" type="submit" value="Koks spendieren"> <input onclick="p.mainView.closeOverlay();" type="submit" style="background-color: #212121;" value="Angebot ablehnen"> <?js } else { ?> <p style="width: 266px"> Stefi ist für dich momentan nicht verfügbar.<br> Du hast entweder bereits Stefi an deiner Seite oder Stefi hat erkannt, dass du ihr nicht genug Credits bieten kannst. </p> <?js } ?> </div> ',data:{valid:false},init:function(container,parent,params){this.parent(container,parent);},load:function(){p.api.get('casino.hooker',null,this.loaded.bind(this));},loaded:function(response){this.data.valid=response.valid;this.render();},render:function(){this.parent();document.getElementById('getHooker').addEventListener('click',()=>{p.api.post('casino.hooker',{},this.posted.bind(this));});},posted:function(){this.$container.find('.overlay-content').text('Stefi steht nun an deiner Seite!');setTimeout(function(){p.mainView.closeOverlay();window.location.reload(false);},1000);},});var Button=function(x,y,w,h,img,callback,nodraw){this.x=x;this.y=y;this.w=w;this.h=h;this.img=img;this.active=false;this.callback=callback;this.nodraw=!!nodraw;};Button.prototype.update=function(ctx,mx,my){var m=20;this.active=(mx>=this.x+m&&mx<=this.x+this.w-m*2&&my>=this.y+m&&my<=this.y+this.h-m*2);if(this.active&&!this.nodraw){ctx.globalCompositeOperation='lighter';ctx.drawImage(this.img,this.x,this.y);ctx.globalCompositeOperation='source-over';}};Button.prototype.click=function(mx,my){var m=20;this.active=(mx>=this.x+m&&mx<=this.x+this.w-m*2&&my>=this.y+m&&my<=this.y+this.h-m*2);if(this.active){this.callback();return true;}
return false;};var Reel=function(img,numSymbols,symbolWidth,symbolHeight,elusiveSymbol){this.img=img;this.symbolWidth=symbolWidth;this.symbolHeight=symbolHeight;this.elusiveSymbol=elusiveSymbol;this.elusiveSymbolOverride=-1;this.slots=new Array(numSymbols*2);for(var i=0;i<this.slots.length;i++){this.slots[i]=i%numSymbols;}
this.arrayShuffle(this.slots);this.pos=0;this.acceleration=0;this.velocity=0;this.maxVelocity=0.5;this.onStop=function(){};};Reel.prototype.arrayShuffle=function(a){for(var i=a.length-1;i;i--){var rand=(Math.random()*i)|0;var temp=a[i];a[i]=a[rand];a[rand]=temp;}
return a;};Reel.prototype.update=function(){var hadVelocity=this.velocity!==0;this.velocity=Math.min(this.maxVelocity,Math.max(0,this.velocity+this.acceleration));this.pos-=this.velocity;if(this.pos<0){this.pos+=this.slots.length;}
if(hadVelocity&&this.velocity===0){this.onStop(this);this.elusiveSymbolOverride=-1;}};Reel.prototype.spin=function(){this.acceleration=0.009+Math.random()*0.003;};Reel.prototype.stopAt=function(symbol){var sp=(this.pos-3)|0;if(sp<0){sp+=this.slots.length;}
for(var i=this.slots.length-1;i;i--){var p=(i+sp)%this.slots.length;if(this.slots[p]===symbol){var distance=this.pos-p+this.velocity/2;if(distance<0){distance+=this.slots.length;}
this.acceleration=-(this.velocity*this.velocity)/(2*distance);if(Math.random()<0.01){this.elusiveSymbolOverride=(p+3)%this.slots.length;}
return;}}};Reel.prototype.draw=function(ctx,sx,sy,height,middle){var reelOffset=middle/this.symbolHeight;var p=this.pos-reelOffset+this.slots.length;var yOffset=(p%1)*this.symbolHeight;for(var y=sy-yOffset,i=0;y<sy+height;y+=this.symbolHeight,i++){var slot=((p+this.slots.length*2+i)|0)%this.slots.length;var symbol=this.slots[slot];if(slot===this.elusiveSymbolOverride){symbol=this.elusiveSymbol;}
ctx.drawImage(this.img,symbol*this.symbolWidth,0,this.symbolWidth,this.symbolHeight,sx,y,this.symbolWidth,this.symbolHeight);}};var Star=function(x,y,wait){this.x=x;this.y=y;this.vx=5-Math.random()*10;this.vy=-(4+Math.random()*8);this.wait=wait;};Star.prototype.update=function(){this.wait--;if(this.wait<0){this.vx*0.99;this.vy+=0.5;this.x+=this.vx;this.y+=this.vy;}};p.View.Games=p.View.Games||{};p.View.Games.Slots=p.View.Base.extend({template:'<a onclick="p.navigateTo(\'casino\')" style="font-size: 25px;position: absolute;top: 3px;left: 0px;z-index: 1;"> <span class="pict" style="font-size: 25px">r</span> Zurück </a> <div class="game-container" style="min-height: 100vh;"> <h3 class="game-loading"><br/><br/>lade…</h3> <canvas class="game-canvas" width="594" height="716"></canvas> <?js if (!isUnlocked) {?> <div class="game-not-unlocked"> <h2>Nich freigeschaltet</h2> <p> Den Benitrat0r gibt es diese mal nur für Menschen die etwas gutes tun. <a href="#top/4467685">Details hier</a>. </p> <p> Bitte beachte dass deine Freischaltung ein bisschen dauern kann. Wir tun unser bestes! </p> </div> <?js } ?> <?js if (hooker) { ?> <div class="game-hooker"> <img src="/media/games/stefi.gif" /> </div> <?js } ?> <div> <div class="pane game-big-wins-container" style="display:none"> <!-- <div class="game-credit-link"><a href="#beniskredit">Benisnot?</a></div> --> <h2 class="section">Gewinnertypen</h2> <table id="game-big-wins"></table> </div> </div> </div> ',requiresLogin:true,spins:0,bet:4,credits:0,win:0,reels:null,spinStartTime:0,canPlayOgg:false,canPlayMp3:false,isSpinning:false,muted:false,currentWinIndicators:[],extraWin:null,stars:[],load:function(){if(window.AudioContext){var probe=new Audio();this.canPlayOgg=probe.canPlayType('audio/ogg; codecs=vorbis');this.canPlayMp3=probe.canPlayType('audio/mpeg');this.audioContext=new AudioContext();this.audioGain=this.audioContext.createGain();this.audioGain.connect(this.audioContext.destination);}
p.api.get('slots.info',{},this.loaded.bind(this));return false;},loaded:function(response){this.data.isUnlocked=response.isUnlocked;this.canPlay=response.canPlay&&response.isUnlocked;this.credits=response.credits;this.data.hooker=response.hooker;this.render();const randomNumber=Math.floor(Math.random()*3)+1;this.loadAssets({'machine':'/media/games/slots/machine.png','spin':'/media/games/slots/button-spin.png','betUp':'/media/games/slots/button-bet-up.png','betDown':'/media/games/slots/button-bet-down.png','mute':'/media/games/slots/button-audio.png','digits':'/media/games/slots/digits.png','symbols':'/media/games/slots/symbols.png','winIndicator':'/media/games/slots/win-indicator.png','extraWinBadge':'/media/games/slots/extra-win-badge.png','star':'/media/games/slots/plus.png','sfxwin':'/media/games/slots/win.ogg','sfxbigwin':'/media/games/slots/big-win.ogg','sfxconfirm':'/media/games/slots/confirm.ogg','sfxerror':'/media/games/slots/error.ogg','sfxspin':'/media/games/slots/spin.ogg','sfxstop':'/media/games/slots/stop.ogg','sfxambient':`/media/games/ambient0${randomNumber}.ogg`,'sfxcoin':'/media/games/slots/coin.ogg'},this.assetsLoaded.bind(this));},loadAssets:function(urls,callback){var assets={};var pending=0;for(var name in urls){pending++;}
var that=this;for(var name in urls){(function(name,url){if(url.match(/\.(jpe?g|png)$/)){var img=new Image();assets[name]=img;img.onload=function(){pending--;if(pending===0){callback(assets);}}
img.src=url;}
else if(url.match(/\.ogg$/)){var audioUrl=null;if(that.canPlayOgg){audioUrl=url;}
else if(that.canPlayMp3){audioUrl=url.replace(/\.ogg$/,'.mp3');}
else{pending--;if(pending===0){callback(assets);}
return;}
var request=new XMLHttpRequest();request.open('GET',audioUrl,true);request.responseType='arraybuffer';request.onload=function(ev){that.audioContext.decodeAudioData(request.response,function(buffer){assets[name]=buffer;pending--;if(pending===0){callback(assets);}},function(ev){pending--;if(pending===0){callback(assets);}});};request.onerror=function(ev){loadCallback(path,false,ev);};request.send();}})(name,urls[name]);}},assetsLoaded:function(assets){this.$container.find('.game-loading').remove();this.assets=assets;this.buttonSpin=new Button(446,520,97,97,this.assets.spin,this.spin.bind(this));this.buttonBetUp=new Button(65,520,100,98,this.assets.betUp,this.betUp.bind(this));this.buttonBetDown=new Button(125,520,100,98,this.assets.betDown,this.betDown.bind(this));this.buttonMute=new Button(150,20,110,120,this.assets.mute,this.mute.bind(this),true);this.onClickBound=this.onClick.bind(this);this.canvas.addEventListener('mousedown',this.onClickBound);this.onTouchStartBound=this.onTouchStart.bind(this);this.canvas.addEventListener('touchstart',this.onTouchStartBound);this.onMouseMoveBound=this.onMouseMove.bind(this);this.canvas.addEventListener('mousemove',this.onMouseMoveBound);this.interval=setInterval(this.update.bind(this),16);this.reels=[];for(var i=0;i<5;i++){var reel=new Reel(assets.symbols,9,76,76,9);reel.onStop=this.onReelStop.bind(this);this.reels.push(reel);}
this.backgroundSound=this.playSound(this.assets.sfxambient,true,0.3);this.loadWinnersInterval=setInterval(this.loadWinners.bind(this),60*1000);this.loadWinners();},loadWinners:function(){p.api.get('slots.winners',{},function(response){var rows=[];for(var i=0;i<response.winners.length;i++){var w=response.winners[i];var time=new Date(w.created*1000);rows.push('<tr class="game-win-row">'+'<td><a href="/user/'+w.name+'" class="user um'+w.mark+'">'+w.name+'</a></td>'+'<td class="game-win">'+(w.extra?(w.extra.pr0mium?'Tag'.inflect(w.extra.pr0mium)+' pr0mium':'Tag'.inflect(w.extra.ban)+' Ban'):w.win+' Credits')+'</td>'+'<td class="game-win-time time" title="'+time.readableDate()+'">'+
time.relativeTime(true)+'</td>'+'</tr>');}
this.$container.find('.game-big-wins-container').show();this.$container.find('#game-big-wins').html(rows.join(''));}.bind(this));},hide:function(){this.backgroundSound.stop();clearInterval(this.interval);clearInterval(this.loadWinnersInterval);this.canvas.removeEventListener('click',this.onClickBound);this.canvas.removeEventListener('mousemove',this.onMouseMoveBound);this.canvas.removeEventListener('touchstart',this.onTouchStartBound);},mute:function(){if(this.audioGain){this.muted=!this.muted;this.audioGain.gain.value=this.muted?0:1;}},render:function(){this.parent();this.canvas=this.$container.find('.game-canvas')[0];this.ctx=this.canvas.getContext('2d');this.mx=0;this.my=0;},onReelStop:function(reel){this.playSound(this.assets.sfxstop);var allReelsStopped=true;for(var i=0;i<this.reels.length;i++){allReelsStopped=allReelsStopped&&this.reels[i].velocity===0;}
if(allReelsStopped){this.allReelsStopped();}},allReelsStopped:function(){var r=this.lastResponse;this.credits=r.credits;this.win=r.win;this.currentWinIndicators=[];var waitTime=150;if(r.win||r.extra){var first=Infinity;var last=0;for(var i=0;i<r.symbols.length;i++){if(r.symbols[i]===r.winningSymbol){first=Math.min(first,i);last=Math.max(last,i);setTimeout(this.showWinIndicator.bind(this,i),waitTime);waitTime+=250;}}
setTimeout(this.spawnStars.bind(this,r,first,last),waitTime-250);if(r.bigWin){setTimeout(this.playSound.bind(this,this.assets.sfxbigwin),waitTime-250);}
if(r.extra){setTimeout(function(){this.extraWin=r.extra.pr0mium?'Tag'.inflect(r.extra.pr0mium)+' pr0mium':'Tag'.inflect(r.extra.ban)+' Ban';}.bind(this),waitTime-250);if(r.extra.ban){this.canPlay=false;}}}
this.spins+=1;if(this.spins>=15&&!this.data.hooker){this.spins=0;setTimeout(()=>{p.mainView.showOverlay(p.View.Overlay.Hooker);},500);}
if(r.bonus>0){const text='<div class="overlay-content"><h2>Bonus</h2><p>Stefi hat sich beim Tanzen zu tief gebückt, es sind '+r.bonus+' Credits auf deinen Schoß gefallen. Behalte sie!</p></div>'
document.getElementById('overlay-box').innerHTML=text;document.getElementById('overlay').style.display="block";setTimeout(()=>{document.getElementById('overlay-box').innerHTML='';document.getElementById('overlay').style.display='';},5*1000);}
this.isSpinning=false;},spawnStars:function(res,first,last){if(this.isSpinning){return;}
var amount=Math.min(res.win,64);var frameWait=Math.max(8,32/Math.sqrt(amount));for(var i=0;i<amount;i++){var x=70-16+first*76+Math.random()*(last-first+1)*76;var y=334-16;this.stars.push(new Star(x,y,5+(i*frameWait)|0));}},showWinIndicator:function(reelId){this.playSound(this.assets.sfxwin);this.currentWinIndicators.push(reelId);},playSound:function(buffer,loop,volume=1){if(!buffer){return;}
const source=this.audioContext.createBufferSource();source.buffer=buffer;this.audioGain.volume=volume;source.connect(this.audioGain);source.loop=!!loop;source.start();return source;},loadImage:function(path){var img=new Image();img.src=path;return img;},zeropad:function(n,zeros){var s=(n|0).toString();return'0000000000000000'.substr(0,zeros-s.length)+n;},onClick:function(ev){var r=this.canvas.getBoundingClientRect();var zoom=this.canvas.width/r.width;this.mx=(ev.clientX-r.left)*zoom;this.my=(ev.clientY-r.top)*zoom;this.buttonSpin.click(this.mx,this.my);this.buttonBetUp.click(this.mx,this.my);this.buttonBetDown.click(this.mx,this.my);this.buttonMute.click(this.mx,this.my);ev.stopPropagation();ev.preventDefault();return false;},onTouchStart:function(ev){if(!ev.touches.length){return;}
var r=this.canvas.getBoundingClientRect();var zoom=this.canvas.width/r.width;this.mx=(ev.touches[0].clientX-r.left)*zoom;this.my=(ev.touches[0].clientY-r.top)*zoom;if(this.buttonSpin.click(this.mx,this.my)||this.buttonBetUp.click(this.mx,this.my)||this.buttonBetDown.click(this.mx,this.my)||this.buttonMute.click(this.mx,this.my)){ev.stopPropagation();ev.preventDefault();}},onMouseMove:function(ev){var r=this.canvas.getBoundingClientRect();var zoom=this.canvas.width/r.width;this.mx=(ev.clientX-r.left)*zoom;this.my=(ev.clientY-r.top)*zoom;},spin:function(){if(!this.canPlay||!this.bet||(this.credits-this.bet<0)||this.isSpinning){this.playSound(this.assets.sfxerror);return;}
this.stars=[];this.extraWin=null;this.credits-=this.bet;for(var i=0;i<this.reels.length;i++){this.reels[i].spin();}
this.spinStartTime=Date.now();this.isSpinning=true;setTimeout(this.playSound.bind(this,this.assets.sfxspin),150);this.playSound(this.assets.sfxconfirm);this.currentWinIndicators=[];p.api.post('slots.spin',{bet:this.bet},this.spinResult.bind(this));},spinResult:function(response){this.lastResponse=response;var diff=Date.now()-this.spinStartTime;var stopSpinTime=Math.max(0,500-diff);setTimeout(this.stopSpin.bind(this,response),stopSpinTime);},stopSpin:function(response){for(var i=0;i<this.reels.length;i++){this.reels[i].stopAt(response.symbols[i]);}},betUp:function(){if(!this.canPlay||this.bet===512||this.isSpinning){this.playSound(this.assets.sfxerror);return;}
this.playSound(this.assets.sfxconfirm);this.bet=this.bet*2;},betDown:function(){if(!this.canPlay||this.bet===4||this.isSpinning){this.playSound(this.assets.sfxerror);return;}
this.playSound(this.assets.sfxconfirm);this.bet=this.bet*0.5;},update:function(){var ctx=this.ctx;ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var i=0;i<this.reels.length;i++){var reel=this.reels[i];reel.update();reel.draw(ctx,83+i*76,235,294,108);}
ctx.drawImage(this.assets.machine,0,0);if(!this.isSpinning){for(var i=0;i<this.currentWinIndicators.length;i++){var reelId=this.currentWinIndicators[i];ctx.drawImage(this.assets.winIndicator,70+reelId*76,334);}}
if(this.stars.length){var starsVisible=false;ctx.globalCompositeOperation='lighter';for(var i=0;i<this.stars.length;i++){var s=this.stars[i];if(s.y<760){starsVisible=true;s.update();if(s.wait<1){if(s.wait===0){this.playSound(this.assets.sfxcoin);}
ctx.globalAlpha=Math.max(0,Math.min(1,1-(s.y-460)/200));ctx.drawImage(this.assets.star,s.x,s.y);}}}
ctx.globalAlpha=1;ctx.globalCompositeOperation='source-over';if(!starsVisible){this.stars=[];}}
if(this.extraWin){ctx.drawImage(this.assets.extraWinBadge,94,336);ctx.font='28px Arial';ctx.textAlign='center';ctx.fillStyle='#fff';ctx.fillText(this.extraWin,275,392);}
this.drawDigits(215,568,this.zeropad(this.bet,3));this.drawDigits(298,568,this.zeropad(this.win,4));this.drawDigits(387,568,this.zeropad(this.credits,7));this.buttonSpin.update(ctx,this.mx,this.my);this.buttonBetUp.update(ctx,this.mx,this.my);this.buttonBetDown.update(ctx,this.mx,this.my);this.buttonMute.update(ctx,this.mx,this.my);if(!this.muted){ctx.drawImage(this.assets.mute,170,40);}
if(this.buttonSpin.active||this.buttonBetUp.active||this.buttonBetDown.active||this.buttonMute.active){this.canvas.style.cursor='pointer';}
else{this.canvas.style.cursor='default';}},drawDigits:function(x,y,s){var ctx=this.ctx;var base="0".charCodeAt(0);for(var i=0;i<s.length;i++){var c=s.charCodeAt(i)-base;ctx.drawImage(this.assets.digits,c*10,0,10,13,x,y,10,13);x+=10;}}});p.View.Games=p.View.Games||{};p.View.Games.Credit=p.View.Base.extend({template:'<div class="pane credit-contract"> <?js if (canGetCredit) {?> <link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet"> <img class="credit-contract-image" src="/media/slots/credit-contract.png"/> <span class="credit-signature" style="font-family: \'Gloria Hallelujah\', cursive;"> {userName} </span> <span class="action credit-accept">Kredit annehmen ✔</span> <?js } else if(!p.user.id) { ?> <h2>Nicht eingeloggt</h2> <p>Bitte beachten Sie, dass wir Kredite nur an uns bekannte Personen vergeben können.</p> <?js } else { ?> <h2>Nicht Kreditwürdig</h2> <p>Leider mussten wir feststellen, dass Sie nicht unseren Anforderungen für eine Kreditwürdigkeit entsprechen.</p> <?js } ?> </div>',data:{userName:""},load:function(){p.api.post('slots.cangetcredit',{},this.loaded.bind(this));},loaded:function(response){this.data.userName=response.userName;this.data.canGetCredit=response.canGetCredit;this.render();},render:function(){this.parent();this.$container.find('.credit-accept').click(this.acceptCredit.bind(this));},acceptCredit:function(){p.api.post('slots.acceptcredit',{},function(){p.navigateTo('user/'+this.data.userName)}.bind(this));}});p.View.Games=p.View.Games||{};p.View.Games.Roulette=p.View.Base.extend({template:'<div class="pane" style="min-height: 100vh;"> <h1 class="pane-head"> <a onclick="p.navigateTo(\'casino\')" style="font-size: 25px"> <span class="pict" style="font-size: 25px">r</span> Zurück </a> <svg id="audio-background" viewBox="0 0 75 75" style="width: 1em; fill: white; float: right"> <polygon class="speaker" points="39.389,13.769 22.235,28.606 6,28.606 6,47.699 21.989,47.699 39.389,62.75 39.389,13.769"/> <g class="mute" style="display: none;"> <path d="M 49,50 69,26"/> <path d="M 69,50 49,26"/> </g> <g class="wave"> <path class="wave-1" d="M 48,49 C 50,46 51,42 51,38 C 51,34 50,31 48,28"/> <path class="wave-2" d="M 55,21 C 59,26 61,32 61,38 C 61,45 59,51 55,56"/> <path class="wave-3" d="M 62,63 C 67,56 70,48 70,38 C 70,29 67,21 62,14"/> </g> </svg> </h1> <?js if (!isUnlocked) {?> <div class="game-not-unlocked"> <h2>Nich freigeschaltet</h2> <p> Das Casino gibt es diese mal nur für Menschen die etwas gutes tun. <a href="#top/4467685">Details hier</a>. </p> <p> Bitte beachte dass deine Freischaltung ein bisschen dauern kann. Wir tun unser bestes! </p> </div> <?js } ?> <?js if (hooker) {?> <div class="game-hooker"> <img src="/media/games/stefi.gif" /> </div> <?js } ?> <div class="buttons"> <input type="submit" id="spin" value="Drehen" /> </div> <div class=\'roulette-wrapper\'> <div class=\'selector\'></div> <div class=\'wheel\'> <div class="card green">0</div> <div class="card red">32</div> <div class="card black">15</div> <div class="card red">19</div> <div class="card black">4</div> <div class="card red">21</div> <div class="card black">2</div> <div class="card red">25</div> <div class="card black">17</div> <div class="card red">34</div> <div class="card black">6</div> <div class="card red">27</div> <div class="card black">13</div> <div class="card red">36</div> <div class="card black">11</div> <div class="card red">30</div> <div class="card black">8</div> <div class="card red">23</div> <div class="card black">10</div> <div class="card red">5</div> <div class="card black">24</div> <div class="card red">16</div> <div class="card black">33</div> <div class="card red">1</div> <div class="card black">20</div> <div class="card red">14</div> <div class="card black">31</div> <div class="card red">9</div> <div class="card black">22</div> <div class="card red">18</div> <div class="card black">29</div> <div class="card red">7</div> <div class="card black">28</div> <div class="card red">12</div> <div class="card black">35</div> <div class="card red">3</div> <div class="card black">26</div> <!-- BR --> <div class="card green">0</div> <div class="card red">32</div> <div class="card black">15</div> <div class="card red">19</div> <div class="card black">4</div> <div class="card red">21</div> <div class="card black">2</div> <div class="card red">25</div> <div class="card black">17</div> <div class="card red">34</div> <div class="card black">6</div> <div class="card red">27</div> <div class="card black">13</div> <div class="card red">36</div> <div class="card black">11</div> <div class="card red">30</div> <div class="card black">8</div> <div class="card red">23</div> <div class="card black">10</div> <div class="card red">5</div> <div class="card black">24</div> <div class="card red">16</div> <div class="card black">33</div> <div class="card red">1</div> <div class="card black">20</div> <div class="card red">14</div> <div class="card black">31</div> <div class="card red">9</div> <div class="card black">22</div> <div class="card red">18</div> <div class="card black">29</div> <div class="card red">7</div> <div class="card black">28</div> <div class="card red">12</div> <div class="card black">35</div> <div class="card red">3</div> <div class="card black">26</div> <!-- BR --> <div class="card green">0</div> <div class="card red">32</div> <div class="card black">15</div> <div class="card red">19</div> <div class="card black">4</div> <div class="card red">21</div> <div class="card black">2</div> <div class="card red">25</div> <div class="card black">17</div> <div class="card red">34</div> <div class="card black">6</div> <div class="card red">27</div> <div class="card black">13</div> <div class="card red">36</div> <div class="card black">11</div> <div class="card red">30</div> <div class="card black">8</div> <div class="card red">23</div> <div class="card black">10</div> <div class="card red">5</div> <div class="card black">24</div> <div class="card red">16</div> <div class="card black">33</div> <div class="card red">1</div> <div class="card black">20</div> <div class="card red">14</div> <div class="card black">31</div> <div class="card red">9</div> <div class="card black">22</div> <div class="card red">18</div> <div class="card black">29</div> <div class="card red">7</div> <div class="card black">28</div> <div class="card red">12</div> <div class="card black">35</div> <div class="card red">3</div> <div class="card black">26</div> <!-- BR --> <div class="card green">0</div> <div class="card red">32</div> <div class="card black">15</div> <div class="card red">19</div> <div class="card black">4</div> <div class="card red">21</div> <div class="card black">2</div> <div class="card red">25</div> <div class="card black">17</div> <div class="card red">34</div> <div class="card black">6</div> <div class="card red">27</div> <div class="card black">13</div> <div class="card red">36</div> <div class="card black">11</div> <div class="card red">30</div> <div class="card black">8</div> <div class="card red">23</div> <div class="card black">10</div> <div class="card red">5</div> <div class="card black">24</div> <div class="card red">16</div> <div class="card black">33</div> <div class="card red">1</div> <div class="card black">20</div> <div class="card red">14</div> <div class="card black">31</div> <div class="card red">9</div> <div class="card black">22</div> <div class="card red">18</div> <div class="card black">29</div> <div class="card red">7</div> <div class="card black">28</div> <div class="card red">12</div> <div class="card black">35</div> <div class="card red">3</div> <div class="card black">26</div> <!-- BR --> <div class="card green">0</div> <div class="card red">32</div> <div class="card black">15</div> <div class="card red">19</div> <div class="card black">4</div> <div class="card red">21</div> <div class="card black">2</div> <div class="card red">25</div> <div class="card black">17</div> <div class="card red">34</div> <div class="card black">6</div> <div class="card red">27</div> <div class="card black">13</div> <div class="card red">36</div> <div class="card black">11</div> <div class="card red">30</div> <div class="card black">8</div> <div class="card red">23</div> <div class="card black">10</div> <div class="card red">5</div> <div class="card black">24</div> <div class="card red">16</div> <div class="card black">33</div> <div class="card red">1</div> <div class="card black">20</div> <div class="card red">14</div> <div class="card black">31</div> <div class="card red">9</div> <div class="card black">22</div> <div class="card red">18</div> <div class="card black">29</div> <div class="card red">7</div> <div class="card black">28</div> <div class="card red">12</div> <div class="card black">35</div> <div class="card red">3</div> <div class="card black">26</div> </div> </div> <object id="game-table" style="width: 100%;" data="/media/games/roulette/table.svg" type="image/svg+xml"> <!---Fallback---> Dein shitty Browser hat Probleme eine SVG darzustellen, traust Du uns etwa nicht? :/ </object> <div class="divide-3-1"> <h3>Einsatz</h3> <div class="form-row" id="bet-amount"> <input type="number" id="bet" value="1"> </div> <div> Deine Credits: <span id="credits">{credits}</span> </div> </div> <div class="divide-3-2"> <h3>Deine Platzierungen</h3> <div id="bets-placed"> </div> </div> <div class="divide-3-3" style="margin-bottom: 4em;"> <h3>Spielverlauf</h3> <div id="history"> </div> </div> </div> <style> #audio-background:hover { cursor: pointer; } #bet-amount ,#bet-amount *{ font-size: 20px; } #bets-placed, #history { display: flex; flex-direction: column; max-height: 75px; overflow-y: auto; overflow-x: hidden; } #bets-placed, #bets-placed * { font-size: 18px; } #history * { margin-bottom: 3px; } span.pict:hover { cursor: pointer; } .buttons { display: flex; justify-content: center; margin-bottom: 1em; } .roulette-wrapper{ position: relative; display: flex; justify-content: center; width: 42%; overflow: hidden; margin: 0 auto 10px; } .roulette-wrapper .selector{ width: 3px; background: grey; left: 50%; height: 100%; transform: translate(-50%,0%); position: absolute; z-index: 2; } .roulette-wrapper .wheel{ display: flex; transform: translate3d(1428px, 0px, 0px); } .roulette-wrapper .wheel .row{ display: flex; } .roulette-wrapper .wheel .row .card{ height: 75px; width: 75px; margin:3px; border-radius:8px; border-bottom:3px solid rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center; color:white; font-size:1.5em; } .card { margin-right: 2px; width: 24px; text-align: center; } .card.red{ background: #ee4d2e; } .card.black{ background: #2a2e31; } .card.green{ background: #5cb85c; } #game-table { background: #0e6d38; padding: 5px; border: 9px solid green; border-image-source: linear-gradient(#353535, #131313); border-image-slice: 20; } #spin { width: 100px; font-size: 21px; } </style> ',requiresLogin:true,looses:0,data:{bet:1,credits:0},order:[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26],names:{37:'firstDozen',38:'secondDozen',39:'thirdDozen',40:'lowerEighteen',41:'even',42:'red',43:'black',44:'odd',45:'higherEighteen',46:'firstColumn',47:'secondColumn',48:'thirdColumn'},load:function(){p.api.get('casino.info',null,this.loaded.bind(this));return false;},loaded:function(response){this.data.credits=Math.floor(response.credits);this.data.isUnlocked=response.activated;this.data.hooker=response.hooker;this.render();},render:function(){this.parent();document.getElementById('audio-background').addEventListener('click',()=>{if(this.audioContext.state==="suspended"){this.audioContext.resume().then(()=>this.audioIsPlaying=true);document.querySelector('#audio-background .wave').style.display="block";}else if(this.audioIsPlaying){this.audioSource.stop();this.audioIsPlaying=false;document.querySelector('#audio-background .wave').style.display="none";}else{this.playBackgroundMusic();this.audioIsPlaying=true;this.audioSource.volume=1;document.querySelector('#audio-background .wave').style.display="block";}});this.playBackgroundMusic();document.getElementById('game-table').addEventListener('load',()=>{this.svg=document.getElementById('game-table').contentDocument;this.svg.querySelectorAll('g#Normal *').forEach(elem=>{elem.addEventListener('mouseenter',(ev)=>this.mouseEnter(ev.target.dataset.name));elem.addEventListener('mouseleave',(ev)=>this.mouseLeave(ev.target.dataset.name));elem.style.cursor="pointer";elem.addEventListener('click',(ev)=>this.placeChip(ev.target));});this.svg.querySelectorAll('g#vierer *').forEach(elem=>{elem.addEventListener('mouseenter',(ev)=>this.mouseEnter(ev.target.dataset.name));elem.addEventListener('mouseleave',(ev)=>this.mouseLeave(ev.target.dataset.name));elem.style.cursor="pointer";elem.addEventListener('click',(ev)=>this.placeChip(ev.target));});this.svg.querySelectorAll('g#zweier *').forEach(elem=>{elem.addEventListener('mouseenter',(ev)=>this.mouseEnter(ev.target.dataset.name));elem.addEventListener('mouseleave',(ev)=>this.mouseLeave(ev.target.dataset.name));elem.style.cursor="pointer";elem.addEventListener('click',(ev)=>this.placeChip(ev.target));});});window.addEventListener('keydown',(ev)=>{this.shift=ev.shiftKey;});window.addEventListener('keyup',(ev)=>{this.shift=ev.shiftKey;});document.getElementById('spin').addEventListener('click',()=>{$('.wheel').css({'transition-timing-function':'','transition-duration':'',});$('.wheel').css('transform','translate3d(1428px, 0px, 0px)');p.api.post('casino.roulette',this.getFields(),this.submitted.bind(this));});},hide:function(){this.audioSource.stop();},playSound:function(url,volume=1){if(!this.audioIsPlaying)return;const that=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;const audioContext=new AudioContext();const audioGain=audioContext.createGain();const audioSource=audioContext.createBufferSource();const request=new XMLHttpRequest();request.open('GET',url,true);request.responseType='arraybuffer';request.onload=function(){audioContext.decodeAudioData(request.response,function(buffer){audioSource.buffer=buffer;});}
request.send();audioGain.gain.value=volume;audioGain.connect(audioContext.destination);audioSource.connect(audioGain);audioSource.start(0);},playBackgroundMusic:function(){const that=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;this.audioContext=new AudioContext();this.audioGain=this.audioContext.createGain();this.audioSource=this.audioContext.createBufferSource();const request=new XMLHttpRequest();const randomNumber=Math.floor(Math.random()*3)+1;request.open('GET','/media/games/ambient0'+randomNumber+'.ogg',true);request.responseType='arraybuffer';request.onload=function(){that.audioContext.decodeAudioData(request.response,function(buffer){that.audioSource.buffer=buffer;});}
request.send();this.audioGain.gain.value=0.3;this.audioGain.connect(this.audioContext.destination);this.audioSource.connect(this.audioGain);this.audioSource.start(0);this.audioSource.loop=true;this.audioIsPlaying=!(this.audioContext.state==="suspended");if(!this.audioIsPlaying){document.querySelector('#audio-background .mute').style.display="block";document.querySelector('#audio-background .wave').style.display="none";}},mute:function(){this.audioSource.stop();},mouseEnter:function(ids){ids=ids.split(',');ids.forEach(id=>this.svg.querySelector('g#Normal #_'+id).style.fill="rgb(125,125,125, 0.6)");},mouseLeave:function(ids){ids=ids.split(',');ids.forEach(id=>this.svg.querySelector('g#Normal #_'+id).style.fill="rgb(0,0,0,0)");},removeChip(id){if(!!this.spinning){return;}
const elem=this.svg.querySelector('#chip_'+id.replaceAll(',','-'));if(!!elem){elem.parentElement.removeChild(elem);document.getElementById('bets-placed').removeChild(document.getElementById('placed_'+id.replaceAll(',','-')));return true;}
return false;},placeChip:function(target){if (target.x != "lol") { this.lastTarget = target;console.log(this);} else {target = this.lastTarget}if(!!this.spinning){return;}
if(this.removeChip(target.dataset.name)){return;}
this.playSound('/media/games/chip.ogg',1);const x=(target.x['baseVal']['value']+(target.width['baseVal']['value']/2))-25;const y=(target.y['baseVal']['value']+(target.height['baseVal']['value']/2))-25;const svgimg=document.createElementNS('http://www.w3.org/2000/svg','image');svgimg.setAttributeNS(null,'id','chip_'+target.dataset.name.replaceAll(',','-'));svgimg.setAttributeNS(null,'data-numbers',target.dataset.name.replaceAll(',','-'));svgimg.setAttributeNS(null,'data-value',document.getElementById('bet').value);svgimg.setAttributeNS(null,'height','50');svgimg.setAttributeNS(null,'width','50');svgimg.setAttributeNS('http://www.w3.org/1999/xlink','href','/media/games/chips/empty.png');svgimg.setAttributeNS(null,'x',x.toString());svgimg.setAttributeNS(null,'y',y.toString());svgimg.setAttributeNS(null,'visibility','visible');svgimg.addEventListener('click',(ev)=>this.removeChip(ev.target.dataset.numbers));this.svg.querySelector('svg').append(svgimg);const deleteSpan=document.createElement('span');deleteSpan.innerText="O";deleteSpan.className="pict";deleteSpan.style.color="var(--theme-main-color)";deleteSpan.dataset.numbers=target.dataset.name.replaceAll(',','-');deleteSpan.addEventListener('click',(ev)=>{this.removeChip(ev.target.dataset.numbers);});const placed=document.createElement('span');const name=(target.dataset.name>36)?this.names[target.dataset.name]:target.dataset.name;placed.innerHTML=name+' für '+document.getElementById('bet').value;placed.id='placed_'+target.dataset.name.replaceAll(',','-');placed.appendChild(deleteSpan);const currentList=document.querySelectorAll('#bets-placed > *');if(currentList.length>0){document.getElementById('bets-placed').insertBefore(placed,currentList[0]);}else{document.getElementById('bets-placed').appendChild(placed);}},getFields:function(){let fields=[];let extraFields=[];this.svg.querySelectorAll('*[data-numbers]').forEach(elem=>{const numbers=elem.dataset.numbers.split('-');if(numbers.length>1){fields.push({'fields':numbers,'value':elem.dataset.value});}else{if(numbers[0]>36){extraFields.push({'field':numbers[0],'value':elem.dataset.value});}else{fields.push({'fields':numbers,'value':elem.dataset.value});}}});let obj={fields:fields};extraFields.forEach(extraField=>{obj[this.names[extraField['field']]]=extraField['value'];});return obj;},submitted:function(res){this.spinning=true;let index=this.order.indexOf(res.roll.result);let pxl=26*index+495;const spinBtn=document.getElementById('spin');spinBtn.disabled=true;$('.wheel').css({'transition-timing-function':'cubic-bezier(0, 0.6, 0.004, 1)','transition-duration':'5s','transform':'translate3d(-'+pxl+'px, 0px, 0px)'});this.playSound('/media/games/roulette/spin.ogg',1);setTimeout(()=>{this.setHistory(res);if(res.prize>res.bet){this.playSound('/media/games/chips.ogg',1);}else{this.looses+=1;if(this.looses>5&&!this.data.hooker){this.looses=0;setTimeout(()=>{p.mainView.showOverlay(p.View.Overlay.Hooker);},500);}}
this.svg.querySelector('g#Normal #_'+res.roll.result).style.fill="rgb(15,215,10, 0.4)"
if(res.roll.even!==-1){const even=(res.roll.even)?'41':'44';this.svg.querySelector('g#Normal #_'+even).style.fill="rgb(15,215,10, 0.4)";}
if(res.roll.higherEighteen){this.svg.querySelector('g#Normal #_45').style.fill="rgb(15,215,10, 0.4)";}else if(res.roll.lowerEighteen){this.svg.querySelector('g#Normal #_40').style.fill="rgb(15,215,10, 0.4)";}
if(res.roll.color==="black"){this.svg.querySelector('g#Normal #_43').style.fill="rgb(15,215,10, 0.4)";}else if(res.roll.color==="red"){this.svg.querySelector('g#Normal #_42').style.fill="rgb(15,215,10, 0.4)";}
if(!!res.roll.columns){this.svg.querySelector('g#Normal #_'+(res.roll.columns+45)).style.fill="rgb(15,215,10, 0.4)";}
if(!!res.roll.dozens){this.svg.querySelector('g#Normal #_'+(res.roll.dozens+36)).style.fill="rgb(15,215,10, 0.4)";}
if(res.bonus>0){const text='<div class="overlay-content"><h2>Bonus</h2><p>Stefi hat sich beim Tanzen zu tief gebückt, es sind '+res.bonus+' Credits auf deinen Schoß gefallen. Behalte sie!</p></div>';document.getElementById('overlay-box').innerHTML=text;document.getElementById('overlay').style.display="block";setTimeout(()=>{document.getElementById('overlay-box').innerHTML='';document.getElementById('overlay').style.display='';},5*1000)}},5*1000);setTimeout(()=>{spinBtn.disabled=false;this.spinning=false;this.clearTable();this.svg.querySelectorAll('#Normal *').forEach(elem=>this.mouseLeave(elem.id.replace('_','')));},8*1000);},clearTable:function(){const svg=this.svg.querySelectorAll('svg > image');svg.forEach(elem=>this.removeChip(elem.dataset.numbers));},setHistory:function(res){this.data.credits=this.data.credits-res.bet;this.data.credits=this.data.credits+res.prize+res.bonus;document.getElementById('credits').innerText=this.data.credits;const wrapper=document.createElement('div');wrapper.innerHTML='Bet: '+res.bet+' Win: '+res.prize+' <span style="color:'+(res.prize>res.bet?'green':'red')+'">('+(res.prize-res.bet)+')</span>';const number=document.createElement('div');number.className='card '+res.roll.color;number.style.float="left";number.innerText=res.roll.result;wrapper.appendChild(number);const currentHistory=document.querySelectorAll('#history > *');if(currentHistory.length>0){document.getElementById('history').insertBefore(wrapper,currentHistory[0]);}else{document.getElementById('history').appendChild(wrapper);}},});p.View.Games=p.View.Games||{};p.View.Games.BlackJack=p.View.Base.extend({template:'<div class="pane" style="min-height: 100vh;"> <h1 class="pane-head"> <a onclick="p.navigateTo(\'casino\')" style="font-size: 25px"> <span class="pict" style="font-size: 25px">r</span> Zurück </a> <svg id="audio-background" viewBox="0 0 75 75" style="width: 1em; fill: white; float: right"> <polygon class="speaker" points="39.389,13.769 22.235,28.606 6,28.606 6,47.699 21.989,47.699 39.389,62.75 39.389,13.769"/> <g class="mute" style="display: none;"> <path d="M 49,50 69,26"/> <path d="M 69,50 49,26"/> </g> <g class="wave"> <path class="wave-1" d="M 48,49 C 50,46 51,42 51,38 C 51,34 50,31 48,28"/> <path class="wave-2" d="M 55,21 C 59,26 61,32 61,38 C 61,45 59,51 55,56"/> <path class="wave-3" d="M 62,63 C 67,56 70,48 70,38 C 70,29 67,21 62,14"/> </g> </svg> </h1> <?js if (!isUnlocked) {?> <div class="game-not-unlocked"> <h2>Nich freigeschaltet</h2> <p> Das Casino gibt es diese mal nur für Menschen die etwas gutes tun. <a href="#top/4467685">Details hier</a>. </p> <p> Bitte beachte dass deine Freischaltung ein bisschen dauern kann. Wir tun unser bestes! </p> </div> <?js } ?> <?js if (hooker) {?> <div class="game-hooker"> <img src="/media/games/stefi.gif" /> </div> <?js } ?> <object id="game-table" style="width: 100%; max-height: 75vh;" data="/media/games/cards/blackjack.svg" type="image/svg+xml"> <!---Fallback---> Dein shitty Browser hat Probleme eine SVG darzustellen, traust Du uns etwa nicht? :/ </object> <h3>FAQ</h3> <ul class="fine-print"> <li>Sitzungen laufen nach 5 Minuten Inaktivität aus.</li> </ul> </div> <style> #audio-background:hover { cursor: pointer; } #game-table { background: #0e6d38; padding: 5px; border: 9px solid green; border-image-source: linear-gradient(#353535, #131313); border-image-slice: 20; } </style>',requiresLogin:true,looses:0,dealerCards:[],playerCards:[],data:{},load:function(){p.api.get('casino.info',null,this.loaded.bind(this));return false;},loaded:function(response){this.data.credits=Math.floor(response.credits);this.data.isUnlocked=response.activated;this.data.hooker=response.hooker;this.render();},render:function(){this.parent();if(!this.data.isUnlocked)return;document.getElementById('game-table').addEventListener('load',()=>{this.svg=document.getElementById('game-table').contentDocument;this.svg.querySelector('#Info #_player').innerHTML=p.user.name+' (0)';this.svg.querySelector('#Info #_credits').innerHTML=this.data.credits;this.svg.querySelectorAll('#Actions *').forEach(elem=>{elem.style.cursor="pointer";});this.svg.querySelectorAll('#Bet *').forEach(elem=>{elem.style.cursor="pointer";elem.addEventListener('click',(ev)=>{this.clear();this.data.bet=ev.target.dataset.value;this.placeBet(this.data.bet)});});this.svg.querySelector('#Start').addEventListener('click',()=>{this.svg.querySelector('#Bet').style.display="block";this.svg.querySelector('#Actions').style.display="none";});this.svg.querySelector('#Card').addEventListener('click',(ev)=>this.handleAction(ev.target.parentElement));this.svg.querySelector('#Double').addEventListener('click',(ev)=>this.handleAction(ev.target.parentElement));this.svg.querySelector('#Hold').addEventListener('click',(ev)=>this.handleAction(ev.target.parentElement));});document.getElementById('audio-background').addEventListener('click',()=>{if(this.audioContext.state==="suspended"){this.audioContext.resume().then(()=>this.audioIsPlaying=true);document.querySelector('#audio-background .wave').style.display="block";}else if(this.audioIsPlaying){this.audioSource.stop();this.audioIsPlaying=false;document.querySelector('#audio-background .wave').style.display="none";}else{this.playBackgroundMusic();this.audioIsPlaying=true;document.querySelector('#audio-background .wave').style.display="block";}});this.playBackgroundMusic();},hide:function(){if(!!this.audioSource){this.audioSource.stop();}},playSound:function(url,volume=1){if(!this.audioIsPlaying)return;const that=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;const audioContext=new AudioContext();const audioGain=audioContext.createGain();const audioSource=audioContext.createBufferSource();const request=new XMLHttpRequest();request.open('GET',url,true);request.responseType='arraybuffer';request.onload=function(){audioContext.decodeAudioData(request.response,function(buffer){audioSource.buffer=buffer;});}
request.send();audioGain.gain.value=volume;audioGain.connect(audioContext.destination);audioSource.connect(audioGain);audioSource.start(0);},playBackgroundMusic:function(){const that=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;this.audioContext=new AudioContext();this.audioGain=this.audioContext.createGain();this.audioSource=this.audioContext.createBufferSource();const request=new XMLHttpRequest();const randomNumber=Math.floor(Math.random()*3)+1;request.open('GET','/media/games/ambient0'+randomNumber+'.ogg',true);request.responseType='arraybuffer';request.onload=function(){that.audioContext.decodeAudioData(request.response,function(buffer){that.audioSource.buffer=buffer;});}
request.send();this.audioGain.gain.value=0.3;this.audioGain.connect(this.audioContext.destination);this.audioSource.connect(this.audioGain);this.audioSource.start(0);this.audioSource.loop=true;this.audioIsPlaying=!(this.audioContext.state==="suspended");if(!this.audioIsPlaying){document.querySelector('#audio-background .mute').style.display="block";document.querySelector('#audio-background .wave').style.display="none";}},placeBet:function(value){this.svg.querySelector('#Info #_bet').innerHTML=value;this.svg.querySelector('#Bet').style.display="none";this.svg.querySelector('#Info #_credits').innerHTML=parseInt(this.svg.querySelector('#Info #_credits').innerHTML)-value;this.playSound('/media/games/chip.ogg',1);p.api.post('casino.blackjack',{bet:this.data.bet,action:'start'},this.handleResponse.bind(this));},playerYPos:function(){return Math.floor(Math.random()*(660-645+1)+645);},dealerYPos:function(){return Math.floor(Math.random()*(109-100+1)+100);},handleAction:function(elem){p.api.post('casino.blackjack',{currentDeck:this.currentDeck,state:this.state,action:elem.id.toLowerCase()},this.handleResponse.bind(this));},handleResponse:function(res){this.currentDeck=res.currentDeck;this.state=res.state;this.svg.querySelector('#Info #_player').innerHTML=p.user.name+' ('+res.playerValue+')';if(!!res.dealerValue){this.svg.querySelector('#Info #_dealer').innerHTML='Dealer ('+res.dealerValue+')';}
if(!!res.bet){this.svg.querySelector('#Info #_bet').innerHTML=res.bet;}
this.svg.querySelector('#Actions #Start').style.display="none";this.svg.querySelector('#Actions #Card').style.display="none";this.svg.querySelector('#Actions #Hold').style.display="none";this.svg.querySelector('#Actions #Double').style.display="none";if(this.dealerCards.length<1){this.addHiddenCard(270,this.dealerYPos()+0.5);}
if(!!res.dealerCards){if(res.dealerCards.length>this.dealerCards.length){res.dealerCards.forEach((dealerCards,index)=>{if(!(index+1>this.dealerCards.length)){return;}
if(this.dealerCards.length===1&&!!this.svg.querySelector('#backCard')){this.svg.querySelector('#backCard').setAttributeNS('http://www.w3.org/1999/xlink','href','/media/games/cards/'+dealerCards[0]+'/'+dealerCards[1]+'.png');this.svg.querySelector('#backCard').setAttributeNS(null,'id',null);}else{this.addCard(dealerCards[0],dealerCards[1],350+(index*50),this.dealerYPos()+0.5);this.dealerCards.push(dealerCards);}});}}
if(!!res.playerCards){res.playerCards.forEach((playerCard,index)=>{if(!this.playerCards||index>this.playerCards.length-1){this.addCard(playerCard[0],playerCard[1],300+(index*70),this.playerYPos()+0.5);this.playerCards.push(playerCard);}});}
if(!!res.options){this.svg.querySelector('#Actions').style.display="block";res.options.forEach(option=>{const name=option.charAt(0).toUpperCase()+option.slice(1);this.svg.querySelector('#Actions #'+name).style.display="block";});}
if(typeof res.won!='undefined'){this.svg.querySelector('#Actions').style.display="block";this.svg.querySelector('#Actions #Start').style.display="block";if(!!res.won){this.playSound('/media/games/chips.ogg',1);this.svg.querySelector('#Info #_player').style.fill="#a6ca18";}else{this.handleLoose();this.svg.querySelector('#Info #_dealer').style.fill="#a6ca18";}
if(res.bonus>0){this.hanleBonus(res.bonus);}}
if(!!res.credits){let credits=(res.bonus)?res.credits+res.bonus:res.credits;this.svg.querySelector('#Info #_credits').innerHTML=credits;}},hanleBonus:function(bonus){const text='<div class="overlay-content"><h2>Bonus</h2><p>Stefi hat sich beim Tanzen zu tief gebückt, es sind '+bonus+' Credits auf deinen Schoß gefallen. Behalte sie!</p></div>'
document.getElementById('overlay-box').innerHTML=text;document.getElementById('overlay').style.display="block";setTimeout(()=>{document.getElementById('overlay-box').innerHTML='';document.getElementById('overlay').style.display='';},5*1000);},handleLoose:function(){this.looses+=1;if(this.looses>=5&&!this.data.hooker){this.looses=0;setTimeout(()=>{p.mainView.showOverlay(p.View.Overlay.Hooker);},500);}},addHiddenCard(x,y){const svgimg=document.createElementNS('http://www.w3.org/2000/svg','image');svgimg.setAttributeNS('http://www.w3.org/1999/xlink','href',`/media/games/cards/back.png`);svgimg.setAttributeNS(null,'id','backCard');svgimg.setAttributeNS(null,'height','900');svgimg.setAttributeNS(null,'width','635');svgimg.setAttributeNS(null,'visibility','visible');svgimg.setAttributeNS(null,'class','cls-9')
svgimg.setAttributeNS(null,'transform','translate('+x+' '+y+') rotate(-10.8) scale(0.34)');this.svg.querySelector('#Blackjack').append(svgimg);},addCard:function(symbol,value,x,y){const svgimg=document.createElementNS('http://www.w3.org/2000/svg','image');svgimg.setAttributeNS('http://www.w3.org/1999/xlink','href','/media/games/cards/'+symbol+'/'+value+'.png');svgimg.setAttributeNS(null,'height','451');svgimg.setAttributeNS(null,'width','318');svgimg.setAttributeNS(null,'visibility','visible');svgimg.setAttributeNS(null,'class','cls-9')
svgimg.setAttributeNS(null,'transform','translate('+x+' '+y+') scale(0.69 0.7)');this.svg.querySelector('#Blackjack').append(svgimg);},clear:function(){this.svg.querySelector('#Blackjack').innerHTML="";this.svg.querySelector('#Info #_dealer').style.fill="#e6e6e6";this.svg.querySelector('#Info #_player').style.fill="#e6e6e6";this.playerCards=[];this.dealerCards=[];this.state=null;this.currentDeck=null;}});p.View.Stats=p.View.Base.extend({title:"Schwanzvergleich",template:'<h1 class="pane-head">Schwanzvergleich <a href="/user/{p.user.name}">{p.user.name}</a></h1> <div class="pane"> <?js if (!p.user.paid || !p.user) { ?> Statistiken zu deinem Profil sind nur mit <a href="/pr0mium">pr0mium</a> einsehbar! <?js } else { ?> <h2>Benisgraph</h2> <svg viewBox="-3 -3 510 160" class="score-chart"> <?js if (scoreHistory) { ?> <text id="circle-description" x="0" y="90%" fill="var(--theme-main-color)" style="font-size: 10px"> Klicke auf einen Kreis, um die Werte anzeigen zu lassen </text> <polyline id="polyline" stroke-width="1" points="{points}" /> <?js for (let c of circles) { ?> <circle cy="{c.y}" cx="{c.x}" r="3" data-date="{c.created}" data-score="{c.score}"> <title>{c.score} @ {c.created}</title> </circle> <?js } ?> <?js } else { ?> <text id="circle-description" x="0" y="50%" fill="var(--theme-main-color)" style="font-size: 12px"> Es sind noch nicht ausreichend Daten vorhanden, um deinen Graphen anzuzeigen. </text> <?js } ?> </svg> <h2>Kennzahlen</h2> <div class="grid key-indicators"> <div class="followers" style="grid-column: auto /span 6;"> {followers.count} <div class="subtitle">stelzen dich</div> </div> <div class="subscribed" style="grid-column: auto /span 6;"> {followers.subscribed} <div class="subtitle">abonnieren dich</div> </div> <div class="banned-days" style="grid-column: auto /span 6;"> {Math.round(bannedDays)} <div class="subtitle">Tage gebannt</div> </div> <div class="favCount" style="grid-column: auto /span 6;"> <span class="pict" style="font-size: 40px">c</span>{favCount.comments} <span class="pict" style="font-size: 40px">g</span>{favCount.items} <div class="subtitle heart-before">erhalten</div> </div> </div> <h2>Benis</h2> <div class="grid key-indicators"> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {score.items} <div class="subtitle">&#8960;-Benis deiner Hochlads</div> </div> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {score.comments} <div class="subtitle">&#8960;-Benis deiner Kommentare</div> </div> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {score.tags} <div class="subtitle">&#8960;-Benis deiner Tags</div> </div> </div> <h2>Nachrichten</h2> <div class="grid key-indicators"> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {messages.received} <div class="subtitle">erhaltene Nachrichten</div> </div> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {messages.send} <div class="subtitle">versendete Nachrichten</div> </div> <div class="avg-item-votes" style="grid-column: auto /span 4;"> {messages.conversations} <div class="subtitle">verschiedene Chatpartner</div> </div> </div> <div class="grid" style="margin-top: 15px"> <div class="list-items-wrapper"> <h2 class="heart-after" style="text-align: center">Hochlads mit den meisten</h2> <div class="list-items"> <?js for( let item of topCollectedItems ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="votes" style="grid-column: auto / span 11; text-align: center; font-size: 40px"> <span class="heart-after" title="{item.count} haben diesen Hochlad favorisiert"> {item.count} </span> </div> </div> <?js } ?> </div> </div> <div class="list-comments-wrapper"> <h2 class="heart-after" style="text-align: center">Kommentare mit den meisten</h2> <div class="list-comments"> <?js for( let item of topFavedComments ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="comment" style="grid-column: auto / span 6; padding: 5px"><span>{item.content.shorten(40)}</span></div> <div class="total" style="grid-column: auto / span 5; text-align: center; font-size: 40px"> <span class="heart-after" title="{item.count} haben diesen Kommentar favorisiert"> {item.count} </span> </div> </div> <?js } ?> </div> </div> </div> <div class="grid" style="margin-top: 15px"> <div class="list-items-wrapper"> <h2 style="text-align: center">TOP 10 - Hochlads</h2> <div class="list-items"> <?js for( let item of topScoredItems ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="votes" style="grid-column: auto / span 11; text-align: center; font-size: 40px"><span title="{item.up} up, {item.down} down">{item.votes}</span></div> </div> <?js } ?> </div> </div> <div class="list-items-wrapper"> <h2 style="text-align: center">FLOP 10 - Hochlads</h2> <div class="list-items"> <?js for( let item of lowestScoredItems ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="votes" style="grid-column: auto / span 11; text-align: center; font-size: 40px"><span title="{item.up} up, {item.down} down">{item.votes}</span></div> </div> <?js } ?> </div> </div> </div> <div class="grid" style="margin-top: 15px"> <div class="list-comments-wrapper"> <h2 style="text-align: center">TOP 10 - Kommentare</h2> <div class="list-comments"> <?js for( let item of topScoredComments ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="comment" style="grid-column: auto / span 6; padding: 5px"><span>{item.content.shorten(40)}</span></div> <div class="total" style="grid-column: auto / span 5; text-align: center; font-size: 40px"><span title="{item.up} up, {item.down} down">{item.votes}</span></div> </div> <?js } ?> </div> </div> <div class="list-comments-wrapper"> <h2 style="text-align: center">FLOP 10 - Kommentare</h2> <div class="list-comments"> <?js for( let item of lowestScoredComments ) { ?> <div class="grid"> <?js if (!(item.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> <div class="flag flag-{item.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (item.flags === 1) { ?>SFW<?js }?> <?js if (item.flags === 2) { ?>NSFW<?js }?> <?js if (item.flags === 4) { ?>NSFL<?js }?> <?js if (item.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{item.itemId}:comment{item.id}"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </a> </div> <?js } ?> <div class="comment" style="grid-column: auto / span 6; padding: 5px"><span>{item.content.shorten(40)}</span></div> <div class="total" style="grid-column: auto / span 5; text-align: center; font-size: 40px"><span title="{item.up} up, {item.down} down">{item.votes}</span></div> </div> <?js } ?> </div> </div> </div> <div class="grid" style="margin-top: 15px"> <div class="list-comments-wrapper"> <h2 style="text-align: center">TOP 10 - Tags</h2> <div class="list-comments"> <?js for( let tag of topScoredTags ) { ?> <div class="grid"> <?js if (!(tag.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{tag.itemId}"> <img src="{CONFIG.PATH.THUMBS}/{tag.thumb}"> </a> <div class="flag flag-{tag.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (tag.flags === 1) { ?>SFW<?js }?> <?js if (tag.flags === 2) { ?>NSFW<?js }?> <?js if (tag.flags === 4) { ?>NSFL<?js }?> <?js if (tag.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{tag.itemId}"> <img src="{CONFIG.PATH.THUMBS}/{tag.thumb}"> </a> </div> <?js } ?> <div class="comment" style="grid-column: auto / span 6; padding: 5px"><span class="tag" style="font-size: 15px;">{tag.tag.shorten(20)}</span></div> <div class="total" style="grid-column: auto / span 5; text-align: center; font-size: 40px"> <span title="{tag.up} up, {tag.down} down"> {tag.votes} </span> </div> </div> <?js } ?> </div> </div> <div class="list-comments-wrapper"> <h2 style="text-align: center">FLOP 10 - Tags</h2> <div class="list-comments"> <?js for( let tag of lowestScoredTags ) { ?> <div class="grid"> <?js if (!(tag.flags & p.user.flags)) { ?> <div class="thumb flag-container" style="width: 128px; height: 128px"> <a href="/new/{tag.itemId}"> <img src="{CONFIG.PATH.THUMBS}/{tag.thumb}"> </a> <div class="flag flag-{tag.flags}" style="transform: translateX(32%) translateY(-830%) rotate(45deg) scale(1.5);"> <?js if (tag.flags === 1) { ?>SFW<?js }?> <?js if (tag.flags === 2) { ?>NSFW<?js }?> <?js if (tag.flags === 4) { ?>NSFL<?js }?> <?js if (tag.flags === 8) { ?>NSFP<?js }?> </div> </div> <?js } else { ?> <div class="thumb"> <a href="/new/{tag.itemId}"> <img src="{CONFIG.PATH.THUMBS}/{tag.thumb}"> </a> </div> <?js } ?> <div class="comment" style="grid-column: auto / span 6; padding: 5px"><span class="tag" style="font-size: 15px;">{tag.tag.shorten(20)}</span></div> <div class="total" style="grid-column: auto / span 5; text-align: center; font-size: 40px"> <span title="{tag.up} up, {tag.down} down"> {tag.votes} </span> </div> </div> <?js } ?> </div> </div> </div> <p>Zuletzt aktualisiert am {updated}</p> <?js } ?> </div> ',load:function(){if(!p.mainView.requireLogin()){return false;}
if(p.user.paid){this.showLoader();p.api.get('stats.user',{},this.loaded.bind(this));}else{this.render();}
return false;},loaded:function(response){this.hideLoader();this.data=response;this.data.bannedDays=this.data.bannedDays.reduce((a,b)=>{const{days}=JSON.parse(b.data);return(!isNaN(days))?a+days:a;},0);this.data.updated=new Date(response.ts*1000).readableTime();if(!this.data.scoreHistory){this.render();return;}
let scoreHistory=this.data.scoreHistory;if(scoreHistory.length<2){scoreHistory.push({created:Math.floor(Date.now()/1000),score:scoreHistory[0].score});}
this.data.highestScore=Math.max.apply(Math,scoreHistory.map(a=>a.score));this.data.lowestScore=Math.min.apply(Math,scoreHistory.map(a=>a.score));let step=500/(scoreHistory.length-1);this.data.points=[];this.data.circles=[];for(let point in scoreHistory){let score=scoreHistory[point].score;let x=step*point;let y=100*(this.data.highestScore-(score))/this.data.highestScore;this.data.circles.push({x:x,y:y,created:new Date(scoreHistory[point].created*1000).readableDate(),score:score});}
let maxY=Math.max.apply(Math,this.data.circles.map(a=>a.y));this.data.circles.forEach(circle=>{circle.y=(maxY>0)?circle.y/(maxY/100):circle.y;this.data.points.push(`${circle.x},${circle.y}`);});this.render();},render:function(){this.parent();if(!this.data.scoreHistory)return;let circleDescription=document.getElementById('circle-description');let circles=document.getElementsByTagName('circle');for(let circle of circles){circle.addEventListener('click',ev=>{let score=ev.target.dataset.score;let date=ev.target.dataset.date;this.removeCircleColor();ev.target.style.fill='#fc8833';circleDescription.textContent=`${score}\u0020Benis am ${date}`;});}
let polyLine=document.getElementById('polyline');let totalLength=polyLine.getTotalLength();polyLine.style.strokeDasharray=totalLength;polyLine.style.strokeDashoffset=totalLength;},removeCircleColor:function(){let circles=document.getElementsByTagName('circle');for(let circle of circles){circle.style.fill="slategrey"}}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.DETACHINVITE=p.View.Base.extend({name:'overlay-detach-invite',resetViewport:false,template:'<div class="overlay-content"> <h2 class="warn" id="overlay-title">Möchtest Du Diesen Invite wirklich entfernen?</h2> <div id="yesno-buttons" style="text-align: center; margin-top: 10px"> <input type="button" class="yes" style="background-color: #ff0000;" value="Ja, ich bin mir sicher!" style="margin-right: 15px"> <input type="button" class="no" value="Nein, abbrechen!" style="margin-left: 15px"> </div> </div> ',data:{invite:null,type:null},init:function(container,parent,params){this.data.invite=params.invite;this.data.type=(params.type.toUpperCase()==="SELF")?'Self':'Invite';this.parent(container,parent);},show:function(){this.parent();let that=this;this.$container.find('.yes').click(async()=>{p.api.post(`user.detach${this.data.type}`,{userId:this.data.invite},(res)=>{this.hideLoader();let error=res.error||null;if(!!error){if(this.data.type==='Self'){error=(error==='notEnoughPaidMonth')?'Du kannst eine Bürgschaft nur je 6 Monate pr0mium-Laufzeit aufheben!':'Der Invite ist nicht älter als 2 Monate!';}else{error=(error==='notEnoughPaidMonth')?'Du kannst Dich nur je 6 Monate pr0mium-Laufzeit loslösen!':'Dein Benutzeraccount ist nicht älter als 2 Monate!';}}
document.getElementById('overlay-title').innerText=(!!res.success)?"Dein Invite wurde losgelöst":error||"Es ist ein Fehler aufgetreten"
that.$container.find('input[type=button]').attr('disabled','disabled');setTimeout(()=>p.reload(),3000);});});this.$container.find('.no').click(()=>{p.mainView.closeOverlay();});}});p.View.Settings=p.View.Base.extend({title:"Einstellungen",template:p.load('frontend/templates/settings.html',p.LOAD.LAZY),requiresLogin:true,data:{error:null,saved:false,tab:'bookmarklet',emailChanged:false,passwordChanged:false,selfBan:false,account:{email:'',likesArePublic:false,deviceMail:true,invites:0,isInvited:false},inviteSent:false,inviteDetached:false,invitesDetached:0,payments:0,detachType:''},init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);},show:function(params){if(!p.mainView.requireLogin()){return false;}
if(params.token){this.showLoader();this.data.tab='account';p.api.post('user.changeemail',{token:params.token},this.changedEmail.bind(this));return;}
this.data.tab=params.tab||'site';return this.parent(params);},load:function(){p.api.get('user.info',{},this.loaded.bind(this));return false;},loaded:function(response){this.data.account=response.account;this.data.invited=response.invited;this.data.invitesDetached=response.invitesDetached;this.data.payments=response.payments;this.data.subscriptions=response.subscriptions;this.data.account.theme=p.user.getTheme();if(this.data.account.paidUntil){this.data.account.paidUntil=new Date(this.data.account.paidUntil*1000);}
if(this.data.subscriptions){this.data.subscriptions.map(i=>i.created=new Date(i.created*1000));}
this.data.invited.map(i=>i.created=new Date(i.created*1000));this.render();},render:function(){this.parent();$('#settings-logout-link').click(this.logout.bind(this));this.$container.find('.bookmarklet').click(this.bookmarkClick.bind(this));var that=this;this.$container.find('#settings-site-form').submit(function(ev){p.user.setTheme(that.$container.find('input[name=theme]:checked').val());p.mainView.setThemeCSS();p.user.setShowAds($('#showAdsOn').prop('checked'));p.user.setFavUpvote(!$('#favUpvote').prop('checked'));p.api.post('user.sitesettings',ev.currentTarget,that.posted.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-security-form').submit(function(ev){p.api.post('user.changesecurity',ev.currentTarget,that.posted.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-name-form').submit(function(ev){that.data.nameChanged=true;that.data.username=that.$container.find('input[name=username]')[0].value;p.api.post('user.changeName',ev.currentTarget,that.posted.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-ban-form').submit(function(ev){p.api.post('user.selfBan',{days:that.$container.find('input[name=days]')[0].value,currentPassword:that.$container.find('input[name=currentPassword]')[0].value,},(res)=>{that.hideLoader();if(res.error){that.data.selfBan=true;that.data.error=res.error;that.render();}else{p.navigateTo('/new',p.NAVIGATE.DEFAULT);}});that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-email-form').submit(function(ev){that.data.emailChanged=true;p.api.post('user.requestemailchange',ev.currentTarget,that.posted.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-password-form').submit(function(ev){that.data.passwordChanged=true;p.api.post('user.changepassword',ev.currentTarget,that.posted.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('#settings-invite-form').submit(function(ev){p.api.post('user.invite',ev.currentTarget,that.invited.bind(that));that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});this.$container.find('.detach-invite').click((ev)=>{this.showLoader();const{invite}=ev.currentTarget.dataset;p.mainView.showOverlay(p.View.Overlay.DETACHINVITE,{invite:invite,type:'invite'});});this.$container.find('.detach-self').click((ev)=>{this.showLoader();const{invite}=ev.currentTarget.dataset;p.mainView.showOverlay(p.View.Overlay.DETACHINVITE,{invite:invite,type:'self'});});$('#settings-reset-synclog').click(this.resetSynclog.bind(this));this.data.saved=false;},resetSynclog:function(){$('#settings-reset-synclog').removeClass('link').text('lade…');p.user.restoreVotes(function(response){$('#settings-reset-synclog').text(response.logLength+' Votes u. Favoriten geladen');});},posted:function(response){if(!response.error){this.data.account=response.account;this.data.saved=true;}
this.data.error=response.error;this.data.nameLastChanged=(response.nameLastChanged)?new Date(response.nameLastChanged*1000):0;this.render();this.data.passwordChanged=false;this.data.emailChanged=false;},changedEmail:function(response){if(!response.error){this.data.account=response.account;this.data.saved=true;}
this.data.error=response.error;this.show({tab:'account'});},invited:function(response){if(!response.error){this.data.account=response.account;}
this.data.error=response.error;this.data.inviteSent=!response.error;this.render();this.data.inviteSent=false;},bookmarkClick:function(ev){alert('Ziehe den Link in deine Lesezeichenleiste!');return false;},logout:function(ev){p.user.logout();p.mainView.setUserStatus(false);p.navigateTo('',p.NAVIGATE.FORCE);return false;}});p.View.Rules=p.View.Base.extend({template:'<div class="fine-print"> <?js for(let rule of rules) { ?> <?js const indent = (rule.number.toString().indexOf(".") !== -1) ? \'indent\' : \'\'; ?> <?js if (!!rule.hasReason) { ?> <pre class="{indent}"><b>{rule.number}</b> {rule.text}</pre> <?js } else { ?> <pre><b>{rule.number}</b> <i>{rule.text}</i></pre> <?js } ?> <?js } ?> </div> <p class="warn"> Unfähigkeit, diese Regeln zu befolgen, wird mit einer Sperrung Deines Accounts honoriert. Diskussionen um die Sperrung werden die Sperrung verlängern. Wiederholte Unfähigkeit führt zum permanenten Ausschluss oder zu Einschränkungen einzelner Webseiten-Funktionen. Eine Neuregistrierung nach einem permanenten Ausschluss ist nur nach ausdrücklicher Genehmigung der Moderation gestattet. </p> ',data:{rules:{}},load:function(){p.api.get('faq.rules',null,this.loaded.bind(this));},loaded:function(response){this.data.rules=response.rules;this.render();}});p.View.Filter=p.View.Base.extend({template:'<h3>Filter</h3> <p> Vor dem Upload müssen Bilder/Videos mit dem passenden Filter versehen werden. </p> <ul class="fine-print"> <li> <strong>SFW (Safe for Work)</strong> - keine Gewalt, keine nackte Haut, kein ekliges Zeug. </li> <li> <strong>NSFP (Not Safe for Public)</strong> – wie SFW allerdings nur für registrierte Mitglieder sichtbar. NSFP muss gesetzt werden, wenn Kommentare anderer Benutzer im Upload sichtbar sind. </li> <li> <strong>NSFW (Not Safe for Work)</strong> – beinhaltet nackte Haut, Bikinis, weite Ausschnitte, Pornos und leicht offensiven Kram. Wie der Name schon sagt, nichts, was der Chef sehen sollte, wenn er dir über die Schulter sieht. Nur für registrierte Mitglieder sichtbar. </li> <li> <strong>NSFL (Not Safe for Life)</strong> – Gewalt, ekliges Zeug, alles, wobei Menschen Schaden nehmen. Nur für registrierte Mitglieder sichtbar. </li> </ul> '});p.View.UploadSimilar=p.View.Base.extend({template:'<p class="warn"> Wir haben ein paar Bilder mit ähnlichem Fingerprint gefunden. Bist Du sicher, dass es sich nicht um einen Repost handelt? </p> <div class="upload-similar-images"> <?js for( var i = 0; i < similar.length; i++ ) { var item = similar[i]; ?> <a href="/new/{item.id}" target="_blank" class="similar-thumb"><img src="{item.thumb}"/></a> <?js } ?> </div> ',show:function(similar){for(var i=0;i<similar.length;i++){var item=similar[i];item.thumb=CONFIG.PATH.THUMBS+item.thumb;item.image=CONFIG.PATH.IMAGES+item.image;item.fullsize=item.fullsize?CONFIG.PATH.FULLSIZE+item.fullsize:null;}
this.data.similar=similar;this.parent();}});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.UploadQueue=p.View.Base.extend({name:'overlay-upload-queue',resetViewport:false,template:'<div class="overlay-content"> <h2 class="main-message">Schlitz in der Warteschlange</h2> </div> <div class="overlay-content"> <h1 class="queue-position">{position}</h1> <?js if (status == \'processing\') {?> <p class="queue-description"> Wird verarbeitet&hellip; </p> <?js } ?> <p class="queue-description"> (Dein Hochlad wird auch weiter verarbeitet<br/> wenn Du dieses Fenster schließt.) </p> </div> ',data:{status:'pending','position':'...'},queueId:0,pollTimeout:0,init:function(container,parent,queueId){this.queueId=queueId;this.parent(container,parent);this.poll();},poll:function(){p.api.get('items.queue',{id:this.queueId},this.pollResult.bind(this));},pollResult:function(response){if(response.status=='error'){p.mainView.showOverlay(p.View.Overlay.Error,{code:'INTERNER FEHLER',msg:'Fehler bei der Verarbeitung. QueueId: '+$this.queueId});return;}
this.data.status=response.status;this.data.position=response.position;this.show();if(response.status=='done'){p.mainView.closeOverlay();p.user.voteCache.votes.items[response.item.id]=1;p.navigateTo('new/'+response.item.id);}
else{this.pollTimeout=setTimeout(this.poll.bind(this),2000);}},remove:function(){clearTimeout(this.pollTimeout);this.parent();}});p.View.Upload=p.View.Base.extend({title:"Hochladen",template:'<h1 class="pane-head">Datei hochladen</h1> <div class="pane form-page"> <?js if( error ) {?> <?js if( error === \'invalidType\' ) {?> <h2 class="warn">Ungültiger Dateityp</h2> <p>Nur JPEG, PNG, GIF, WebM oder MP4 erlaubt.</p> <?js } else if( error === \'invalid\' ) {?> <?js if(report) {?> <h2 class="warn">Ungültige Datei-Eigenschaften ◉︵◉</h2> <p> <?js if(report.error === \'dimensionsTooSmall\') {?> Die Auflösung ist zu klein – Mindestens 0,09 Megapixel (z.B. 300×300). <?js } else if(report.error === \'dimensionsTooLarge\') {?> Die Auflösung ist zu hoch – Maximal 20,25 Megapixel (z.B. 4608×4608). <?js } else if(report.error === \'durationTooLong\') {?> Das Video ist zu lang – Maximal 300 Sekunden. <?js } else if(report.error === \'invalidCodec\') {?> Ungültiges Codec gefunden – Nur VP8, VP9 oder H264 für Video bzw. AAC, Vorbis oder Opus für Audio erlaubt. <?js } else if(report.error === \'invalidStreams\') {?> Ungültige Stream-Konstellation (z.B zwei Video Streams). <?js } else if(report.error === \'invalidContainer\') {?> Ungültige Container/Codec-Konstellation. (z.B. VP8 in einem MP4 Container). <?js } ?> </p> <h2 class="section">Details zur Hochgeladenen Datei:</h2> <p> Format: {report.format}, {report.width}×{report.height} Pixel <?js if(report.duration) {?>, {report.duration} Sekunden<?js } ?> </p> <?js if(report.streams && report.streams.length) {?> <h3>Streams:</h3> <ol> <?js for(var i = 0; i < report.streams.length; i++) { var stream = report.streams[i]; ?> <li>Typ: {{stream.type}}, Codec: {{stream.codec}}</li> <?js } ?> </ol> <?js } ?> <?js } else {?> <p class="warn">Unbekanntes Dateiformat &#175;\\_(&#12484;)_/&#175;</p> <?js }?> <?js } else if( error === \'blacklisted\' ) {?> <h2 class="warn">Bild oder Domain gesperrt</h2> <p class="warn">Gesperrte Bilder wurden meist schon einmal durch einen Moderator gelöscht.</p> <?js } else if( error === \'internal\' ) {?> <h2 class="warn">Interner Fehler bei der Verarbeitung</h2> <?js } else if( error === \'download\' ) {?> <h2 class="warn">Download fehlgeschlagen</h2> <p>Die maximale Dateigröße ist 10MB bzw. 20MB für <a href="#pr0mium">pr0mium-Accounts</a>.</p> <?js } else if( error === \'upload\' ) {?> <h2 class="warn">Upload fehlgeschlagen</h2> <p>Die maximale Dateigröße ist 10MB bzw. 20MB für <a href="#pr0mium">pr0mium-Accounts</a>.</p> <?js } else if( error === \'missingData\' ) {?> <h2 class="warn">Kein Bild oder URL angegeben</h2> <?js } else if( error === \'uploadNotSupported\' ) {?> <h2 class="warn">Datei-Upload wird nicht unterstüzt</h2> <p>Vielleicht solltest du mal darüber nachdenken, nicht so einen Unterschichten-Brauser zu benutzen.</p> <?js } else if( error === \'paymentRequired\' ) {?> <h2 class="warn">pr0mium benötigt</h2> <p>Nur mit <a href="pr0mium">pr0mium</a> kannst du Hochlads vorausplanen</p> <?js } else if( error === \'timeForbidden\' ) {?> <h2 class="warn">Ungültige Zeitauswahl</h2> <p>Hochlads können nur für 6 - 24 Uhr geplant werden!</p> <?js } else if( error === \'dateInPast\' ) {?> <h2 class="warn">Ungültige Datumsauswahl</h2> <p>Ihr Auswahl darf nicht zurückliegen!</p> <?js } else if( error === \'dateInPast\' ) {?> <h2 class="warn">Ungültige Datumsauswahl</h2> <p>Ein Vorausplanen von Hochlads ist nur für jeweils 7 Tage möglich!</p> <?js } else if( error === \'dailyLimitReached\' ) {?> <h2 class="warn">Tageslimit erreicht</h2> <p>Für einen Tag lassen sich maximal 5 Hochlads vorausplanen!</p> <?js } ?> <p><span class="link" id="upload-link">Na gut…</span></p> <?js } else { ?> <form id="upload-form"> <div id="upload-source"> <div id="upload-droparea"> Datei auswählen <?js if(supportsDragDrop) { ?> oder per Drag &amp; Drop reinziehen <?js } ?> </div> <div> <h3 class="upload-enter-url">oder URL angeben</h3> <input type="text" name="imageUrl" id="upload-url" placeholder="http://" class="wide"/> <input type="file" name="image" id="upload-file"/> </div> </div> <p> Erlaubte Dateitypen: JPEG, PNG, GIF mit min. 0,09 Megapixel (z.B. 300×300), max. 20,25 Megapixel (z.B. 4608×4608). Videos als WebM (VP8/Vorbis/Opus) oder MP4 (H264/AAC), max. 300sek. </p> <p> Die maximale Dateigröße ist 10MB bzw. 20MB für <a href="#pr0mium">pr0mium-Accounts</a>. </p> <div id="upload-progress"> <div id="upload-preview"></div> <div class="progress-bar"> <div class="progress"></div> </div> </div> <div class="upload-tag-container"> <?js if(!!p.user.verified) { ?> <div class="sfw-status"> <input type="radio" class="box-from-label" name="sfwstatus" value="sfw" id="ratingSfw"> <label title="Safe for Work" for="ratingSfw">sfw</label> <input type="radio" class="box-from-label" name="sfwstatus" value="nsfw" id="ratingNsfw"> <label title="Not Safe for Work" for="ratingNsfw">nsfw</label> <input type="radio" class="box-from-label" name="sfwstatus" value="nsfl" id="ratingNsfl"> <label title="Not Safe for Life" for="ratingNsfl">nsfl</label> <input type="radio" class="box-from-label" name="sfwstatus" value="nsfp" id="ratingNsfp"> <label title="Safe for Work aber nur f&uuml;r registrierte Benutzer" for="ratingNsfp">sfw/nsfp</label> </div> <?js } ?> <h3>Tags</h3> <input type="text" class="upload-tagsinput" name="tags"/> <span class="warn" id="warn_taglimit" style="display: none"> Du kannst maximal 10 Tags gleichzeitig eingeben! </span> </div> <div class="grid" style="column-gap: 5px"> <div class="schedule-upload" style="grid-column: auto /span 6;"> <h3>Vorausplanen (<a href="/pr0mium">pr0mium</a>)</h3> <input style="min-width: 50%" type="date" id="schedule-date" min="" max="" name="scheduleDate" pattern="\\d{4}-\\d{2}-\\d{2}"> <input style="min-width: 45%" type="time" id="schedule-time" name="scheduleTime" min="06:00" max="24:55" pattern="\\d{2}:\\d{2}"> <br> <span class="warn">Hochlads können nur für 6 - 24 Uhr geplant werden</span> </div> <div class="default-comment" style="grid-column: auto /span 6;"> <h3>Kommentar</h3> <textarea minlength="3" class="comment" name="comment" style="height: 30px" placeholder="Kommentar schreiben…" title="Kommentar schreiben [c]"></textarea> </div> </div> <div class="upload-similar"></div> <div> <input type="hidden" name="checkSimilar" value="1"/> <input type="submit" class="button" value="Datei Hochladen" disabled="disabled"/> </div> <input type="hidden" name="key" value=""/> <input type="hidden" name="processAsync" value="1"/> </form> <div class="post-filter"></div> <div class="post-rules"></div> <?js } ?> </div> ',data:{error:null,report:null},uploadInProgress:false,postInProgress:false,hasUpload:false,currentFileType:null,init:function(container,parent){this.parent(container,parent);p.mainView.setTab(null);},show:function(params){if(!p.mainView.requireLogin()){return false;}
this.data.tab=params.tab||'bookmarklet';return this.parent(params);},load:function(){p.api.post('items.ratelimited');return true;},render:function(){if(!this.supportsFileUpload()){this.data.error='uploadNotSupported';}
this.data.supportsDragDrop=this.supportsDragDrop();this.parent();let that=this;let tags=this.$container.find('.upload-tagsinput');let options=CONFIG.TAGS_INPUT_SETTINGS;let taglimit=$('#warn_taglimit');options.onAddTag=function(elem){let tag=elem.toString();if(tag==='nsfw'||tag==='nsfl'||tag==='nsfp')return;if($('.tag').length>10){$(this).removeTag(elem);taglimit.show();}else{taglimit.hide();}};let tagInput=tags.tagsInput(options);p.api.get('tags.top',{},function(response){this.$container.find('.tagsinput input').autocomplete({minLength:3,delay:200,autoFocus:false,source:response.tags,select:function(event,ui){tagInput.addTag(ui.item.value);ui.item.value=null;that.$container.find('.ui-autocomplete-input').focus();}});}.bind(this));if(!!p.user.verified){this.$container.find('input[name=sfwstatus]').change(function(){that.setSFWTags($(this));});}
this.$container.find('textarea[name=comment]').click(function(){this.style.height='140px';})
let $dropTargets=this.$container.find('#upload-droparea').add('body');let $dropArea=this.$container.find('#upload-droparea');$dropTargets.on('dragover',function(){$dropArea.addClass('active');return false;});$dropTargets.on('dragend dragout dragleave',function(){$dropArea.removeClass('active');return false;});$dropTargets.on('drop',function(ev){$dropArea.removeClass('active');ev.preventDefault();that.readFiles(ev.originalEvent.dataTransfer.files);return false;});let $fileSelect=this.$container.find('#upload-file');$dropArea.on('click',function(){$fileSelect.click();});let fileUpload=this.$container.find('#upload-file');fileUpload.on('change',function(ev){that.readFiles(this.files);});this.$container.find('#upload-url').on('change keypress paste',function(ev){setTimeout(that.validateUrl.bind(that,ev),1);});this.$container.find('#upload-form').submit(this.submit.bind(this));this.$container.find('#upload-link').click(function(){this.data={error:null,report:null};this.render();}.bind(this));let dateFormated=(date)=>{let day=('0'+date.getDate()).slice(-2);let month=('0'+(date.getMonth()+1)).slice(-2);return`${date.getFullYear()}-${month}-${day}`};let scheduledDate=document.getElementById('schedule-date');scheduledDate.setAttribute("min",dateFormated(new Date()));let date=new Date();date.setDate(date.getDate()+7);scheduledDate.setAttribute("max",dateFormated(date));this.rulesView=new p.View.Rules(this.$container.find('.post-rules'),this);if(!!p.user.verified){this.filterView=new p.View.Filter(this.$container.find('.post-filter'),this);}
this.currentFileType=null;},setSFWTags:function($radio){let tags=this.$container.find('.upload-tagsinput');let status=$radio.val();tags.removeTag('nsfw');tags.removeTag('nsfl');tags.removeTag('nsfp');if(status!=='sfw'){if($('.tag').length>=5)$('.tag:last').remove();tags.addTag(status);}},validateUrl:function(ev){let url=$(ev.target).val();if(this.hasUpload||url.match(/^https?:\/\/[^\s\/$.?#].[^\s]*$/i)){this.$container.find('input[type=submit]').removeAttr('disabled');}
else{this.$container.find('input[type=submit]').attr('disabled','disabled');}},remove:function(){$('body').off('dragover dragend dragout dragleave drop');},submit:function(ev){let imageUrl=this.$container.find('input[name=imageUrl]').val();if(this.uploadInProgress||this.postInProgress||(!imageUrl&&!this.hasUpload)){return false;}
if(!!p.user.verified&&!this.$container.find('input[name=sfwstatus]:checked').length){this.$container.find('.sfw-status').highlight(252,136,52,1);return false;}
this.postInProgress=true;p.api.post('items.post',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(response.error){this.postInProgress=false;if(response.error=='similar'){this.similarView=new p.View.UploadSimilar(this.$container.find('.upload-similar'),this);this.similarView.show(response.similar);this.$container.find('input[type=submit]').removeAttr('disabled');this.$container.find('input[name=checkSimilar]').val(0);}
else{this.data.error=response.error;this.data.report=response.report;this.render();}}
else if(response.item){p.mainView.closeOverlay();p.user.voteCache.votes.items[response.item.id]=1;p.navigateTo('new/'+response.item.id);}
else if(response.scheduled){p.mainView.closeOverlay();p.navigateTo('scheduled');}
else{p.mainView.showOverlay(p.View.Overlay.UploadQueue,response.queueId);}},readFiles:function(files){if(this.currentFileType!==null){return;}
let file=files[0];if(!file||CONFIG.API.ALLOWED_UPLOAD_TYPES.indexOf(file.type)===-1){this.data.error='invalidType';this.render();return;}
this.currentFileType=file.type;this.uploadInProgress=true;this.$container.find('input[type=submit]').attr('disabled','disabled');let reader=new FileReader();reader.onload=this.previewLoaded.bind(this);reader.readAsDataURL(file);let that=this;let formData=new FormData();formData.append('image',file);let req=new XMLHttpRequest();req.onload=function(ev){that.uploadComplete(req);};req.onerror=function(ev){that.uploadError(req);};if(req.upload){req.upload.onprogress=this.uploadProgress.bind(this);}
req.open('POST',CONFIG.API.ENDPOINT+'items/upload');req.send(formData);},previewLoaded:function(ev){this.$container.find('#upload-source').remove();this.$container.find('#upload-preview').show();if(this.currentFileType.match(/^video/)){let video=$('<video autoplay loop muted/>').attr('src',ev.target.result);this.$container.find('#upload-preview').append(video);}
else if(this.currentFileType.match(/^image/)){let image=$('<img/>');image.attr('src',ev.target.result);this.$container.find('#upload-preview').append(image);}},uploadError:function(req){this.data.error='upload';this.render();},uploadComplete:function(req){if(req.status!==200){this.uploadError(req);return;}
this.uploadInProgress=false;this.hasUpload=true;this.setProgress(1.0);let response=JSON.parse(req.responseText);this.$container.find('input[type=submit]').removeAttr('disabled');this.$container.find('input[name=key]').val(response.key);},uploadProgress:function(ev){if(!ev.lengthComputable){return;}
let progress=(ev.loaded/ev.total);this.setProgress(progress);},setProgress:function(progress){progress=Math.round(progress*100);this.$container.find('.progress').css('width',progress+'%');},supportsFileUpload:function(){return(typeof FileReader!='undefined'&&!!window.FormData&&'upload'in new XMLHttpRequest);},supportsDragDrop:function(){return('draggable'in document.createElement('span'));}});p.View.Scheduled=p.View.Base.extend({title:"Geplante Hochlads",template:'<h1 class="pane-head">Geplante Hochlads</h1> <div class="pane"> <?js if (items.length === 0) { ?> <h3>Keine geplanten Hochlads</h3> <?js } ?> <?js for( var i = 0; i < items.length; i++ ) { let item = items[i]; ?> <div class="scheduled-items"> <div class="thumb"> <img src="{CONFIG.PATH.THUMBS}/{item.thumb}"> </div> <div class="info"> Geplant zu: {item.date.readableTime()}<br> Tags: {{item.tags.toString()}}<br> <?js if (item.comment) { ?>Kommentar: <textarea disabled readonly>{{item.comment}}</textarea><br><?js } ?> <form method="post" id="scheduled-item-remove"> <input type="hidden" name="id" value="{item.id}"> <input type="submit" value="Entfernen"/> </form> </div> </div> <?js } ?> </div>',requiresLogin:true,load:function(){p.api.get('items.scheduled',{},this.loaded.bind(this));return false;},loaded:function(response){response.items.forEach(item=>{item.date=new Date(item.scheduled*1000);});this.data.items=response.items;this.render();},render:function(){this.parent();let that=this;this.$container.find('#scheduled-item-remove').submit(function(ev){p.api.post('items.removeScheduled',ev.currentTarget,(res)=>{that.load();});that.$container.find('input[type=submit]').attr('disabled','disabled');that.showLoader();return false;});}});p.View.Contact=p.View.Base.extend({title:"Kontaktformular",template:p.load('frontend/templates/contact.html',p.LOAD.LAZY),data:{sent:false,category:null,article:p.getQuery('article')},load:function(category=null){p.api.get('faq.all',null,this.loaded.bind(this));},loaded:function(response){this.data.faqCategories=response.categories;this.render();},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));this.focus('input[name=subject]');if(p.getQuery('category')){this.data.category=p.getQuery('category');this.$container.find('#faqCategory').val(this.data.category);}},submit:function(ev){if($('input[name=subject]').val().match(/^\s*$/)){$('input[name=subject]').highlight(252,136,52,1,200,function(el){el.css('background-color','#1B1E1F');});return false;}
if(!$('input[name=email]').val().match(/.+@.+\..+/)){$('input[name=email]').highlight(252,136,52,1,200,function(el){el.css('background-color','#1B1E1F');});return false;}
p.api.post('contact.send',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){this.data.sent=true;this.render();}});p.View.FAQ=p.View.Base.extend({title:"FAQ",template:p.load('frontend/templates/faq.html',p.LOAD.LAZY),rulesView:null,filterView:null,data:{error:null,search:null,category:null,categories:[],article:null,articles:[],relatedArticles:[]},getFragment:function(){const fragment=p.getFragment();return(fragment.indexOf('/')!==-1)?fragment.substring(0,fragment.indexOf('/')):fragment;},load:function(){this.data.category=(this.data.params)?this.data.params.category:this.data.category;this.data.article=(this.data.params)?this.data.params.article:this.data.article;this.data.search=(this.data.params['category']==="search")?this.getFragment():this.data.search;p.api.get('faq.get',{category:this.data.category,article:this.data.article||p.getURL().split('/')[2],search:this.data.search},this.loaded.bind(this));},loaded:function(response){this.data.categories=response['categories']||[];this.data.articles=response.results||response['articles']||[];this.data.article=response['article']||null;this.data.relatedArticles=response['relatedArticles']||[];this.render();},reset:function(){this.data.error=null;this.data.category=null;this.data.categories=[];this.data.article=null;this.data.articles=[];this.data.relatedArticles=[];},render:function(){this.parent();this.$container.find('#faq-search-btn').click(()=>{const q=encodeURIComponent(this.$container.find('#faq-search').val());this.search(q);});this.rulesView=new p.View.Rules(this.$container.find('.faq-rules'),this);this.rulesView.show();if(!!p.user.id&&!!p.user.verified){this.filterView=new p.View.Filter(this.$container.find('.faq-filter'),this);this.filterView.show();}
document.addEventListener('keyup',(ev)=>{if(this.$container.find('#faq-search').is(':focus')&&ev.code==='Enter'){ev.preventDefault();this.$container.find('#faq-search-btn').click();}});window.onpopstate=(ev)=>{this.reset();this.load();}},search:function(q){p.api.get('faq.search',{search:q},res=>{this.reset();this.data.search=q;if(res.results.length<=0){this.data.error='noResults';}else{this.data.category="search";this.data.articles=res.results;}
p.navigateTo('faq/search:'+q,p.NAVIGATE.SILENT);this.render();});},});p.View.Overlay=p.View.Overlay||{};p.View.Overlay.Wirepay=p.View.Base.extend({name:'overlay-error',resetViewport:false,template:'<div class="overlay-content"> <h2 class="warn">Achtung</h2> </div> <div class="overlay-content"> <h2>Andere Zahlarten</h2> <p>Leider sind andere Zahlarten wie z.B. &Uuml;berweisung/Vorkasse im Moment nur &uuml;ber unseren Partner pr0mart m&ouml;glich: <a href="https://pr0mart.com/product/sonstiges/coupon12acc-classic/66/" target="_blank">zum pr0mart</a></p> </div> '});p.View.BuyCode=p.View.BuyCode||{};p.View.BuyCode.Products=p.View.Base.extend({title:"pr0mium",data:{error:null,account:{email:'',paidUntil:null}},template:'<h1 class="pane-head">pr0mium Account</h1> <div class="pane no-select"> <div class="divide-3-1"> <h2 class="feature-head">Werbefrei</h2> <div class="feature-icon"> <img src="/media/pr0mium/star.png" alt=""/> </div> <p class="feature-description"> Das pr0gramm, wie es sein sollte: ohne Werbebanner und drölf Prozent schneller. </p> </div> <div class="divide-3-2"> <h2 class="feature-head">Stelzen</h2> <div class="feature-icon"> <img src="/media/pr0mium/binoculars.png" alt=""/> </div> <p class="feature-description"> Folge Deinen Lieblings-Nutzern und verpasse dank Benachrichtigung nie wieder einen Upload. </p> </div> <div class="divide-3-3"> <h2 class="feature-head">admins füttern</h2> <div class="feature-icon"> <img src="/media/pr0mium/burger.png" alt=""/> </div> <p class="feature-description"> Unterstütze die Weiterentwicklung von pr0gramm. </p> </div> <div class="clear"></div> <div class="product-sub-feature"> <span class="pict product-sub-feature-icon">u</span> Als pr0mium-Nutzer darfst Du Dateien mit bis zu 20MB hochladen (statts nur 10MB). Außerdem darfst du einen Hochlad mehr pro 12h tätigen. </div> <div class="product-sub-feature"> <svg viewBox="0 0 384 512" class="icon bookmark-icon product-sub-feature-icon"> <path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"/> </svg> Deine Lesezeichen lassen sich frei verwalten. </div> <div class="product-sub-feature"> <span class="producte-feature-status product-sub-feature-icon">●</span> Du hast die Wahl, ob Du als <span class="user um9">“Edler Spender</span>” oder mit dem normalen Status angezeigt wirst. </div> <div class="product-sub-feature" style="padding-left: 13px"> <span class="pict product-sub-feature-icon" style="margin-right: 6px">a</span> Blockiere einen Nutzer für das Senden von privaten Nachrichten, Kommentaren und Markierungen. </div> <div class="product-sub-feature"> <svg viewBox="0 0 640 512" class="icon product-sub-feature-icon" style="width: 18px; fill: currentColor;"> <path d="M132.65,212.32,36.21,137.78A63.4,63.4,0,0,0,32,160a63.84,63.84,0,0,0,100.65,52.32Zm40.44,62.28A63.79,63.79,0,0,0,128,256H64A64.06,64.06,0,0,0,0,320v32a32,32,0,0,0,32,32H97.91A146.62,146.62,0,0,1,173.09,274.6ZM544,224a64,64,0,1,0-64-64A64.06,64.06,0,0,0,544,224ZM500.56,355.11a114.24,114.24,0,0,0-84.47-65.28L361,247.23c41.46-16.3,71-55.92,71-103.23A111.93,111.93,0,0,0,320,32c-57.14,0-103.69,42.83-110.6,98.08L45.46,3.38A16,16,0,0,0,23,6.19L3.37,31.46A16,16,0,0,0,6.18,53.91L594.53,508.63A16,16,0,0,0,617,505.82l19.64-25.27a16,16,0,0,0-2.81-22.45ZM128,403.21V432a48,48,0,0,0,48,48H464a47.45,47.45,0,0,0,12.57-1.87L232,289.13C173.74,294.83,128,343.42,128,403.21ZM576,256H512a63.79,63.79,0,0,0-45.09,18.6A146.29,146.29,0,0,1,542,384h66a32,32,0,0,0,32-32V320A64.06,64.06,0,0,0,576,256Z"/> </svg>Pro 180 Tage pr0mium darfst Du einen eingeladenen Benutzer vom eigenen Account ablösen und haftest nicht mehr für ihn. </div> <div class="product-sub-feature"> <svg viewBox="0 0 576 512" class="icon product-sub-feature-icon" style="width: 18px; fill: currentColor;"> <path d="M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-352 96c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H86.4C74 384 64 375.4 64 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2zM512 312c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"/> </svg>2x im Jahr einen Namenswechsel durchführen (statts nur 1x). </div> <div class="clear spacing"></div> <div class="product-overview-grid"> <?js if(p.user.id) { ?> <div class="product-grid offer-1" id="product-pr0mium90"> <div class="title"> 3 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium90.discount) { let price = products.pr0mium90.price - products.pr0mium90.discount; let monthly = (price / Math.floor(products.pr0mium90.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium90.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium90.price / Math.floor(products.pr0mium90.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium90.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button product-type" data-name="pr0mium90">3 Monate auswählen</span> <div class="product-dropdown"> <a class="select-product" data-name="pr0mium90">für vorhandenen Account</a> <a class="select-product" data-name="pr0mium90acc">inkl. neuem Account (+{{accountOption.toString()}}€)</a> </div> </div> </div> <div class="product-grid offer-2" id="product-pr0mium365"> <div class="title"> 12 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium365.discount) { let price = products.pr0mium365.price - products.pr0mium365.discount; let monthly = (price / Math.floor(products.pr0mium365.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium365.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly middle">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium365.price / Math.floor(products.pr0mium365.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium365.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly middle">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button product-type" data-name="pr0mium365">12 Monate auswählen</span> <div class="product-dropdown"> <a class="select-product" data-name="pr0mium365">für vorhandenen Account</a> <a class="select-product" data-name="pr0mium365acc">inkl. neuem Account (+{{accountOption.toString()}}€)</a> </div> </div> </div> <div class="product-grid offer-3" id="product-pr0mium183"> <div class="title"> 6 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium183.discount) { let price = products.pr0mium183.price - products.pr0mium183.discount; let monthly = (price / Math.floor(products.pr0mium183acc.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium183.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium183.price / Math.floor(products.pr0mium183.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium183.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button product-type" data-name="pr0mium183">6 Monate auswählen</span> <div class="product-dropdown"> <a class="select-product" data-name="pr0mium183">für vorhandenen Account</a> <a class="select-product" data-name="pr0mium183acc">inkl. neuem Account (+{{accountOption.toString()}}€)</a> </div> </div> </div> <?js } else { ?> <div class="product-grid offer-1" id="product-pr0mium90acc"> <div class="title"> 3 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium90acc.discount) { let price = products.pr0mium90acc.price - products.pr0mium90acc.discount; let monthly = (price / Math.floor(products.pr0mium90acc.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium90acc.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium90acc.price / Math.floor(products.pr0mium90acc.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium90acc.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button select-product" data-name="pr0mium90acc">3 Monate auswählen</span> </div> </div> <div class="product-grid offer-2" id="product-pr0mium365acc"> <div class="title"> 12 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium365acc.discount) { let price = products.pr0mium365acc.price - products.pr0mium365acc.discount; let monthly = (price / Math.floor(products.pr0mium365acc.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium365acc.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly middle">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium365acc.price / Math.floor(products.pr0mium365acc.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium365acc.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly middle">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button select-product" data-name="pr0mium365acc">12 Monate auswählen</span> </div> </div> <div class="product-grid offer-3" id="product-pr0mium183acc"> <div class="title"> 6 MONATE PR0MIUM </div> <div class="price"> <?js if(products.pr0mium183acc.discount) { let price = products.pr0mium183acc.price - products.pr0mium183acc.discount; let monthly = (price / Math.floor(products.pr0mium183acc.days / 30)).toPrice().toString(); ?> <div class="discount-badge"><div>REDUZIERT</div></div> <span class="price-detail discount">{{products.pr0mium183acc.price.toPrice().toString()}}€</span> {{price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } else { let monthly = (products.pr0mium183acc.price / Math.floor(products.pr0mium183acc.days / 30)).toPrice().toString(); ?> <span class="price-detail">nur</span> {{products.pr0mium183acc.price.toPrice().toString()}}<span class="price-symbol">€</span> <br><span class="price-monthly">({{monthly}}€/Monat)</span> <?js } ?> </div> <div class="select"> <span class="button confirm-button select-product" data-name="pr0mium183acc">6 Monate auswählen</span> </div> </div> <?js } ?> </div> <div class="clear" id="step-2"></div> <form method="post" id="payment-form"> <h2 class="selected-product-head"></h2> <p class="warn" id="account" style="font-weight: bold;">Nach Ablauf des pr0miums, ist der Account weiterhin kostenlos nutzbar.</p> <p class="warn" id="no-account">Wenn Du noch keinen Account hast und Dir einen Account erstellen möchtest, musst du Deine <a id="select-account-option">Auswahl ändern</a>.</p> <span class="clear"></span> <p> Sofort nach Bestätigung Deiner Zahlung bekommst Du von uns eine E-Mail mit Deinem pr0mium-Code. </p> <div id="gift"> <input type="checkbox" class="box-from-label" id="as_gift" name="as_gift"/> <label for="as_gift">Als Geschenk kaufen</label> <div id="gift-receiver"> <span class="warn" id="gift-receiver-error"></span> <p>Die Angabe des Empfängers und einer Grußnachricht sind optional, alternativ kannst Du die Felder leer lassen und Deinem Beschenkten den pr0mium-Code eigenständig zukommen lassen.</p> <div id="gift-receiver-name" class="form-row"> <label id="gift_user_label" for="gift_user">Nutzername: </label> <input id="gift_user" name="gift_user" type="text" minlength="3" maxlength="32" accept="text/plain" placeholder="Gamb"><span class="gift-select confirm-button">Übernehmen</span> </div> <div id="gift-receiver-mail" class="form-row"> <label id="gift_mail_label" for="gift_mail">E-Mailadresse: </label> <input id="gift_mail" name="gift_mail" type="email" accept="text/plain" placeholder="Gamb@pr0gramm.com"><span class="gift-select confirm-button">Übernehmen</span> </div> <span id="gift-deselect" class="confirm-button">Auswahl ändern</span> </div> <div id="gift-greeting"> <label for="gift_message">Grußnachricht:</label> <textarea accept="text/plain" id="gift_message" name="gift_message" placeholder="Hinterlasse eine Nachricht..."></textarea> </div> <input type="hidden" name="gift_item"> <input type="hidden" name="gift_reciver"> </div> <div class="form-row"> <h3>Deine E-Mail Adresse:</h3> <input id="email" type="email" name="email" value="{{account.email}}" required class="text-line important" placeholder="E-Mail Adresse"/> <p class="warn" id="email-invalid">Ungültige E-Mail Adresse</p> <h3>Bitte bestätige Deine E-Mail Adresse:</h3> <input id="email_confirm" type="email" name="email_confirm" value="{{account.email}}" required class="text-line important" placeholder="E-Mail Adressen Bestätigung"/> <p class="warn" id="email-confirm-invalid">Ungültige E-Mail Adresse</p> <p class="warn" id="email-confirm-nomatch">Die beiden E-Mail Adressen stimmen nicht überein</p> </div> <div class="form-row" id="tos-row"> <input type="checkbox" class="box-from-label" id="tos" name="tos"/> <label for="tos">Ich habe die <a target="_blank" href="/tos">AGB und Widerrufsbelehrung</a> gelesen und stimme dieser zu.</label> <p class="warn" id="tos-not-accepted">Die AGB muss akzeptiert werden.</p> </div> <div class="form-row" id="datasafety-row"> <input type="checkbox" class="box-from-label" id="datasafety" name="datasafety"/> <label for="datasafety">Ich habe die <a target="_blank" href="/datasafety">Datenschutzerklärung</a> gelesen und stimme dieser zu.</label> <p class="warn" id="gdpr-not-accepted">Du musst die Datenschutzerklärung lesen und zustimmen.</p> </div> <div class="form-row"> <input type="hidden" name="product" value="invalid"/> <input type="hidden" name="cryptocurrency" id="cryptocurrency"> <input type="button" class="pay-with-braintree checkout confirm" value="Zahlen mit Kreditkarte"/> <input type="button" class="pay-with-wire checkout confirm" value="Andere Zahlarten"/> <br> <input type="button" class="pay-with-coinpayments checkout confirm" data-currency="btc" value="Zahlen mit Bitcoin (BTC)"/> <input type="button" class="pay-with-coinpayments checkout confirm" data-currency="eth" value="Zahlen mit Ethereum (ETH)"/> </div> </form> <div id="bt-overlay"> <div id="bt-window"> <form id="bt-checkout" method="post" action="/api/braintree/charge" > <a id="bt-logo" href="https://www.braintreegateway.com/merchants/yhmycp4cr95zss48/verified" target="_blank"> <img src="https://s3.amazonaws.com/braintree-badges/braintree-badge-wide-dark.png" width="280px" height ="44px" border="0"/> </a> <div id="dropin-container"></div> <input type="submit" id="bt-complete-payment" value="Zahlung abschließen"> <input type="hidden" id="nonce" name="payment_method_nonce"/> <input type="hidden" id="device-data" name="device-data"/> <input type="hidden" id="bt-token" name="token" value=""/> <input type="hidden" id="bt-client-token" name="client-token" value=""/> </form> </div> </div> <p class="faint-footer"> <a target="_blank" href="/tos">AGB und Widerrufsbelehrung</a> / <a target="_blank" href="/imprint">Impressum</a> / <a target="_blank" href="/datasafety">Datenschutzerklärung</a> </p> </div> ',load:function(){if(this.data.params.iap){$('#head').hide();}
p.api.get('pr0mium.getProducts',null,this.loaded.bind(this));return false},loaded:function(response){this.data.products=response.products;this.data.accountOption=response.accountOption;if(response.user){this.data.account=response.user;this.data.account.paidUntil=(this.data.account.paidUntil)?new Date(this.data.account.paidUntil*1000):null;}
this.render();},render:function(){this.parent();this.$paymentForm=this.$container.find('#payment-form');this.$container.find('.select-product').click(this.selectProduct.bind(this));this.$container.find('.checkout').click(this.submit.bind(this));this.$container.find('.gift-select.confirm-button').click(this.selectGiftReceiver.bind(this));this.$container.find('#gift-deselect').click(this.deselectGiftReceiver.bind(this));this.$container.find('#select-account-option').click(this.selectAccountOption.bind(this));if(p.mobile){this.$container.find('.button.product-type').click(this.selectProductType.bind(this));}
$('#gift').hide();this.$container.find('#as_gift').click(gift=>{this.$container.find('#gift').toggleClass('gift');let giftMessage=this.$container.find('#gift-greeting');let giftReceiver=this.$container.find('#gift-receiver');if(gift.currentTarget.checked){giftMessage.fadeIn();giftReceiver.fadeIn();}else{giftMessage.fadeOut();giftReceiver.fadeOut();}});},selectProductType:function(ev){this.$container.find('.button.product-type').removeClass('selected');$(ev.currentTarget).addClass('selected');},selectProduct:function(ev,productName){this.$container.find('.button.product-type').removeClass('selected');document.getElementById('tos').checked=false;document.getElementById('datasafety').checked=false;let name=(ev!==null)?$(ev.currentTarget).data('name'):productName;let product=Object.assign({},this.data.products[name]);product.account=name.includes('acc');product.month=Math.floor(product.days/30);this.data.product=product;this.data.productName=name;product.price=(product.discount)?product.price-product.discount:product.price;let productTitle=`${(product.account)?'Account und ':''}${product.month}\ Monate pr0mium für ${product.price.toPrice()}€ kaufen`;this.$paymentForm.find('.selected-product-head').html(productTitle);if(product.account){this.$paymentForm.find('#gift-receiver-mail').show();this.$paymentForm.find('#gift-receiver-name').hide();this.$paymentForm.find('#no-account').hide();this.$paymentForm.find('#account').show();}else{this.$paymentForm.find('#gift-receiver-mail').hide();this.$paymentForm.find('#gift-receiver-name').show();this.$paymentForm.find('#no-account').show();this.$paymentForm.find('#account').hide();}
if(p.user.id){this.$paymentForm.find('#no-account').hide();}
this.$paymentForm.find('.pay-with-coinpayments').show();this.deselectGiftReceiver();this.$paymentForm.find('#email-invalid').hide();this.$paymentForm.find('#email-confirm-invalid').hide();this.$paymentForm.find('#email-confirm-nomatch').hide();this.$paymentForm.find('#gdpr-not-accepted').hide();this.$paymentForm.find('#tos-not-accepted').hide();this.$paymentForm.find('#email-blacklisted').hide();this.$paymentForm.find('input[name=product]').val(name);this.$paymentForm.find('#gift_mail').val('');this.$paymentForm.find('#gift_user').val('');this.$paymentForm.find('#gift-deselect').hide();this.$paymentForm.find('.gift-select.confirm-button').show();this.$paymentForm.find('input[name=gift_reciver]').val('0');if(!p.mobile&&!this.$paymentForm.is(':visible')){$('html, body').animate({scrollTop:this.$container.find('#step-2').offset().top});this.$paymentForm.slideDown();}else if(p.mobile){this.$paymentForm.show();$('html, body').scrollTop(this.$container.find('#step-2').offset().top);}},selectGiftReceiver:function(){this.showLoader();let that=this;function setReceiverByName(){let name=that.$paymentForm.find('#gift_user').val();p.api.get('profile.info',{name},(cb)=>{that.hideLoader();that.$paymentForm.find('#gift_user_label').append(`<span class="user um${cb.user.mark}">${cb.user.name}</span>`);that.$paymentForm.find('.gift-select.confirm-button').hide();that.$paymentForm.find('#gift_user').hide();that.$paymentForm.find('#gift-deselect').show();that.$paymentForm.find('#gift-receiver-error').html(null);that.$paymentForm.find('input[name=gift_reciver]').val('1');},(err)=>{that.hideLoader();if(err.status===404){that.$paymentForm.find('#gift-receiver-error').html('Der Nutzer konnte nicht gefunden werden!');}else{that.$paymentForm.find('#gift-receiver-error').html('Ein Fehler ist aufgetreten!');}},false);}
function setReceiverByMail(){let mail=that.$paymentForm.find('#gift_mail').val();if(!mail.match(/.+@.+\..+/)){that.$paymentForm.find('#gift-receiver-error').html('Ungültige E-Mail Adresse!');return;}
that.$paymentForm.find('#gift_mail').hide();that.$paymentForm.find('#gift_mail_label').append(mail);that.$paymentForm.find('.gift-select.confirm-button').hide();that.$paymentForm.find('#gift-deselect').show();that.$paymentForm.find('#gift-receiver-error').html(null);that.$paymentForm.find('input[name=gift_reciver]').val('1');that.hideLoader();}
if(this.data.product.account){setReceiverByMail();}else{setReceiverByName();}},deselectGiftReceiver:function(){if(this.data.product.account){this.$paymentForm.find('#gift_mail_label').html('E-Mailadresse: ');this.$paymentForm.find('#gift_mail').show();}else{this.$paymentForm.find('#gift_user_label').html('Nutzername: ');this.$paymentForm.find('#gift_user').show();}
this.$paymentForm.find('.gift-select.confirm-button').show();this.$paymentForm.find('#gift-deselect').hide();this.$paymentForm.find('input[name=gift_reciver]').val('0');},selectAccountOption:function(){this.selectProduct(null,this.data.productName+'acc');},scrollIntoForm:function(){$('html,body').animate({scrollTop:$("#payment-form").offset().top-100},'slow');},submit:function(ev){let email=$('input[name=email]').val();let email_confirm=$('input[name=email_confirm]').val();if(!email.match(/.+@.+\..+/)){$('#email-invalid').show();return false;}else{$('#email-invalid').hide();}
if(!email_confirm.match(/.+@.+\..+/)){$('#email-confirm-invalid').show();return false;}else{$('#email-confirm-invalid').hide();}
if(email!=email_confirm){$('#email-confirm-nomatch').show();return false;}else{$('#email-confirm-nomatch').hide();}
if(!this.$container.find('input[name=tos]:checked').length){this.$container.find('#tos-row').highlight(252,136,52,1);return false;}
if(!this.$container.find('input[name=datasafety]:checked').length){this.$container.find('#datasafety-row').highlight(252,136,52,1);return false;}
$('#email-invalid').hide();this.$paymentForm.find('.checkout').attr("disabled",true);this.showLoader();if($(ev.currentTarget).hasClass('pay-with-coinpayments')){$("#cryptocurrency").val($(ev.currentTarget).data("currency"));p.api.post('coinpayments.getpaymentaddress',this.$paymentForm,this.coinpaymentsCheckoutResponse.bind(this),()=>{this.$paymentForm.find('.checkout').attr("disabled",false);});}else if($(ev.currentTarget).hasClass('pay-with-braintree')){this.loadBraintreeJS(function(){p.api.post('braintree.getclienttoken',this.$paymentForm,this.braintreeCheckoutResponse.bind(this),()=>{this.$paymentForm.find('.checkout').attr("disabled",false);});}.bind(this));}else if($(ev.currentTarget).hasClass('pay-with-wire')){this.hideLoader();const pr0mart={'pr0mium365acc':'https://pr0mart.com/product/pr0mium/pr0mium365acc/247/','pr0mium365':'https://pr0mart.com/product/pr0mium/pr0mium365/244/','pr0mium183acc':'https://pr0mart.com/product/pr0mium/pr0mium183acc/246/','pr0mium183':'https://pr0mart.com/product/pr0mium/pr0mium183/243/','pr0mium90acc':'https://pr0mart.com/product/pr0mium/pr0mium90acc/245/','pr0mium90':'https://pr0mart.com/product/pr0mium/pr0mium90/242/'}
window.open(pr0mart[this.data.productName],'_blank')
this.$paymentForm.find('.checkout').attr("disabled",false);}else if($(ev.currentTarget).hasClass('pay-with-coinpayments')){$("#cryptocurrency").val($(ev.currentTarget).data("currency"));p.api.post('coinpayments.getpaymentaddress',this.$paymentForm,this.coinpaymentsCheckoutResponse.bind(this),()=>{this.$paymentForm.find('.checkout').attr("disabled",false);});}
return false;},loadBraintreeJS:function(callback){if(this.braintreeJSLoaded){callback();}else{$.getScript("https://js.braintreegateway.com/web/3.69.0/js/client.min.js");$.getScript("https://js.braintreegateway.com/web/3.69.0/js/data-collector.min.js");$.getScript("https://js.braintreegateway.com/web/dropin/1.25.0/js/dropin.min.js",function(){this.braintreeJSLoaded=true;callback();}.bind(this));}},braintreeCheckoutResponse:function(response){if(response.error){return;}
this.hideLoader();$('#bt-overlay').show();$('#bt-client-token').val(response.clientToken);$('#bt-token').val(response.internalToken);const form=document.getElementById('bt-checkout');braintree.dropin.create({authorization:response.clientToken,container:'#dropin-container'},(error,dropinInstance)=>{if(error)console.error(error);form.addEventListener('submit',event=>{$('#bt-complete-payment').hide();event.preventDefault();dropinInstance.requestPaymentMethod((error,payload)=>{if(error)console.error(error);document.getElementById('nonce').value=payload.nonce;form.submit();});});});},coinpaymentsCheckoutResponse:function(response){if(response.error){this.$paymentForm.find('.checkout').attr("disabled",false);}else{window.location=response.address;}}});p.View.BuyCode=p.View.BuyCode||{};p.View.BuyCode.PaypalThanks=p.View.Base.extend({template:p.load('frontend/templates/buy-code/paypal-thanks.html',p.LOAD.LAZY)});p.View.BuyCode=p.View.BuyCode||{};p.View.BuyCode.SubscriptionThanks=p.View.Base.extend({template:p.load('frontend/templates/buy-code/subscription-thanks.html',p.LOAD.LAZY)});p.View.BuyCode=p.View.BuyCode||{};p.View.BuyCode.GifThanks=p.View.Base.extend({template:p.load('frontend/templates/buy-code/gift-thanks.html',p.LOAD.LAZY)});p.View.RedeemShopCoupon=p.View.Base.extend({title:"Code Einlösen",template:p.load('frontend/templates/redeem-shop-coupon.html',p.LOAD.LAZY),data:{error:null,redeemed:false,code:''},render:function(){this.parent();this.$container.find('#redeem-form').submit(this.redeem.bind(this));this.focus('input[name=code]');},redeem:function(ev){this.data.error=null;this.data.code=this.$container.find('input[name=code]').val();p.api.post('user.redeemshopcoupon',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(response.error){this.data.error=response.error;}
else{this.data.error=null;this.data.redeemed=true;p.user.loadCookie();p.user.set('paid',true);}
this.render();}});p.View.Imprint=p.View.Base.extend({title:"Impressum",template:p.load('frontend/templates/imprint.html',p.LOAD.LAZY),});p.View.Datasafety=p.View.Base.extend({title:"Datenschutz",template:p.load('frontend/templates/datasafety.html',p.LOAD.LAZY),render:function(){this.parent();this.$container.find('#disable-ga').click(function(){p.user.set('gadisable',1);window['ga-disable-'+CONFIG.ANALYTICS.ACCOUNT]=true;this.resetViewport=false;this.render();}.bind(this));}});p.View.TOS=p.View.Base.extend({title:"AGB / Widerrufsbelehrung",template:p.load('frontend/templates/tos.html',p.LOAD.LAZY)});p.View.Search=p.View.Base.extend({title:"Erweiterte Suche",template:p.load("frontend/templates/search.html",p.LOAD.LAZY),q:[{logic:-1,type:"tag",include:true,value:""}],render:function(){this.parent();this.addListeners(0);this.tmpl=document.getElementById("template").innerText;let template=this.tmpl.replaceAll("{:id:}","1");this.$container.find("#search-wrapper").append(template);this.addListeners(1);this.addAutocomplete(0);document.getElementById("search-go").addEventListener("click",()=>{const tab=$("#search-top").prop("checked")?"top":"new";const search=document.getElementById("search").value;const q=(search.trim().length>0)?"/"+encodeURIComponent(search):"";p.navigateTo(tab+q,p.NAVIGATE.DEFAULT);});document.getElementById("search-save").addEventListener("click",()=>{const tab=$("#search-top").prop("checked")?"top":"new";p.mainView.showOverlay(p.View.Overlay.BookmarkAdd,{link:"/"+tab+"/"+encodeURIComponent(document.getElementById("search").value),name:document.getElementById("search").value||"Meine Suche"});});document.querySelector("input[name='q']")},addListeners:function(id){let value=this.$container.find(`*[name*='search[${id}][value]']`);let type=this.$container.find(`*[name*='search[${id}][type]']`);let include=this.$container.find(`*[name*='search[${id}][include]']`);let logic=this.$container.find(`*[name*='search[${id}][logic]']`);if(!this.q[id]){this.q[id]={};}
value[0].addEventListener("input",(ev)=>{this.q[id].value=ev.currentTarget.value;this.setSearch();if(ev.currentTarget.type==="range"){document.getElementById(`score[${id}]`).innerText=ev.currentTarget.value;}});include[0].addEventListener("input",(ev)=>{this.q[id].include=ev.currentTarget.value;this.setSearch();});type[0].addEventListener("input",(ev)=>{this.q[id].type=ev.currentTarget.value;this.setSearch();this.changeType(ev);});if(logic.length>0){logic[0].addEventListener("input",(ev)=>{this.q[id].logic=ev.currentTarget.value;this.setSearch();});}},setSearch:function(){const elem=document.getElementById("search");let q="!";this.q.forEach(s=>{let{logic,type,include,value}=s;if(!type||!value)return;value=value.trim();if(logic!=-1){q+=(logic&&logic==="|")?" | ":" & ";}else{q+=" ";}
q+=(include&&include==="-")?"-":"";switch(type){case"exactTag":q+=`"${value}"`;break;case"user":q+=`u:${value}`;break;case"date":q+=`d:${value.replaceAll("-",":")}`;break;case"score":q+=`s:${value}`;break;case"rank":q+=`m:${value}`;break
case"res":q+=`q:${value}`;break;default:q+=value;break;}});elem.value=q;},loadTemplate:function(name,values){let tmpl=document.getElementById(name).innerText;for(const[key,value]of Object.entries(values)){tmpl=tmpl.replaceAll(`{:${key}:}`,value);}
return tmpl;},getUsers:function(prefix){return new Promise((resolve,reject)=>{p.api.get("profile.suggest",{prefix:prefix},resolve,reject);})},addAutocomplete:function(id,type="tags"){let that=this;let field=this.$container.find(`input[name*='search[${id}][value]']`);function addTags(){field.autocomplete({minLength:3,delay:200,autoFocus:false,source:that.tags,select:function(event,ui){const regex=/([a-z]+)\[([0-9]+)\]\[([a-z]+)\]/gm;let m=regex.exec(event.target.name);that.q[m[2]].value=ui.item.value;that.setSearch();}});}
function addUsers(){field.autocomplete({minLength:3,delay:200,autoFocus:false,source:function(request,response){that.getUsers(request.term).then(res=>response(res.users));},select:function(event,ui){const regex=/([a-z]+)\[([0-9]+)\]\[([a-z]+)\]/gm;let m=regex.exec(event.target.name);that.q[m[2]].value=ui.item.value;that.setSearch();}});}
if(!this.tags&&type==="tags"){p.api.get("tags.top",{},function(response){that.tags=response.tags;addTags();});}else if(this.tags&&type==="tags"){addTags();}else if(type==="users"){addUsers();}},changeType:function(ev){const regex=/([a-z]+)\[([0-9]+)\]\[([a-z]+)\]/gm;let currentTarget=ev.currentTarget;let m=regex.exec(currentTarget.name);const[all,prefix,id,field]=m;let searchInput=$(`input[name*='search[${id}][value]']`);searchInput=(searchInput.length===0)?$(`select[name*='search[${id}][value]']`):searchInput;searchInput.disable=false;const parent=searchInput[0].parentElement;switch(currentTarget.value){case"tag":parent.innerHTML=this.loadTemplate("template-text-input",{id:id,placeholder:"Bitte gebe einen Tag ein..."});this.addAutocomplete(id);break;case"exactTag":parent.innerHTML=this.loadTemplate("template-text-input",{id:id,placeholder:"Bitte gebe einen Tag ein..."});this.addAutocomplete(id);break;case"user":parent.innerHTML=this.loadTemplate("template-text-input",{id:id,placeholder:"Bitte gebe einen Benutzernamen ein..."});this.addAutocomplete(id,"users");break;case"date":parent.innerHTML=this.loadTemplate("template-date-input",{id:id,max:new Date().toISOString().substr(0,10)});break;case"score":parent.innerHTML=this.loadTemplate("template-number-input",{id:id});break;case"rank":let ranks=[{value:"admin",text:"Admin"},{value:"mod",text:"Moderator"},{value:"altmod",text:"Alt-Mod"},{value:"communityhelfer",text:"Helfer"},{value:"legende",text:"Lebende Legende"},{value:"wichtel",text:"Wichtel"},{value:"pr0mium",text:"Edler Spender"},{value:"schwuchtel",text:"Schwuchtel"},{value:"neuschwuchtel",text:"Neuschwuchtel"},{value:"mittelaltschwuchtel",text:"Mittelaltschwuchtel"},{value:"altschwuchtel",text:"Altschwuchtel"},{value:"ftb",text:"Fliesentischbesitzer"},{value:"banned",text:"Gesperrt"},{value:"userbot",text:"Benutzer-Bot"},{value:"systembot",text:"System-Bot"}];ranks=ranks.map(x=>`<option value="${x.value}">${x.text}</option>`);parent.innerHTML=this.loadTemplate("template-select-input",{id:id,options:ranks});break;case"res":let res=[{value:"2160p",text:"2160p"},{value:"1080p",text:"1080p"},{value:"720p",text:"720p"},{value:"sd",text:"SD"}];res=res.map(x=>`<option value="${x.value}">${x.text}</option>`);parent.innerHTML=this.loadTemplate("template-select-input",{id:id,options:res});break;default:break;}
this.addListeners(id);if(!currentTarget.parentNode.parentNode.nextElementSibling){let newId=parseInt(id)+1;let template=this.tmpl.replaceAll("{:id:}",newId.toString());this.$container.find(".pane").append(template);this.addListeners(newId);}}});p.View.Bookmarklet=p.View.Bookmarklet||{};p.View.Bookmarklet.Layout=p.View.Base.extend({template:'<div id="main-view" class="bookmarklet"></div> ',init:function(container,parent){$('html,body').css('background-color','transparent');this.parent(container,parent);}});p.View.Bookmarklet=p.View.Bookmarklet||{};p.View.Bookmarklet.Login=p.View.Base.extend({template:'<div class="overlay-content"> <div class="bookmarklet-head" style="height:50px;"> <img src="/media/pr0gramm.png" class="bookmarklet-logo"/> </div> <?js if(loginFailed) {?> <?js if(ban && ban.banned) { ?> <p class="warn"> Dein Account ist gesperrt. <?js if(ban.till) {?> Die Sperrung wird am {ban.till.readableTime()} ({ban.till.relativeTime()}) aufgehoben. <?js } else { ?> Die Sperrung ist dauerhaft. <?js } ?> <?js if(ban.reason) {?> <strong>Grund:</strong> {{ban.reason}} <?js } ?> </p> <?js } else { ?> <p class="warn">Falscher Benutzername oder Passwort</p> <?js } ?> <?js } ?> <form> <div class="form-row"> <label>Benutzername:</label> <input type="text" class="text-line" name="name" placeholder="Name" tabindex="201" value="{{name}}"/> </div> <div class="form-row"> <label>Passwort:</label> <input type="password" class="text-line" name="password" placeholder="Passwort" tabindex="202"/> </div> <div class="form-row"> <input type="submit" value="Anmelden" id="login-button" tabindex="203"/> </div> </form> </div> ',data:{ban:null,name:'',loginFailed:false},render:function(){this.parent();this.$container.find('form').submit(this.submit.bind(this));this.focus('input[name=name]');},submit:function(ev){p.user.login(ev.target,this.posted.bind(this));this.data.name=$(ev.target).find('input[name=name]').val();this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){if(response.success){p.navigateToPopStack();}
else{this.data.loginFailed=true;this.data.ban=response.ban;if(this.data.ban&&this.data.ban.till){this.data.ban.till=new Date(this.data.ban.till*1000);}
this.render();}}});(function($){var delimiter=new Array();var tags_callbacks=new Array();$.fn.doAutosize=function(o){var minWidth=$(this).data('minwidth'),maxWidth=$(this).data('maxwidth'),val='',input=$(this),testSubject=$('#'+$(this).data('tester_id'));if(val===(val=input.val())){return;}
var escaped=val.replace(/&/g,'&amp;').replace(/\s/g,' ').replace(/</g,'&lt;').replace(/>/g,'&gt;');testSubject.html(escaped);var testerWidth=testSubject.width(),newWidth=(testerWidth+o.comfortZone)>=minWidth?testerWidth+o.comfortZone:minWidth,currentWidth=input.width(),isValidWidthChange=(newWidth<currentWidth&&newWidth>=minWidth)||(newWidth>minWidth&&newWidth<maxWidth);if(isValidWidthChange){input.width(newWidth);}};$.fn.resetAutosize=function(options){var minWidth=$(this).data('minwidth')||options.minInputWidth||$(this).width(),maxWidth=$(this).data('maxwidth')||options.maxInputWidth||($(this).closest('.tagsinput').width()-options.inputPadding),val='',input=$(this),testSubject=$('<tester/>').css({position:'absolute',top:-9999,left:-9999,width:'auto',fontSize:input.css('fontSize'),fontFamily:input.css('fontFamily'),fontWeight:input.css('fontWeight'),letterSpacing:input.css('letterSpacing'),whiteSpace:'nowrap'}),testerId=$(this).attr('id')+'_autosize_tester';if(!$('#'+testerId).length>0){testSubject.attr('id',testerId);testSubject.appendTo('body');}
input.data('minwidth',minWidth);input.data('maxwidth',maxWidth);input.data('tester_id',testerId);input.css('width',minWidth);};$.fn.addTag=function(value,options){options=jQuery.extend({focus:false,callback:true},options);this.each(function(){var id=$(this).attr('id');var tagslist=$(this).val().split(delimiter[id]);if(tagslist[0]==''){tagslist=new Array();}
value=jQuery.trim(value);if(options.unique){var skipTag=$(this).tagExist(value);if(skipTag==true){$('#'+id+'_tag').addClass('not_valid');}}else{var skipTag=false;}
if(value!=''&&skipTag!=true){$('<span>').addClass('tag').append($('<span>').text(value).append('&nbsp;&nbsp;'),$('<a>',{href:'#',title:'Tag entfernen',text:'×'}).click(function(){return $('#'+id).removeTag(escape(value));})).insertBefore('#'+id+'_addTag');tagslist.push(value);$('#'+id+'_tag').val('');if(options.focus){$('#'+id+'_tag').focus();}else{$('#'+id+'_tag').blur();}
$.fn.tagsInput.updateTagsField(this,tagslist);if(options.callback&&tags_callbacks[id]&&tags_callbacks[id]['onAddTag']){var f=tags_callbacks[id]['onAddTag'];f.call(this,value);}
if(tags_callbacks[id]&&tags_callbacks[id]['onChange'])
{var i=tagslist.length;var f=tags_callbacks[id]['onChange'];f.call(this,$(this),tagslist[i-1]);}}});return false;};$.fn.removeTag=function(value){value=unescape(value);this.each(function(){var id=$(this).attr('id');var old=$(this).val().split(delimiter[id]);$('#'+id+'_tagsinput .tag').remove();var str='';for(var i=0;i<old.length;i++){if(old[i]!=value){str=str+delimiter[id]+old[i];}}
$.fn.tagsInput.importTags(this,str);if(tags_callbacks[id]&&tags_callbacks[id]['onRemoveTag']){var f=tags_callbacks[id]['onRemoveTag'];f.call(this,value);}});return false;};$.fn.tagExist=function(val){var id=$(this).attr('id');var tagslist=$(this).val().split(delimiter[id]);return(jQuery.inArray(val,tagslist)>=0);};$.fn.importTags=function(str){id=$(this).attr('id');$('#'+id+'_tagsinput .tag').remove();$.fn.tagsInput.importTags(this,str);}
$.fn.tagsInput=function(options){var settings=jQuery.extend({interactive:true,defaultText:'add a tag',minChars:0,maxChars:32,width:'300px',height:'100px',autocomplete:{selectFirst:false},hide:true,delimiter:',',unique:true,removeWithBackspace:true,placeholderColor:'#666666',autosize:true,comfortZone:20,inputPadding:6*2},options);this.each(function(){if(settings.hide){$(this).hide();}
var id=$(this).attr('id');if(!id||delimiter[$(this).attr('id')]){id=$(this).attr('id','tags'+new Date().getTime()).attr('id');}
var data=jQuery.extend({pid:id,real_input:'#'+id,holder:'#'+id+'_tagsinput',input_wrapper:'#'+id+'_addTag',fake_input:'#'+id+'_tag'},settings);delimiter[id]=data.delimiter;if(settings.onAddTag||settings.onRemoveTag||settings.onChange){tags_callbacks[id]=new Array();tags_callbacks[id]['onAddTag']=settings.onAddTag;tags_callbacks[id]['onRemoveTag']=settings.onRemoveTag;tags_callbacks[id]['onChange']=settings.onChange;}
var cc=$(this).attr('class');var markup='<div id="'+id+'_tagsinput" class="tagsinput '+cc+'"><div style="float: left;" id="'+id+'_addTag">';if(settings.interactive){markup=markup+'<input id="'+id+'_tag" value="" '+'class="tagsinput-writebox" maxlength="'+settings.maxChars+'" '+'data-default="'+settings.defaultText+'" />';}
markup=markup+'</div><div class="tags_clear"></div></div>';$(markup).insertAfter(this);if($(data.real_input).val()!=''){$.fn.tagsInput.importTags($(data.real_input),$(data.real_input).val());}
if(settings.interactive){$(data.fake_input).val($(data.fake_input).attr('data-default'));$(data.fake_input).addClass('tagsinput-placeholder');$(data.fake_input).resetAutosize(settings);$(data.holder).bind('click',data,function(event){$(event.data.fake_input).focus();});$(data.fake_input).bind('focus',data,function(event){if($(event.data.fake_input).val()==$(event.data.fake_input).attr('data-default')){$(event.data.fake_input).val('');}
$(event.data.fake_input).addClass('active');});if(settings.autocomplete_url!=undefined){autocomplete_options={source:settings.autocomplete_url};for(attrname in settings.autocomplete){autocomplete_options[attrname]=settings.autocomplete[attrname];}
if(jQuery.Autocompleter!==undefined){$(data.fake_input).autocomplete(settings.autocomplete_url,settings.autocomplete);$(data.fake_input).bind('result',data,function(event,data,formatted){if(data){$('#'+id).addTag(data[0]+"",{focus:true,unique:(settings.unique)});}});}else if(jQuery.ui.autocomplete!==undefined){$(data.fake_input).autocomplete(autocomplete_options);$(data.fake_input).bind('autocompleteselect',data,function(event,ui){$(event.data.real_input).addTag(ui.item.value,{focus:true,unique:(settings.unique)});return false;});}}else{$(data.fake_input).bind('blur',data,function(event){var d=$(this).attr('data-default');if($(event.data.fake_input).val()!=''&&$(event.data.fake_input).val()!=d){if((event.data.minChars<=$(event.data.fake_input).val().length)&&(!event.data.maxChars||(event.data.maxChars>=$(event.data.fake_input).val().length)))
$(event.data.real_input).addTag($(event.data.fake_input).val(),{focus:true,unique:(settings.unique)});}else{$(event.data.fake_input).val($(event.data.fake_input).attr('data-default'));$(event.data.fake_input).removeClass('active');}
return false;});}
$(data.fake_input).bind('keypress',data,function(event){if(event.which==event.data.delimiter.charCodeAt(0)||event.which==13){event.preventDefault();if((event.data.minChars<=$(event.data.fake_input).val().length)&&(!event.data.maxChars||(event.data.maxChars>=$(event.data.fake_input).val().length)))
$(event.data.real_input).addTag($(event.data.fake_input).val(),{focus:true,unique:(settings.unique)});$(event.data.fake_input).resetAutosize(settings);return false;}else if(event.data.autosize){$(event.data.fake_input).doAutosize(settings);}});data.removeWithBackspace&&$(data.fake_input).bind('keydown',function(event)
{if(event.keyCode==8&&$(this).val()=='')
{event.preventDefault();var last_tag=$(this).closest('.tagsinput').find('.tag:last').text();var id=$(this).attr('id').replace(/_tag$/,'');last_tag=last_tag.replace(/[\s]+×$/,'');$('#'+id).removeTag(escape(last_tag));$(this).trigger('focus');}});$(data.fake_input).blur();if(data.unique){$(data.fake_input).keydown(function(event){if(event.keyCode==8||String.fromCharCode(event.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){$(this).removeClass('not_valid');}});}}});return this;};$.fn.tagsInput.updateTagsField=function(obj,tagslist){var id=$(obj).attr('id');$(obj).val(tagslist.join(delimiter[id]));};$.fn.tagsInput.importTags=function(obj,val){$(obj).val('');var id=$(obj).attr('id');var tags=val.split(delimiter[id]);for(var i=0;i<tags.length;i++){$(obj).addTag(tags[i],{focus:false,callback:false});}
if(tags_callbacks[id]&&tags_callbacks[id]['onChange'])
{var f=tags_callbacks[id]['onChange'];f.call(obj,obj,tags[i]);}};})(jQuery);p.View.Bookmarklet=p.View.Bookmarklet||{};p.View.Bookmarklet.Post=p.View.Base.extend({template:'<div class="overlay-content"> <div class="bookmarklet-head"> <img src="/media/pr0gramm.png" class="bookmarklet-logo"/> &ndash; Datei hochladen </div> <?js if( posted ) {?> <h2 class="main-message"> Fertig!<br/><br/> <a href="http://{CONFIG.HOST}/new/{item.id}" target="_blank">Gehe zum Post</a> </h2> <?js } else { ?> <?js if( error ) {?> <p class="warn"> <?js if( error === \'invalidType\' ) {?> Ungültiger Dateityp. Nur JPEG, PNG, GIF WebM erlaubt. <?js } else if( error === \'invalid\' ) {?> Bild ist ungültig, zu groß oder zu klein (min. 0,04 Megapixel, max. 16 Megapixel, max. 4MB Dateigröße – WebM nur mit VP8 codec, max. 300sek, keine Audiospur) <?js } else if( error === \'blacklisted\' ) {?> Bild oder Domain gesperrt. <?js } else if( error === \'internal\' ) {?> Interner Fehler bei der Verarbeitung. <?js } else if( error === \'download\' ) {?> Download fehlgeschlagen (4MB max). <?js } else if( error === \'missingData\' ) {?> Kein Bild oder URL angegeben. <?js } ?> </p> <?js } ?> <form id="upload-form"> <input type="hidden" name="imageUrl" value="{{imageUrl}}"/> <input type="hidden" name="siteUrl" value="{{siteUrl}}"/> <div id="upload-preview" style="display:block"> <?js if( params.type == \'video\' ) { ?> <video src="{{imageUrl}}" autoplay loop></video> <?js } else { ?> <img src="{{imageUrl}}"/> <?js } ?> </div> <div id="upload-progress"> <div class="progress-bar"> <div class="progress"></div> </div> </div> <div class="upload-tag-container"> <div class="sfw-status"> <label title="Safe for Work"> <input type="radio" name="sfwstatus" value="sfw"> sfw </label> <label title="Not Safe for Work"> <input type="radio" name="sfwstatus" value="nsfw"> nsfw </label> <label title="Not Safe for Life"> <input type="radio" name="sfwstatus" value="nsfl"> nsfl </label> <label title="Safe for Work aber nur f&uuml;r registrierte Benutzer"> <input type="radio" name="sfwstatus" value="nsfp"> sfw/nsfp </label> </div> <h3>SFW Status und Tags</h3> <input type="text" class="upload-tagsinput" name="tags"/> </div> <div class="upload-similar"></div> <div> <input type="hidden" name="checkSimilar" value="1"/> <input type="submit" class="button" value="Datei Hochladen"/> </div> </form> <div class="post-rules"></div> <?js } ?> </div> ',requiresLogin:true,loginUrl:'bm/login',data:{error:null,posted:false},load:function(){this.data.imageUrl=decodeURIComponent(this.data.params.imageUrl);this.data.siteUrl=decodeURIComponent(this.data.params.siteUrl);return true;},render:function(){this.parent();var that=this;var tags=this.$container.find('.upload-tagsinput');tags.tagsInput(CONFIG.TAGS_INPUT_SETTINGS);this.$container.find('input[name=sfwstatus]').change(function(){that.setSFWTags($(this));});this.$container.find('form').submit(this.submit.bind(this));this.rulesView=new p.View.Rules(this.$container.find('.post-rules'),this);this.rulesView.show();this.filterView=new p.View.Filter(this.$container.find('.post-filter'),this);this.filterView.show();},setSFWTags:function($radio){var tags=this.$container.find('.upload-tagsinput');var status=$radio.val();tags.removeTag('nsfw');tags.removeTag('nsfl');if(status!='sfw'){tags.addTag(status);}},submit:function(ev){if(!this.$container.find('input[name=sfwstatus]:checked').length){this.$container.find('.sfw-status').highlight(252,136,52,1);return false;}
p.api.post('items.post',ev.target,this.posted.bind(this),this.onError.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},posted:function(response){this.data.posted=!response.error;this.data.error=response.error;this.data.selfPosted=!!response.selfPosted;this.data.item=response.item;this.render();if(response.error=='similar'){this.similarView=new p.View.UploadSimilar(this.$container.find('.upload-similar'),this);this.similarView.show(response.similar);this.$container.find('input[name=checkSimilar]').val(0);}},onError:function(response){return p.setView(p.View.Overlay.Error,response.responseJSON);}});p.View.SecretSanta=p.View.Overlay||{};p.View.SecretSanta=p.View.Base.extend({title:"Wichteln",name:'overlay-secretsanta',template:p.load('frontend/templates/secret-santa.html',p.LOAD.LAZY),requiresLogin:true,data:{phase:'running',error:null,checks:null,closed:null,saved:false,isInList:false,firstName:'',lastName:'',street:'',houseNumber:'',packstation:'',zip:'',city:'',country:'',confirmed:0,email:0,wishlist:''},load:function(){p.api.get('secretsanta.info',{},this.loaded.bind(this),this.error.bind(this));if(this.data.params.iap){$('#head').hide();}
return false;},error:function(){this.loaded({error:'notAllowed'});},loaded:function(response){this.data.error=response.error;this.data.checks=response.checks;this.data.closed=response.closed;if(response.entry){this.data=p.merge(this.data,response.entry);this.data.isInList=true;}
this.data.partner=response.partner;this.data.partner2=response.partner2;this.data.entry=response.entry;this.data.phase=response.phase;this.render();},render:function(){this.parent();this.$container.find('#secret-santa-form').submit(this.submit.bind(this));this.$container.find('#secret-santa-statusform').submit(this.update.bind(this));this.$container.find('.secret-santa-delete').click(this.removeList.bind(this));this.$container.find('#secret-santa-message-donor').click(()=>this.message(true));this.$container.find('#secret-santa-message-partner').click(()=>this.message(false));if(this.data.error==='mustAcceptDatasafety'){this.$container.find('#disclaimer').hide();this.$container.find('#terms').show();}else if(this.data.error==='mustAcceptTos'){this.$container.find('#disclaimer').hide();this.$container.find('#terms').show();}else if(this.data.error==='incomplete'){this.$container.find('#disclaimer').hide();this.$container.find('#register').show();}
if(this.data.country){this.$container.find(`.secret-santa-country option[value="${this.data.country}"]`).prop('selected',true);}
this.$container.find('.next-card').click(this.nextCard.bind(this));},nextCard:function(ev){let next=ev.target.dataset.next;let current=ev.target.dataset.current;$('#'+current).fadeOut(200,()=>{$('#'+next).fadeIn();});},update:function(ev){if(this.data.phase=='running '){this.data.sended=this.$container.find('input[name=sended]').val();this.data.received=this.$container.find('input[name=received]').val();this.data.tracking=this.$container.find('input[name=tracking]').val();}
p.api.post('secretsanta.save',ev.target,this.updated.bind(this));this.showLoader();return false;},message:function(toDonor){this.showLoader();let message=this.$container.find('#anon_message').val();let endpoint=(toDonor)?'secretsanta.sendMessageToDonator':'secretsanta.sendMessageToReciever';p.api.post(endpoint,{message:message},(cb)=>{if(cb.send===1){window.location='/inbox/notifications';}else{this.hideLoader();this.$container.find('#message_fail').show();}});},submit:function(ev){if(this.data.phase==='register '||this.data.phase==='confirm'){this.data.firstName=this.$container.find('input[name=firstName]').val();this.data.lastName=this.$container.find('input[name=lastName]').val();this.data.street=this.$container.find('input[name=street]').val();this.data.houseNumber=this.$container.find('input[name=houseNumber]').val();this.data.packstation=this.$container.find('input[name=packstation]').val();this.data.zip=this.$container.find('input[name=zip]').val();this.data.city=this.$container.find('input[name=city]').val();this.data.wishlist=this.$container.find('textarea[name=wishlist]').val();this.data.country=this.$container.find('select[name=country]').val();this.data.email=this.$container.find('input[name=email]').val();}
p.api.post('secretsanta.save',ev.target,this.posted.bind(this));this.$container.find('input[type=submit]').attr('disabled','disabled');this.showLoader();return false;},removeList:function(response){if(confirm('Willst Du Dich wirklich aus der Wichtelliste löschen?')){p.api.post('secretsanta.remove',{},p.reload);}},posted:function(response){this.data.error=response.error;this.data.saved=response.saved;this.render();},updated:function(response){$('#update').show();this.$container.find('input[type=submit]').prop('disabled',false);this.hideLoader();}});p.api=new p.ServerAPI(CONFIG.API.ENDPOINT);p.user=new p.User();p.hotkeys=new p.Hotkeys($(document));p.mainView=null;if(p.getLocation().match(/^newest/)){document.location='/';}
if(p.getLocation().match(/^tv/)){p.mainView=new p.View.TV.Layout('body');p.addRoute(p.View.TV.Channel,'tv');}
else if(p.getLocation().match(/^bm\//)){p.mainView=new p.View.Bookmarklet.Layout('body');p.addRoute(p.View.Bookmarklet.Login,'bm/login');p.addRoute(p.View.Bookmarklet.Post,'bm/post/<type>/<siteUrl>/<imageUrl>');}
else{p.mainView=new p.View.Layout('body');p.addRoute(p.View.Stream.Main,'');p.addRoute(p.View.Stream.Main,'<tab:top|new|stalk>');p.addRoute(p.View.Stream.Main,'<tab:top|new|stalk>/<itemId:d>');p.addRoute(p.View.Stream.Main,'<tab:top|new>/<tags>');p.addRoute(p.View.Stream.Main,'<tab:top|new>/<tags>/<itemId:d>');p.addRoute(p.View.ResetPassword,'user/<name>/resetpass/<token>');p.addRoute(p.View.Validate,'user/<name>/validate/<token>');p.addRoute(p.View.ValidateInfo,'user/<name>/validate');p.addRoute(p.View.User.CommentLikes,'user/<name>/comments/likes/<search:after|before>/<timestamp:d>');p.addRoute(p.View.User.Comments,'user/<name>/comments/<search:after|before>/<timestamp:d>');p.addRoute(p.View.Stream.Main,'user/<userName>/<userTab>');p.addRoute(p.View.Stream.Main,'user/<userName>/<userTab>/<itemId:d>');p.addRoute(p.View.Stream.Main,'user/<userName>/<userTab>/<tags>');p.addRoute(p.View.Stream.Main,'user/<userName>/<userTab>/<tags>/<itemId:d>');p.addRoute(p.View.User,'user/<name>');p.addRoute(p.View.InboxGeneric,'inbox/<tab:all|comments|notifications|follows>');p.addRoute(p.View.InboxBlockList,'inbox/blocklist');p.addRoute(p.View.InboxMessages,'inbox/messages');p.addRoute(p.View.InboxMessages,'inbox/messages/<with>');p.addRoute(p.View.FollowList,'stalk/list/<sort:stalk-date|post-date>');p.addRoute(p.View.Settings,'settings/account/mail/<token>');p.addRoute(p.View.Settings,'settings/<tab:bookmarklet|site|account|invites>');p.addRoute(p.View.Upload,'upload');p.addRoute(p.View.Scheduled,'scheduled');p.addRoute(p.View.Stats,'userstats');p.addRoute(p.View.Contact,'contact');p.addRoute(p.View.RegisterInvite,'register/<token>');p.addRoute(p.View.RedeemThanks,'redeem/thanks');p.addRoute(p.View.RedeemRegistered,'redeem/registered');p.addRoute(p.View.RedeemCode,'redeem');p.addRoute(p.View.RedeemCode,'redeem/<token>');p.addRoute(p.View.BuyCode.PaypalThanks,'pr0mium/thanks');p.addRoute(p.View.BuyCode.SubscriptionThanks,'pr0mium/subscriptions-thanks');p.addRoute(p.View.BuyCode.GifThanks,'pr0mium/gift-thanks');p.addRoute(p.View.BuyCode.Products,'pr0mium');p.addRoute(p.View.BuyCode.Products,'pr0mium/<user:user>');p.addRoute(p.View.BuyCode.Products,'pr0mium/<user:user>/<post:post>');p.addRoute(p.View.BuyCode.Products,'pr0mium/<iap:iap>');p.addRoute(p.View.RedeemShopCoupon,'code');p.addRoute(p.View.FAQ,'faq');p.addRoute(p.View.FAQ,'faq/<category>');p.addRoute(p.View.FAQ,'faq/<category>/<article>');p.addRoute(p.View.Auth,'auth');p.addRoute(p.View.Auth,'auth/<name>/<state>');p.addRoute(p.View.Imprint,'imprint');p.addRoute(p.View.Imprint,'disclaimer');p.addRoute(p.View.Datasafety,'datasafety');p.addRoute(p.View.TOS,'tos');p.addRoute(p.View.Changes,'changelog');p.addRoute(p.View.Discord,'discord');p.addRoute(p.View.Search,'search');p.addRoute(p.View.Overlay.ResetPassword,'resetpassword');p.addRoute(p.View.SecretSanta,'secret-santa');p.addRoute(p.View.SecretSanta,'secret-santa/<iap:iap>');p.addRoute(p.View.CancerDonations,'donations');p.addRoute(p.View.CancerDonations,'donations/<iap:iap>');p.addRoute(p.View.Games.Casino,'casino');p.addRoute(p.View.Games.Slots,'casino/slots');p.addRoute(p.View.Games.Roulette,'casino/roulette');p.addRoute(p.View.Games.BlackJack,'casino/blackjack');}
p.addRoute(p.View.Error404,'*');p.mainView.show();p.start('#main-view');if(CONFIG.ANALYTICS.ENABLED){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName('head')[0];a.async=1;a.src=g;m.appendChild(a)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create',CONFIG.ANALYTICS.ACCOUNT,'auto');ga('set','dimension1',(p.user.id?'yes':'no'));ga('set','dimension2',p.user.flagsName);ga('set','anonymizeIp',true);ga('send','pageview',{page:p.getLocation()});}

